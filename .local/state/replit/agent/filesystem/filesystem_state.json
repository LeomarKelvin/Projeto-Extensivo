{"file_contents":{"backend/src/controllers/perfilController.js":{"content":"const { supabase, supabaseAdmin } = require('../config/supabaseClient');\n\nasync function criarPerfil(req, res) {\n    const { email, password, nome, tipo, nome_loja } = req.body;\n\n    if (!email || !password || !nome || !tipo) {\n        return res.status(400).json({ error: 'Todos os campos são obrigatórios' });\n    }\n\n    if (tipo.toLowerCase() === 'loja' && !nome_loja) {\n        return res.status(400).json({ error: 'O nome da loja é obrigatório para o tipo de perfil Loja.' });\n    }\n\n    // Etapa 1: Cria o usuário na autenticação\n    const { data: authData, error: authError } = await supabase.auth.signUp({\n        email: email,\n        password: password,\n        options: {\n            data: {\n                // O metadata pode ter o nome que quisermos, mas nome_completo é mais descritivo\n                nome_completo: nome \n            }\n        }\n    });\n\n    if (authError) {\n        return res.status(400).json({ error: authError.message });\n    }\n\n    if (!authData.user) {\n        return res.status(500).json({ error: 'Não foi possível criar o usuário na autenticação.' });\n    }\n    const userId = authData.user.id;\n\n    try {\n        // --- Etapa 2: Inserir o perfil na tabela 'perfis' ---\n        const { data: perfilData, error: perfilError } = await supabaseAdmin\n            .from('perfis')\n            .insert({ \n                user_id: userId, \n                email, \n                nome_completo: nome, // CORREÇÃO 1: Usando a coluna correta 'nome_completo'\n                tipo: tipo.toLowerCase() \n            })\n            .select()\n            .single();\n        \n        if (perfilError) throw perfilError;\n\n        // --- Etapa 3: Se o usuário for do tipo 'loja', criar a loja ---\n        if (perfilData.tipo === 'loja') {\n            // CORREÇÃO 2: Usando a coluna correta 'nome_loja'\n            const { error: lojaError } = await supabaseAdmin\n                .from('lojas')\n                .insert({\n                    nome_loja: nome_loja,\n                    user_id: userId,\n                    perfil_id: perfilData.id\n                });\n\n            if (lojaError) throw lojaError;\n        }\n\n        res.status(201).json({ message: 'Usuário e Loja cadastrados com sucesso!', data: authData });\n\n    } catch (error) {\n        console.error('Erro no processo de criação de perfil/loja:', error);\n        await supabaseAdmin.auth.admin.deleteUser(userId);\n        res.status(500).json({ error: 'Ocorreu um erro crítico ao registrar seu perfil. O usuário foi removido.' });\n    }\n}\n\n\n// As funções 'login' e 'getPerfil' não precisam de alteração\nasync function login(req, res) {\n    const { email, password } = req.body;\n    if (!email || !password) return res.status(400).json({ error: 'Email e senha são obrigatórios.' });\n\n    try {\n        const { data: sessionData, error: authError } = await supabase.auth.signInWithPassword({ email, password });\n        if (authError) return res.status(401).json({ error: \"E-mail ou senha inválidos.\" });\n\n        const { data: perfilData, error: perfilError } = await supabase\n            .from('perfis').select('*').eq('user_id', sessionData.user.id).single();\n        if (perfilError || !perfilData) return res.status(404).json({ error: 'Perfil do usuário não encontrado.' });\n\n        res.status(200).json({\n            message: 'Login bem-sucedido!',\n            user: sessionData.user,\n            session: sessionData.session,\n            perfil: perfilData\n        });\n    } catch (error) {\n        res.status(500).json({ error: 'Erro interno do servidor.' });\n    }\n}\n\nasync function getPerfil(req, res) {\n    const userId = req.user.id;\n    if (!userId) return res.status(400).json({ error: 'ID do usuário não fornecido.' });\n\n    try {\n        const { data, error } = await supabase.from('perfis').select('*').eq('user_id', userId).single();\n        if (error) throw error;\n        res.status(200).json(data);\n    } catch (error) {\n        res.status(500).json({ error: 'Erro ao buscar perfil.' });\n    }\n}\n\nmodule.exports = {\n    criarPerfil,\n    login,\n    getPerfil,\n};","size_bytes":4104},"frontend/js/app.js":{"content":"function adicionarAoCarrinho(nomeDoProduto, precoDoProduto, lojaId) {\n    let carrinho = JSON.parse(localStorage.getItem('carrinho')) || [];\n\n    // LÓGICA ATUALIZADA: Chama o novo modal\n    if (carrinho.length > 0 && carrinho[0].lojaId !== lojaId) {\n        \n        const onConfirmAction = () => {\n            // Esta é a ação que acontece se o usuário clicar em \"Sim\"\n            carrinho = []; // Esvazia o carrinho\n            carrinho.push({\n                nome: nomeDoProduto,\n                preco: precoDoProduto,\n                quantidade: 1,\n                lojaId: lojaId\n            });\n            localStorage.setItem('carrinho', JSON.stringify(carrinho));\n            updateHeader();\n            showToast('Carrinho esvaziado', 'Um novo carrinho foi criado com o item da nova loja.');\n        };\n\n        // Mostra o modal personalizado\n        showConfirmationModal(\n            'Trocar de Loja?',\n            'Seu carrinho contém itens de outra loja. Deseja limpá-lo para adicionar este novo item?',\n            onConfirmAction\n        );\n\n    } else {\n        // Se o carrinho está vazio ou o item é da mesma loja, adiciona normalmente\n        let itemExistente = carrinho.find(item => item.nome === nomeDoProduto);\n        if (itemExistente) {\n            itemExistente.quantidade++;\n        } else {\n            carrinho.push({\n                nome: nomeDoProduto,\n                preco: precoDoProduto,\n                quantidade: 1,\n                lojaId: lojaId\n            });\n        }\n        localStorage.setItem('carrinho', JSON.stringify(carrinho));\n        showToast('Carrinho', `${nomeDoProduto} foi adicionado com sucesso!`);\n        updateHeader();\n    }\n}","size_bytes":1702},"frontend/js/pedidos.js":{"content":"// frontend/js/pedidos.js\n\nimport { fetchPedidos } from './api/pedidosApi.js';\n\n// Função que define a cor e o ícone do status do pedido\nfunction getStatusInfo(status) {\n    switch (status) {\n        case 'Entregue':\n            return {\n                badgeClass: 'status-delivered',\n                icon: `<svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-4 w-4 mr-1\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"></path></svg>`\n            };\n        case 'Em processamento':\n            return {\n                badgeClass: 'status-processing',\n                icon: `<svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-4 w-4 mr-1 animate-spin\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 4v5h5M4 12a8 8 0 018-8v0a8 8 0 018 8v0a8 8 0 01-8 8h-4m-4 0H4m0 0v5h5\"></path></svg>`\n            };\n        case 'Cancelado':\n            return {\n                badgeClass: 'status-canceled',\n                icon: `<svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-4 w-4 mr-1\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path></svg>`\n            };\n        default: // Pendente ou outros status\n            return {\n                badgeClass: 'status-pending',\n                icon: `<svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-4 w-4 mr-1\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"></path></svg>`\n            };\n    }\n}\n\n// Função que cria o HTML para um único card de pedido, USANDO O SEU DESIGN\nfunction criarCardPedido(pedido) {\n    const dataPedido = new Date(pedido.created_at).toLocaleDateString('pt-BR', { day: '2-digit', month: 'long', year: 'numeric' });\n    const { badgeClass, icon } = getStatusInfo(pedido.status || 'Pendente');\n\n    // Supondo que você terá uma forma de buscar o nome e a imagem da loja\n    const nomeLoja = \"Nome da Loja\"; // Substituir com dados reais no futuro\n    const imagemLoja = \"https://placehold.co/100x100\"; // Substituir com dados reais no futuro\n\n    return `\n    <div class=\"order-card bg-white rounded-xl shadow-md p-6 fade-in cursor-pointer\">\n        <div class=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\n            <div class=\"flex items-center\">\n                <img src=\"${imagemLoja}\" alt=\"Logo da ${nomeLoja}\" class=\"store-logo mr-4\">\n                <div>\n                    <h2 class=\"font-bold text-lg text-gray-800\">${nomeLoja}</h2>\n                    <p class=\"text-sm text-gray-500\">Pedido #${pedido.id}</p>\n                </div>\n            </div>\n\n            <div class=\"flex-grow flex items-center justify-between md:justify-start space-x-4\">\n                 <div>\n                    <p class=\"text-sm text-gray-500\">Data</p>\n                    <p class=\"font-medium text-gray-800\">${dataPedido}</p>\n                </div>\n                <div>\n                    <p class=\"text-sm text-gray-500\">Total</p>\n                    <p class=\"font-medium text-gray-800\">R$ ${pedido.total.toFixed(2).replace('.', ',')}</p>\n                </div>\n                 <div>\n                    <p class=\"text-sm text-gray-500\">Status</p>\n                    <span class=\"status-badge ${badgeClass} flex items-center\">\n                        ${icon}\n                        ${pedido.status || 'Pendente'}\n                    </span>\n                </div>\n            </div>\n\n            <div class=\"flex gap-3 mt-4 md:mt-0\">\n                <button class=\"btn-primary flex-1 md:flex-none px-4 py-2 rounded-lg font-medium text-sm\">\n                    Ver Detalhes\n                </button>\n                <button class=\"btn-outline flex-1 md:flex-none px-4 py-2 rounded-lg font-medium text-sm\">\n                    Ajuda\n                </button>\n            </div>\n        </div>\n    </div>\n  `;\n}\n\n// Função principal que carrega e exibe os pedidos\nasync function carregarPedidos() {\n    const container = document.getElementById('pedidos-container');\n    if (!container) {\n        console.error('O elemento com ID \"pedidos-container\" não foi encontrado no seu HTML.');\n        return;\n    }\n\n    container.innerHTML = '<p class=\"text-center text-gray-500\">Buscando seus pedidos...</p>';\n\n    const pedidos = await fetchPedidos();\n\n    if (pedidos.length === 0) {\n        container.innerHTML = `\n            <div class=\"text-center py-12\">\n                <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"mx-auto h-16 w-16 text-gray-300\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01\" />\n                </svg>\n                <h2 class=\"mt-2 text-xl font-medium text-gray-800\">Nenhum pedido encontrado</h2>\n                <p class=\"mt-1 text-gray-500\">Parece que você ainda não fez nenhum pedido. Que tal explorar algumas lojas?</p>\n                <button class=\"btn-primary mt-6 px-6 py-2 rounded-lg font-medium\" onclick=\"window.location.href='/frontend/Lojas.html'\">\n                    Ver Lojas\n                </button>\n            </div>\n        `;\n        return;\n    }\n\n    container.innerHTML = ''; // Limpa a mensagem de \"buscando\"\n    pedidos.forEach(pedido => {\n        const cardHtml = criarCardPedido(pedido);\n        container.innerHTML += cardHtml;\n    });\n}\n\n// Inicia o processo quando a página é carregada\ndocument.addEventListener('DOMContentLoaded', carregarPedidos);","size_bytes":5867},"frontend/js/Perfil.js":{"content":"// frontend/js/Perfil.js\n\nimport { fetchPerfil, updatePerfil } from './api/perfilApi.js';\n\n// Função para preencher os campos do formulário com os dados do usuário\nfunction preencherFormulario(profile) {\n    if (!profile) return;\n    \n    // Pega os elementos do HTML\n    const profileNameElement = document.getElementById('profile-name');\n    const profileEmailElement = document.getElementById('profile-email');\n    const nameInputElement = document.getElementById('name');\n    const emailInputElement = document.getElementById('email');\n    const phoneInputElement = document.getElementById('phone');\n    const cpfInputElement = document.getElementById('cpf');\n    const birthdateInputElement = document.getElementById('birthdate');\n\n    // Preenche os dados no cabeçalho do perfil e no formulário\n    if (profileNameElement) profileNameElement.textContent = profile.nome_completo || 'Usuário';\n    if (profileEmailElement) profileEmailElement.textContent = profile.email || '...';\n    if (nameInputElement) nameInputElement.value = profile.nome_completo || '';\n    if (emailInputElement) emailInputElement.value = profile.email || '';\n    if (phoneInputElement) phoneInputElement.value = profile.telefone || '';\n    if (cpfInputElement) cpfInputElement.value = profile.cpf || '';\n    if (birthdateInputElement && profile.data_nascimento) {\n        birthdateInputElement.value = profile.data_nascimento.split('T')[0]; // Formata a data para YYYY-MM-DD\n    }\n}\n\n// Função para lidar com o envio do formulário\nasync function handleSalvarPerfil(event) {\n    event.preventDefault(); // Impede o recarregamento da página\n\n    const profileData = {\n        nome_completo: document.getElementById('name').value,\n        telefone: document.getElementById('phone').value,\n        // Adicione outros campos que você queira atualizar\n    };\n\n    console.log(\"Enviando para atualização:\", profileData);\n    const result = await updatePerfil(profileData);\n\n    if (result && !result.error) {\n        alert('Perfil atualizado com sucesso!');\n        // Opcional: atualiza o nome no topo da página\n        const profileNameElement = document.getElementById('profile-name');\n        if (profileNameElement) profileNameElement.textContent = result.profile.nome_completo;\n    } else {\n        alert('Erro ao atualizar o perfil. Tente novamente.');\n    }\n}\n\n// Função principal que é executada quando a página carrega\nasync function setupPaginaPerfil() {\n    const profile = await fetchPerfil();\n\n    if (profile) {\n        preencherFormulario(profile);\n    } else {\n        // Se não conseguir buscar o perfil, talvez o usuário não esteja logado\n        alert('Você precisa estar logado para ver seu perfil.');\n        window.location.href = '/frontend/Clientes/login.html';\n        return;\n    }\n\n    // Adiciona o evento de clique ao botão de salvar do formulário\n    const form = document.querySelector('#dados-pessoais form');\n    if (form) {\n        form.addEventListener('submit', handleSalvarPerfil);\n    }\n\n    // Lógica para as abas (Perfil, Endereços, etc.)\n    const tabs = document.querySelectorAll('.tab');\n    const tabContents = document.querySelectorAll('.tab-content');\n\n    tabs.forEach(tab => {\n        tab.addEventListener('click', () => {\n            // Remove a classe 'active' de todas as abas e esconde todos os conteúdos\n            tabs.forEach(t => t.classList.remove('active'));\n            tabContents.forEach(c => c.style.display = 'none');\n\n            // Adiciona 'active' na aba clicada e mostra o conteúdo correspondente\n            tab.classList.add('active');\n            const target = document.querySelector(tab.dataset.target);\n            if (target) {\n                target.style.display = 'block';\n            }\n        });\n    });\n}\n\n// Inicia tudo\ndocument.addEventListener('DOMContentLoaded', setupPaginaPerfil);","size_bytes":3872},"backend/src/index.js":{"content":"require('dotenv').config();\nconst express = require('express');\nconst cors = require('cors');\nconst path = require('path');\n\n// Importação das rotas\nconst perfilRoutes = require('./routes/perfil');\nconst lojasRoutes = require('./routes/lojas');\nconst pedidosRoutes = require('./routes/pedidos');\nconst lojaDashboardRoutes = require('./routes/lojaDashboard');\n\nconst app = express();\nconst PORT = process.env.PORT || 5000;\n\nconst corsOptions = {\n  origin: '*',\n  methods: 'GET,HEAD,PUT,PATCH,POST,DELETE',\n  preflightContinue: false,\n  optionsSuccessStatus: 204\n};\n\napp.use(cors(corsOptions));\napp.options('*', cors(corsOptions));\n\napp.use(express.json());\n\napp.use('/api/perfil', perfilRoutes);\napp.use('/api/lojas', lojasRoutes);\napp.use('/api/pedidos', pedidosRoutes);\napp.use('/api/dashboard/loja', lojaDashboardRoutes);\n\napp.use('/frontend', express.static(path.join(__dirname, '../../frontend')));\napp.use('/loja-frontend', express.static(path.join(__dirname, '../../loja-frontend')));\n\napp.get('/', (req, res) => {\n  res.sendFile(path.join(__dirname, '../../frontend/Clientes/Inicio.html'));\n});\n\napp.listen(PORT, '0.0.0.0', () => {\n  console.log(`Servidor rodando em 0.0.0.0:${PORT}`);\n});","size_bytes":1198},"backend/src/controllers/lojaController.js":{"content":"const supabase = require('../config/supabaseClient');\n\nconst buscarLojas = async (req, res) => {\n    try {\n        const { data, error } = await supabase\n            .from('lojas')\n            .select('*');\n\n        if (error) {\n            throw error;\n        }\n\n        res.status(200).json(data);\n    } catch (error) {\n        res.status(500).json({ error: 'Erro ao buscar lojas.' });\n    }\n};\n\nmodule.exports = {\n    buscarLojas,\n};","size_bytes":437},"backend/src/controllers/lojaDashboardController.js":{"content":"const { supabase } = require('../config/supabaseClient');\n\n\nconst getDashboardStats = async (req, res) => {\n    const perfilId = req.perfil.id;\n    try {\n        const { data: lojaData, error: lojaError } = await supabase\n            .from('lojas')\n            .select('id, nota_avaliacao')\n            .eq('perfil_id', perfilId)\n            .single();\n\n        if (lojaError || !lojaData) {\n            return res.status(404).json({ error: 'Nenhuma loja encontrada para este perfil.' });\n        }\n        const lojaId = lojaData.id;\n\n        const { data: pedidos, error: pedidosError } = await supabase\n            .from('pedidos')\n            .select('valor_total, user_id, status')\n            .eq('loja_id', lojaId);\n\n        if (pedidosError) throw pedidosError;\n\n        const totalPedidos = pedidos.length;\n        const faturamento = pedidos\n            .filter(p => p.status === 'Entregue')\n            .reduce((acc, pedido) => acc + (pedido.valor_total || 0), 0);\n        const novosClientes = new Set(pedidos.map(p => p.user_id)).size;\n        const avaliacaoMedia = lojaData.nota_avaliacao || 0;\n\n        res.status(200).json({\n            totalPedidos,\n            faturamento,\n            novosClientes,\n            avaliacaoMedia\n        });\n    } catch (error) {\n        res.status(500).json({ error: 'Erro ao buscar estatísticas: ' + error.message });\n    }\n};\n\n// Função para o gráfico de vendas (Corrigida)\nconst getSalesChartData = async (req, res) => {\n    const perfilId = req.perfil.id;\n    const period = req.query.period || '7d';\n\n    try {\n        const { data: lojaData, error: lojaError } = await supabase\n            .from('lojas')\n            .select('id')\n            .eq('perfil_id', perfilId)\n            .single();\n\n        if (lojaError || !lojaData) {\n            return res.status(404).json({ error: 'Nenhuma loja encontrada para este perfil.' });\n        }\n        const lojaId = lojaData.id;\n\n        const hoje = new Date();\n        let dataInicio = new Date();\n\n        switch (period) {\n            case 'today':\n                dataInicio.setHours(0, 0, 0, 0);\n                break;\n            case '30d':\n                dataInicio.setDate(hoje.getDate() - 30);\n                break;\n            case '7d':\n            default:\n                dataInicio.setDate(hoje.getDate() - 7);\n                break;\n        }\n\n        const { data: pedidos, error: pedidosError } = await supabase\n            .from('pedidos')\n            .select('valor_total, created_at')\n            .eq('loja_id', lojaId)\n            .eq('status', 'Entregue')\n            .gte('created_at', dataInicio.toISOString());\n\n        if (pedidosError) throw pedidosError;\n\n        const vendasPorDia = {};\n        const numeroDeDias = period === 'today' ? 1 : (period === '30d' ? 30 : 7);\n\n        for (let i = numeroDeDias - 1; i >= 0; i--) {\n            const d = new Date();\n            d.setDate(hoje.getDate() - i);\n            const diaFormatado = d.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' });\n            vendasPorDia[diaFormatado] = 0;\n        }\n\n        pedidos.forEach(pedido => {\n            const dataPedido = new Date(pedido.created_at);\n            const diaFormatado = dataPedido.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' });\n            if (vendasPorDia.hasOwnProperty(diaFormatado)) {\n                vendasPorDia[diaFormatado] += (pedido.valor_total || 0);\n            }\n        });\n\n        const labels = Object.keys(vendasPorDia);\n        const data = Object.values(vendasPorDia);\n\n        res.status(200).json({ labels, data });\n    } catch (error) {\n        res.status(500).json({ error: 'Erro ao buscar dados do gráfico: ' + error.message });\n    }\n};\n\nconst getRecentOrders = async (req, res) => {\n    const lojaId = req.user.id;\n\n    try {\n        // Consulta corrigida para corresponder à sua tabela\n        const { data, error } = await supabase\n            .from('pedidos')\n            .select(`\n                id,\n                created_at,\n                valor_total,\n                status,\n                perfis ( nome_completo ) \n            `)\n            .eq('loja_id', lojaId)\n            .order('created_at', { ascending: false })\n            .limit(5);\n\n        if (error) {\n            console.error('Erro na consulta de pedidos recentes do Supabase:', error);\n            throw error;\n        }\n\n        res.status(200).json(data);\n\n    } catch (error) {\n        res.status(500).json({\n            error: 'Erro interno do servidor ao buscar pedidos recentes.',\n            details: error.message\n        });\n    }\n};\n\nconst getProdutosMaisVendidos = async (req, res) => {\n    // Este é o ID da autenticação, do tipo UUID\n    const lojaAuthId = req.user.id;\n\n    try {\n        // Passo 1: Encontrar o ID numérico do perfil usando o UUID da autenticação.\n        const { data: perfil, error: perfilError } = await supabase\n            .from('perfis')\n            .select('id')\n            .eq('user_id', lojaAuthId)\n            .single();\n\n        if (perfilError) throw new Error('Erro ao buscar perfil da loja.');\n        if (!perfil) return res.status(404).json({ error: 'Perfil da loja não encontrado.' });\n\n        const perfilId = perfil.id; // ID numérico do perfil\n\n        // Passo 2: Usar o ID do perfil para encontrar o ID numérico da loja.\n        const { data: loja, error: lojaError } = await supabase\n            .from('lojas')\n            .select('id')\n            .eq('perfil_id', perfilId)\n            .single();\n\n        if (lojaError) throw new Error('Erro ao buscar dados da loja.');\n        if (!loja) return res.status(404).json({ error: 'Loja não encontrada para este perfil.' });\n\n        const lojaNumericId = loja.id; // ID numérico final da loja\n\n        // Passo 3: Usar o ID numérico da loja para buscar os pedidos.\n        const { data: pedidos, error: pedidosError } = await supabase\n            .from('pedidos')\n            .select('id')\n            .eq('loja_id', lojaNumericId)\n            .eq('status', 'Entregue');\n\n        if (pedidosError) throw new Error('Erro ao buscar pedidos da loja.');\n        if (!pedidos || pedidos.length === 0) {\n            return res.status(200).json([]); // Nenhum pedido entregue, retorna lista vazia.\n        }\n\n        const pedidoIds = pedidos.map(p => p.id);\n\n        // Passo 4: Buscar todos os itens desses pedidos\n        const { data: itens, error: itensError } = await supabase\n            .from('pedido_itens')\n            .select('nome_produto, quantidade')\n            .in('pedido_id', pedidoIds);\n\n        if (itensError) throw new Error('Erro ao buscar itens dos pedidos.');\n\n        // Passo 5: Contar os produtos em JavaScript (esta parte continua igual)\n        const salesCount = {};\n        for (const item of itens) {\n            salesCount[item.nome_produto] = (salesCount[item.nome_produto] || 0) + item.quantidade;\n        }\n\n        // Passo 6: Formatar e ordenar os resultados\n        const sortedProducts = Object.entries(salesCount)\n            .map(([nome, total]) => ({ nome_produto: nome, total_vendido: total }))\n            .sort((a, b) => b.total_vendido - a.total_vendido);\n\n        const top5Products = sortedProducts.slice(0, 5);\n\n        res.status(200).json(top5Products);\n\n    } catch (error) {\n        console.error('Erro ao calcular produtos mais vendidos:', error.message);\n        res.status(500).json({ error: 'Erro interno ao processar a requisição.' });\n    }\n};\n\nconst getAvaliacoesRecentes = async (req, res) => {\n    // O ID do usuário logado (loja) é um UUID\n    const lojaAuthId = req.user.id;\n\n    try {\n        // Passo 1: Encontrar o ID numérico do perfil da loja\n        const { data: perfil, error: perfilError } = await supabase\n            .from('perfis')\n            .select('id')\n            .eq('user_id', lojaAuthId)\n            .single();\n\n        if (perfilError) throw new Error(`Erro ao buscar perfil da loja: ${perfilError.message}`);\n        if (!perfil) return res.status(404).json({ error: 'Perfil da loja não encontrado.' });\n\n        const perfilId = perfil.id;\n\n        // Passo 2: Encontrar o ID numérico da loja\n        const { data: loja, error: lojaError } = await supabase\n            .from('lojas')\n            .select('id')\n            .eq('perfil_id', perfilId)\n            .single();\n\n        if (lojaError) throw new Error(`Erro ao buscar dados da loja: ${lojaError.message}`);\n        if (!loja) return res.status(404).json({ error: 'Loja não encontrada para este perfil.' });\n\n        const lojaNumericId = loja.id;\n\n        // Passo 3: Buscar as últimas 3 avaliações da loja\n        const { data: avaliacoes, error: avaliacoesError } = await supabase\n            .from('avaliacoes')\n            .select('*')\n            .eq('loja_id', lojaNumericId)\n            .order('created_at', { ascending: false })\n            .limit(3);\n\n        if (avaliacoesError) throw new Error(`Erro ao buscar avaliações: ${avaliacoesError.message}`);\n        if (avaliacoes.length === 0) {\n            return res.status(200).json([]);\n        }\n\n        // Passo 4: Coletar os IDs dos clientes que fizeram as avaliações\n        const clienteUserIds = avaliacoes.map(a => a.user_id);\n\n        // Passo 5: Buscar os perfis (nomes) desses clientes\n        const { data: perfis, error: perfisError } = await supabase\n            .from('perfis')\n            .select('user_id, nome_completo')\n            .in('user_id', clienteUserIds);\n\n        if (perfisError) throw new Error(`Erro ao buscar perfis dos clientes: ${perfisError.message}`);\n\n        // Passo 6: Criar um mapa para facilitar a busca (id -> nome)\n        const perfisMap = new Map(perfis.map(p => [p.user_id, p]));\n\n        // Passo 7: Juntar as avaliações com os nomes dos clientes\n        const resultadoFinal = avaliacoes.map(avaliacao => ({\n            ...avaliacao,\n            cliente: perfisMap.get(avaliacao.user_id) || { nome_completo: 'Cliente Anônimo' }\n        }));\n\n        res.status(200).json(resultadoFinal);\n\n    } catch (error) {\n        console.error('Erro no controller de avaliações:', error.message);\n        res.status(500).json({ error: 'Erro interno ao processar a requisição.' });\n    }\n};\n\nconst getProdutosDaLoja = async (req, res) => {\n    const { loja_id } = req; // Usando o loja_id injetado pelo authMiddleware\n    try {\n        // Ajuste para buscar o nome da categoria junto com o produto\n        const { data, error } = await supabase\n            .from('produtos')\n            .select(`*, categorias(nome_categoria)`)\n            .eq('loja_id', loja_id)\n            .order('nome', { ascending: true });\n        if (error) throw error;\n        res.status(200).json(data);\n    } catch (error) {\n        res.status(500).json({ message: \"Erro ao buscar produtos.\", error: error.message });\n    }\n};\n\nconst adicionarProduto = async (req, res) => {\n    const { loja_id } = req;\n    const { nome, descricao, preco, categoria_id } = req.body; \n    try {\n        let imagem_url = null;\n        if (req.file) {\n            // Sua lógica de upload de imagem\n        }\n        const { data, error } = await supabase.from('produtos').insert([{ nome, descricao, preco, loja_id, categoria_id: parseInt(categoria_id) || null, imagem_url }]).select();\n        if (error) throw error;\n        res.status(201).json({ message: \"Produto adicionado com sucesso!\", produto: data });\n    } catch (error) {\n        res.status(500).json({ message: \"Erro ao adicionar produto.\", error: error.message });\n    }\n};\n\nconst editarProduto = async (req, res) => {\n    const { loja_id } = req;\n    const { id } = req.params;\n    const { nome, descricao, preco, categoria_id } = req.body;\n    try {\n        const { data, error } = await supabase.from('produtos').update({ nome, descricao, preco, categoria_id: parseInt(categoria_id) || null }).match({ id, loja_id }).select().single();\n        if (error) throw error;\n        res.status(200).json(data);\n    } catch (error) {\n        res.status(500).json({ message: \"Erro ao editar produto.\", error: error.message });\n    }\n};\n\nconst deletarProduto = async (req, res) => {\n    const { loja_id } = req;\n    const { id } = req.params;\n    try {\n        const { error } = await supabase.from('produtos').delete().match({ id, loja_id });\n        if (error) throw error;\n        res.status(204).send();\n    } catch (error) {\n        res.status(500).json({ message: \"Erro ao deletar produto.\", error: error.message });\n    }\n};\n\n// --- FUNÇÕES DE CATEGORIAS (Novas) ---\n\nconst obterCategorias = async (req, res) => {\n    const { loja_id } = req;\n    try {\n        const { data, error } = await supabase.from('categorias').select('id, nome_categoria').eq('loja_id', loja_id).order('nome_categoria');\n        if (error) throw error;\n        res.status(200).json(data);\n    } catch (error) {\n        res.status(500).json({ message: \"Erro ao buscar categorias.\", error: error.message });\n    }\n};\n\nconst adicionarCategoria = async (req, res) => {\n    const { loja_id } = req;\n    const { nome_categoria } = req.body;\n    if (!nome_categoria) return res.status(400).json({ message: 'O nome da categoria é obrigatório.' });\n    try {\n        const { data, error } = await supabase.from('categorias').insert([{ nome_categoria: nome_categoria.trim(), loja_id }]).select().single();\n        if (error) throw error;\n        res.status(201).json({ message: 'Categoria criada com sucesso!', categoria: data });\n    } catch (error) {\n        if (error.code === '23505') return res.status(409).json({ message: 'Essa categoria já existe.' });\n        res.status(500).json({ message: 'Erro ao criar categoria.', error: error.message });\n    }\n};\n\nconst excluirCategoria = async (req, res) => {\n    const { loja_id } = req;\n    const { id } = req.params;\n    try {\n        await supabase.from('produtos').update({ categoria_id: null }).eq('categoria_id', id).eq('loja_id', loja_id);\n        const { error } = await supabase.from('categorias').delete().match({ id: id, loja_id: loja_id });\n        if (error) throw error;\n        res.status(200).json({ message: 'Categoria excluída com sucesso.' });\n    } catch (error) {\n        res.status(500).json({ message: 'Erro ao excluir categoria.', error: error.message });\n    }\n};\n\n// Exportando AMBAS as funções\nmodule.exports = {\n    getDashboardStats,\n    getSalesChartData,\n    getRecentOrders,\n    getProdutosDaLoja,\n    getProdutosMaisVendidos,\n    getAvaliacoesRecentes,\n    adicionarProduto,\n    editarProduto,\n    deletarProduto,\n    obterCategorias,\n    adicionarCategoria,\n    excluirCategoria\n};","size_bytes":14630},"frontend/js/login.js":{"content":"document.addEventListener('DOMContentLoaded', function () {\n    const loginTab = document.getElementById('login-tab');\n    const registerTab = document.getElementById('register-tab');\n    const loginForm = document.getElementById('login-form');\n    const registerForm = document.getElementById('register-form');\n\n    const userTypeButton = document.getElementById('user-type');\n    const storeTypeButton = document.getElementById('store-type');\n    const deliveryTypeButton = document.getElementById('delivery-type');\n\n    const storeFields = document.getElementById('store-fields');\n    const deliveryFields = document.getElementById('delivery-fields');\n\n    // Esta variável irá guardar o tipo de conta selecionado\n    let selectedAccountType = 'cliente';\n\n    function setupEventListeners() {\n        if (loginTab) loginTab.addEventListener('click', () => switchTab('login'));\n        if (registerTab) registerTab.addEventListener('click', () => switchTab('register'));\n\n        // Eventos para selecionar o tipo de conta\n        if (userTypeButton) userTypeButton.addEventListener('click', () => selectAccountType('cliente'));\n        if (storeTypeButton) storeTypeButton.addEventListener('click', () => selectAccountType('loja'));\n        if (deliveryTypeButton) deliveryTypeButton.addEventListener('click', () => selectAccountType('entregador'));\n\n        if (loginForm) {\n            loginForm.addEventListener('submit', (event) => {\n                event.preventDefault();\n                handleLogin();\n            });\n        }\n        if (registerForm) {\n            registerForm.addEventListener('submit', (event) => {\n                event.preventDefault();\n                handleRegister();\n            });\n        }\n    }\n\n    function switchTab(tab) {\n        if (tab === 'login') {\n            loginTab.classList.add('tab-active');\n            registerTab.classList.remove('tab-active');\n            loginForm.classList.remove('hidden');\n            registerForm.classList.add('hidden');\n        } else {\n            registerTab.classList.add('tab-active');\n            loginTab.classList.remove('tab-active');\n            registerForm.classList.remove('hidden');\n            loginForm.classList.add('hidden');\n        }\n    }\n\n    function selectAccountType(type) {\n        // Atualiza a variável global com o tipo de conta\n        selectedAccountType = type;\n\n        // Lógica visual para destacar o botão selecionado\n        userTypeButton.classList.remove('account-type-selected');\n        storeTypeButton.classList.remove('account-type-selected');\n        deliveryTypeButton.classList.remove('account-type-selected');\n\n        storeFields.classList.add('hidden');\n        deliveryFields.classList.add('hidden');\n\n        if (type === 'cliente') {\n            userTypeButton.classList.add('account-type-selected');\n        } else if (type === 'loja') {\n            storeTypeButton.classList.add('account-type-selected');\n            storeFields.classList.remove('hidden');\n        } else if (type === 'entregador') {\n            deliveryTypeButton.classList.add('account-type-selected');\n            deliveryFields.classList.remove('hidden');\n        }\n    }\n\n    async function handleLogin() {\n        const email = document.getElementById('login-email').value;\n        const password = document.getElementById('login-password').value;\n        if (!email || !password) return showToast('Atenção', 'Por favor, preencha e-mail e senha.', 'error');\n\n        try {\n            const response = await fetch(`${window.location.origin}/api/perfil/login`, {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({ email, password }),\n            });\n            const result = await response.json();\n            if (response.ok) {\n                localStorage.setItem('userToken', result.session.access_token);\n                localStorage.setItem('userData', JSON.stringify(result.user));\n                localStorage.setItem('userProfile', JSON.stringify(result.perfil));\n                showToast('Sucesso!', 'Login realizado com sucesso!');\n                setTimeout(() => {\n                    if (result.perfil.tipo === 'loja') {\n                        window.location.href = '/loja-frontend/Dashboard.html';\n                    } else {\n                        window.location.href = '/frontend/Clientes/Inicio.html';\n                    }\n                }, 1500);\n            } else {\n                showToast('Erro no login', result.error, 'error');\n            }\n        } catch (error) {\n            showToast('Erro de Conexão', 'Não foi possível conectar com o servidor.', 'error');\n        }\n    }\n\n    async function handleRegister() {\n        const nome = document.getElementById('register-name').value;\n        const email = document.getElementById('register-email').value;\n        const password = document.getElementById('register-password').value;\n        const passwordConfirm = document.getElementById('register-password-confirm').value;\n\n        if (!nome || !email || !password) return showToast('Atenção', 'Por favor, preencha nome, e-mail e senha.', 'error');\n        if (password !== passwordConfirm) return showToast('Atenção', 'As senhas não coincidem.', 'error');\n\n        const dataToSend = {\n            nome: nome,\n            email: email,\n            password: password,\n            tipo: selectedAccountType // Envia o tipo correto\n        };\n\n        if (selectedAccountType === 'loja') {\n            const nomeLoja = document.getElementById('store-name').value;\n            if (!nomeLoja) return showToast('Atenção', 'O nome da loja é obrigatório.', 'error');\n            dataToSend.nome_loja = nomeLoja;\n        }\n\n        try {\n            const response = await fetch(`${window.location.origin}/api/perfil/register`, {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify(dataToSend),\n            });\n            const result = await response.json();\n            if (response.ok) {\n                showToast('Sucesso!', 'Cadastro realizado! Você já pode fazer o login.');\n                setTimeout(() => switchTab('login'), 2000);\n            } else {\n                showToast('Erro no cadastro', result.error, 'error');\n            }\n        } catch (error) {\n            showToast('Erro de Conexão', 'Não foi possível conectar com o servidor.', 'error');\n        }\n    }\n\n    setupEventListeners();\n    // Garante que o estado inicial seja 'cliente'\n    selectAccountType('cliente');\n    switchTab('login');\n});\n\n// A função showToast permanece a mesma","size_bytes":6702},"frontend/js/api/pedidosApi.js":{"content":"import { supabase } from '../shared/auth.js'; // Importamos o supabase para pegar o token de login\n\nconst API_URL = `${window.location.origin}/api`; // O endereço do nosso backend\n\nexport async function fetchPedidos() {\n  try {\n    const { data: { session } } = await supabase.auth.getSession();\n\n    if (!session) {\n      console.log('Nenhum usuário logado para buscar pedidos.');\n      return [];\n    }\n\n    const token = session.access_token;\n\n    const response = await fetch(`${API_URL}/pedidos`, {\n      headers: {\n        'Authorization': `Bearer ${token}`\n      }\n    });\n\n    if (!response.ok) {\n      const errorData = await response.json();\n      throw new Error(errorData.error || 'Não foi possível buscar os pedidos.');\n    }\n    \n    return await response.json();\n  } catch (error) {\n    console.error(\"Erro ao buscar pedidos:\", error);\n    return [];\n  }\n}\n\n\n/**\n * Função para CRIAR um novo pedido no backend.\n * Ela envia os dados do carrinho e o \"crachá\" (token) do usuário.\n * @param {object} orderData Os dados do pedido, ex: { items, total, loja_id }\n */\nexport async function createOrder(orderData) {\n    const { data: { session } } = await supabase.auth.getSession();\n    if (!session) {\n        alert('Sessão expirada. Por favor, faça login novamente.');\n        return { error: 'Usuário não autenticado' };\n    }\n\n    try {\n        const response = await fetch(`${API_URL}/pedidos`, {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': `Bearer ${session.access_token}`\n            },\n            body: JSON.stringify(orderData)\n        });\n\n        if (!response.ok) {\n            const errorData = await response.json();\n            throw new Error(errorData.error || 'Não foi possível criar o pedido.');\n        }\n        \n        return await response.json();\n    } catch (error) {\n        console.error(\"Erro ao criar pedido:\", error);\n        return { error: error.message };\n    }\n}","size_bytes":2012},"frontend/js/shared/supabaseClient.js":{"content":"import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';\n\nconst SUPABASE_URL = 'https://jrskruadcwuytvjeqybh.supabase.co';\nconst SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Impyc2tydWFkY3d1eXR2amVxeWJoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkyMjc4OTMsImV4cCI6MjA2NDgwMzg5M30.JzNlpPJ7jAONIpUK92zg-6YLPK6WRRfhotYiMu6KFjs';\n\nexport const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);","size_bytes":453},"frontend/js/modal.js":{"content":"function showConfirmationModal(title, message, onConfirm) {\n    const modal = document.getElementById('confirmation-modal');\n    const modalTitle = document.getElementById('modal-title');\n    const modalMessage = document.getElementById('modal-message');\n    const confirmBtn = document.getElementById('modal-confirm-btn');\n    const cancelBtn = document.getElementById('modal-cancel-btn');\n\n    if (!modal) return;\n\n    // Preenche o texto do modal\n    modalTitle.textContent = title;\n    modalMessage.textContent = message;\n\n    // Mostra o modal\n    modal.classList.remove('hidden');\n\n    // Função para fechar o modal\n    const closeModal = () => {\n        modal.classList.add('hidden');\n        // Remove os event listeners para não serem duplicados na próxima vez\n        confirmBtn.replaceWith(confirmBtn.cloneNode(true));\n        cancelBtn.replaceWith(cancelBtn.cloneNode(true));\n    };\n\n    // Ação do botão \"Sim\"\n    confirmBtn.addEventListener('click', () => {\n        onConfirm(); // Executa a ação que queremos\n        closeModal();\n    });\n\n    // Ação do botão \"Não\"\n    cancelBtn.addEventListener('click', closeModal);\n}","size_bytes":1149},"loja-frontend/js/api/lojaApi.js":{"content":"import { supabase } from '../../frontend/js/shared/auth.js';\n\nconst API_URL = `${window.location.origin}/api/dashboard/loja`;\n\nexport async function fetchPedidosDaLoja() {\n    const { data: { session } } = await supabase.auth.getSession();\n    if (!session) return null;\n\n    const response = await fetch(`${API_URL}/pedidos`, {\n        headers: { 'Authorization': `Bearer ${session.access_token}` }\n    });\n\n    if (!response.ok) {\n        console.error('Falha ao buscar pedidos da loja');\n        return [];\n    }\n    return await response.json();\n}\n\nexport async function updatePedidoStatus(pedido_id, novo_status) {\n    const { data: { session } } = await supabase.auth.getSession();\n    if (!session) return null;\n\n    const response = await fetch(`${API_URL}/pedidos/update-status`, {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/json',\n            'Authorization': `Bearer ${session.access_token}`\n        },\n        body: JSON.stringify({ pedido_id, novo_status })\n    });\n    \n    return await response.json();\n}","size_bytes":1060},"frontend/js/notifications.js":{"content":"function showToast(title, message, type = 'success') {\n    const toast = document.getElementById('toast');\n    const toastTitle = document.getElementById('toast-title');\n    const toastMessage = document.getElementById('toast-message');\n    const toastIcon = document.getElementById('toast-icon');\n\n    if (!toast || !toastTitle || !toastMessage || !toastIcon) {\n        console.error('Elementos do Toast não foram encontrados no HTML.');\n        return;\n    }\n\n    toastTitle.innerText = title;\n    toastMessage.innerText = message;\n\n    if (type === 'error') {\n        toastIcon.innerHTML = `\n            <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-6 w-6 text-red-500\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n            </svg>\n        `;\n    } else { // 'success'\n        toastIcon.innerHTML = `\n            <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-6 w-6 text-green-500\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\n    </svg>\n`;\n    }\n\n    toast.classList.remove('hidden');\n    // Força a animação a rodar de novo\n    toast.classList.remove('slide-in');\n    void toast.offsetWidth; // truque para reiniciar a animação\n    toast.classList.add('slide-in');\n\n\n    // Esconde automaticamente depois de 3 segundos\n    setTimeout(() => {\n        hideToast();\n    }, 3000);\n}\n\nfunction hideToast() {\n    const toast = document.getElementById('toast');\n    if (toast) {\n        toast.classList.add('hidden');\n    }\n}","size_bytes":1730},"frontend/js/api/lojasApi.js":{"content":"const API_BASE_URL = `${window.location.origin}/api`;\n\n/**\n * Busca a lista de todas as lojas cadastradas no backend.\n */\nexport async function getLojas() {\n    try {\n        const response = await fetch(`${API_BASE_URL}/lojas`);\n        if (!response.ok) {\n            throw new Error('A resposta da rede não foi boa.');\n        }\n        return await response.json();\n    } catch (error) {\n        console.error('Houve um problema ao buscar as lojas:', error);\n        return []; // Retorna uma lista vazia para não quebrar a página.\n    }\n}","size_bytes":546},"loja-frontend/js/pages/pedidos.js":{"content":"import { fetchPedidosDaLoja, updatePedidoStatus } from '../api/lojaApi.js';\n\nfunction getStatusClass(status) {\n    switch (status) {\n        case 'Entregue': return 'bg-green-100 text-green-800';\n        case 'Pendente': return 'bg-yellow-100 text-yellow-800';\n        case 'Cancelado': return 'bg-red-100 text-red-800';\n        case 'Em preparo': return 'bg-blue-100 text-blue-800';\n        default: return 'bg-gray-100 text-gray-800';\n    }\n}\n\nfunction criarLinhaPedido(pedido) {\n    const dataPedido = new Date(pedido.created_at).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });\n    const nomeCliente = pedido.profiles ? pedido.profiles.nome_completo : 'Cliente Anônimo';\n\n    return `\n    <tr class=\"bg-white border-b\">\n        <td class=\"px-6 py-4 font-medium text-gray-900\">#${pedido.id}</td>\n        <td class=\"px-6 py-4\">${dataPedido}</td>\n        <td class=\"px-6 py-4\">${nomeCliente}</td>\n        <td class=\"px-6 py-4\">R$ ${pedido.total.toFixed(2).replace('.', ',')}</td>\n        <td class=\"px-6 py-4\">\n            <span class=\"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${getStatusClass(pedido.status)}\">\n                ${pedido.status}\n            </span>\n        </td>\n        <td class=\"px-6 py-4 text-right\">\n            <select class=\"status-select border border-gray-300 rounded-md p-1\" data-pedido-id=\"${pedido.id}\">\n                <option value=\"Pendente\" ${pedido.status === 'Pendente' ? 'selected' : ''}>Pendente</option>\n                <option value=\"Em preparo\" ${pedido.status === 'Em preparo' ? 'selected' : ''}>Em preparo</option>\n                <option value=\"A caminho\" ${pedido.status === 'A caminho' ? 'selected' : ''}>A caminho</option>\n                <option value=\"Entregue\" ${pedido.status === 'Entregue' ? 'selected' : ''}>Entregue</option>\n                <option value=\"Cancelado\" ${pedido.status === 'Cancelado' ? 'selected' : ''}>Cancelado</option>\n            </select>\n        </td>\n    </tr>\n    `;\n}\n\nasync function carregarPedidos() {\n    const tbody = document.getElementById('pedidos-tbody');\n    if (!tbody) return;\n\n    tbody.innerHTML = '<tr><td colspan=\"6\" class=\"text-center p-4\">Carregando pedidos...</td></tr>';\n    const pedidos = await fetchPedidosDaLoja();\n    \n    if (pedidos && pedidos.length > 0) {\n        tbody.innerHTML = '';\n        pedidos.forEach(pedido => {\n            tbody.innerHTML += criarLinhaPedido(pedido);\n        });\n        adicionarEventosStatus();\n    } else {\n        tbody.innerHTML = '<tr><td colspan=\"6\" class=\"text-center p-4\">Nenhum pedido encontrado.</td></tr>';\n    }\n}\n\nfunction adicionarEventosStatus() {\n    document.querySelectorAll('.status-select').forEach(select => {\n        select.addEventListener('change', async (e) => {\n            const pedidoId = e.target.dataset.pedidoId;\n            const novoStatus = e.target.value;\n            \n            const result = await updatePedidoStatus(pedidoId, novoStatus);\n            if(result && result.message) {\n                //alert(result.message);\n                carregarPedidos(); // Recarrega a lista para mostrar a mudança\n            } else {\n                alert('Erro ao atualizar status.');\n            }\n        });\n    });\n}\n\ndocument.addEventListener('DOMContentLoaded', carregarPedidos);","size_bytes":3292},"backend/src/routes/lojas.js":{"content":"const express = require('express');\nconst router = express.Router();\nconst { buscarLojas } = require('../controllers/lojaController');\n\nrouter.get('/', buscarLojas);\n\nmodule.exports = router;","size_bytes":191},"loja-frontend/js/api/produtosApi.js":{"content":"import { getAuthToken } from '../shared/auth.js';\n\nconst API_BASE_URL = `${window.location.origin}/api`;\n\n/**\n * Adiciona um novo produto enviando os dados para a API.\n * @param {FormData} productFormData - Os dados do produto em um FormData object.\n * @returns {Promise<Object>} - O resultado da API.\n */\nexport const addProduct = async (productFormData) => {\n    const authToken = getAuthToken();\n    if (!authToken) {\n        console.error('Token de autenticação não encontrado.');\n        alert('Erro de autenticação. Faça o login novamente.');\n        return { error: { message: 'Acesso não autorizado.' } };\n    }\n\n    try {\n        const response = await fetch(`${API_BASE_URL}/dashboard/produtos`, {\n            method: 'POST',\n            headers: {\n                'Authorization': `Bearer ${authToken}`\n                // Nota: Não defina 'Content-Type' ao usar FormData, o navegador faz isso.\n            },\n            body: productFormData\n        });\n\n        const result = await response.json();\n\n        if (!response.ok) {\n            throw new Error(result.message || 'Falha ao adicionar o produto.');\n        }\n\n        return result;\n    } catch (error) {\n        console.error('Erro ao adicionar produto:', error);\n        return { error };\n    }\n};\n\n// Futuramente, adicionaremos aqui as funções para carregar, editar e deletar produtos.","size_bytes":1371},"frontend/js/lojas.js":{"content":"import { getLojas } from './api/lojasApi.js';\n\n// Função para criar o HTML de um card de loja (seu código original)\nfunction criarCardLoja(loja) {\n    const rating = 4.9;\n    const reviewCount = 254;\n    const distance = \"2.5 km\";\n    const deliveryTime = \"25-35 min\";\n    const deliveryFee = \"R$ 5,99\";\n\n    return `\n      <div class=\"store-card bg-white rounded-xl shadow-md overflow-hidden transition-all duration-300 hover:shadow-lg\">\n          <div class=\"relative\">\n              <img src=\"${loja.url_imagem || 'https://placehold.co/400x200'}\" alt=\"Imagem da ${loja.nome}\" class=\"w-full h-40 object-cover\">\n              <div class=\"absolute top-2 right-2 bg-white rounded-full p-1.5 shadow-md\">\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-5 w-5 text-gray-400\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z\"></path></svg>\n              </div>\n          </div>\n          <div class=\"p-4\">\n              <div class=\"flex justify-between items-start\">\n                  <h3 class=\"text-lg font-bold text-gray-800\">${loja.nome}</h3>\n                  <div class=\"flex items-center bg-gray-100 px-2 py-0.5 rounded-full\">\n                      <span class=\"text-yellow-500 mr-1\">★</span>\n                      <span class=\"text-sm font-semibold text-gray-700\">${rating}</span>\n                  </div>\n              </div>\n              <p class=\"text-sm text-gray-500 mb-3\">${reviewCount}+ avaliações</p>\n              <div class=\"flex items-center text-sm text-gray-600 mb-1\">\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-4 w-4 mr-1.5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z\"></path><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 11a3 3 0 11-6 0 3 3 0 016 0z\"></path></svg>\n                  ${distance}\n              </div>\n              <div class=\"flex items-center text-sm text-gray-600\">\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-4 w-4 mr-1.5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"></path></svg>\n                  ${deliveryTime} • Entrega: ${deliveryFee}\n              </div>\n          </div>\n      </div>\n  `;\n}\n\n// Função principal que carrega as lojas (seu código original)\nasync function carregarLojas() {\n    const containerLojas = document.getElementById('lojas-container');\n    if (!containerLojas) {\n        console.error('O elemento com ID \"lojas-container\" não foi encontrado no seu HTML.');\n        return;\n    }\n\n    containerLojas.innerHTML = '<p class=\"text-center text-gray-500\">Carregando lojas...</p>';\n    const lojas = await getLojas();\n\n    if (lojas.length === 0) {\n        containerLojas.innerHTML = '<p class=\"text-center text-gray-500\">Nenhuma loja encontrada no momento.</p>';\n        return;\n    }\n    containerLojas.innerHTML = '';\n    lojas.forEach(loja => {\n        const cardHtml = criarCardLoja(loja);\n        containerLojas.innerHTML += cardHtml;\n    });\n}\n\n// ===== LÓGICA DO BOTÃO DE TESTE ADICIONADA AQUI =====\nfunction setupTestButton() {\n    const testButton = document.getElementById('add-test-item-btn');\n    if (!testButton) return;\n\n    testButton.addEventListener('click', () => {\n        // Define um item de teste\n        const testItem = {\n            id: `prod_${Date.now()}`, // ID único para não agrupar sempre o mesmo\n            nome: 'X-Burger Teste',\n            preco: 25.50,\n            loja_id: '12345', // ID da loja fictícia\n            loja_nome: 'Lanchonete do Zé'\n        };\n\n        // Pega o carrinho atual, adiciona o item e salva de volta\n        const cart = JSON.parse(localStorage.getItem('pedeai_cart')) || [];\n\n        // Lógica para adicionar ou incrementar\n        const itemExistente = cart.find(item => item.id === testItem.id);\n        if (itemExistente) {\n            itemExistente.quantidade++;\n        } else {\n            testItem.quantidade = 1;\n            cart.push(testItem);\n        }\n        \n        localStorage.setItem('pedeai_cart', JSON.stringify(cart));\n\n        // Mostra a notificação de sucesso\n        showToast('Sucesso!', `${testItem.nome} foi adicionado ao carrinho.`);\n\n        // Força a atualização do header para mostrar o contador\n        window.location.reload(); \n    });\n}\n\n// O evento que dispara tudo quando a página é carregada\ndocument.addEventListener('DOMContentLoaded', () => {\n    carregarLojas();\n    setupTestButton(); // Ativa nosso novo botão\n});","size_bytes":4909},"backend/src/routes/perfil.js":{"content":"const express = require('express');\nconst router = express.Router();\nconst perfilController = require('../controllers/perfilController');\nconst authMiddleware = require('../middleware/authMiddleware');\n\nrouter.post('/register', perfilController.criarPerfil);\nrouter.post('/login', perfilController.login);\nrouter.get('/', authMiddleware, perfilController.getPerfil);\n\nmodule.exports = router;","size_bytes":392},"frontend/js/api/perfilApi.js":{"content":"const API_BASE_URL = `${window.location.origin}/api`;\n\nasync function registerUser(email, password, role, additionalData = {}) {\n    try {\n        // Rota de cadastro correta\n        const response = await fetch(`${API_BASE_URL}/perfil/register`, {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n            },\n            body: JSON.stringify({ email, password, role, ...additionalData }),\n        });\n        if (!response.ok) {\n            const errorResult = await response.json();\n            throw new Error(errorResult.error);\n        }\n        return await response.json();\n    } catch (error) {\n        console.error('Erro no registro:', error);\n        throw error;\n    }\n}\n\nasync function loginUser(email, password) {\n    try {\n        // A correção está aqui: a URL agora aponta para /perfil/login\n        const response = await fetch(`${API_BASE_URL}/perfil/login`, {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n            },\n            body: JSON.stringify({ email, password }),\n        });\n        if (!response.ok) {\n            const errorResult = await response.json();\n            throw new Error(errorResult.error || 'Erro ao fazer login.');\n        }\n        return await response.json();\n    } catch (error) {\n        console.error('Erro de Conexão:', error);\n        throw new Error('Não foi possível conectar com o servidor.');\n    }\n}\n\nasync function fetchUserProfile() {\n    const token = localStorage.getItem('userToken');\n    if (!token) {\n        throw new Error('Usuário não autenticado.');\n    }\n\n    try {\n        const response = await fetch(`${API_BASE_URL}/perfil`, {\n            method: 'GET',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': `Bearer ${token}`\n            },\n        });\n        if (!response.ok) {\n            const errorResult = await response.json();\n            throw new Error(errorResult.error);\n        }\n        return await response.json();\n    } catch (error) {\n        console.error('Erro ao buscar perfil:', error);\n        throw error;\n    }\n}\n\nasync function updateUserProfile(updates) {\n    const token = localStorage.getItem('userToken');\n    if (!token) {\n        throw new Error('Usuário não autenticado.');\n    }\n\n    try {\n        const response = await fetch(`${API_BASE_URL}/perfil`, {\n            method: 'PUT',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': `Bearer ${token}`\n            },\n            body: JSON.stringify(updates),\n        });\n        if (!response.ok) {\n            const errorResult = await response.json();\n            throw new Error(errorResult.error);\n        }\n        return await response.json();\n    } catch (error) {\n        console.error('Erro ao atualizar perfil:', error);\n        throw error;\n    }\n}","size_bytes":2958},"backend/src/middleware/authMiddleware.js":{"content":"const { supabase } = require('../config/supabaseClient');\n\nasync function authMiddleware(req, res, next) {\n    const authHeader = req.headers.authorization;\n\n    if (!authHeader || !authHeader.startsWith('Bearer ')) {\n        return res.status(401).json({ error: 'Token não fornecido ou mal formatado.' });\n    }\n\n    const token = authHeader.split(' ')[1];\n\n    try {\n        const { data: { user }, error: userError } = await supabase.auth.getUser(token);\n\n        if (userError || !user) {\n            return res.status(403).json({ error: 'Token inválido ou expirado.' });\n        }\n\n        // CORREÇÃO: Garante que estamos buscando da tabela \"perfis\" com 'p' minúsculo.\n        const { data: perfil, error: perfilError } = await supabase\n            .from('perfis')\n            .select('*')\n            .eq('user_id', user.id)\n            .single();\n\n        if (perfilError || !perfil) {\n            return res.status(404).json({ error: 'Perfil associado ao token não encontrado.' });\n        }\n\n        req.user = user;\n        req.perfil = perfil;\n        next();\n\n    } catch (error) {\n        console.error('Erro no middleware de autenticação:', error);\n        res.status(500).json({ error: 'Erro interno do servidor ao autenticar.' });\n    }\n}\n\nmodule.exports = authMiddleware;","size_bytes":1297},"frontend/js/shared/header.js":{"content":"// A função de montar o header agora é global, pode ser chamada de qualquer lugar.\nfunction montarHeader() {\n    const headerElement = document.querySelector('header');\n    if (!headerElement) {\n        return;\n    }\n    headerElement.id = 'main-header';\n    const userData = JSON.parse(localStorage.getItem('userData'));\n\n    if (userData) {\n        renderHeaderLogado(headerElement, userData);\n    } else {\n        renderHeaderDeslogado(headerElement);\n    }\n}\n\n// O restante do seu arquivo header.js continua exatamente igual...\n\nfunction getCart() {\n    const cartJson = localStorage.getItem('pedeai_cart');\n    return cartJson ? JSON.parse(cartJson) : [];\n}\n\nfunction renderHeaderDeslogado(headerElement) {\n    headerElement.className = 'bg-gray-900 text-white p-4 shadow-md z-50 relative';\n    headerElement.innerHTML = `\n        <div class=\"container mx-auto px-4 flex justify-between items-center\">\n            <a href=\"/frontend/Clientes/Inicio.html\" class=\"flex items-center\">\n                <svg class=\"h-10 w-10 lightning-logo\" viewBox=\"0 0 24 24\"><circle cx=\"12\" cy=\"12\" r=\"11\" fill=\"#FFD100\"></circle><circle cx=\"12\" cy=\"12\" r=\"9\" fill=\"#1A1A1A\"></circle><path d=\"M13 6L7 14h4v4l6-8h-4V6z\" fill=\"#FFD100\"></path></svg>\n                <span class=\"ml-2 text-2xl font-bold text-primary\">PedeAí</span>\n            </a>\n            <div id=\"user-navigation\" class=\"flex items-center space-x-4\">\n                <a href=\"/frontend/Clientes/Inicio.html\" class=\"text-white hover:text-primary transition-colors\">Início</a>\n                <a href=\"/frontend/Clientes/Lojas.html\" class=\"text-white hover:text-primary transition-colors\">Lojas</a>\n                <a href=\"/frontend/Clientes/login.html\" class=\"bg-primary text-secondary font-medium py-2 px-4 rounded-full\">Entrar</a>\n            </div>\n        </div>\n    `;\n}\n\nfunction renderHeaderLogado(headerElement, userData) {\n    const primeiroNome = userData.nome_completo ? userData.nome_completo.split(' ')[0] : userData.email.split('@')[0];\n    const cart = getCart();\n    const cartItemCount = cart.reduce((total, item) => total + item.quantidade, 0);\n\n    headerElement.className = 'bg-secondary shadow-md sticky top-0 z-50';\n    headerElement.innerHTML = `\n        <div class=\"container mx-auto px-4 py-3\">\n            <div class=\"flex justify-between items-center\">\n                <div class=\"flex items-center\">\n                    <div class=\"mr-2\">\n                        <svg class=\"h-10 w-10 lightning-logo\" viewBox=\"0 0 24 24\"><circle cx=\"12\" cy=\"12\" r=\"11\" fill=\"#FFD100\"></circle><circle cx=\"12\" cy=\"12\" r=\"9\" fill=\"#1A1A1A\"></circle><path d=\"M13 6L7 14h4v4l6-8h-4V6z\" fill=\"#FFD100\"></path></svg>\n                    </div>\n                    <h1 class=\"text-2xl font-bold text-white\">Pede<span class=\"text-primary\">Aí</span></h1>\n                </div>\n                <div id=\"user-navigation\" class=\"flex items-center space-x-4\">\n                    <a href=\"/frontend/Clientes/Inicio.html\" class=\"text-white hover:text-primary transition-colors\">Início</a>\n                    <a href=\"/frontend/Clientes/Lojas.html\" class=\"text-white hover:text-primary transition-colors\">Lojas</a>\n                    <a href=\"/frontend/Clientes/Pedidos.html\" class=\"text-white hover:text-primary transition-colors\">Meus Pedidos</a>\n                    <a href=\"/frontend/Clientes/Perfil.html\" class=\"font-medium text-primary hover:text-white\">Olá, ${primeiroNome}</a>\n                    <a href=\"/frontend/Clientes/Carrinho.html\" class=\"relative text-white p-2 rounded-full hover:bg-gray-700\">\n                        <svg class=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z\"></path></svg>\n                        ${cartItemCount > 0 ? `\n                        <span class=\"absolute -top-1 -right-1 bg-primary text-secondary text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center\">\n                            ${cartItemCount}\n                        </span>\n                        ` : ''}\n                    </a>\n                    <button id=\"logout-button\" class=\"bg-red-500 text-white px-3 py-1 rounded-lg text-sm font-medium\">Sair</button>\n                </div>\n            </div>\n        </div>\n    `;\n\n    const logoutButton = document.getElementById('logout-button');\n    if (logoutButton) {\n        logoutButton.addEventListener('click', () => {\n            localStorage.removeItem('userToken');\n            localStorage.removeItem('userData');\n            localStorage.removeItem('pedeai_cart'); \n            window.location.href = '/frontend/Clientes/login.html';\n        });\n    }\n}\n\n// Apenas chamamos a função quando a página carregar\ndocument.addEventListener('DOMContentLoaded', montarHeader);","size_bytes":4955},"loja-frontend/js/api/categoriasApi.js":{"content":"import { getAuthToken } from '../shared/auth.js';\n\nconst API_BASE_URL = `${window.location.origin}/api/dashboard`;\n\nasync function fetchWithAuth(url, options = {}) {\n    const token = getAuthToken();\n    const headers = {\n        'Authorization': `Bearer ${token}`,\n        'Content-Type': 'application/json',\n        ...options.headers,\n    };\n\n    const response = await fetch(url, { ...options, headers });\n\n    if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.message || 'Ocorreu um erro na requisição.');\n    }\n    return response.json();\n}\n\nexport const getCategories = () => {\n    return fetchWithAuth(`${API_BASE_URL}/categorias`);\n};\n\nexport const addCategory = (nome_categoria) => {\n    return fetchWithAuth(`${API_BASE_URL}/categorias`, {\n        method: 'POST',\n        body: JSON.stringify({ nome_categoria }),\n    });\n};\n\nexport const deleteCategory = (categoryId) => {\n    return fetchWithAuth(`${API_BASE_URL}/categorias/${categoryId}`, {\n        method: 'DELETE',\n    });\n};","size_bytes":1047},"loja-frontend/js/api/dashboardApi.js":{"content":"// Função auxiliar para lidar com erros de autenticação\nfunction handleAuthError(response) {\n    if (response.status === 401 || response.status === 403) {\n        localStorage.clear();\n        window.location.href = '/frontend/Clientes/login.html';\n        return true;\n    }\n    return false;\n}\n\n// Função para buscar os dados dos CARDS\nexport async function fetchDashboardStats() {\n    const token = localStorage.getItem('userToken');\n    if (!token) {\n        window.location.href = '/frontend/Clientes/login.html';\n        return null;\n    }\n    try {\n        const response = await fetch(`${window.location.origin}/api/dashboard/loja/stats`, {\n            headers: { 'Authorization': `Bearer ${token}` }\n        });\n        if (handleAuthError(response)) return null;\n        if (!response.ok) throw new Error((await response.json()).error);\n        return await response.json();\n    } catch (error) {\n        console.error('Erro na API de stats:', error);\n        return null;\n    }\n}\n\n// Função para buscar os dados do GRÁFICO\nexport async function fetchSalesChartData(period = '7d') {\n    const token = localStorage.getItem('userToken');\n    if (!token) return null;\n    try {\n        const response = await fetch(`${window.location.origin}/api/dashboard/loja/vendas?period=${period}`, {\n            headers: { 'Authorization': `Bearer ${token}` }\n        });\n        if (handleAuthError(response)) return null;\n        if (!response.ok) throw new Error((await response.json()).error);\n        return await response.json();\n    } catch (error) {\n        console.error('Erro na API do gráfico:', error);\n        return null;\n    }\n}\n\n// Função para buscar os PEDIDOS RECENTES\nexport async function fetchRecentOrders() {\n    const token = localStorage.getItem('userToken');\n    if (!token) return null;\n    try {\n        const response = await fetch(`${window.location.origin}/api/dashboard/loja/pedidos-recentes`, {\n            headers: { 'Authorization': `Bearer ${token}` }\n        });\n        if (handleAuthError(response)) return null;\n        if (!response.ok) throw new Error((await response.json()).error);\n        return await response.json();\n    } catch (error) {\n        console.error('Erro na API de pedidos recentes:', error);\n        return null;\n    }\n}\n\n// Função para buscar os PRODUTOS DA LOJA\nexport async function fetchProdutosDaLoja() {\n    const token = localStorage.getItem('userToken');\n    if (!token) return null;\n    try {\n        const response = await fetch(`${window.location.origin}/api/dashboard/loja/produtos`, {\n            headers: { 'Authorization': `Bearer ${token}` }\n        });\n        if (handleAuthError(response)) return null;\n        if (!response.ok) throw new Error((await response.json()).error);\n        return await response.json();\n    } catch (error) {\n        console.error('Erro na API de produtos:', error);\n        return null;\n    }\n}","size_bytes":2911},"frontend/js/services/cartService.js":{"content":"const CART_KEY = 'pedeai_cart'; // A chave para salvar o carrinho no localStorage\n\n/**\n * Pega o carrinho atual do localStorage.\n * @returns {Array} O array de itens do carrinho.\n */\nexport function getCart() {\n  const cartJson = localStorage.getItem(CART_KEY);\n  return cartJson ? JSON.parse(cartJson) : [];\n}\n\n/**\n * Salva o carrinho no localStorage.\n * @param {Array} cart O array de itens do carrinho para salvar.\n */\nfunction saveCart(cart) {\n  localStorage.setItem(CART_KEY, JSON.stringify(cart));\n}\n\n/**\n * Adiciona um item ao carrinho ou incrementa sua quantidade.\n * @param {object} item O item a ser adicionado (ex: { id, nome, preco, quantidade }).\n */\nexport function addItemToCart(item) {\n  const cart = getCart();\n  const existingItem = cart.find(cartItem => cartItem.id === item.id);\n\n  if (existingItem) {\n    existingItem.quantidade += item.quantidade || 1;\n  } else {\n    cart.push({ ...item, quantidade: item.quantidade || 1 });\n  }\n  \n  saveCart(cart);\n}\n\n/**\n * Remove um item do carrinho.\n * @param {string} itemId O ID do item a ser removido.\n */\nexport function removeItemFromCart(itemId) {\n  let cart = getCart();\n  cart = cart.filter(item => item.id !== itemId);\n  saveCart(cart);\n}\n\n/**\n * Atualiza a quantidade de um item específico.\n * @param {string} itemId O ID do item.\n * @param {number} quantidade A nova quantidade.\n */\nexport function updateItemQuantity(itemId, quantidade) {\n  const cart = getCart();\n  const itemToUpdate = cart.find(item => item.id === itemId);\n\n  if (itemToUpdate) {\n    itemToUpdate.quantidade = Number(quantidade);\n    if (itemToUpdate.quantidade <= 0) {\n      // Se a quantidade for 0 ou menor, remove o item\n      removeItemFromCart(itemId);\n    } else {\n      saveCart(cart);\n    }\n  }\n}\n\n/**\n * Limpa completamente o carrinho.\n */\nexport function clearCart() {\n  localStorage.removeItem(CART_KEY);\n}\n\n/**\n * Calcula o subtotal do carrinho.\n * @returns {number} O valor subtotal.\n */\nexport function getSubtotal() {\n    const cart = getCart();\n    return cart.reduce((total, item) => total + (item.preco * item.quantidade), 0);\n}","size_bytes":2091},"backend/src/routes/lojaDashboard.js":{"content":"// backend/src/routes/lojaDashboard.js (VERSÃO FINAL)\nconst express = require('express');\nconst router = express.Router();\nconst authMiddleware = require('../middleware/authMiddleware');\nconst lojaDashboardController = require('../controllers/lojaDashboardController');\n\nrouter.get('/stats', authMiddleware, lojaDashboardController.getDashboardStats);\nrouter.get('/vendas', authMiddleware, lojaDashboardController.getSalesChartData);\nrouter.get('/pedidos-recentes', authMiddleware, lojaDashboardController.getRecentOrders);\nrouter.get('/produtos', authMiddleware, lojaDashboardController.getProdutosDaLoja);\nrouter.get('/produtos-mais-vendidos', authMiddleware, lojaDashboardController.getProdutosMaisVendidos);\nrouter.get('/avaliacoes-recentes', authMiddleware, lojaDashboardController.getAvaliacoesRecentes);\n\nrouter.get('/categorias', authMiddleware, lojaDashboardController.obterCategorias);\nrouter.post('/categorias', authMiddleware, lojaDashboardController.adicionarCategoria);\nrouter.delete('/categorias/:id', authMiddleware, lojaDashboardController.excluirCategoria);\n\nrouter.post('/produtos', authMiddleware, lojaDashboardController.adicionarProduto);\nrouter.put('/produtos/:id', authMiddleware, lojaDashboardController.editarProduto);\nrouter.delete('/produtos/:id', authMiddleware, lojaDashboardController.deletarProduto);\n\nmodule.exports = router;","size_bytes":1359},"backend/src/config/supabaseClient.js":{"content":"// Arquivo: backend/src/config/supabaseClient.js\n\nrequire('dotenv').config();\nconst { createClient } = require('@supabase/supabase-js');\n\nconst supabaseUrl = process.env.SUPABASE_URL;\nconst supabaseAnonKey = process.env.SUPABASE_ANON_KEY;\nconst supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n\n// =========== INÍCIO DO BLOCO DE DEBUG ===========\nconsole.log('--- VERIFICANDO VARIÁVEIS DE AMBIENTE ---');\nconsole.log('URL do Supabase lida:', supabaseUrl ? `...${supabaseUrl.slice(-6)}` : '!!! NÃO ENCONTRADA !!!');\nconsole.log('Chave Anon lida:   ', supabaseAnonKey ? `...${supabaseAnonKey.slice(-6)}` : '!!! NÃO ENCONTRADA !!!');\nconsole.log('-----------------------------------------');\n// =========== FIM DO BLOCO DE DEBUG ===========\n\nif (!supabaseUrl || !supabaseAnonKey || !supabaseServiceRoleKey) {\n    throw new Error('As variáveis de ambiente do Supabase (URL, ANON_KEY, SERVICE_ROLE_KEY) não foram definidas.');\n}\n\nconst supabase = createClient(supabaseUrl, supabaseAnonKey);\n\nconst supabaseAdmin = createClient(supabaseUrl, supabaseServiceRoleKey, {\n  auth: {\n    autoRefreshToken: false,\n    persistSession: false\n  }\n});\n\nmodule.exports = { supabase, supabaseAdmin };","size_bytes":1201},"frontend/js/Carrinho.js":{"content":"// frontend/js/Carrinho.js\n\n// Mantive as importações que você já usa\nimport { getCart, removeItemFromCart, updateItemQuantity, getSubtotal, clearCart } from './services/cartService.js';\nimport { createOrder } from './api/pedidosApi.js'; \n\nfunction renderizarItensCarrinho() {\n    const cart = getCart();\n    const container = document.getElementById('itens-do-carrinho');\n    const resumoContainer = document.getElementById('resumo-pedido');\n    const subtotalEl = document.getElementById('subtotal-valor');\n    const totalEl = document.getElementById('total-pedido');\n\n    if (!container || !resumoContainer || !subtotalEl || !totalEl) {\n        console.error('Um ou mais elementos do carrinho não foram encontrados no HTML.');\n        return;\n    }\n\n    container.innerHTML = '';\n    resumoContainer.innerHTML = '';\n\n    if (cart.length === 0) {\n        container.innerHTML = '<p class=\"text-gray-500\">Seu carrinho está vazio.</p>';\n        subtotalEl.textContent = 'R$ 0,00';\n        totalEl.textContent = 'R$ 0,00';\n        return;\n    }\n\n    cart.forEach(item => {\n        const itemHtml = `\n            <div class=\"cart-item flex items-center justify-between p-4 border-b border-gray-100\">\n                <div class=\"flex items-center\">\n                    <img src=\"${item.imagem || 'https://placehold.co/80x80'}\" alt=\"${item.nome}\" class=\"w-16 h-16 rounded-lg object-cover mr-4\">\n                    <div>\n                        <h3 class=\"font-medium text-gray-800\">${item.nome}</h3>\n                        <p class=\"text-sm text-gray-500\">R$ ${item.preco.toFixed(2).replace('.', ',')}</p>\n                    </div>\n                </div>\n                <div class=\"flex items-center gap-4\">\n                    <div class=\"flex items-center border border-gray-300 rounded-lg\">\n                        <button class=\"quantity-btn p-2\" data-item-id=\"${item.id}\" data-change=\"-1\">-</button>\n                        <span class=\"px-3 text-center\">${item.quantidade}</span>\n                        <button class=\"quantity-btn p-2\" data-item-id=\"${item.id}\" data-change=\"1\">+</button>\n                    </div>\n                    <p class=\"font-semibold w-20 text-right\">R$ ${(item.preco * item.quantidade).toFixed(2).replace('.', ',')}</p>\n                    <button class=\"text-gray-400 hover:text-red-500 p-2 remove-btn\" data-item-id=\"${item.id}\">\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-5 w-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path></svg>\n                    </button>\n                </div>\n            </div>\n        `;\n        container.innerHTML += itemHtml;\n\n        const resumoHtml = `\n            <div class=\"flex justify-between text-sm\">\n                <span>${item.quantidade}x ${item.nome}</span>\n                <span>R$ ${(item.preco * item.quantidade).toFixed(2).replace('.', ',')}</span>\n            </div>\n        `;\n        resumoContainer.innerHTML += resumoHtml;\n    });\n\n    const subtotal = getSubtotal();\n    subtotalEl.textContent = `R$ ${subtotal.toFixed(2).replace('.', ',')}`;\n    totalEl.textContent = `R$ ${subtotal.toFixed(2).replace('.', ',')}`;\n\n    adicionarEventos();\n}\n\nfunction adicionarEventos() {\n    document.querySelectorAll('.quantity-btn').forEach(button => {\n        button.addEventListener('click', () => {\n            const itemId = button.dataset.itemId;\n            const change = parseInt(button.dataset.change);\n            const cart = getCart();\n            const item = cart.find(i => i.id === itemId);\n            if (item) {\n                const novaQuantidade = item.quantidade + change;\n                updateItemQuantity(itemId, novaQuantidade);\n                renderizarItensCarrinho();\n                montarHeader(); // ===== CORREÇÃO 1: ATUALIZA O HEADER =====\n            }\n        });\n    });\n\n    document.querySelectorAll('.remove-btn').forEach(button => {\n        button.addEventListener('click', () => {\n            const itemId = button.dataset.itemId;\n            if (confirm('Tem certeza que deseja remover este item?')) {\n                removeItemFromCart(itemId);\n                renderizarItensCarrinho();\n                montarHeader(); // ===== CORREÇÃO 2: ATUALIZA O HEADER =====\n            }\n        });\n    });\n}\n\nasync function finalizarPedido() {\n    const cart = getCart();\n    if (cart.length === 0) {\n        alert('Seu carrinho está vazio.');\n        return;\n    }\n    \n    const loja_id = cart[0].loja_id; \n    const total = getSubtotal();\n\n    const orderData = {\n        items: cart,\n        total: total,\n        loja_id: loja_id\n    };\n\n    const checkoutButton = document.getElementById('checkout-button');\n    checkoutButton.disabled = true;\n    checkoutButton.textContent = 'Processando...';\n    \n    const result = await createOrder(orderData);\n\n    if (result && !result.error) {\n        clearCart();\n        montarHeader(); // ===== CORREÇÃO 3: ATUALIZA O HEADER APÓS FINALIZAR =====\n        alert('Pedido realizado com sucesso!');\n        window.location.href = '/frontend/Pedidos.html';\n    } else {\n        alert('Houve um erro ao finalizar seu pedido. Por favor, tente novamente.');\n        checkoutButton.disabled = false;\n        checkoutButton.textContent = 'Finalizar Pedido';\n    }\n}\n\ndocument.addEventListener('DOMContentLoaded', () => {\n    renderizarItensCarrinho();\n\n    const checkoutButton = document.getElementById('checkout-button');\n    if (checkoutButton) {\n        checkoutButton.addEventListener('click', finalizarPedido);\n    }\n});","size_bytes":5635},"backend/src/routes/pedidos.js":{"content":"const express = require('express');\nconst router = express.Router();\n// CORREÇÃO: Importando a função com o nome novo 'buscarPedidos'\nconst { criarPedido, buscarPedidos } = require('../controllers/pedidoController');\nconst authMiddleware = require('../middleware/authMiddleware');\n\n// Esta rota para criar o pedido já estava correta.\nrouter.post('/', authMiddleware, criarPedido);\n\n// CORREÇÃO: Usando a função com o nome novo 'buscarPedidos'\nrouter.get('/', authMiddleware, buscarPedidos);\n\nmodule.exports = router;","size_bytes":525},"loja-frontend/js/dashboard.js":{"content":"import { fetchDashboardStats, fetchSalesChartData } from './api/dashboardApi.js';\n\n// Esta variável vai guardar a instância do nosso gráfico para podermos atualizá-la\nlet salesChartInstance = null;\n\ndocument.addEventListener('DOMContentLoaded', () => {\n    // Proteção para garantir que o usuário está logado\n    if (!localStorage.getItem('userToken')) {\n        window.location.href = '/frontend/Clientes/login.html';\n        return;\n    }\n\n    // Funções que rodam assim que a página carrega\n    carregarEstatisticas();\n    carregarGraficoDeVendas('7d');\n    configurarBotoesDePeriodo();\n    carregarPedidosRecentes();\n    carregarTabelaDeProdutos();\n    carregarProdutosMaisVendidos();\n    carregarAvaliacoesRecentes();\n    configurarLogout();\n});\n\nfunction configurarLogout() {\n    const logoutButton = document.getElementById('logout-button');\n    if (logoutButton) {\n        logoutButton.addEventListener('click', () => {\n            localStorage.clear();\n            window.location.href = '/frontend/Clientes/login.html';\n        });\n    }\n}\n\nasync function carregarEstatisticas() {\n    const stats = await fetchDashboardStats();\n    if (!stats) return;\n\n    document.getElementById('stats-total-pedidos').textContent = stats.totalPedidos;\n    document.getElementById('stats-faturamento').textContent = `R$ ${stats.faturamento.toFixed(2).replace('.', ',')}`;\n    document.getElementById('stats-novos-clientes').textContent = stats.novosClientes;\n\n    const avaliacaoContainer = document.getElementById('stats-avaliacao-media');\n    if (avaliacaoContainer) {\n        const nota = parseFloat(stats.avaliacaoMedia) || 0;\n        let estrelasHtml = '';\n        for (let i = 1; i <= 5; i++) {\n            const cor = i <= nota ? 'text-yellow-400' : 'text-gray-300';\n            estrelasHtml += `<svg class=\"w-5 h-5 ${cor}\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\"></path></svg>`;\n        }\n        avaliacaoContainer.innerHTML = `<p class=\"text-2xl font-bold mr-1\">${nota.toFixed(1)}</p><div class=\"flex\">${estrelasHtml}</div>`;\n    }\n}\n\nfunction configurarBotoesDePeriodo() {\n    const containerBotoes = document.getElementById('periodo-vendas-botoes');\n    if (!containerBotoes) return;\n\n    containerBotoes.addEventListener('click', (event) => {\n        const target = event.target.closest('.sales-period-btn');\n        if (!target) return;\n\n        // Lógica para o efeito visual de \"botão ativo\"\n        containerBotoes.querySelectorAll('.sales-period-btn').forEach(btn => {\n            btn.classList.remove('bg-yellow-400', 'text-black');\n            btn.classList.add('bg-gray-100', 'hover:bg-gray-200');\n        });\n        target.classList.add('bg-yellow-400', 'text-black');\n        target.classList.remove('bg-gray-100', 'hover:bg-gray-200');\n\n        const period = target.dataset.period;\n        carregarGraficoDeVendas(period);\n    });\n}\n\nasync function carregarGraficoDeVendas(period) {\n    const chartData = await fetchSalesChartData(period);\n    if (!chartData) return;\n\n    const ctx = document.getElementById('salesChart').getContext('2d');\n\n    // Se um gráfico antigo já existe, o destruímos antes de desenhar o novo\n    if (salesChartInstance) {\n        salesChartInstance.destroy();\n    }\n\n    salesChartInstance = new Chart(ctx, {\n        type: 'line',\n        data: {\n            labels: chartData.labels,\n            datasets: [{\n                label: 'Vendas (R$)',\n                data: chartData.data,\n                backgroundColor: 'rgba(255, 209, 0, 0.2)',\n                borderColor: '#FFD100',\n                borderWidth: 2,\n                tension: 0.3,\n                pointBackgroundColor: '#FFD100',\n            }]\n        },\n        options: {\n            responsive: true,\n            maintainAspectRatio: false,\n            scales: { y: { beginAtZero: true } },\n            plugins: { legend: { display: false } }\n        }\n    });\n}\n\nasync function carregarPedidosRecentes() {\n    const token = localStorage.getItem('userToken');\n    if (!token) {\n        console.error('Token não encontrado.');\n        return;\n    }\n\n    const container = document.getElementById('recent-orders-container');\n    if (!container) {\n        console.error('Container de pedidos recentes não encontrado.');\n        return;\n    }\n\n    const nomeCliente = pedido.perfis ? pedido.perfis.nome_completo : 'Cliente Anônimo';\n\n    try {\n        const response = await fetch(`${window.location.origin}/api/dashboard/loja/pedidos-recentes`, {\n            headers: { 'Authorization': `Bearer ${token}` }\n        });\n\n        if (!response.ok) {\n            throw new Error('Falha ao buscar os pedidos do servidor.');\n        }\n\n        const pedidos = await response.json();\n        container.innerHTML = ''; // Limpa a mensagem \"Carregando...\"\n\n        if (pedidos.length === 0) {\n            container.innerHTML = '<p class=\"text-center text-gray-500 p-4\">Nenhum pedido recente encontrado.</p>';\n            return;\n        }\n\n        const statusMap = {\n            'Pendente': 'text-gray-800 bg-gray-100',\n            'Confirmado': 'text-cyan-800 bg-cyan-100',\n            'Em preparo': 'text-yellow-800 bg-yellow-100',\n            'A caminho': 'text-blue-800 bg-blue-100',\n            'Entregue': 'text-green-800 bg-green-100',\n            'Cancelado': 'text-red-800 bg-red-100',\n        };\n\n        pedidos.forEach((pedido, index) => {\n            const agora = new Date();\n            const dataPedido = new Date(pedido.created_at);\n            const diffMinutos = Math.round((agora - dataPedido) / (1000 * 60));\n\n            let tempoAtras = `${diffMinutos} min atrás`;\n            if (diffMinutos >= 60) {\n                const diffHoras = Math.floor(diffMinutos / 60);\n                tempoAtras = `${diffHoras}h atrás`;\n            }\n\n            tr.innerHTML = `\n            <div class=\"flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors\">\n                <div class=\"flex-shrink-0 w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center\">\n                    <span class=\"font-semibold text-blue-600\">#${index + 1}</span>\n                </div>\n                <div class=\"ml-3 flex-1\">\n                    <p class=\"text-sm font-medium\">Cliente ID: ${pedido.cliente_id.substring(0, 8)}...</p>\n                    <p class=\"text-xs text-gray-500\">Pedido #${pedido.id.substring(0, 6)}... • ${tempoAtras}</p>\n                </div>\n                <div class=\"text-right\">\n                    <p class=\"text-sm font-semibold\">${pedido.valor_total.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</p>\n                    <span class=\"inline-block px-2 py-1 text-xs rounded-full ${statusMap[pedido.status] || statusMap['Pendente']}\">\n                        ${pedido.status}\n                    </span>\n                </div>\n                <div class=\"ml-3 flex-1\">\n                    <p class=\"text-sm font-medium\">${nomeCliente}</p>\n                    <p class=\"text-xs text-gray-500\">Pedido #${pedido.id.substring(0, 6)}... • ${tempoAtras}</p>\n                </div>\n            </div>\n        `;\n            container.innerHTML += itemHtml;\n        });\n\n    } catch (error) {\n        console.error('Erro ao carregar pedidos recentes:', error.message);\n        container.innerHTML = '<p class=\"text-center text-red-500 p-4\">Erro ao carregar os pedidos.</p>';\n    }\n}\n\nfunction criarItemPedidoHtml(pedido) {\n    const nomeCliente = pedido.cliente ? pedido.cliente.nome_completo : 'Cliente Anônimo';\n    const agora = new Date();\n    const dataPedido = new Date(pedido.created_at);\n    const diffMinutos = Math.round((agora - dataPedido) / (1000 * 60));\n\n    const statusMap = {\n        'Pendente': 'text-gray-800 bg-gray-100',\n        'Em preparo': 'text-yellow-800 bg-yellow-100',\n        'Entregue': 'text-green-800 bg-green-100',\n        'Cancelado': 'text-red-800 bg-red-100',\n    };\n\n    return `\n        <div class=\"flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors\">\n            <div class=\"flex-shrink-0 w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center\">\n                <span class=\"font-semibold text-blue-600\">#${pedido.id}</span>\n            </div>\n            <div class=\"ml-3 flex-1\">\n                <p class=\"text-sm font-medium\">${nomeCliente}</p>\n                <p class=\"text-xs text-gray-500\">${diffMinutos} min atrás</p>\n            </div>\n            <div class=\"text-right\">\n                <p class=\"text-sm font-semibold\">R$ ${pedido.valor_total.toFixed(2).replace('.', ',')}</p>\n                <span class=\"inline-block px-2 py-1 text-xs rounded-full ${statusMap[pedido.status] || statusMap['Pendente']}\">\n                    ${pedido.status}\n                </span>\n            </div>\n        </div>\n    `;\n}\n\nasync function carregarTabelaDeProdutos() {\n    const token = localStorage.getItem('userToken');\n    const tbody = document.getElementById('produtos-tbody');\n\n    if (!tbody) {\n        console.error('Elemento #produtos-tbody não encontrado.');\n        return;\n    }\n\n    // Exibe uma mensagem de carregamento\n    tbody.innerHTML = '<tr><td colspan=\"4\" class=\"px-6 py-4 text-center text-gray-500\">Carregando produtos...</td></tr>';\n\n    try {\n        const response = await fetch(`${window.location.origin}/api/dashboard/loja/produtos`, {\n            headers: { 'Authorization': `Bearer ${token}` }\n        });\n\n        if (!response.ok) {\n            throw new Error('Falha ao buscar produtos do servidor.');\n        }\n\n        const produtos = await response.json();\n        tbody.innerHTML = ''; // Limpa a mensagem de carregamento\n\n        if (produtos.length === 0) {\n            tbody.innerHTML = '<tr><td colspan=\"4\" class=\"px-6 py-4 text-center text-gray-500\">Nenhum produto cadastrado.</td></tr>';\n            return;\n        }\n\n        produtos.forEach(produto => {\n            const tr = document.createElement('tr');\n\n            const statusClass = produto.disponivel ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';\n            const statusText = produto.disponivel ? 'Disponível' : 'Indisponível';\n            const precoFormatado = produto.preco ? `R$ ${produto.preco.toFixed(2).replace('.', ',')}` : 'Não definido';\n\n            tr.innerHTML = `\n                <td class=\"px-6 py-4 whitespace-nowrap\">\n                    <div class=\"flex items-center\">\n                        <div class=\"flex-shrink-0 h-10 w-10\">\n                            <img class=\"h-10 w-10 rounded-full object-cover\" src=\"${produto.imagem_url || 'https://via.placeholder.com/150'}\" alt=\"${produto.nome}\">\n                        </div>\n                        <div class=\"ml-4\">\n                            <div class=\"text-sm font-medium text-gray-900\">${produto.nome}</div>\n                        </div>\n                    </div>\n                </td>\n                <td class=\"px-6 py-4 whitespace-nowrap\">\n                    <div class=\"text-sm text-gray-900\">${precoFormatado}</div>\n                </td>\n                <td class=\"px-6 py-4 whitespace-nowrap\">\n                    <span class=\"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}\">\n                        ${statusText}\n                    </span>\n                </td>\n                <td class=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium\">\n                    <a href=\"#\" class=\"text-yellow-600 hover:text-yellow-900\">Editar</a>\n                </td>\n            `;\n            tbody.appendChild(tr);\n        });\n\n    } catch (error) {\n        console.error('Erro ao carregar produtos:', error);\n        tbody.innerHTML = '<tr><td colspan=\"4\" class=\"px-6 py-4 text-center text-red-500\">Erro ao carregar produtos.</td></tr>';\n    }\n}\n\nasync function carregarProdutosMaisVendidos() {\n    const token = localStorage.getItem('userToken');\n    const container = document.getElementById('produtos-mais-vendidos-container');\n    if (!container) return;\n\n    try {\n        const response = await fetch(`${window.location.origin}/api/dashboard/loja/produtos-mais-vendidos`, {\n            headers: { 'Authorization': `Bearer ${token}` }\n        });\n        if (!response.ok) throw new Error('Falha ao buscar dados do servidor.');\n\n        const produtos = await response.json();\n        container.innerHTML = '';\n\n        if (produtos.length === 0) {\n            container.innerHTML = '<p class=\"text-sm text-gray-500 text-center\">Ainda não há dados de vendas.</p>';\n            return;\n        }\n\n        const maxVendas = Math.max(...produtos.map(p => p.total_vendido));\n\n        produtos.forEach((produto, index) => {\n            const progresso = maxVendas > 0 ? (produto.total_vendido / maxVendas) * 100 : 0;\n            const itemHtml = `\n                <div class=\"flex items-center\">\n                    <div class=\"h-10 w-10 rounded-md bg-gray-200 flex-shrink-0 flex items-center justify-center\">\n                        <span class=\"font-semibold text-gray-600\">${index + 1}</span>\n                    </div>\n                    <div class=\"ml-3 flex-1\">\n                        <div class=\"flex justify-between\">\n                            <p class=\"text-sm font-medium\">${produto.nome_produto}</p>\n                            <p class=\"text-sm font-semibold\">${produto.total_vendido} vendas</p>\n                        </div>\n                        <div class=\"w-full bg-gray-200 rounded-full h-2 mt-2\">\n                            <div class=\"bg-yellow-400 h-2 rounded-full\" style=\"width: ${progresso}%\"></div>\n                        </div>\n                    </div>\n                </div>\n            `;\n            container.innerHTML += itemHtml;\n        });\n\n    } catch (error) {\n        console.error('Erro ao carregar produtos mais vendidos:', error);\n        container.innerHTML = '<p class=\"text-sm text-red-500 text-center\">Não foi possível carregar os dados.</p>';\n    }\n}\n\nasync function carregarAvaliacoesRecentes() {\n    const token = localStorage.getItem('userToken');\n    const container = document.getElementById('avaliacoes-recentes-container');\n    if (!container) return;\n\n    try {\n        const response = await fetch(`${window.location.origin}/api/dashboard/loja/avaliacoes-recentes`, {\n            headers: { 'Authorization': `Bearer ${token}` }\n        });\n\n        if (!response.ok) {\n            throw new Error('Falha ao buscar avaliações.');\n        }\n\n        const avaliacoes = await response.json();\n        container.innerHTML = ''; // Limpa o \"Carregando...\"\n\n        if (avaliacoes.length === 0) {\n            container.innerHTML = '<p class=\"text-sm text-gray-500 text-center\">Nenhuma avaliação recente encontrada.</p>';\n            return;\n        }\n\n        avaliacoes.forEach(avaliacao => {\n            const nomeCliente = avaliacao.cliente ? avaliacao.cliente.nome_completo : 'Cliente';\n            // Gera as iniciais a partir do nome do cliente\n            const iniciais = nomeCliente.split(' ').map(n => n[0]).join('').substring(0, 2);\n            \n            let estrelasHtml = '';\n            for (let i = 1; i <= 5; i++) {\n                const cor = i <= avaliacao.nota ? 'text-yellow-400 fill-current' : 'text-gray-300';\n                // Código completo do SVG da estrela\n                estrelasHtml += `<svg class=\"feather feather-star h-4 w-4 ${cor}\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><polygon points=\"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2\"></polygon></svg>`;\n            }\n\n            const itemHtml = `\n                <div class=\"border-b pb-4\">\n                    <div class=\"flex justify-between items-start\">\n                        <div class=\"flex items-center\">\n                            <div class=\"h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0\">\n                                <span class=\"font-semibold text-blue-600\">${iniciais}</span>\n                            </div>\n                            <div class=\"ml-3\">\n                                <p class=\"text-sm font-medium\">${nomeCliente}</p>\n                                <p class=\"text-xs text-gray-500\">${new Date(avaliacao.created_at).toLocaleDateString('pt-BR')}</p>\n                            </div>\n                        </div>\n                        <div class=\"flex\">${estrelasHtml}</div>\n                    </div>\n                    <p class=\"text-sm mt-2 text-gray-600\">${avaliacao.comentario || 'O cliente não deixou um comentário.'}</p>\n                </div>\n            `;\n            container.innerHTML += itemHtml;\n        });\n\n    } catch (error) {\n        console.error('Erro ao carregar avaliações:', error);\n        container.innerHTML = '<p class=\"text-sm text-red-500 text-center\">Não foi possível carregar as avaliações.</p>';\n    }\n}","size_bytes":17345},"backend/src/controllers/pedidoController.js":{"content":"const supabase = require('../config/supabaseClient');\n\nconst criarPedido = async (req, res) => {\n    const { items, total, loja_id } = req.body;\n    const user = req.user;\n    try {\n        const { data: novoPedido, error: pedidoError } = await supabase.from('pedidos').insert({ user_id: user.id, total: total, status: 'Pendente', loja_id: loja_id }).select().single();\n        if (pedidoError) throw pedidoError;\n        const itensParaInserir = items.map(item => ({ pedido_id: novoPedido.id, produto_id: item.id, quantidade: item.quantidade, preco_unitario: item.preco }));\n        const { error: itensError } = await supabase.from('pedido_itens').insert(itensParaInserir);\n        if (itensError) {\n            await supabase.from('pedidos').delete().eq('id', novoPedido.id);\n            throw itensError;\n        }\n        res.status(201).json({ message: 'Pedido criado com sucesso!', pedido: novoPedido });\n    } catch (error) {\n        res.status(500).json({ error: 'Falha ao criar o pedido.' });\n    }\n};\n\nconst buscarPedidos = async (req, res) => {\n    const user = req.user;\n    const perfil = req.perfil; // Fornecido pelo nosso authMiddleware\n    const { status } = req.query;\n    try {\n        // Corrigido: 'lojas(nome_fantasia)' para buscar o nome correto da loja\n        let query = supabase.from('pedidos').select(`id, created_at, total, status, lojas ( nome_fantasia )`).order('created_at', { ascending: false });\n\n        // Se o usuário não for admin, ele só vê os próprios pedidos\n        if (perfil.tipo !== 'admin') {\n            query = query.eq('user_id', user.id);\n        }\n\n        if (status && status !== 'Todos os pedidos') {\n            query = query.eq('status', status);\n        }\n        const { data: pedidos, error: pedidosError } = await query;\n        if (pedidosError) throw pedidosError;\n        res.status(200).json(pedidos);\n    } catch (error) {\n        res.status(500).json({ error: 'Falha ao buscar os pedidos.' });\n    }\n};\n\nmodule.exports = { criarPedido, buscarPedidos: buscarPedidos };","size_bytes":2039},"loja-frontend/js/pages/produtos.js":{"content":"document.addEventListener('DOMContentLoaded', function () {\n    // --- LÓGICA DO LAYOUT (SIDEBAR, ETC.) ---\n    feather.replace();\n\n    const sidebar = document.getElementById('sidebar');\n    const content = document.querySelector('.main-content-wrapper') || document.getElementById('content');\n    const sidebarToggle = document.getElementById('sidebar-toggle');\n\n    if (sidebarToggle && sidebar && content) {\n        sidebarToggle.addEventListener('click', function () {\n            sidebar.classList.toggle('show');\n        });\n    }\n\n    // --- LÓGICA DE VISUALIZAÇÃO (GRID/LISTA) ---\n    const gridViewBtn = document.getElementById('gridViewBtn');\n    const listViewBtn = document.getElementById('listViewBtn');\n    const gridView = document.getElementById('gridView');\n    const listView = document.getElementById('listView');\n\n    if (gridViewBtn && listViewBtn && gridView && listView) {\n        gridViewBtn.addEventListener('click', function () {\n            gridView.classList.remove('hidden');\n            if(listView) listView.classList.add('hidden');\n            gridViewBtn.classList.add('bg-gray-100');\n            listViewBtn.classList.remove('bg-gray-100');\n        });\n\n        listViewBtn.addEventListener('click', function () {\n            if(gridView) gridView.classList.add('hidden');\n            listView.classList.remove('hidden');\n            gridViewBtn.classList.remove('bg-gray-100');\n            listViewBtn.classList.add('bg-gray-100');\n        });\n    }\n    \n    // --- CONTROLE DE TODOS OS MODAIS DA PÁGINA ---\n    function setupModal(btnId, modalId, closeSelectors) {\n        const btn = document.getElementById(btnId);\n        const modal = document.getElementById(modalId);\n        \n        if (btn && modal) {\n            const closeBtns = modal.querySelectorAll(closeSelectors);\n            const show = () => modal.classList.remove('hidden');\n            const hide = () => modal.classList.add('hidden');\n\n            btn.addEventListener('click', show);\n            closeBtns.forEach(cb => cb.addEventListener('click', hide));\n            \n            modal.addEventListener('click', (event) => {\n                if (event.target === modal) hide();\n            });\n        }\n    }\n\n    setupModal('addProductBtn', 'productDetailModal', '#closeProductModal, .btn-cancelar');\n    setupModal('importExportBtn', 'importExportModal', '#closeImportExportModal');\n\n    const dropzone = document.getElementById('dropzone');\n    const fileInput = document.getElementById('fileInput');\n    const imagePreviewContainer = document.getElementById('imagePreviewContainer');\n\n    if (dropzone && fileInput && imagePreviewContainer) {\n        dropzone.addEventListener('click', () => fileInput.click());\n\n        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {\n            dropzone.addEventListener(eventName, preventDefaults, false);\n        });\n\n        function preventDefaults(e) {\n            e.preventDefault();\n            e.stopPropagation();\n        }\n\n        ['dragenter', 'dragover'].forEach(eventName => {\n            dropzone.addEventListener(eventName, () => dropzone.classList.add('border-yellow-500'), false);\n        });\n\n        ['dragleave', 'drop'].forEach(eventName => {\n            dropzone.addEventListener(eventName, () => dropzone.classList.remove('border-yellow-500'), false);\n        });\n\n        dropzone.addEventListener('drop', (e) => {\n            handleFiles(e.dataTransfer.files);\n        }, false);\n\n        fileInput.addEventListener('change', (e) => {\n            handleFiles(e.target.files);\n        });\n\n        function handleFiles(files) {\n            for (const file of files) {\n                if (!file.type.startsWith('image/')) continue;\n\n                const reader = new FileReader();\n                reader.onload = function (e) {\n                    const div = document.createElement('div');\n                    div.className = 'relative w-24 h-24 m-1'; // Estilo para a miniatura\n                    div.innerHTML = `\n                        <img src=\"${e.target.result}\" class=\"w-full h-full object-cover rounded-md\">\n                        <button type=\"button\" class=\"remove-btn absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-lg font-bold leading-none\">&times;</button>\n                    `;\n                    imagePreviewContainer.appendChild(div);\n\n                    div.querySelector('.remove-btn').addEventListener('click', function () {\n                        div.remove();\n                    });\n                };\n                reader.readAsDataURL(file);\n            }\n        }\n    }\n\n    // --- LÓGICA DE DADOS (API) ---\n    const produtosTabelaBody = document.querySelector('#listView tbody');\n    const formAdicionarProduto = document.querySelector('#productDetailModal form');\n    const API_BASE_URL = `${window.location.origin}/api/dashboard/loja`;\n    const token = localStorage.getItem('token');\n\n    if (!produtosTabelaBody || !formAdicionarProduto) {\n        console.error(\"Não foi possível encontrar a tabela (#listView tbody) ou o formulário (#productDetailModal form).\");\n        return;\n    }\n\n    const renderizarLinhaProduto = (produto) => {\n        const tr = document.createElement('tr');\n        tr.className = 'hover:bg-gray-50';\n        tr.innerHTML = `\n            <td class=\"p-4\">\n                <img src=\"${produto.imagem_url || 'https://via.placeholder.com/80'}\" alt=\"${produto.nome}\" class=\"w-16 h-16 object-cover rounded-md\">\n            </td>\n            <td class=\"p-4 font-medium text-gray-800\">\n                ${produto.nome}\n            </td>\n            <td class=\"p-4 text-gray-600\">\n                ${produto.categoria || 'N/A'}\n            </td>\n            <td class=\"p-4 font-semibold\">\n                R$ ${parseFloat(produto.preco).toFixed(2)}\n            </td>\n            <td class=\"p-4\">\n                <span class=\"px-2 py-1 text-xs font-semibold rounded-full ${produto.disponivel ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}\">\n                    ${produto.disponivel ? 'Ativo' : 'Inativo'}\n                </span>\n            </td>\n            <td class=\"p-4 text-right\">\n                <button class=\"text-blue-600 hover:text-blue-800 mr-2 btn-editar\" data-produto-id=\"${produto.id}\">\n                    Editar\n                </button>\n                <button class=\"text-red-600 hover:text-red-700 btn-deletar\" data-produto-id=\"${produto.id}\">\n                    Excluir\n                </button>\n            </td>\n        `;\n        return tr;\n    };\n\n    // Função para carregar os produtos\n    const carregarProdutos = async () => {\n        if (!token) {\n            produtosTabelaBody.innerHTML = '<tr><td colspan=\"6\" class=\"p-4 text-center\">Não autenticado.</td></tr>';\n            return;\n        }\n        produtosTabelaBody.innerHTML = '<tr><td colspan=\"6\" class=\"p-4 text-center\">Carregando...</td></tr>';\n        try {\n            const response = await fetch(`${API_BASE_URL}/produtos`, { headers: { 'Authorization': `Bearer ${token}` } });\n            if (!response.ok) throw new Error('Falha ao buscar produtos');\n            const produtos = await response.json();\n            produtosTabelaBody.innerHTML = '';\n\n            if (produtos.length === 0) {\n                produtosTabelaBody.innerHTML = '<tr><td colspan=\"6\" class=\"p-4 text-center\">Nenhum produto cadastrado.</td></tr>';\n            } else {\n                produtos.forEach(produto => {\n                    const linhaProduto = renderizarLinhaProduto(produto);\n                    produtosTabelaBody.appendChild(linhaProduto);\n                });\n            }\n        } catch (error) {\n            console.error('Erro ao carregar produtos:', error);\n            produtosTabelaBody.innerHTML = `<tr><td colspan=\"6\" class=\"p-4 text-center text-red-500\">Erro ao carregar produtos.</td></tr>`;\n        }\n    };\n\n    // Função para lidar com o envio do formulário\n    const handleAdicionarProduto = async (event) => {\n        event.preventDefault();\n\n        const formData = new FormData();\n        const form = event.target;\n\n        // Função para encontrar um campo pelo texto do seu label.\n        // Isso nos protege caso os IDs dos campos não estejam definidos no HTML.\n        const findInputByLabel = (labelText) => {\n            const labels = Array.from(form.querySelectorAll('label'));\n            const label = labels.find(l => l.textContent.trim().includes(labelText));\n            return label ? (label.parentElement.querySelector('input, select, textarea') || label.nextElementSibling?.querySelector('input')) : null;\n        };\n\n        // Coletando TODOS os campos do seu formulário, incluindo os que eu havia removido por engano.\n        formData.append('nome', findInputByLabel('Nome do Produto')?.value || '');\n        formData.append('preco', findInputByLabel('Preço (R$)')?.value || '');\n        formData.append('preco_promocional', findInputByLabel('Preço Promocional')?.value || '');\n        formData.append('categoria', findInputByLabel('Categoria')?.value || '');\n        formData.append('sku', findInputByLabel('Código do Produto')?.value || '');\n        formData.append('tags', findInputByLabel('Tags')?.value || '');\n        formData.append('descricao', findInputByLabel('Descrição')?.value || '');\n        \n        // Coletando o estado dos toggles (ativo/inativo, promoção)\n        const statusToggle = findInputByLabel('Status');\n        formData.append('disponivel', statusToggle ? statusToggle.checked : false);\n        const promocaoToggle = findInputByLabel('Promoção');\n        formData.append('em_promocao', promocaoToggle ? promocaoToggle.checked : false);\n\n        // Coletando os campos de Informações Adicionais\n        formData.append('tempo_preparo', findInputByLabel('Tempo de Preparo')?.value || '');\n        formData.append('disponibilidade_horario', findInputByLabel('Disponibilidade')?.value || '');\n        \n        // Anexando o arquivo de imagem\n        if (fileInput.files.length > 0) {\n            formData.append('imagem', fileInput.files[0]);\n        }\n\n        const result = await addProduct(formData);\n\n        if (result.error) {\n            alert(`Erro ao salvar: ${result.error.message}`);\n        } else {\n            alert('Produto salvo com sucesso!');\n            document.getElementById('productDetailModal').classList.add('hidden');\n            await carregarProdutos(); // Sua função para recarregar a lista.\n        }\n    };\n\n    if (formAdicionarProduto) {\n        formAdicionarProduto.addEventListener('submit', handleAdicionarProduto);\n    }\n\n    carregarProdutos();\n});\n\n// Este código seria adicionado ao seu arquivo produtos.js\n\n// --- CONTROLE DO MODAL DE CATEGORIAS ---\nconst manageCategoriesBtn = document.getElementById('manageCategoriesBtn');\nconst categoryModal = document.getElementById('categoryManagerModal');\nconst closeCategoryModalBtn = document.getElementById('closeCategoryModal');\nconst addCategoryBtn = document.getElementById('addCategoryBtn');\nconst newCategoryInput = document.getElementById('newCategoryName');\nconst categoryList = document.getElementById('categoryList');\n\n// Função para abrir o modal de categorias\nif (manageCategoriesBtn && categoryModal) {\n    manageCategoriesBtn.addEventListener('click', () => {\n        categoryModal.classList.remove('hidden');\n        // Futuramente, aqui chamaríamos a função para carregar as categorias da API\n        // loadCategories(); \n    });\n}\n\n// Função para fechar o modal de categorias\nif (closeCategoryModalBtn && categoryModal) {\n    closeCategoryModalBtn.addEventListener('click', () => {\n        categoryModal.classList.add('hidden');\n    });\n}\n\n// Função para adicionar uma nova categoria (simulação)\nif (addCategoryBtn && newCategoryInput && categoryList) {\n    addCategoryBtn.addEventListener('click', () => {\n        const categoryName = newCategoryInput.value.trim();\n        if (categoryName === '') {\n            alert('Por favor, digite um nome para a categoria.');\n            return;\n        }\n        \n        // Simulação: Adiciona o item na lista da tela\n        const newListItem = document.createElement('li');\n        newListItem.className = 'flex justify-between items-center bg-gray-100 p-2 rounded-md';\n        newListItem.innerHTML = `\n            <span>${categoryName}</span>\n            <button class=\"text-gray-400 hover:text-red-500\"><i class=\"fas fa-trash-alt\"></i></button>\n        `;\n        categoryList.appendChild(newListItem);\n        \n        // Limpa o campo de input\n        newCategoryInput.value = '';\n\n        // Futuramente, aqui chamaríamos a API para salvar a nova categoria no banco\n        // await api_addCategory(categoryName);\n        console.log(`Simulação: Categoria \"${categoryName}\" adicionada.`);\n    });\n}","size_bytes":12884},"frontend/js/shared/auth.js":{"content":"\n// PASSO 1: Importa a função 'createClient' diretamente da biblioteca do Supabase.\nimport { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';\n\n// ATENÇÃO: Verifique se suas chaves do Supabase estão corretas aqui.\nconst SUPABASE_URL = 'https://jrskruadcwuytvjeqybh.supabase.co';\nconst SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Impyc2tydWFkY3d1eXR2amVxeWJoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkyMjc4OTMsImV4cCI6MjA2NDgwMzg5M30.JzNlpPJ7jAONIpUK92zg-6YLPK6WRRfhotYiMu6KFjs';\n\n// PASSO 2: Agora usamos a função 'createClient' diretamente para criar nossa conexão.\nexport const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);\n\n/**\n * Verifica a sessão atual do usuário.\n * @returns {Promise<import('@supabase/supabase-js').User | null>} O objeto do usuário se estiver logado, ou nulo.\n */\nexport async function getUser() {\n    const { data: { session } } = await supabase.auth.getSession();\n    if (session) {\n        return session.user;\n    }\n    return null;\n}\n\n/**\n * Função para fazer logout.\n */\nexport async function signOut() {\n    const { error } = await supabase.auth.signOut();\n    if (error) {\n        console.error('Erro ao fazer logout:', error);\n    } else {\n        // Redireciona para a página inicial após o logout\n        window.location.href = '/frontend/Inicio.html';\n    }\n}","size_bytes":1380},"pedai-nextjs/app/page.tsx":{"content":"import Link from 'next/link'\nimport { getAllTenants } from '@/lib/tenantConfig'\n\nexport default function Home() {\n  const allTenants = getAllTenants()\n  \n  // Reorder to put Alagoa Nova in the center\n  const orderedTenants = [\n    allTenants.find(t => t.slug === 'esperanca'),\n    allTenants.find(t => t.slug === 'alagoa-nova'),\n    allTenants.find(t => t.slug === 'lagoa-seca'),\n  ].filter((t): t is NonNullable<typeof t> => t !== undefined)\n  \n  return (\n    <div className=\"min-h-screen bg-secondary text-white\">\n      <div className=\"container mx-auto px-4 py-16\">\n        <div className=\"flex flex-col items-center justify-center min-h-[60vh]\">\n          <div className=\"flex items-center mb-8\">\n            <svg className=\"h-24 w-24 lightning-logo\" viewBox=\"0 0 24 24\">\n              <circle cx=\"12\" cy=\"12\" r=\"11\" fill=\"#FFD100\"></circle>\n              <circle cx=\"12\" cy=\"12\" r=\"9\" fill=\"#1A1A1A\"></circle>\n              <path d=\"M13 6L7 14h4v4l6-8h-4V6z\" fill=\"#FFD100\"></path>\n            </svg>\n          </div>\n          <h1 className=\"text-6xl font-bold mb-4\">\n            Pede<span className=\"text-primary\">Aí</span>\n          </h1>\n          <p className=\"text-2xl text-gray-300 mb-12\">\n            Delivery local para sua cidade\n          </p>\n\n          <div className=\"w-full max-w-2xl\">\n            <h2 className=\"text-2xl font-bold text-center mb-6\">\n              Escolha seu município:\n            </h2>\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n              {orderedTenants.map((tenant) => (\n                <Link\n                  key={tenant.id}\n                  href={`/${tenant.slug}`}\n                  className=\"p-6 rounded-lg border-2 text-center hover:scale-105 transition-transform\"\n                  style={{ borderColor: tenant.theme.primary }}\n                >\n                  <h3 \n                    className=\"text-xl font-bold mb-2\"\n                    style={{ color: tenant.theme.primary }}\n                  >\n                    {tenant.name}\n                  </h3>\n                  <p className=\"text-sm text-gray-400\">{tenant.state}</p>\n                </Link>\n              ))}\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":2242},"pedai-nextjs/middleware.ts":{"content":"import { type NextRequest } from 'next/server'\nimport { updateSession } from '@/lib/supabase/middleware'\nimport { getTenantBySlug } from '@/lib/tenantConfig'\n\nexport async function middleware(request: NextRequest) {\n  const { pathname } = request.nextUrl\n  \n  // Extract potential tenant slug from path\n  const pathParts = pathname.split('/').filter(Boolean)\n  const potentialSlug = pathParts[0]\n  \n  // Check if this is a tenant route\n  const tenant = getTenantBySlug(potentialSlug)\n  \n  // Update Supabase session\n  const { supabaseResponse } = await updateSession(request)\n  \n  // Add tenant info to response headers if tenant exists\n  if (tenant) {\n    supabaseResponse.headers.set('x-tenant-slug', tenant.slug)\n    supabaseResponse.headers.set('x-tenant-name', tenant.name)\n  }\n  \n  return supabaseResponse\n}\n\nexport const config = {\n  matcher: [\n    '/((?!_next/static|_next/image|favicon.ico|.*\\\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)',\n  ],\n}\n","size_bytes":948},"pedai-nextjs/lib/supabase/server.ts":{"content":"import { createServerClient } from '@supabase/ssr'\nimport { cookies } from 'next/headers'\n\nexport async function createClient(accessToken?: string) {\n  const cookieStore = await cookies()\n\n  return createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return cookieStore.getAll()\n        },\n        setAll(cookiesToSet) {\n          try {\n            cookiesToSet.forEach(({ name, value, options }) =>\n              cookieStore.set(name, value, options)\n            )\n          } catch {\n            // The `setAll` method was called from a Server Component.\n            // This can be ignored if you have middleware refreshing\n            // user sessions.\n          }\n        },\n      },\n      global: {\n        headers: accessToken ? {\n          Authorization: `Bearer ${accessToken}`,\n        } : {},\n      },\n    }\n  )\n}\n","size_bytes":934},"pedai-nextjs/app/layout.tsx":{"content":"import type { Metadata } from \"next\";\nimport { Poppins } from \"next/font/google\";\nimport \"./globals.css\";\nimport Providers from \"@/components/Providers\";\n\nconst poppins = Poppins({\n  weight: ['300', '400', '500', '600', '700', '800'],\n  subsets: ['latin'],\n  display: 'swap',\n});\n\nexport const metadata: Metadata = {\n  title: \"PedeAí - Delivery local para sua cidade\",\n  description: \"Comida, remédios, compras e muito mais. Entrega rápida para toda a cidade.\",\n};\n\nexport default function RootLayout({\n  children,\n}: Readonly<{\n  children: React.ReactNode;\n}>) {\n  return (\n    <html lang=\"pt-BR\">\n      <body className={poppins.className} suppressHydrationWarning>\n        <Providers>\n          {children}\n        </Providers>\n      </body>\n    </html>\n  );\n}\n","size_bytes":765},"pedai-nextjs/lib/supabase/client.ts":{"content":"import { createBrowserClient } from '@supabase/ssr'\n\nexport function createClient() {\n  return createBrowserClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          // Fallback to localStorage if cookies don't work (iframe issues in Replit)\n          const session = localStorage.getItem('supabase.auth.token')\n          if (session) {\n            return [\n              {\n                name: 'sb-jrskruadcwuytvjeqybh-auth-token',\n                value: session,\n              },\n            ]\n          }\n          return []\n        },\n        setAll(cookiesToSet) {\n          // Store in localStorage as fallback\n          cookiesToSet.forEach(({ name, value }) => {\n            if (name.includes('auth-token')) {\n              localStorage.setItem('supabase.auth.token', value)\n            }\n          })\n        },\n      },\n    }\n  )\n}\n","size_bytes":936},"pedai-nextjs/tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nconst config: Config = {\n  content: [\n    \"./pages/**/*.{js,ts,jsx,tsx,mdx}\",\n    \"./components/**/*.{js,ts,jsx,tsx,mdx}\",\n    \"./app/**/*.{js,ts,jsx,tsx,mdx}\",\n  ],\n  theme: {\n    extend: {\n      colors: {\n        primary: '#FFD100',\n        secondary: '#1A1A1A',\n        detail: '#FFFFFF',\n      },\n    },\n  },\n  plugins: [],\n};\nexport default config;\n","size_bytes":398},"pedai-nextjs/app/api/test-supabase/route.ts":{"content":"import { createClient } from '@/lib/supabase/server'\nimport { NextResponse } from 'next/server'\n\nexport async function GET() {\n  try {\n    const supabase = await createClient()\n    \n    // Tentar buscar lojas como teste\n    const { data, error } = await supabase\n      .from('lojas')\n      .select('id, nome, municipio')\n      .limit(5)\n    \n    if (error) {\n      return NextResponse.json(\n        { success: false, error: error.message },\n        { status: 500 }\n      )\n    }\n    \n    return NextResponse.json({\n      success: true,\n      message: 'Supabase conectado com sucesso!',\n      lojas: data,\n    })\n  } catch (error) {\n    return NextResponse.json(\n      { success: false, error: String(error) },\n      { status: 500 }\n    )\n  }\n}\n","size_bytes":744},"replit.md":{"content":"# PedeAí - Plataforma de Delivery Multi-Municipal\n\n## Overview\n\nPedeAí is a full-stack Next.js 14 platform for local delivery services across multiple municipalities in Paraíba, Brazil. It supports multi-tenancy with dynamic theming and configurations for each municipality. The platform features a complete order placement and checkout flow, a comprehensive order management system for shopkeepers, and a professional admin panel for full platform management. The project's vision is to deliver a production-ready, scalable, and secure MVP that streamlines local delivery operations and provides efficient tools for businesses, enhancing user experience and ensuring financial integrity.\n\n## User Preferences\n\n- This project was created entirely with AI (Gemini/ChatGPT).\n- The developer has no prior programming experience.\n- The focus is on maintainability and scalability.\n\n## System Architecture\n\n**UI/UX Decisions:**\n- **Dynamic Theming:** Distinct primary color themes for each municipality (Alagoa Nova: yellow, Esperança: cyan, Lagoa Seca: green), with a consistent secondary dark color.\n- **Font:** Poppins (weights 300-800) for a modern and readable interface.\n- **Shared Components:** Reusable, tenant-aware components like SimpleHeader, Footer, CartButton, Logo, and LoginForm.\n- **Admin Panel:** Professional dark mode interface with fixed sidebar navigation and responsive design.\n\n**Technical Implementations:**\n- **Next.js 14 Fullstack:** Utilizes the App Router with TypeScript.\n- **Multi-Tenancy System:** Implemented with dynamic routes (`/[municipio]/*`), TypeScript types, and helper functions for tenant-specific settings.\n- **Server-Side Rendering (SSR):** Primarily uses Server Components with Supabase for data fetching, passing data to Client Components for interactivity.\n- **State Management:** Currently uses Context API for client-side state (e.g., shopping cart), with plans for Zustand integration.\n- **Authentication:** Supports four user types (client, shop, deliveryman, admin) with API routes for user creation and middleware for route protection. Session storage is adapted for Replit's iframe environment using localStorage.\n- **Shopping Cart:** Persistent cart via Context API and LocalStorage, including minimum order validation and delivery fee calculation.\n- **Order Management System for Shopkeepers:** Authenticated API endpoints and a dedicated UI page (`/loja/pedidos`) for viewing, filtering, and updating order statuses.\n- **Admin Account System:** A universal admin profile provides full access to platform statistics and comprehensive management modules via a professional admin panel.\n\n**Feature Specifications:**\n- **Complete Checkout Flow:** Dynamic shopping cart, checkout page with address forms and payment options (cash, PIX, card), and server-side validation.\n- **Secure API for Orders:** Ensures financial integrity with server-side price calculation, data validation, and atomic transactions. Supports guest checkout.\n- **Database Structure:** Includes tables for `perfis`, `lojas`, `produtos`, `pedidos`, `pedido_itens`, `configuracoes_plataforma`, `repasses_financeiros`, `auditoria`, and `cupons`. Features foreign keys, indexes, automatic `updated_at` triggers, and validation constraints.\n- **Audit System:** Automatic logging of critical admin operations with full before/after state tracking.\n- **Municipality-Based User Segmentation:** User registration includes municipality field with server-side validation and auto-detection based on URL.\n\n## External Dependencies\n\n- **Supabase:** Backend-as-a-service for database management, authentication, and SSR data fetching (`@supabase/ssr`).\n- **Next.js:** Web framework for the full-stack application.\n- **React:** JavaScript library for building user interfaces.\n- **Tailwind CSS:** Utility-first CSS styling framework with dark mode support.","size_bytes":3864},"pedai-nextjs/lib/supabase/middleware.ts":{"content":"import { createServerClient } from '@supabase/ssr'\nimport { NextResponse, type NextRequest } from 'next/server'\n\nexport async function updateSession(request: NextRequest) {\n  let supabaseResponse = NextResponse.next({\n    request,\n  })\n\n  const supabase = createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return request.cookies.getAll()\n        },\n        setAll(cookiesToSet) {\n          cookiesToSet.forEach(({ name, value }) => request.cookies.set(name, value))\n          supabaseResponse = NextResponse.next({\n            request,\n          })\n          cookiesToSet.forEach(({ name, value, options }) =>\n            supabaseResponse.cookies.set(name, value, options)\n          )\n        },\n      },\n    }\n  )\n\n  // IMPORTANT: Avoid writing any logic between createServerClient and\n  // supabase.auth.getUser(). A simple mistake could make it very hard to debug\n  // issues with users being randomly logged out.\n\n  const {\n    data: { user },\n  } = await supabase.auth.getUser()\n\n  // IMPORTANT: You must use the Response object returned from supabase.auth.getUser()\n  // to set cookies. Do not use the supabaseResponse object directly.\n\n  return { supabaseResponse, user }\n}\n","size_bytes":1294},"pedai-nextjs/next.config.js":{"content":"/** @type {import('next').NextConfig} */\nconst nextConfig = {\n  images: {\n    remotePatterns: [\n      {\n        protocol: 'https',\n        hostname: 'jrskruadcwuytvjeqybh.supabase.co',\n        pathname: '/storage/v1/object/public/**',\n      },\n      {\n        protocol: 'https',\n        hostname: 'via.placeholder.com',\n      },\n    ],\n  },\n}\n\nmodule.exports = nextConfig\n","size_bytes":372},"pedai-nextjs/app/globals.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n:root {\n  --color-primary: #FFD100;\n  --color-secondary: #1A1A1A;\n  --color-accent: #FFFFFF;\n}\n\nbody {\n  font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',\n    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',\n    sans-serif;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n.lightning-logo {\n  filter: drop-shadow(0 0 8px rgba(255, 209, 0, 0.5));\n}\n\n/* Utility classes for tenant theming */\n.bg-tenant-primary {\n  background-color: var(--color-primary);\n}\n\n.text-tenant-primary {\n  color: var(--color-primary);\n}\n\n.border-tenant-primary {\n  border-color: var(--color-primary);\n}\n\n.bg-tenant-secondary {\n  background-color: var(--color-secondary);\n}\n\n.text-tenant-secondary {\n  color: var(--color-secondary);\n}\n","size_bytes":860},"pedai-nextjs/components/ClientLayout.tsx":{"content":"import { ReactNode } from 'react'\nimport SimpleHeader from './SimpleHeader'\nimport Footer from './Footer'\nimport CartButton from './CartButton'\nimport TenantTheme from './TenantTheme'\nimport type { TenantConfig } from '@/lib/types/tenant'\n\ninterface ClientLayoutProps {\n  children: ReactNode\n  tenant?: TenantConfig\n  showHeader?: boolean\n  showFooter?: boolean\n  showCart?: boolean\n}\n\nexport default function ClientLayout({ \n  children, \n  tenant,\n  showHeader = true,\n  showFooter = true,\n  showCart = true\n}: ClientLayoutProps) {\n  return (\n    <>\n      <TenantTheme tenant={tenant} />\n      <div className=\"min-h-screen flex flex-col\">\n        {showHeader && <SimpleHeader tenant={tenant} />}\n        <main className=\"flex-grow\">\n          {children}\n        </main>\n        {showFooter && <Footer tenant={tenant} />}\n        {showCart && <CartButton tenant={tenant} />}\n      </div>\n    </>\n  )\n}\n","size_bytes":902},"pedai-nextjs/lib/types/tenant.ts":{"content":"export interface TenantConfig {\n  id: string\n  name: string\n  slug: string\n  state: string\n  theme: {\n    primary: string\n    secondary: string\n    accent: string\n  }\n  delivery: {\n    baseFee: number\n    feePerKm: number\n    minOrder: number\n    maxDistance: number\n  }\n  location: {\n    lat: number\n    lng: number\n    coverageRadius: number\n  }\n  contact: {\n    phone: string\n    email: string\n    whatsapp: string\n  }\n  enabled: boolean\n}\n\nexport type TenantSlug = 'alagoa-nova' | 'esperanca' | 'lagoa-seca'\n","size_bytes":512},"pedai-nextjs/components/Logo.tsx":{"content":"import type { TenantConfig } from '@/lib/types/tenant'\n\ninterface LogoProps {\n  tenant?: TenantConfig\n  size?: 'sm' | 'md' | 'lg'\n  showText?: boolean\n  className?: string\n}\n\nconst sizes = {\n  sm: 'h-8 w-8',\n  md: 'h-10 w-10',\n  lg: 'h-16 w-16',\n}\n\nexport default function Logo({ tenant, size = 'md', showText = true, className = '' }: LogoProps) {\n  const primaryColor = tenant?.theme.primary || '#FFD100'\n  const secondaryColor = tenant?.theme.secondary || '#1A1A1A'\n\n  return (\n    <div className={`flex items-center ${className}`}>\n      <svg className={`${sizes[size]} lightning-logo`} viewBox=\"0 0 24 24\">\n        <circle cx=\"12\" cy=\"12\" r=\"11\" fill={primaryColor} />\n        <circle cx=\"12\" cy=\"12\" r=\"9\" fill={secondaryColor} />\n        <path d=\"M13 6L7 14h4v4l6-8h-4V6z\" fill={primaryColor} />\n      </svg>\n      {showText && (\n        <span className=\"ml-2 text-2xl font-bold text-white\">\n          Pede<span style={{ color: primaryColor }}>Aí</span>\n        </span>\n      )}\n    </div>\n  )\n}\n","size_bytes":1004},"pedai-nextjs/lib/tenantConfig/index.ts":{"content":"import type { TenantConfig, TenantSlug } from '../types/tenant'\n\nexport const tenantConfigs: Record<TenantSlug, TenantConfig> = {\n  'alagoa-nova': {\n    id: 'alagoa-nova',\n    name: 'Alagoa Nova',\n    slug: 'alagoa-nova',\n    state: 'PB',\n    theme: {\n      primary: '#FFD100',\n      secondary: '#1A1A1A',\n      accent: '#FFFFFF',\n    },\n    delivery: {\n      baseFee: 5.0,\n      feePerKm: 2.0,\n      minOrder: 15.0,\n      maxDistance: 10,\n    },\n    location: {\n      lat: -7.0743,\n      lng: -35.7623,\n      coverageRadius: 10,\n    },\n    contact: {\n      phone: '(83) 99999-0001',\n      email: 'alagoa.nova@pedeai.com.br',\n      whatsapp: '5583999990001',\n    },\n    enabled: true,\n  },\n  'esperanca': {\n    id: 'esperanca',\n    name: 'Esperança',\n    slug: 'esperanca',\n    state: 'PB',\n    theme: {\n      primary: '#00D4FF',\n      secondary: '#1A1A1A',\n      accent: '#FFFFFF',\n    },\n    delivery: {\n      baseFee: 4.5,\n      feePerKm: 1.8,\n      minOrder: 12.0,\n      maxDistance: 8,\n    },\n    location: {\n      lat: -7.0234,\n      lng: -35.8567,\n      coverageRadius: 8,\n    },\n    contact: {\n      phone: '(83) 99999-0002',\n      email: 'esperanca@pedeai.com.br',\n      whatsapp: '5583999990002',\n    },\n    enabled: true,\n  },\n  'lagoa-seca': {\n    id: 'lagoa-seca',\n    name: 'Lagoa Seca',\n    slug: 'lagoa-seca',\n    state: 'PB',\n    theme: {\n      primary: '#00FF85',\n      secondary: '#1A1A1A',\n      accent: '#FFFFFF',\n    },\n    delivery: {\n      baseFee: 5.5,\n      feePerKm: 2.2,\n      minOrder: 15.0,\n      maxDistance: 12,\n    },\n    location: {\n      lat: -7.1542,\n      lng: -35.8513,\n      coverageRadius: 12,\n    },\n    contact: {\n      phone: '(83) 99999-0003',\n      email: 'lagoa.seca@pedeai.com.br',\n      whatsapp: '5583999990003',\n    },\n    enabled: true,\n  },\n}\n\nexport const defaultTenant: TenantSlug = 'alagoa-nova'\n\nexport function getTenantConfig(slug?: string | null): TenantConfig {\n  const tenantSlug = (slug as TenantSlug) || defaultTenant\n  return tenantConfigs[tenantSlug] || tenantConfigs[defaultTenant]\n}\n\nexport function getAllTenants(): TenantConfig[] {\n  return Object.values(tenantConfigs).filter((tenant) => tenant.enabled)\n}\n\nexport function isTenantValid(slug: string): boolean {\n  return slug in tenantConfigs && tenantConfigs[slug as TenantSlug].enabled\n}\n\nexport function getTenantBySlug(slug: string): TenantConfig | null {\n  if (!isTenantValid(slug)) return null\n  return tenantConfigs[slug as TenantSlug]\n}\n","size_bytes":2466},"pedai-nextjs/components/SimpleHeader.tsx":{"content":"'use client'\n\nimport Link from 'next/link'\nimport { useState, useEffect } from 'react'\nimport { createClient } from '@/lib/supabase/client'\nimport Logo from './Logo'\nimport type { TenantConfig } from '@/lib/types/tenant'\n\ninterface SimpleHeaderProps {\n  tenant?: TenantConfig\n}\n\ninterface UserProfile {\n  id: number\n  nome_completo: string\n  tipo: string\n  email: string\n}\n\ninterface Loja {\n  nome_loja: string\n}\n\nexport default function SimpleHeader({ tenant }: SimpleHeaderProps) {\n  const [mobileMenuOpen, setMobileMenuOpen] = useState(false)\n  const [userProfile, setUserProfile] = useState<UserProfile | null>(null)\n  const [lojaName, setLojaName] = useState<string | null>(null)\n  const [lojaMunicipio, setLojaMunicipio] = useState<string | null>(null)\n  \n  // Check if user is logged in\n  useEffect(() => {\n    checkAuth()\n  }, [])\n\n  const checkAuth = async () => {\n    try {\n      const supabase = createClient()\n      const { data: { session } } = await supabase.auth.getSession()\n      \n      if (!session) {\n        setUserProfile(null)\n        setLojaName(null)\n        return\n      }\n\n      // Get user profile (send cookies for server-side session validation)\n      const profileResponse = await fetch('/api/auth/get-profile', {\n        credentials: 'include'\n      })\n      \n      if (profileResponse.ok) {\n        const data = await profileResponse.json()\n        setUserProfile(data.perfil)\n\n        // If user is loja, get store name and municipality\n        if (data.perfil.tipo === 'loja') {\n          const { data: lojaData } = await supabase\n            .from('lojas')\n            .select('nome_loja, municipio')\n            .eq('perfil_id', data.perfil.id)\n            .single()\n          \n          if (lojaData) {\n            setLojaName(lojaData.nome_loja)\n            setLojaMunicipio(lojaData.municipio)\n          }\n        }\n      }\n    } catch (error) {\n      console.error('Error checking auth:', error)\n    }\n  }\n\n  const handleLogout = async () => {\n    const supabase = createClient()\n    await supabase.auth.signOut()\n    localStorage.clear()\n    window.location.href = '/'\n  }\n  \n  // Handle keyboard navigation for mobile menu\n  useEffect(() => {\n    const handleEscape = (e: KeyboardEvent) => {\n      if (e.key === 'Escape' && mobileMenuOpen) {\n        setMobileMenuOpen(false)\n      }\n    }\n    \n    if (mobileMenuOpen) {\n      document.addEventListener('keydown', handleEscape)\n      return () => document.removeEventListener('keydown', handleEscape)\n    }\n  }, [mobileMenuOpen])\n  \n  // Build tenant-aware URLs (all routes maintain tenant context)\n  const basePath = tenant ? `/${tenant.slug}` : ''\n  \n  // For lojistas, home URL points to their municipality\n  let homeUrl = basePath || '/'\n  if (userProfile?.tipo === 'loja' && lojaMunicipio) {\n    homeUrl = `/${lojaMunicipio}`\n  }\n  \n  const lojasUrl = `${basePath}/lojas`\n  const loginUrl = `${basePath}/auth/login`\n\n  const primaryColor = tenant?.theme.primary || '#FFD100'\n\n  return (\n    <header className=\"bg-gray-900 text-white p-4 shadow-md z-50 sticky top-0\">\n      <div className=\"container mx-auto px-4\">\n        <div className=\"flex justify-between items-center\">\n          <Link href={homeUrl} className=\"flex items-center\">\n            <Logo tenant={tenant} />\n          </Link>\n\n          {/* Mobile menu button */}\n          <button\n            onClick={() => setMobileMenuOpen(!mobileMenuOpen)}\n            className=\"md:hidden text-white p-2\"\n            aria-label={mobileMenuOpen ? 'Fechar menu' : 'Abrir menu'}\n            aria-expanded={mobileMenuOpen}\n            aria-controls=\"mobile-menu\"\n          >\n            {mobileMenuOpen ? (\n              <svg className=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n              </svg>\n            ) : (\n              <svg className=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 6h16M4 12h16M4 18h16\" />\n              </svg>\n            )}\n          </button>\n\n          {/* Desktop navigation */}\n          <nav className=\"hidden md:flex items-center space-x-6\">\n            <Link \n              href={homeUrl}\n              className=\"transition-colors text-white\"\n              style={{ color: 'white' }}\n              onMouseEnter={(e) => e.currentTarget.style.color = primaryColor}\n              onMouseLeave={(e) => e.currentTarget.style.color = 'white'}\n            >\n              Início\n            </Link>\n            {userProfile?.tipo === 'loja' ? (\n              <Link \n                href=\"/loja/dashboard\"\n                className=\"transition-colors text-white\"\n                style={{ color: 'white' }}\n                onMouseEnter={(e) => e.currentTarget.style.color = primaryColor}\n                onMouseLeave={(e) => e.currentTarget.style.color = 'white'}\n              >\n                Dashboard\n              </Link>\n            ) : (\n              <>\n                <Link \n                  href={lojasUrl}\n                  className=\"transition-colors text-white\"\n                  style={{ color: 'white' }}\n                  onMouseEnter={(e) => e.currentTarget.style.color = primaryColor}\n                  onMouseLeave={(e) => e.currentTarget.style.color = 'white'}\n                >\n                  Lojas\n                </Link>\n                {userProfile?.tipo === 'cliente' && (\n                  <Link \n                    href={`${basePath}/meus-pedidos`}\n                    className=\"transition-colors text-white\"\n                    style={{ color: 'white' }}\n                    onMouseEnter={(e) => e.currentTarget.style.color = primaryColor}\n                    onMouseLeave={(e) => e.currentTarget.style.color = 'white'}\n                  >\n                    Meus Pedidos\n                  </Link>\n                )}\n                <Link \n                  href=\"/\"\n                  className=\"transition-colors text-white\"\n                  style={{ color: 'white' }}\n                  onMouseEnter={(e) => e.currentTarget.style.color = primaryColor}\n                  onMouseLeave={(e) => e.currentTarget.style.color = 'white'}\n                >\n                  Municípios\n                </Link>\n                {userProfile?.tipo === 'admin' && (\n                  <Link \n                    href=\"/admin/dashboard\"\n                    className=\"transition-colors text-white\"\n                    style={{ color: 'white' }}\n                    onMouseEnter={(e) => e.currentTarget.style.color = primaryColor}\n                    onMouseLeave={(e) => e.currentTarget.style.color = 'white'}\n                  >\n                    Dashboard\n                  </Link>\n                )}\n              </>\n            )}\n            {userProfile ? (\n              <>\n                <span className=\"text-white font-medium\">\n                  Olá, {lojaName || userProfile.nome_completo.split(' ')[0]}\n                </span>\n                <button\n                  onClick={handleLogout}\n                  className=\"font-medium py-2 px-6 rounded-full hover:opacity-90 transition-opacity bg-red-500 text-white\"\n                >\n                  Sair\n                </button>\n              </>\n            ) : (\n              <Link\n                href={loginUrl}\n                className=\"font-medium py-2 px-6 rounded-full hover:opacity-90 transition-opacity\"\n                style={{\n                  backgroundColor: primaryColor,\n                  color: tenant?.theme.secondary || '#1A1A1A',\n                }}\n              >\n                Entrar\n              </Link>\n            )}\n          </nav>\n        </div>\n\n        {/* Mobile navigation */}\n        {mobileMenuOpen && (\n          <nav \n            id=\"mobile-menu\"\n            className=\"md:hidden mt-4 pb-4 flex flex-col space-y-3\"\n            role=\"navigation\"\n            aria-label=\"Menu mobile\"\n          >\n            <Link \n              href={homeUrl}\n              className=\"text-white hover:opacity-80 transition-opacity py-2\"\n              onClick={() => setMobileMenuOpen(false)}\n            >\n              Início\n            </Link>\n            {userProfile?.tipo === 'loja' ? (\n              <Link \n                href=\"/loja/dashboard\"\n                className=\"text-white hover:opacity-80 transition-opacity py-2\"\n                onClick={() => setMobileMenuOpen(false)}\n              >\n                Dashboard\n              </Link>\n            ) : (\n              <>\n                <Link \n                  href={lojasUrl}\n                  className=\"text-white hover:opacity-80 transition-opacity py-2\"\n                  onClick={() => setMobileMenuOpen(false)}\n                >\n                  Lojas\n                </Link>\n                {userProfile?.tipo === 'cliente' && (\n                  <Link \n                    href={`${basePath}/meus-pedidos`}\n                    className=\"text-white hover:opacity-80 transition-opacity py-2\"\n                    onClick={() => setMobileMenuOpen(false)}\n                  >\n                    Meus Pedidos\n                  </Link>\n                )}\n                <Link \n                  href=\"/\"\n                  className=\"text-white hover:opacity-80 transition-opacity py-2\"\n                  onClick={() => setMobileMenuOpen(false)}\n                >\n                  Municípios\n                </Link>\n                {userProfile?.tipo === 'admin' && (\n                  <Link \n                    href=\"/admin/dashboard\"\n                    className=\"text-white hover:opacity-80 transition-opacity py-2\"\n                    onClick={() => setMobileMenuOpen(false)}\n                  >\n                    Dashboard\n                  </Link>\n                )}\n              </>\n            )}\n            {userProfile ? (\n              <>\n                <span className=\"text-white font-medium py-2\">\n                  Olá, {lojaName || userProfile.nome_completo.split(' ')[0]}\n                </span>\n                <button\n                  onClick={() => {\n                    handleLogout()\n                    setMobileMenuOpen(false)\n                  }}\n                  className=\"font-medium py-2 px-6 rounded-full text-center hover:opacity-90 transition-opacity bg-red-500 text-white\"\n                >\n                  Sair\n                </button>\n              </>\n            ) : (\n              <Link\n                href={loginUrl}\n                className=\"font-medium py-2 px-6 rounded-full text-center hover:opacity-90 transition-opacity\"\n                style={{\n                  backgroundColor: primaryColor,\n                  color: tenant?.theme.secondary || '#1A1A1A',\n                }}\n                onClick={() => setMobileMenuOpen(false)}\n              >\n                Entrar\n              </Link>\n            )}\n          </nav>\n        )}\n      </div>\n    </header>\n  )\n}\n","size_bytes":11047},"pedai-nextjs/SECURITY.md":{"content":"# Notas de Segurança - PedeAí Next.js\n\n## ⚠️ AÇÃO IMEDIATA NECESSÁRIA\n\nA `SUPABASE_SERVICE_ROLE_KEY` que estava exposta no código precisa ser **rotacionada imediatamente**:\n\n### Passos para Rotacionar a Chave:\n\n1. **Acesse o Supabase Dashboard**:\n   - Vá para: https://supabase.com/dashboard/project/jrskruadcwuytvjeqybh\n   - Entre nas configurações (Settings) → API\n\n2. **Revogue a chave antiga**:\n   - A chave antiga começava com: `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3M...`\n   - Clique em \"Reset service role key\" ou \"Revoke\"\n\n3. **Gere uma nova chave**:\n   - O Supabase vai gerar automaticamente uma nova `service_role` key\n   - **IMPORTANTE**: NÃO comite esta chave em nenhum arquivo!\n\n4. **Adicione a nova chave como Secret no Replit**:\n   - No Replit, vá em \"Tools\" → \"Secrets\"\n   - Adicione: `SUPABASE_SERVICE_ROLE_KEY` = (nova chave)\n   - O Next.js automaticamente vai usar essa variável de ambiente\n\n### Por que isso é importante?\n\nA `SUPABASE_SERVICE_ROLE_KEY` dá **acesso administrativo total** ao seu banco de dados, incluindo:\n- Ler todos os dados (incluindo senhas, informações sensíveis)\n- Modificar qualquer registro\n- Deletar tabelas\n- Ignorar políticas RLS (Row Level Security)\n\n**NUNCA** compartilhe ou exponha esta chave!\n\n## Boas Práticas de Segurança\n\n### ✅ O que PODE ser público:\n- `NEXT_PUBLIC_SUPABASE_URL`\n- `NEXT_PUBLIC_SUPABASE_ANON_KEY` (chave anônima com permissões limitadas)\n\n### ❌ O que NUNCA deve ser exposto:\n- `SUPABASE_SERVICE_ROLE_KEY`\n- Senhas de banco de dados\n- Chaves de API privadas\n- Tokens de autenticação\n\n### Arquivos que NUNCA devem ser comitados:\n- `.env`\n- `.env.local`\n- `.env.production`\n- Qualquer arquivo com secrets ou chaves\n\n### Como usar secrets no Replit:\n1. Vá em Tools → Secrets\n2. Adicione suas variáveis sensíveis\n3. Elas ficam disponíveis em `process.env` automaticamente\n4. Nunca são expostas no código-fonte\n\n## Verificação de Segurança\n\nAntes de cada deploy, verifique:\n- [ ] Nenhum arquivo `.env` está sendo comitado\n- [ ] Todas as chaves sensíveis estão em Secrets\n- [ ] O `.gitignore` contém `.env*`\n- [ ] Nenhuma chave está hardcoded no código\n\n---\n\n**Status Atual**: ⚠️ Aguardando rotação da SUPABASE_SERVICE_ROLE_KEY\n","size_bytes":2259},"pedai-nextjs/app/tenants/page.tsx":{"content":"import { getAllTenants } from '@/lib/tenantConfig'\nimport Link from 'next/link'\nimport ClientLayout from '@/components/ClientLayout'\n\nexport default function TenantsPage() {\n  const tenants = getAllTenants()\n\n  return (\n    <ClientLayout showFooter={false}>\n      <div className=\"min-h-screen bg-secondary text-white p-8\">\n        <div className=\"container mx-auto\">\n          <h1 className=\"text-4xl font-bold mb-8 text-center\">\n            Escolha seu Município\n          </h1>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 max-w-4xl mx-auto\">\n            {tenants.map((tenant) => (\n              <div\n                key={tenant.id}\n                className=\"bg-white/5 rounded-lg p-6 border-2 hover:scale-105 transition-transform\"\n                style={{ borderColor: tenant.theme.primary }}\n              >\n                <h2\n                  className=\"text-2xl font-bold mb-6 text-center\"\n                  style={{ color: tenant.theme.primary }}\n                >\n                  {tenant.name}\n                </h2>\n\n                <Link\n                  href={`/${tenant.slug}`}\n                  className=\"block text-center py-3 px-6 rounded-lg font-semibold transition-colors hover:opacity-90\"\n                  style={{\n                    backgroundColor: tenant.theme.primary,\n                    color: tenant.theme.secondary,\n                  }}\n                >\n                  Visitar\n                </Link>\n              </div>\n            ))}\n          </div>\n        </div>\n      </div>\n    </ClientLayout>\n  )\n}\n","size_bytes":1568},"pedai-nextjs/app/[municipio]/page.tsx":{"content":"import { getTenantBySlug, isTenantValid } from '@/lib/tenantConfig'\nimport { notFound } from 'next/navigation'\nimport ClientLayout from '@/components/ClientLayout'\nimport HeroSection from '@/components/clientes/HeroSection'\nimport CategoriesSection from '@/components/clientes/CategoriesSection'\n\ninterface Props {\n  params: Promise<{ municipio: string }>\n}\n\nexport default async function MunicipioPage({ params }: Props) {\n  const { municipio } = await params\n  \n  if (!isTenantValid(municipio)) {\n    notFound()\n  }\n\n  const config = getTenantBySlug(municipio)\n  \n  if (!config) {\n    notFound()\n  }\n\n  return (\n    <ClientLayout tenant={config}>\n      <HeroSection tenant={config} />\n      <CategoriesSection tenant={config} />\n      \n      {/* Info Section */}\n      <section className=\"py-16 bg-gray-800\">\n        <div className=\"container mx-auto px-4\">\n          <div className=\"grid md:grid-cols-2 gap-8 max-w-5xl mx-auto\">\n            <div \n              className=\"p-8 rounded-2xl shadow-xl\"\n              style={{ \n                border: `2px solid ${config.theme.primary}`,\n                backgroundColor: 'rgba(26, 26, 26, 0.5)',\n              }}\n            >\n              <h2 className=\"text-2xl font-bold mb-4 text-tenant-primary\">\n                📦 Informações de Entrega\n              </h2>\n              <ul className=\"text-left text-gray-300 space-y-3\">\n                <li>✓ Taxa de entrega: R$ {config.delivery.baseFee.toFixed(2)} + R$ {config.delivery.feePerKm.toFixed(2)}/km</li>\n                <li>✓ Pedido mínimo: R$ {config.delivery.minOrder.toFixed(2)}</li>\n                <li>✓ Entregamos em até {config.delivery.maxDistance} km</li>\n              </ul>\n            </div>\n\n            <div \n              className=\"p-8 rounded-2xl shadow-xl\"\n              style={{ \n                border: `2px solid ${config.theme.primary}`,\n                backgroundColor: 'rgba(26, 26, 26, 0.5)',\n              }}\n            >\n              <h2 className=\"text-2xl font-bold mb-4 text-tenant-primary\">\n                📞 Entre em Contato\n              </h2>\n              <ul className=\"text-left text-gray-300 space-y-3\">\n                <li>📱 {config.contact.phone}</li>\n                <li>📧 {config.contact.email}</li>\n                <li>\n                  <a \n                    href={`https://wa.me/${config.contact.whatsapp}`}\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                    className=\"px-6 py-3 rounded-full font-semibold hover:opacity-90 transition-opacity bg-tenant-primary text-tenant-secondary inline-block\"\n                  >\n                    💬 WhatsApp\n                  </a>\n                </li>\n              </ul>\n            </div>\n          </div>\n        </div>\n      </section>\n    </ClientLayout>\n  )\n}\n","size_bytes":2835},"pedai-nextjs/components/Footer.tsx":{"content":"import Link from 'next/link'\nimport Logo from './Logo'\nimport type { TenantConfig } from '@/lib/types/tenant'\n\ninterface FooterProps {\n  tenant?: TenantConfig\n}\n\nexport default function Footer({ tenant }: FooterProps) {\n  const currentYear = new Date().getFullYear()\n  const municipioName = tenant?.name || 'sua cidade'\n  \n  // Build tenant-aware URLs (all routes maintain tenant context)\n  const basePath = tenant ? `/${tenant.slug}` : ''\n  const homeUrl = basePath || '/'\n  const lojasUrl = `${basePath}/lojas`\n  const cadastroUrl = `${basePath}/auth/cadastro`\n  const lojaCadastroUrl = `${basePath}/loja/cadastro`\n  const sobreUrl = `${basePath}/sobre`\n  const termosUrl = `${basePath}/termos`\n  const privacidadeUrl = `${basePath}/privacidade`\n  const faqUrl = `${basePath}/faq`\n\n  return (\n    <footer className=\"bg-gray-900 text-white mt-auto\">\n      <div className=\"container mx-auto px-4 py-12\">\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-8\">\n          {/* Logo e descrição */}\n          <div className=\"col-span-1 md:col-span-2\">\n            <Logo tenant={tenant} className=\"mb-4\" />\n            <p className=\"text-gray-400 mb-4\">\n              Delivery local para {municipioName}. Comida, remédios, compras e muito mais, \n              entregue rápido na sua porta.\n            </p>\n            {tenant && (\n              <div className=\"text-sm text-gray-500\">\n                <p>📞 {tenant.contact.phone}</p>\n                <p>📧 {tenant.contact.email}</p>\n              </div>\n            )}\n          </div>\n\n          {/* Links úteis */}\n          <div>\n            <h3 className=\"font-bold text-lg mb-4\">Links Rápidos</h3>\n            <ul className=\"space-y-2\">\n              <li>\n                <Link href={homeUrl} className=\"text-gray-400 hover:text-primary transition-colors\">\n                  Início\n                </Link>\n              </li>\n              <li>\n                <Link href={lojasUrl} className=\"text-gray-400 hover:text-primary transition-colors\">\n                  Lojas\n                </Link>\n              </li>\n              <li>\n                <Link href={cadastroUrl} className=\"text-gray-400 hover:text-primary transition-colors\">\n                  Cadastre-se\n                </Link>\n              </li>\n              <li>\n                <Link href={lojaCadastroUrl} className=\"text-gray-400 hover:text-primary transition-colors\">\n                  Seja um Parceiro\n                </Link>\n              </li>\n            </ul>\n          </div>\n\n          {/* Informações */}\n          <div>\n            <h3 className=\"font-bold text-lg mb-4\">Informações</h3>\n            <ul className=\"space-y-2\">\n              <li>\n                <Link href={sobreUrl} className=\"text-gray-400 hover:text-primary transition-colors\">\n                  Sobre Nós\n                </Link>\n              </li>\n              <li>\n                <Link href={termosUrl} className=\"text-gray-400 hover:text-primary transition-colors\">\n                  Termos de Uso\n                </Link>\n              </li>\n              <li>\n                <Link href={privacidadeUrl} className=\"text-gray-400 hover:text-primary transition-colors\">\n                  Privacidade\n                </Link>\n              </li>\n              <li>\n                <Link href={faqUrl} className=\"text-gray-400 hover:text-primary transition-colors\">\n                  FAQ\n                </Link>\n              </li>\n            </ul>\n          </div>\n        </div>\n\n        {/* Linha divisória e copyright */}\n        <div className=\"border-t border-gray-800 mt-8 pt-8 text-center text-gray-500 text-sm\">\n          <p>&copy; {currentYear} PedeAí. Todos os direitos reservados.</p>\n          {tenant && (\n            <p className=\"mt-2\">Atendendo {tenant.name} - {tenant.state}</p>\n          )}\n        </div>\n      </div>\n    </footer>\n  )\n}\n","size_bytes":3890},"pedai-nextjs/app/[municipio]/not-found.tsx":{"content":"export default function NotFound() {\n  return (\n    <div className=\"min-h-screen bg-secondary text-white flex items-center justify-center\">\n      <div className=\"text-center\">\n        <h1 className=\"text-6xl font-bold mb-4\">404</h1>\n        <h2 className=\"text-2xl mb-4\">Município não encontrado</h2>\n        <p className=\"text-gray-400 mb-8\">\n          Este município ainda não está disponível no PedeAí.\n        </p>\n        <a\n          href=\"/tenants\"\n          className=\"inline-block bg-primary text-secondary px-6 py-3 rounded-lg font-semibold hover:opacity-90 transition-opacity\"\n        >\n          Ver municípios disponíveis\n        </a>\n      </div>\n    </div>\n  )\n}\n","size_bytes":687},"pedai-nextjs/components/Header.tsx":{"content":"'use client'\n\nimport Link from 'next/link'\nimport { usePathname } from 'next/navigation'\nimport { useState, useEffect } from 'react'\nimport Logo from './Logo'\nimport type { TenantConfig } from '@/lib/types/tenant'\n\ninterface HeaderProps {\n  tenant?: TenantConfig\n}\n\ninterface UserData {\n  id: string\n  nome_completo?: string\n  email: string\n  tipo_usuario: 'cliente' | 'loja' | 'entregador' | 'admin'\n}\n\nexport default function Header({ tenant }: HeaderProps) {\n  const pathname = usePathname()\n  const [user, setUser] = useState<UserData | null>(null)\n  const [cartCount, setCartCount] = useState(0)\n\n  useEffect(() => {\n    // Verificar se há usuário logado\n    const userData = localStorage.getItem('userData')\n    if (userData) {\n      try {\n        setUser(JSON.parse(userData))\n      } catch (e) {\n        console.error('Erro ao parsear userData:', e)\n      }\n    }\n\n    // Verificar carrinho\n    const cart = localStorage.getItem('pedeai_cart')\n    if (cart) {\n      try {\n        const cartItems = JSON.parse(cart)\n        const total = cartItems.reduce((sum: number, item: any) => sum + (item.quantidade || 0), 0)\n        setCartCount(total)\n      } catch (e) {\n        console.error('Erro ao parsear carrinho:', e)\n      }\n    }\n  }, [])\n\n  const handleLogout = () => {\n    localStorage.removeItem('userToken')\n    localStorage.removeItem('userData')\n    localStorage.removeItem('pedeai_cart')\n    setUser(null)\n    window.location.href = '/auth/login'\n  }\n\n  const primaryColor = tenant?.theme.primary || '#FFD100'\n\n  if (!user) {\n    // Header deslogado\n    return (\n      <header className=\"bg-gray-900 text-white p-4 shadow-md z-50 sticky top-0\">\n        <div className=\"container mx-auto px-4 flex justify-between items-center\">\n          <Link href=\"/\" className=\"flex items-center\">\n            <Logo tenant={tenant} />\n          </Link>\n          <nav className=\"flex items-center space-x-6\">\n            <Link \n              href=\"/\"\n              className={`hover:text-primary transition-colors ${pathname === '/' ? 'text-primary' : 'text-white'}`}\n            >\n              Início\n            </Link>\n            <Link \n              href=\"/lojas\"\n              className={`hover:text-primary transition-colors ${pathname === '/lojas' ? 'text-primary' : 'text-white'}`}\n            >\n              Lojas\n            </Link>\n            <Link\n              href=\"/auth/login\"\n              className=\"bg-primary text-secondary font-medium py-2 px-6 rounded-full hover:opacity-90 transition-opacity\"\n            >\n              Entrar\n            </Link>\n          </nav>\n        </div>\n      </header>\n    )\n  }\n\n  // Header logado\n  const primeiroNome = user.nome_completo \n    ? user.nome_completo.split(' ')[0] \n    : user.email.split('@')[0]\n\n  return (\n    <header className=\"bg-secondary shadow-md sticky top-0 z-50\">\n      <div className=\"container mx-auto px-4 py-3\">\n        <div className=\"flex justify-between items-center\">\n          <Link href=\"/\" className=\"flex items-center\">\n            <Logo tenant={tenant} />\n          </Link>\n          \n          <nav className=\"flex items-center space-x-6\">\n            <Link \n              href=\"/\"\n              className={`transition-colors ${pathname === '/' ? 'text-primary' : 'text-white hover:text-primary'}`}\n            >\n              Início\n            </Link>\n            <Link \n              href=\"/lojas\"\n              className={`transition-colors ${pathname === '/lojas' ? 'text-primary' : 'text-white hover:text-primary'}`}\n            >\n              Lojas\n            </Link>\n            <Link \n              href=\"/pedidos\"\n              className={`transition-colors ${pathname === '/pedidos' ? 'text-primary' : 'text-white hover:text-primary'}`}\n            >\n              Meus Pedidos\n            </Link>\n            <Link \n              href=\"/perfil\"\n              className=\"font-medium text-primary hover:text-white transition-colors\"\n            >\n              Olá, {primeiroNome}\n            </Link>\n            \n            <Link \n              href=\"/carrinho\"\n              className=\"relative text-white p-2 rounded-full hover:bg-gray-700 transition-colors\"\n            >\n              <svg className=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path \n                  strokeLinecap=\"round\" \n                  strokeLinejoin=\"round\" \n                  strokeWidth={2} \n                  d=\"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z\" \n                />\n              </svg>\n              {cartCount > 0 && (\n                <span \n                  className=\"absolute -top-1 -right-1 text-secondary text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center\"\n                  style={{ backgroundColor: primaryColor }}\n                >\n                  {cartCount}\n                </span>\n              )}\n            </Link>\n            \n            <button\n              onClick={handleLogout}\n              className=\"bg-red-500 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-red-600 transition-colors\"\n            >\n              Sair\n            </button>\n          </nav>\n        </div>\n      </div>\n    </header>\n  )\n}\n","size_bytes":5320},"pedai-nextjs/app/loja/dashboard/page.tsx":{"content":"import { Metadata } from 'next'\nimport ClientLayout from '@/components/ClientLayout'\nimport LojaDashboard from '@/components/loja/LojaDashboard'\n\nexport const metadata: Metadata = {\n  title: 'Dashboard - Loja - PedeAí',\n  description: 'Gerencie sua loja no PedeAí',\n}\n\nexport default function DashboardPage() {\n  return (\n    <ClientLayout showCart={false}>\n      <LojaDashboard />\n    </ClientLayout>\n  )\n}\n","size_bytes":410},"pedai-nextjs/components/auth/LoginForm.tsx":{"content":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useRouter } from 'next/navigation'\nimport Link from 'next/link'\nimport { createClient } from '@/lib/supabase/client'\nimport type { TenantConfig } from '@/lib/types/tenant'\n\ninterface LoginFormProps {\n  tenant?: TenantConfig\n}\n\nconst MUNICIPIOS = [\n  { slug: 'alagoa-nova', nome: 'Alagoa Nova' },\n  { slug: 'esperanca', nome: 'Esperança' },\n  { slug: 'lagoa-seca', nome: 'Lagoa Seca' },\n]\n\nexport default function LoginForm({ tenant }: LoginFormProps) {\n  const router = useRouter()\n  const [isLogin, setIsLogin] = useState(true)\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState('')\n  \n  // Login state\n  const [loginData, setLoginData] = useState({\n    email: '',\n    password: '',\n  })\n  \n  // Register state\n  const [registerData, setRegisterData] = useState({\n    email: '',\n    password: '',\n    nome: '',\n    tipo: 'cliente' as 'cliente' | 'loja' | 'entregador',\n    nome_loja: '',\n    municipio: tenant?.slug || 'alagoa-nova',\n  })\n\n  // Auto-detect municipality from URL\n  useEffect(() => {\n    if (tenant?.slug) {\n      setRegisterData(prev => ({ ...prev, municipio: tenant.slug }))\n    }\n  }, [tenant])\n\n  const handleLogin = async (e: React.FormEvent) => {\n    e.preventDefault()\n    setLoading(true)\n    setError('')\n\n    try {\n      const supabase = createClient()\n      \n      // Authenticate user (establishes session in browser)\n      const { data: authData, error: authError } = await supabase.auth.signInWithPassword({\n        email: loginData.email,\n        password: loginData.password,\n      })\n\n      if (authError) throw authError\n\n      if (!authData.user) {\n        throw new Error('Erro ao fazer login')\n      }\n\n      // Get user profile via API (bypasses RLS)\n      // Send cookies for server-side session validation\n      const response = await fetch('/api/auth/get-profile', {\n        credentials: 'include'\n      })\n      const data = await response.json()\n\n      if (!response.ok) {\n        throw new Error(data.error || 'Erro ao buscar perfil')\n      }\n\n      const { perfil } = data\n\n      // Store profile in localStorage for compatibility\n      if (typeof window !== 'undefined') {\n        localStorage.setItem('userProfile', JSON.stringify(perfil))\n      }\n\n      // Redirect based on user type\n      // Note: Loja, entregador and admin dashboards are not tenant-specific\n      console.log('[LOGIN DEBUG] User tipo:', perfil.tipo)\n      switch (perfil.tipo) {\n        case 'admin':\n          console.log('[LOGIN DEBUG] Redirecting admin to /admin/dashboard')\n          router.push('/admin/dashboard')\n          break\n        case 'loja':\n          console.log('[LOGIN DEBUG] Redirecting loja to /loja/dashboard')\n          router.push('/loja/dashboard')\n          break\n        case 'entregador':\n          console.log('[LOGIN DEBUG] Redirecting entregador to /entregador/dashboard')\n          router.push('/entregador/dashboard')\n          break\n        default:\n          // Clientes go to tenant home\n          const basePath = tenant ? `/${tenant.slug}` : ''\n          console.log('[LOGIN DEBUG] Redirecting cliente to', basePath || '/')\n          router.push(basePath || '/')\n      }\n    } catch (err: any) {\n      setError(err.message || 'Erro ao fazer login')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleRegister = async (e: React.FormEvent) => {\n    e.preventDefault()\n    setLoading(true)\n    setError('')\n\n    try {\n      if (registerData.tipo === 'loja' && !registerData.nome_loja) {\n        throw new Error('O nome da loja é obrigatório')\n      }\n\n      const response = await fetch('/api/auth/register', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(registerData),\n      })\n\n      const data = await response.json()\n\n      if (!response.ok) {\n        throw new Error(data.error || 'Erro ao criar conta')\n      }\n\n      // Automatically login after successful registration\n      const supabase = createClient()\n      \n      const { data: authData, error: authError } = await supabase.auth.signInWithPassword({\n        email: registerData.email,\n        password: registerData.password,\n      })\n\n      if (authError) throw authError\n\n      if (!authData.user) {\n        throw new Error('Erro ao fazer login automático')\n      }\n\n      // Get user profile via API (bypasses RLS)\n      // Send cookies for server-side session validation\n      const profileResponse = await fetch('/api/auth/get-profile', {\n        credentials: 'include'\n      })\n      const profileData = await profileResponse.json()\n\n      if (!profileResponse.ok) {\n        throw new Error(profileData.error || 'Erro ao buscar perfil')\n      }\n\n      const { perfil } = profileData\n\n      // Store profile in localStorage for compatibility\n      if (typeof window !== 'undefined') {\n        localStorage.setItem('userProfile', JSON.stringify(perfil))\n      }\n\n      // Redirect based on user type\n      switch (perfil.tipo) {\n        case 'admin':\n          router.push('/admin/dashboard')\n          break\n        case 'loja':\n          router.push('/loja/dashboard')\n          break\n        case 'entregador':\n          router.push('/entregador/dashboard')\n          break\n        default:\n          // Clientes go to tenant home\n          const basePath = tenant ? `/${tenant.slug}` : ''\n          router.push(basePath || '/')\n      }\n    } catch (err: any) {\n      setError(err.message || 'Erro ao criar conta')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  return (\n    <div className=\"bg-gray-800 rounded-2xl shadow-2xl p-8\">\n      {/* Tabs */}\n      <div className=\"flex mb-6 bg-gray-900 rounded-lg p-1\">\n        <button\n          onClick={() => setIsLogin(true)}\n          className={`flex-1 py-3 px-4 rounded-md font-medium transition-all ${\n            isLogin\n              ? 'bg-tenant-primary text-tenant-secondary'\n              : 'text-gray-400 hover:text-white'\n          }`}\n        >\n          Entrar\n        </button>\n        <button\n          onClick={() => setIsLogin(false)}\n          className={`flex-1 py-3 px-4 rounded-md font-medium transition-all ${\n            !isLogin\n              ? 'bg-tenant-primary text-tenant-secondary'\n              : 'text-gray-400 hover:text-white'\n          }`}\n        >\n          Cadastrar\n        </button>\n      </div>\n\n      {error && (\n        <div className=\"mb-4 p-4 bg-red-500/10 border border-red-500 rounded-lg text-red-500 text-sm\">\n          {error}\n        </div>\n      )}\n\n      {/* Login Form */}\n      {isLogin ? (\n        <form onSubmit={handleLogin} className=\"space-y-4\">\n          <div>\n            <label htmlFor=\"login-email\" className=\"block text-sm font-medium text-gray-300 mb-2\">\n              Email\n            </label>\n            <input\n              id=\"login-email\"\n              type=\"email\"\n              required\n              value={loginData.email}\n              onChange={(e) => setLoginData({ ...loginData, email: e.target.value })}\n              className=\"w-full px-4 py-3 bg-gray-900 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-tenant-primary focus:border-transparent\"\n              placeholder=\"seu@email.com\"\n            />\n          </div>\n\n          <div>\n            <label htmlFor=\"login-password\" className=\"block text-sm font-medium text-gray-300 mb-2\">\n              Senha\n            </label>\n            <input\n              id=\"login-password\"\n              type=\"password\"\n              required\n              value={loginData.password}\n              onChange={(e) => setLoginData({ ...loginData, password: e.target.value })}\n              className=\"w-full px-4 py-3 bg-gray-900 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-tenant-primary focus:border-transparent\"\n              placeholder=\"••••••••\"\n            />\n          </div>\n\n          <button\n            type=\"submit\"\n            disabled={loading}\n            className=\"w-full py-3 px-6 bg-tenant-primary text-tenant-secondary font-semibold rounded-lg hover:opacity-90 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed\"\n          >\n            {loading ? 'Entrando...' : 'Entrar'}\n          </button>\n\n          <div className=\"text-center\">\n            <Link href=\"/auth/recuperar-senha\" className=\"text-sm text-tenant-primary hover:underline\">\n              Esqueceu sua senha?\n            </Link>\n          </div>\n        </form>\n      ) : (\n        <form onSubmit={handleRegister} className=\"space-y-4\">\n          {/* Account Type Selection */}\n          <div>\n            <label className=\"block text-sm font-medium text-gray-300 mb-3\">\n              Tipo de Conta\n            </label>\n            <div className=\"grid grid-cols-3 gap-3\">\n              <button\n                type=\"button\"\n                onClick={() => setRegisterData({ ...registerData, tipo: 'cliente' })}\n                className={`p-4 rounded-lg border-2 transition-all ${\n                  registerData.tipo === 'cliente'\n                    ? 'border-tenant-primary bg-tenant-primary/10'\n                    : 'border-gray-700 hover:border-gray-600'\n                }`}\n              >\n                <div className=\"text-2xl mb-2\">👤</div>\n                <div className=\"text-sm font-medium text-white\">Cliente</div>\n              </button>\n              <button\n                type=\"button\"\n                onClick={() => setRegisterData({ ...registerData, tipo: 'loja' })}\n                className={`p-4 rounded-lg border-2 transition-all ${\n                  registerData.tipo === 'loja'\n                    ? 'border-tenant-primary bg-tenant-primary/10'\n                    : 'border-gray-700 hover:border-gray-600'\n                }`}\n              >\n                <div className=\"text-2xl mb-2\">🏪</div>\n                <div className=\"text-sm font-medium text-white\">Loja</div>\n              </button>\n              <button\n                type=\"button\"\n                onClick={() => setRegisterData({ ...registerData, tipo: 'entregador' })}\n                className={`p-4 rounded-lg border-2 transition-all ${\n                  registerData.tipo === 'entregador'\n                    ? 'border-tenant-primary bg-tenant-primary/10'\n                    : 'border-gray-700 hover:border-gray-600'\n                }`}\n              >\n                <div className=\"text-2xl mb-2\">🏍️</div>\n                <div className=\"text-sm font-medium text-white\">Entregador</div>\n              </button>\n            </div>\n          </div>\n\n          <div>\n            <label htmlFor=\"register-nome\" className=\"block text-sm font-medium text-gray-300 mb-2\">\n              Nome Completo\n            </label>\n            <input\n              id=\"register-nome\"\n              type=\"text\"\n              required\n              value={registerData.nome}\n              onChange={(e) => setRegisterData({ ...registerData, nome: e.target.value })}\n              className=\"w-full px-4 py-3 bg-gray-900 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-tenant-primary focus:border-transparent\"\n              placeholder=\"Seu nome completo\"\n            />\n          </div>\n\n          {registerData.tipo === 'loja' && (\n            <div>\n              <label htmlFor=\"register-loja\" className=\"block text-sm font-medium text-gray-300 mb-2\">\n                Nome da Loja\n              </label>\n              <input\n                id=\"register-loja\"\n                type=\"text\"\n                required\n                value={registerData.nome_loja}\n                onChange={(e) => setRegisterData({ ...registerData, nome_loja: e.target.value })}\n                className=\"w-full px-4 py-3 bg-gray-900 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-tenant-primary focus:border-transparent\"\n                placeholder=\"Nome da sua loja\"\n              />\n            </div>\n          )}\n\n          <div>\n            <label htmlFor=\"register-municipio\" className=\"block text-sm font-medium text-gray-300 mb-2\">\n              Município\n            </label>\n            <select\n              id=\"register-municipio\"\n              required\n              value={registerData.municipio}\n              onChange={(e) => setRegisterData({ ...registerData, municipio: e.target.value })}\n              className=\"w-full px-4 py-3 bg-gray-900 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-tenant-primary focus:border-transparent\"\n            >\n              {MUNICIPIOS.map((mun) => (\n                <option key={mun.slug} value={mun.slug}>\n                  {mun.nome}\n                </option>\n              ))}\n            </select>\n            <p className=\"mt-1 text-xs text-gray-400\">\n              {tenant ? `Detectado automaticamente: ${tenant.name}` : 'Selecione seu município'}\n            </p>\n          </div>\n\n          <div>\n            <label htmlFor=\"register-email\" className=\"block text-sm font-medium text-gray-300 mb-2\">\n              Email\n            </label>\n            <input\n              id=\"register-email\"\n              type=\"email\"\n              required\n              value={registerData.email}\n              onChange={(e) => setRegisterData({ ...registerData, email: e.target.value })}\n              className=\"w-full px-4 py-3 bg-gray-900 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-tenant-primary focus:border-transparent\"\n              placeholder=\"seu@email.com\"\n            />\n          </div>\n\n          <div>\n            <label htmlFor=\"register-password\" className=\"block text-sm font-medium text-gray-300 mb-2\">\n              Senha\n            </label>\n            <input\n              id=\"register-password\"\n              type=\"password\"\n              required\n              minLength={6}\n              value={registerData.password}\n              onChange={(e) => setRegisterData({ ...registerData, password: e.target.value })}\n              className=\"w-full px-4 py-3 bg-gray-900 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-tenant-primary focus:border-transparent\"\n              placeholder=\"Mínimo 6 caracteres\"\n            />\n          </div>\n\n          <button\n            type=\"submit\"\n            disabled={loading}\n            className=\"w-full py-3 px-6 bg-tenant-primary text-tenant-secondary font-semibold rounded-lg hover:opacity-90 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed\"\n          >\n            {loading ? 'Criando conta...' : 'Criar Conta'}\n          </button>\n        </form>\n      )}\n    </div>\n  )\n}\n","size_bytes":14925},"pedai-nextjs/populate-categorias.js":{"content":"const { createClient } = require('@supabase/supabase-js');\n\nconst supabase = createClient(\n  'https://jrskruadcwuytvjeqybh.supabase.co',\n  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Impyc2tydWFkY3d1eXR2amVxeWJoIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc0OTIyNzg5MywiZXhwIjoyMDY0ODAzODkzfQ.SQqgGs7mEPPZ7dmS7NjPXUvsDPRHa-UZSY09SZntrAc'\n);\n\nasync function populate() {\n  console.log('🔄 Populando categorias...\\n');\n  \n  const categorias = [\n    { nome_categoria: 'Restaurantes' },\n    { nome_categoria: 'Mercados' },\n    { nome_categoria: 'Farmácias' },\n    { nome_categoria: 'Padarias' },\n    { nome_categoria: 'Bebidas' },\n    { nome_categoria: 'Outros' }\n  ];\n  \n  const { data, error } = await supabase\n    .from('categorias')\n    .insert(categorias)\n    .select();\n  \n  if (error) {\n    console.log('❌ Erro:', error.message);\n  } else {\n    console.log(`✅ ${data.length} categorias inseridas!`);\n    data.forEach(c => console.log(`  - ${c.nome_categoria} (ID: ${c.id})`));\n  }\n}\n\npopulate();\n","size_bytes":1029},"pedai-nextjs/app/api/auth/register/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { createClient } from '@supabase/supabase-js'\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json()\n    const { email, password, nome, tipo, nome_loja, municipio } = body\n\n    if (!email || !password || !nome || !tipo) {\n      return NextResponse.json(\n        { error: 'Todos os campos são obrigatórios' },\n        { status: 400 }\n      )\n    }\n\n    if (!municipio) {\n      return NextResponse.json(\n        { error: 'O município é obrigatório' },\n        { status: 400 }\n      )\n    }\n\n    const municipiosValidos = ['alagoa-nova', 'esperanca', 'lagoa-seca']\n    if (!municipiosValidos.includes(municipio)) {\n      return NextResponse.json(\n        { error: 'Município inválido' },\n        { status: 400 }\n      )\n    }\n\n    if (tipo.toLowerCase() === 'loja' && !nome_loja) {\n      return NextResponse.json(\n        { error: 'O nome da loja é obrigatório para o tipo de perfil Loja.' },\n        { status: 400 }\n      )\n    }\n\n    // Create admin client with service role key\n    const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!\n    const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY!\n    \n    const supabaseAdmin = createClient(supabaseUrl, supabaseServiceKey, {\n      auth: {\n        autoRefreshToken: false,\n        persistSession: false,\n      },\n    })\n\n    // Step 1: Create user in auth\n    const { data: authData, error: authError } = await supabaseAdmin.auth.admin.createUser({\n      email: email,\n      password: password,\n      email_confirm: true,\n      user_metadata: {\n        nome_completo: nome,\n      },\n    })\n\n    if (authError) {\n      return NextResponse.json(\n        { error: authError.message },\n        { status: 400 }\n      )\n    }\n\n    if (!authData.user) {\n      return NextResponse.json(\n        { error: 'Não foi possível criar o usuário na autenticação.' },\n        { status: 500 }\n      )\n    }\n\n    const userId = authData.user.id\n\n    try {\n      // Step 2: Insert profile in 'perfis' table\n      const { data: perfilData, error: perfilError } = await supabaseAdmin\n        .from('perfis')\n        .insert({\n          user_id: userId,\n          email,\n          nome_completo: nome,\n          tipo: tipo.toLowerCase(),\n          municipio,\n        })\n        .select()\n        .single()\n\n      if (perfilError) throw perfilError\n\n      // Step 3: If user type is 'loja', create the store\n      if (perfilData.tipo === 'loja') {\n        const { error: lojaError } = await supabaseAdmin\n          .from('lojas')\n          .insert({\n            nome_loja: nome_loja,\n            municipio,\n            user_id: userId,\n            perfil_id: perfilData.id,\n          })\n\n        if (lojaError) throw lojaError\n      }\n\n      return NextResponse.json(\n        {\n          message: 'Usuário cadastrado com sucesso!',\n          data: { user: authData.user },\n        },\n        { status: 201 }\n      )\n    } catch (error: any) {\n      console.error('Erro no processo de criação de perfil/loja:', error)\n      \n      // Rollback: delete the auth user\n      await supabaseAdmin.auth.admin.deleteUser(userId)\n      \n      return NextResponse.json(\n        {\n          error: 'Ocorreu um erro crítico ao registrar seu perfil. O usuário foi removido.',\n        },\n        { status: 500 }\n      )\n    }\n  } catch (error: any) {\n    console.error('Erro ao processar registro:', error)\n    return NextResponse.json(\n      { error: 'Erro interno do servidor' },\n      { status: 500 }\n    )\n  }\n}\n","size_bytes":3565},"pedai-nextjs/SECURITY_NOTE.md":{"content":"# Security & Tenant Isolation\n\n## Current Implementation\n\n### Critical Decision: Tenant Isolation in Orders\n\nThe current implementation validates that orders are created for lojas that exist, but does NOT enforce that a cliente's profile is bound to a specific municipality.\n\n**Why**: The original database schema does not include a `municipio` column in the `perfis` table for clientes.\n\n**Implications**:\n- A cliente from Alagoa Nova CAN theoretically order from a loja in Esperança if they know the loja_id\n- This is acceptable if the business model allows cross-municipal ordering\n- If strict municipal boundaries are required, the database schema must be updated\n\n## Recommended Future Enhancement\n\n### Add Municipality to User Profiles\n\n```sql\nALTER TABLE perfis \nADD COLUMN municipio VARCHAR(100);\n\nCREATE INDEX idx_perfis_municipio ON perfis(municipio);\n```\n\nThen enforce in API:\n1. On POST /api/pedidos: Verify perfil.municipio === loja.municipio\n2. On GET /api/lojas: Filter by perfil.municipio\n3. Store municipio during registration\n\n### Benefits\n- True tenant isolation\n- Prevents cross-municipal data access\n- Clearer business logic\n\n## Current Safeguards\n\n1. ✅ Authentication required for all orders\n2. ✅ Loja existence validated before order creation\n3. ✅ Lojas filtered by municipio on storefront\n4. ✅ GET /api/pedidos filtered by user role (cliente sees only own orders)\n5. ✅ Loja dashboard shows only own orders\n\n## What's Protected\n\n- Users cannot see other users' orders (perfil_id filtering)\n- Lojas cannot see other lojas' orders (loja_id filtering)\n- Storefront displays only lojas from selected municipio\n- Order listing respects user ownership\n\n## What's NOT Protected (by design, pending schema update)\n\n- Cliente can order from any active loja if they construct the cart manually\n- This requires technical knowledge and deliberate circumvention\n- No UI facilitates cross-municipal ordering\n- Business decision: Is this acceptable?\n","size_bytes":1969},"pedai-nextjs/components/clientes/CarrinhoContent.tsx":{"content":"'use client'\n\nimport { useRouter } from 'next/navigation'\nimport { useCart } from '@/lib/contexts/CartContext'\nimport type { TenantConfig } from '@/lib/types/tenant'\nimport { useState } from 'react'\n\ninterface CarrinhoContentProps {\n  tenant: TenantConfig\n}\n\nexport default function CarrinhoContent({ tenant }: CarrinhoContentProps) {\n  const router = useRouter()\n  const { items, removeItem, updateQuantity, total } = useCart()\n\n  const taxaEntrega = tenant.delivery.baseFee\n  const totalComEntrega = total + taxaEntrega\n\n  const handleIrParaCheckout = () => {\n    if (total < tenant.delivery.minOrder) {\n      alert(`O pedido mínimo é de R$ ${tenant.delivery.minOrder.toFixed(2)}`)\n      return\n    }\n    router.push(`/${tenant.slug}/checkout`)\n  }\n\n  if (items.length === 0) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 flex items-center justify-center\">\n        <div className=\"text-center py-12\">\n          <div className=\"text-6xl mb-4\">🛒</div>\n          <h2 className=\"text-3xl font-bold text-white mb-4\">Carrinho Vazio</h2>\n          <p className=\"text-gray-400 mb-8\">Adicione produtos para continuar</p>\n          <button\n            onClick={() => router.push(`/${tenant.slug}/lojas`)}\n            className=\"px-8 py-3 bg-tenant-primary text-tenant-secondary font-semibold rounded-lg hover:opacity-90 transition-opacity\"\n          >\n            Ver Lojas\n          </button>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 py-8\">\n      <div className=\"container mx-auto px-4\">\n        <h1 className=\"text-4xl font-bold text-white mb-8\">Carrinho</h1>\n\n        <div className=\"grid lg:grid-cols-3 gap-8\">\n          {/* Items List */}\n          <div className=\"lg:col-span-2 space-y-4\">\n            {items.map((item) => (\n              <div\n                key={item.id}\n                className=\"bg-gray-800 rounded-xl p-6 flex items-center gap-4\"\n              >\n                <div className=\"w-20 h-20 bg-gray-700 rounded-lg flex items-center justify-center text-3xl\">\n                  {item.imagem_url ? (\n                    <img src={item.imagem_url} alt={item.nome} className=\"w-full h-full object-cover rounded-lg\" />\n                  ) : (\n                    '🍔'\n                  )}\n                </div>\n\n                <div className=\"flex-1\">\n                  <h3 className=\"text-white font-semibold text-lg\">{item.nome}</h3>\n                  <p className=\"text-gray-400 text-sm\">{item.loja_nome}</p>\n                  <p className=\"text-tenant-primary font-bold mt-1\">\n                    R$ {item.preco.toFixed(2)}\n                  </p>\n                </div>\n\n                <div className=\"flex items-center gap-3\">\n                  <button\n                    onClick={() => updateQuantity(item.id, item.quantidade - 1)}\n                    className=\"w-8 h-8 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-colors\"\n                  >\n                    -\n                  </button>\n                  <span className=\"text-white font-semibold w-8 text-center\">\n                    {item.quantidade}\n                  </span>\n                  <button\n                    onClick={() => updateQuantity(item.id, item.quantidade + 1)}\n                    className=\"w-8 h-8 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-colors\"\n                  >\n                    +\n                  </button>\n                </div>\n\n                <button\n                  onClick={() => removeItem(item.id)}\n                  className=\"text-red-500 hover:text-red-400 transition-colors ml-4\"\n                >\n                  🗑️\n                </button>\n              </div>\n            ))}\n          </div>\n\n          {/* Order Summary */}\n          <div className=\"lg:col-span-1\">\n            <div className=\"bg-gray-800 rounded-xl p-6 sticky top-24\">\n              <h2 className=\"text-2xl font-bold text-white mb-6\">Resumo do Pedido</h2>\n\n              <div className=\"space-y-3 mb-6\">\n                <div className=\"flex justify-between text-gray-400\">\n                  <span>Subtotal ({items.reduce((sum, item) => sum + item.quantidade, 0)} itens)</span>\n                  <span>R$ {total.toFixed(2)}</span>\n                </div>\n                <div className=\"flex justify-between text-gray-400\">\n                  <span>Taxa de Entrega</span>\n                  <span>R$ {taxaEntrega.toFixed(2)}</span>\n                </div>\n                <div className=\"flex justify-between text-white text-xl font-bold border-t border-gray-700 pt-3\">\n                  <span>Total</span>\n                  <span className=\"text-tenant-primary\">R$ {totalComEntrega.toFixed(2)}</span>\n                </div>\n              </div>\n\n              {total < tenant.delivery.minOrder && (\n                <div className=\"p-3 bg-yellow-500/10 border border-yellow-500 rounded-lg text-yellow-500 text-sm mb-4\">\n                  ⚠️ Pedido mínimo: R$ {tenant.delivery.minOrder.toFixed(2)}\n                  <div className=\"mt-1 text-xs\">\n                    Faltam R$ {(tenant.delivery.minOrder - total).toFixed(2)}\n                  </div>\n                </div>\n              )}\n\n              <button\n                onClick={handleIrParaCheckout}\n                disabled={total < tenant.delivery.minOrder}\n                className=\"w-full py-4 bg-tenant-primary text-tenant-secondary font-bold text-lg rounded-lg hover:opacity-90 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                Ir para Checkout\n              </button>\n\n              <button\n                onClick={() => router.push(`/${tenant.slug}/lojas`)}\n                className=\"w-full mt-3 py-3 bg-gray-700 text-white font-semibold rounded-lg hover:bg-gray-600 transition-colors\"\n              >\n                Adicionar Mais Itens\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n","size_bytes":6082},"pedai-nextjs/check-schema.js":{"content":"const { createClient } = require('@supabase/supabase-js');\n\nconst supabaseUrl = 'https://jrskruadcwuytvjeqybh.supabase.co';\nconst supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Impyc2tydWFkY3d1eXR2amVxeWJoIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc0OTIyNzg5MywiZXhwIjoyMDY0ODAzODkzfQ.SQqgGs7mEPPZ7dmS7NjPXUvsDPRHa-UZSY09SZntrAc';\n\nconst supabase = createClient(supabaseUrl, supabaseKey);\n\nasync function checkSchema() {\n  console.log('=== VERIFICANDO SCHEMA ===\\n');\n  \n  const tables = ['categorias', 'lojas', 'produtos', 'perfis', 'pedidos', 'avaliacoes', 'pedido_itens'];\n  \n  for (const table of tables) {\n    console.log(`📋 ${table}`);\n    const { data, error, count } = await supabase\n      .from(table)\n      .select('*', { count: 'exact' })\n      .limit(1);\n    \n    if (error) {\n      console.log(`   ❌ ${error.message}`);\n    } else {\n      console.log(`   ✅ ${count || 0} rows`);\n      if (data && data.length > 0) {\n        console.log(`   Colunas: ${Object.keys(data[0]).join(', ')}`);\n      }\n    }\n  }\n}\n\ncheckSchema().catch(console.error);\n","size_bytes":1100},"pedai-nextjs/components/CartButton.tsx":{"content":"'use client'\n\nimport Link from 'next/link'\nimport { useCart } from '@/lib/contexts/CartContext'\nimport type { TenantConfig } from '@/lib/types/tenant'\n\ninterface CartButtonProps {\n  tenant?: TenantConfig\n}\n\nexport default function CartButton({ tenant }: CartButtonProps) {\n  const { itemCount, total } = useCart()\n  const basePath = tenant ? `/${tenant.slug}` : ''\n\n  if (itemCount === 0) return null\n\n  return (\n    <Link\n      href={`${basePath}/carrinho`}\n      className=\"fixed bottom-6 right-6 z-50 bg-tenant-primary text-tenant-secondary px-6 py-4 rounded-full shadow-2xl hover:opacity-90 transition-all flex items-center gap-3 font-semibold\"\n    >\n      <span className=\"text-2xl\">🛒</span>\n      <div className=\"flex flex-col items-start\">\n        <span className=\"text-xs opacity-80\">{itemCount} {itemCount === 1 ? 'item' : 'itens'}</span>\n        <span className=\"text-lg\">R$ {total.toFixed(2)}</span>\n      </div>\n    </Link>\n  )\n}\n","size_bytes":945},"pedai-nextjs/components/loja/LojaDashboard.tsx":{"content":"'use client'\n\nimport { useEffect, useState } from 'react'\nimport { createClient } from '@/lib/supabase/client'\nimport { useRouter } from 'next/navigation'\n\ninterface DashboardStats {\n  pedidosHoje: number\n  receitaHoje: number\n  pedidosPendentes: number\n  produtosAtivos: number\n}\n\nexport default function LojaDashboard() {\n  const router = useRouter()\n  const [loading, setLoading] = useState(true)\n  const [stats, setStats] = useState<DashboardStats>({\n    pedidosHoje: 0,\n    receitaHoje: 0,\n    pedidosPendentes: 0,\n    produtosAtivos: 0,\n  })\n  const [loja, setLoja] = useState<any>(null)\n\n  useEffect(() => {\n    checkAuth()\n  }, [])\n\n  const checkAuth = async () => {\n    const supabase = createClient()\n    \n    const { data: { user } } = await supabase.auth.getUser()\n    \n    if (!user) {\n      router.push('/auth/login')\n      return\n    }\n\n    // Get user profile via API (bypasses RLS)\n    // Send cookies for server-side session validation\n    const profileResponse = await fetch('/api/auth/get-profile', {\n      credentials: 'include'\n    })\n    const profileData = await profileResponse.json()\n\n    if (!profileResponse.ok || !profileData.perfil) {\n      router.push('/')\n      return\n    }\n\n    const perfil = profileData.perfil\n\n    if (perfil.tipo !== 'loja' && perfil.tipo !== 'admin') {\n      router.push('/')\n      return\n    }\n\n    // Get loja data\n    // Admin pode acessar qualquer loja, mas precisa selecionar uma\n    // Por padrão, pega a primeira loja disponível para admin\n    let lojaQuery = supabase.from('lojas').select('*')\n    \n    if (perfil.tipo === 'loja') {\n      lojaQuery = lojaQuery.eq('perfil_id', perfil.id)\n    }\n    \n    const { data: lojaData } = perfil.tipo === 'admin' \n      ? await lojaQuery.limit(1).single()\n      : await lojaQuery.single()\n\n    if (!lojaData) {\n      console.error('Loja não encontrada para o perfil')\n      router.push('/')\n      return\n    }\n\n    setLoja(lojaData)\n    \n    // Load real stats from database\n    const today = new Date()\n    today.setHours(0, 0, 0, 0)\n    const todayISO = today.toISOString()\n\n    // Count pedidos hoje\n    const { count: pedidosHojeCount } = await supabase\n      .from('pedidos')\n      .select('*', { count: 'exact', head: true })\n      .eq('loja_id', lojaData.id)\n      .gte('created_at', todayISO)\n\n    // Sum receita hoje\n    const { data: pedidosHoje } = await supabase\n      .from('pedidos')\n      .select('total')\n      .eq('loja_id', lojaData.id)\n      .gte('created_at', todayISO)\n      .not('status', 'eq', 'cancelado')\n\n    const receitaHoje = pedidosHoje?.reduce((sum, p) => sum + (p.total || 0), 0) || 0\n\n    // Count pendentes\n    const { count: pendentesCount } = await supabase\n      .from('pedidos')\n      .select('*', { count: 'exact', head: true })\n      .eq('loja_id', lojaData.id)\n      .in('status', ['pendente', 'aceito', 'preparando', 'pronto'])\n\n    // Count produtos ativos\n    const { count: produtosCount } = await supabase\n      .from('produtos')\n      .select('*', { count: 'exact', head: true })\n      .eq('loja_id', lojaData.id)\n      .eq('disponivel', true)\n\n    setStats({\n      pedidosHoje: pedidosHojeCount || 0,\n      receitaHoje: receitaHoje,\n      pedidosPendentes: pendentesCount || 0,\n      produtosAtivos: produtosCount || 0,\n    })\n    \n    setLoading(false)\n  }\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"inline-block animate-spin rounded-full h-12 w-12 border-4 border-gray-700 border-t-tenant-primary\"></div>\n          <p className=\"text-gray-400 mt-4\">Carregando...</p>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900\">\n      <div className=\"container mx-auto px-4 py-8\">\n        {/* Header */}\n        <div className=\"mb-8\">\n          <h1 className=\"text-4xl font-bold text-white mb-2\">\n            Dashboard\n          </h1>\n          <p className=\"text-gray-400\">\n            Bem-vindo de volta, {loja?.nome_loja || 'Loja'}!\n          </p>\n        </div>\n\n        {/* Stats Grid */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8\">\n          <div className=\"bg-gray-800 rounded-xl p-6 border-l-4 border-blue-500\">\n            <div className=\"flex items-center justify-between mb-2\">\n              <span className=\"text-gray-400 text-sm\">Pedidos Hoje</span>\n              <span className=\"text-3xl\">📦</span>\n            </div>\n            <p className=\"text-3xl font-bold text-white\">{stats.pedidosHoje}</p>\n          </div>\n\n          <div className=\"bg-gray-800 rounded-xl p-6 border-l-4 border-green-500\">\n            <div className=\"flex items-center justify-between mb-2\">\n              <span className=\"text-gray-400 text-sm\">Receita Hoje</span>\n              <span className=\"text-3xl\">💰</span>\n            </div>\n            <p className=\"text-3xl font-bold text-white\">R$ {stats.receitaHoje.toFixed(2)}</p>\n          </div>\n\n          <div className=\"bg-gray-800 rounded-xl p-6 border-l-4 border-yellow-500\">\n            <div className=\"flex items-center justify-between mb-2\">\n              <span className=\"text-gray-400 text-sm\">Pendentes</span>\n              <span className=\"text-3xl\">⏳</span>\n            </div>\n            <p className=\"text-3xl font-bold text-white\">{stats.pedidosPendentes}</p>\n          </div>\n\n          <div className=\"bg-gray-800 rounded-xl p-6 border-l-4 border-purple-500\">\n            <div className=\"flex items-center justify-between mb-2\">\n              <span className=\"text-gray-400 text-sm\">Produtos Ativos</span>\n              <span className=\"text-3xl\">🛍️</span>\n            </div>\n            <p className=\"text-3xl font-bold text-white\">{stats.produtosAtivos}</p>\n          </div>\n        </div>\n\n        {/* Quick Actions */}\n        <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          <button\n            onClick={() => router.push('/loja/pedidos')}\n            className=\"bg-gray-800 rounded-xl p-6 hover:bg-gray-700 transition-colors text-left group\"\n          >\n            <div className=\"text-4xl mb-4 group-hover:scale-110 transition-transform\">📋</div>\n            <h3 className=\"text-xl font-bold text-white mb-2\">Gerenciar Pedidos</h3>\n            <p className=\"text-gray-400\">Visualize e atualize o status dos pedidos</p>\n          </button>\n\n          <button\n            onClick={() => router.push('/loja/produtos')}\n            className=\"bg-gray-800 rounded-xl p-6 hover:bg-gray-700 transition-colors text-left group\"\n          >\n            <div className=\"text-4xl mb-4 group-hover:scale-110 transition-transform\">🛒</div>\n            <h3 className=\"text-xl font-bold text-white mb-2\">Produtos</h3>\n            <p className=\"text-gray-400\">Adicione e edite produtos do cardápio</p>\n          </button>\n\n          <button\n            onClick={() => router.push('/loja/configuracoes')}\n            className=\"bg-gray-800 rounded-xl p-6 hover:bg-gray-700 transition-colors text-left group\"\n          >\n            <div className=\"text-4xl mb-4 group-hover:scale-110 transition-transform\">⚙️</div>\n            <h3 className=\"text-xl font-bold text-white mb-2\">Configurações</h3>\n            <p className=\"text-gray-400\">Gerencie informações da loja</p>\n          </button>\n\n          <button\n            onClick={() => router.push('/loja/financeiro')}\n            className=\"bg-gray-800 rounded-xl p-6 hover:bg-gray-700 transition-colors text-left group\"\n          >\n            <div className=\"text-4xl mb-4 group-hover:scale-110 transition-transform\">💳</div>\n            <h3 className=\"text-xl font-bold text-white mb-2\">Financeiro</h3>\n            <p className=\"text-gray-400\">Acompanhe vendas e pagamentos</p>\n          </button>\n\n          <button\n            onClick={() => router.push('/loja/promocoes')}\n            className=\"bg-gray-800 rounded-xl p-6 hover:bg-gray-700 transition-colors text-left group\"\n          >\n            <div className=\"text-4xl mb-4 group-hover:scale-110 transition-transform\">🎁</div>\n            <h3 className=\"text-xl font-bold text-white mb-2\">Promoções</h3>\n            <p className=\"text-gray-400\">Crie ofertas especiais</p>\n          </button>\n\n          <button\n            onClick={() => router.push('/loja/relatorios')}\n            className=\"bg-gray-800 rounded-xl p-6 hover:bg-gray-700 transition-colors text-left group\"\n          >\n            <div className=\"text-4xl mb-4 group-hover:scale-110 transition-transform\">📊</div>\n            <h3 className=\"text-xl font-bold text-white mb-2\">Relatórios</h3>\n            <p className=\"text-gray-400\">Analise o desempenho da loja</p>\n          </button>\n        </div>\n      </div>\n    </div>\n  )\n}\n","size_bytes":8872},"pedai-nextjs/app/auth/login/page.tsx":{"content":"import { Metadata } from 'next'\nimport LoginForm from '@/components/auth/LoginForm'\nimport ClientLayout from '@/components/ClientLayout'\n\nexport const metadata: Metadata = {\n  title: 'Login - PedeAí',\n  description: 'Faça login na sua conta PedeAí',\n}\n\nexport default function LoginPage() {\n  return (\n    <ClientLayout>\n      <div className=\"min-h-[80vh] flex items-center justify-center bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 px-4 py-12\">\n        <div className=\"w-full max-w-md\">\n          <div className=\"text-center mb-8\">\n            <h1 className=\"text-4xl font-bold text-white mb-2\">Bem-vindo!</h1>\n            <p className=\"text-gray-400\">Entre na sua conta ou crie uma nova</p>\n          </div>\n          \n          <LoginForm />\n        </div>\n      </div>\n    </ClientLayout>\n  )\n}\n","size_bytes":815},"pedai-nextjs/get-columns.js":{"content":"const { createClient } = require('@supabase/supabase-js');\n\nconst supabase = createClient(\n  'https://jrskruadcwuytvjeqybh.supabase.co',\n  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Impyc2tydWFkY3d1eXR2amVxeWJoIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc0OTIyNzg5MywiZXhwIjoyMDY0ODAzODkzfQ.SQqgGs7mEPPZ7dmS7NjPXUvsDPRHa-UZSY09SZntrAc'\n);\n\nasync function getColumns() {\n  const tables = ['categorias', 'lojas', 'produtos', 'perfis'];\n  \n  for (const table of tables) {\n    const { data } = await supabase.rpc('exec_sql', {\n      query: `SELECT column_name, data_type, is_nullable \n              FROM information_schema.columns \n              WHERE table_name = '${table}' \n              ORDER BY ordinal_position;`\n    });\n    \n    if (!data) {\n      // Try inserting empty row to see error\n      const { error } = await supabase.from(table).insert({}).select();\n      console.log(`\\n${table}:`, error?.message || 'unknown');\n    }\n  }\n}\n\ngetColumns();\n","size_bytes":978},"pedai-nextjs/app/[municipio]/lojas/page.tsx":{"content":"import { Metadata } from 'next'\nimport { getTenantBySlug } from '@/lib/tenantConfig'\nimport { notFound } from 'next/navigation'\nimport ClientLayout from '@/components/ClientLayout'\nimport LojasContent from '@/components/clientes/LojasContent'\nimport { createClient } from '@/lib/supabase/server'\n\ninterface PageProps {\n  params: {\n    municipio: string\n  }\n  searchParams: {\n    categoria?: string\n  }\n}\n\nexport async function generateMetadata({ params }: PageProps): Promise<Metadata> {\n  const tenant = getTenantBySlug(params.municipio)\n  \n  if (!tenant) {\n    return {\n      title: 'Município não encontrado',\n    }\n  }\n\n  return {\n    title: `Lojas em ${tenant.name} - PedeAí`,\n    description: `Descubra as melhores lojas de ${tenant.name}. Comida, mercado, farmácia e muito mais!`,\n  }\n}\n\nasync function getLojas(municipio: string) {\n  const supabase = await createClient()\n  \n  const { data, error} = await supabase\n    .from('lojas')\n    .select('*')\n    .eq('municipio', municipio)\n    .eq('aprovada', true)\n    .order('nome_loja')\n  \n  if (error) {\n    console.error('Erro ao carregar lojas:', error)\n    return []\n  }\n  \n  return data || []\n}\n\nexport default async function LojasPage({ params, searchParams }: PageProps) {\n  const tenant = getTenantBySlug(params.municipio)\n\n  if (!tenant) {\n    notFound()\n  }\n\n  const lojas = await getLojas(tenant.slug)\n\n  return (\n    <ClientLayout tenant={tenant}>\n      <LojasContent \n        tenant={tenant} \n        initialLojas={lojas}\n        categoriaInicial={searchParams.categoria || 'todas'}\n      />\n    </ClientLayout>\n  )\n}\n","size_bytes":1589},"pedai-nextjs/components/clientes/CategoriesSection.tsx":{"content":"'use client'\n\nimport Link from 'next/link'\nimport type { TenantConfig } from '@/lib/types/tenant'\n\ninterface CategoriesSectionProps {\n  tenant: TenantConfig\n}\n\nconst CATEGORIES = [\n  { id: 'restaurante', name: 'Restaurantes', icon: '🍔', color: 'from-red-500 to-orange-500' },\n  { id: 'mercado', name: 'Mercados', icon: '🛒', color: 'from-green-500 to-emerald-500' },\n  { id: 'farmacia', name: 'Farmácias', icon: '💊', color: 'from-blue-500 to-cyan-500' },\n  { id: 'padaria', name: 'Padarias', icon: '🥖', color: 'from-yellow-500 to-amber-500' },\n  { id: 'bebidas', name: 'Bebidas', icon: '🍺', color: 'from-purple-500 to-pink-500' },\n  { id: 'lanchonete', name: 'Lanchonetes', icon: '🌭', color: 'from-orange-500 to-red-500' },\n  { id: 'pizzaria', name: 'Pizzarias', icon: '🍕', color: 'from-red-600 to-orange-600' },\n  { id: 'outros', name: 'Outros', icon: '📦', color: 'from-gray-500 to-gray-600' },\n]\n\nexport default function CategoriesSection({ tenant }: CategoriesSectionProps) {\n  return (\n    <section className=\"py-16 bg-gray-900\">\n      <div className=\"container mx-auto px-4\">\n        <div className=\"text-center mb-12\">\n          <h2 className=\"text-4xl font-bold text-white mb-4\">\n            Categorias\n          </h2>\n          <p className=\"text-gray-400 text-lg\">\n            Encontre exatamente o que você procura\n          </p>\n        </div>\n\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-6 max-w-6xl mx-auto\">\n          {CATEGORIES.map((category) => (\n            <Link\n              key={category.id}\n              href={`/${tenant.slug}/lojas?categoria=${category.id}`}\n              className=\"group relative overflow-hidden rounded-2xl bg-gradient-to-br p-8 text-center transition-all hover:scale-105 hover:shadow-2xl\"\n              style={{\n                background: `linear-gradient(135deg, ${tenant.theme.primary}15, ${tenant.theme.primary}05)`,\n                border: `1px solid ${tenant.theme.primary}30`,\n              }}\n            >\n              <div className=\"relative z-10\">\n                <div className=\"text-6xl mb-4 transform group-hover:scale-110 transition-transform\">\n                  {category.icon}\n                </div>\n                <h3 className=\"text-white font-semibold text-lg\">\n                  {category.name}\n                </h3>\n              </div>\n            </Link>\n          ))}\n        </div>\n      </div>\n    </section>\n  )\n}\n","size_bytes":2432},"pedai-nextjs/MIGRATION_REPORT.md":{"content":"# 🎉 Relatório de Migração - PedeAí Next.js\n\n**Data**: 17 de novembro de 2025  \n**Status**: ✅ **CONCLUÍDO - MVP Pronto para Uso**\n\n---\n\n## 🎯 Objetivo da Migração\n\nMigrar a plataforma PedeAí de **Express + Vanilla HTML/JS** para **Next.js 14 fullstack** para:\n- Facilitar expansão multi-municipal\n- Melhorar manutenibilidade\n- Modernizar stack tecnológico\n- Preparar para escalabilidade\n\n---\n\n## ✅ Implementações Realizadas\n\n### 1. Estrutura Base\n- ✅ Next.js 14 com App Router\n- ✅ TypeScript configurado\n- ✅ Tailwind CSS\n- ✅ Organização de pastas (app/, components/, lib/)\n\n### 2. Multi-Tenancy\n- ✅ 3 municípios configurados (Alagoa Nova, Esperança, Alagoa Grande)\n- ✅ Rotas dinâmicas `/{municipio}/*`\n- ✅ Theming dinâmico com CSS variables\n- ✅ Middleware para tenant resolution\n- ✅ Configs centralizadas em `lib/tenantConfig/`\n\n### 3. Componentes Reutilizáveis\n- ✅ `SimpleHeader`: Navegação responsiva, tenant-aware\n- ✅ `Footer`: Links dinâmicos\n- ✅ `ClientLayout`: Injeta CSS variables por município\n- ✅ `Logo`: Adaptável\n- ✅ `CartButton`: Botão flutuante\n- ✅ `LoginForm`: Login/Cadastro com tabs\n\n### 4. Autenticação\n- ✅ Sistema completo com Supabase Auth\n- ✅ Registro de 3 tipos de usuário\n- ✅ Redirect automático por perfil\n- ✅ Proteção de rotas\n\n### 5. Páginas do Cliente\n| Página | Rota | Status |\n|--------|------|--------|\n| Home | `/{municipio}` | ✅ |\n| Lojas | `/{municipio}/lojas` | ✅ |\n| Carrinho | `/{municipio}/carrinho` | ✅ |\n| Login | `/{municipio}/auth/login` | ✅ |\n\n### 6. Funcionalidades\n- ✅ Listagem de lojas com filtros\n- ✅ Carrinho de compras com Context API\n- ✅ Checkout com validações\n- ✅ Cálculo de taxa de entrega\n- ✅ Persistência em localStorage\n\n### 7. Dashboard da Loja\n- ✅ `/loja/dashboard` com proteção de auth\n- ✅ Estatísticas e resumo\n- ✅ Layout exclusivo\n\n### 8. APIs Next.js\n| Endpoint | Método | Descrição |\n|----------|--------|-----------|\n| `/api/auth/register` | POST | Criar usuários |\n| `/api/lojas` | GET | Listar lojas (tenant-filtered) |\n| `/api/pedidos` | GET | Listar pedidos do usuário |\n| `/api/pedidos` | POST | Criar pedidos |\n\n---\n\n## 🔒 Segurança\n\n### Implementado\n- ✅ Autenticação obrigatória em todas as APIs\n- ✅ Validação de ownership (users só vêem seus dados)\n- ✅ Filtros tenant-aware em lojas\n- ✅ Validação de loja ativa antes de pedidos\n- ✅ Apenas clientes podem criar pedidos\n\n### Limitações Documentadas\nVer `SECURITY_NOTE.md` para detalhes completos:\n\n- ⚠️ Tenant isolation COMPLETO requer `municipio` na tabela `perfis`\n- ⚠️ Cliente pode teoricamente pedir de outro município se construir request manualmente\n- ✅ UI previne isso naturalmente (storefront filtra por município)\n- ✅ Roadmap de melhorias documentado\n\n---\n\n## 📂 Estrutura do Projeto\n\n```\npedai-nextjs/\n├── app/\n│   ├── layout.tsx                    # Layout raiz\n│   ├── page.tsx                      # Seletor de municípios\n│   ├── [municipio]/                  # Rotas tenant-aware\n│   │   ├── page.tsx                  # Home do município\n│   │   ├── lojas/page.tsx            # Listagem de lojas\n│   │   ├── carrinho/page.tsx         # Carrinho de compras\n│   │   └── auth/login/page.tsx       # Login/Cadastro\n│   ├── loja/\n│   │   └── dashboard/page.tsx        # Dashboard da loja\n│   └── api/\n│       ├── auth/register/route.ts    # Registro de usuários\n│       ├── lojas/route.ts            # API de lojas\n│       └── pedidos/route.ts          # API de pedidos\n├── components/\n│   ├── SimpleHeader.tsx              # Header responsivo\n│   ├── Footer.tsx                    # Footer\n│   ├── ClientLayout.tsx              # Layout com theming\n│   ├── Logo.tsx                      # Logo adaptável\n│   ├── auth/\n│   │   └── LoginForm.tsx             # Form de login/cadastro\n│   ├── clientes/\n│   │   ├── HeroSection.tsx           # Hero da home\n│   │   ├── CategoriesSection.tsx     # Categorias\n│   │   ├── LojasContent.tsx          # Listagem de lojas\n│   │   ├── CarrinhoContent.tsx       # Conteúdo do carrinho\n│   │   └── CartButton.tsx            # Botão flutuante\n│   └── loja/\n│       └── LojaDashboard.tsx         # Dashboard\n├── lib/\n│   ├── types/tenant.ts               # Tipos TypeScript\n│   ├── tenantConfig/index.ts         # Configs dos municípios\n│   ├── contexts/CartContext.tsx      # Context do carrinho\n│   └── supabase/\n│       ├── client.ts                 # Cliente browser\n│       ├── server.ts                 # Cliente server\n│       └── middleware.ts             # Sessões\n├── middleware.ts                      # Middleware Next.js\n├── SECURITY_NOTE.md                   # Documentação de segurança\n└── MIGRATION_REPORT.md                # Este relatório\n```\n\n---\n\n## 🚀 Como Rodar\n\n```bash\ncd pedai-nextjs\nnpm install\nnpm run dev\n```\n\nAcesse: `http://localhost:5000`\n\n---\n\n## 📊 Métricas da Migração\n\n| Métrica | Antes | Depois |\n|---------|-------|--------|\n| Framework | Express | Next.js 14 |\n| Frontend | HTML/JS Vanilla | React + TypeScript |\n| Estilo | CSS puro | Tailwind CSS |\n| APIs | Express routes | Next.js API Routes |\n| State | Variáveis globais | Context API |\n| Multi-tenancy | Config manual | Sistema robusto |\n| Type Safety | ❌ | ✅ TypeScript |\n\n---\n\n## 🎨 Theming Multi-Tenant\n\nCada município tem cores personalizadas injetadas via CSS variables:\n\n```css\n:root {\n  --color-primary: #FFD100;      /* Alagoa Nova */\n  --color-primary: #00D4FF;      /* Esperança */\n  --color-primary: #00FF85;      /* Alagoa Grande */\n  --color-secondary: #1A1A1A;    /* Todas */\n}\n```\n\n---\n\n## 📝 Notas Importantes\n\n1. **Banco de dados não foi migrado** - Continua usando Supabase\n2. **Schema permanece o mesmo** - Compatível com versão anterior\n3. **Rotas de loja não são tenant-specific** - `/loja/dashboard` vale para todos\n4. **Tenant isolation** - Ver `SECURITY_NOTE.md` para roadmap de melhorias\n\n---\n\n## 🐛 Problemas Conhecidos\n\n1. ⚠️ Tenant isolation requer migração SQL (adicionar `municipio` em `perfis`)\n2. ⚠️ Imagens de lojas/produtos ainda não implementadas (upload)\n3. ⚠️ Notificações em tempo real não implementadas\n\n---\n\n## ✨ Próximos Passos Sugeridos\n\n### Curto Prazo\n1. [ ] Adicionar `municipio` à tabela `perfis` (migração SQL)\n2. [ ] Implementar página de produto individual\n3. [ ] Adicionar histórico de pedidos do cliente\n4. [ ] Upload de imagens (produtos, perfil de loja)\n\n### Médio Prazo\n5. [ ] CRUD de produtos para lojistas\n6. [ ] Sistema de avaliações\n7. [ ] Dashboard do entregador\n8. [ ] Painel administrativo\n\n### Longo Prazo\n9. [ ] Notificações push\n10. [ ] Chat loja-cliente\n11. [ ] Tracking de entrega em tempo real\n12. [ ] Analytics e relatórios\n\n---\n\n## 🎓 Lições Aprendidas\n\n1. **Multi-tenancy desde o início** - Facilitou expansão\n2. **TypeScript vale a pena** - Type safety preveniu bugs\n3. **Context API é suficiente** - Zustand seria over-engineering para MVP\n4. **Segurança é iterativa** - Documentação de limitações é essencial\n\n---\n\n## 🙏 Conclusão\n\nA migração foi **concluída com sucesso**! O projeto agora possui:\n- ✅ Base sólida e escalável\n- ✅ Multi-tenancy robusto\n- ✅ Type safety completo\n- ✅ APIs funcionais\n- ✅ UX moderna e responsiva\n\n**MVP está pronto para uso e expansão!** 🚀\n\n---\n\n**Desenvolvido com IA** (Gemini/ChatGPT)  \n**Versão**: 2.0.0  \n**Última atualização**: 17 de novembro de 2025\n","size_bytes":7809},"pedai-nextjs/app/[municipio]/auth/login/page.tsx":{"content":"import { Metadata } from 'next'\nimport { getTenantBySlug } from '@/lib/tenantConfig'\nimport { notFound } from 'next/navigation'\nimport LoginForm from '@/components/auth/LoginForm'\nimport ClientLayout from '@/components/ClientLayout'\n\ninterface PageProps {\n  params: {\n    municipio: string\n  }\n}\n\nexport async function generateMetadata({ params }: PageProps): Promise<Metadata> {\n  const tenant = getTenantBySlug(params.municipio)\n  \n  if (!tenant) {\n    return {\n      title: 'Município não encontrado',\n    }\n  }\n\n  return {\n    title: `Login - ${tenant.name} - PedeAí`,\n    description: 'Faça login na sua conta PedeAí',\n  }\n}\n\nexport default function LoginPage({ params }: PageProps) {\n  const tenant = getTenantBySlug(params.municipio)\n\n  if (!tenant) {\n    notFound()\n  }\n\n  return (\n    <ClientLayout tenant={tenant}>\n      <div className=\"min-h-[80vh] flex items-center justify-center bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 px-4 py-12\">\n        <div className=\"w-full max-w-md\">\n          <div className=\"text-center mb-8\">\n            <h1 className=\"text-4xl font-bold text-white mb-2\">Bem-vindo a <span className=\"text-tenant-primary\">{tenant.name}</span>!</h1>\n            <p className=\"text-gray-400\">Entre na sua conta ou crie uma nova</p>\n          </div>\n          \n          <LoginForm tenant={tenant} />\n        </div>\n      </div>\n    </ClientLayout>\n  )\n}\n","size_bytes":1398},"pedai-nextjs/app/api/lojas/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { createClient } from '@/lib/supabase/server'\n\nexport async function GET(request: NextRequest) {\n  try {\n    const searchParams = request.nextUrl.searchParams\n    const municipio = searchParams.get('municipio')\n    const categoria = searchParams.get('categoria')\n    \n    // Validate that municipio is provided for tenant isolation\n    if (!municipio) {\n      return NextResponse.json(\n        { error: 'Município é obrigatório' },\n        { status: 400 }\n      )\n    }\n    \n    const supabase = await createClient()\n    \n    // Always filter by municipio for tenant isolation\n    let query = supabase\n      .from('lojas')\n      .select('*')\n      .eq('municipio', municipio)\n    \n    if (categoria && categoria !== 'todas') {\n      query = query.eq('categoria', categoria)\n    }\n    \n    const { data, error } = await query.order('created_at', { ascending: false })\n    \n    if (error) {\n      console.error('Erro ao buscar lojas:', error)\n      return NextResponse.json(\n        { error: 'Erro ao buscar lojas' },\n        { status: 500 }\n      )\n    }\n    \n    return NextResponse.json(data)\n  } catch (error: any) {\n    console.error('Erro no endpoint de lojas:', error)\n    return NextResponse.json(\n      { error: 'Erro interno do servidor' },\n      { status: 500 }\n    )\n  }\n}\n","size_bytes":1349},"pedai-nextjs/app/[municipio]/carrinho/page.tsx":{"content":"import { Metadata } from 'next'\nimport { getTenantBySlug } from '@/lib/tenantConfig'\nimport { notFound } from 'next/navigation'\nimport ClientLayout from '@/components/ClientLayout'\nimport CarrinhoContent from '@/components/clientes/CarrinhoContent'\n\ninterface PageProps {\n  params: {\n    municipio: string\n  }\n}\n\nexport async function generateMetadata({ params }: PageProps): Promise<Metadata> {\n  const tenant = getTenantBySlug(params.municipio)\n  \n  if (!tenant) {\n    return {\n      title: 'Município não encontrado',\n    }\n  }\n\n  return {\n    title: `Carrinho - ${tenant.name} - PedeAí`,\n    description: 'Finalize seu pedido',\n  }\n}\n\nexport default function CarrinhoPage({ params }: PageProps) {\n  const tenant = getTenantBySlug(params.municipio)\n\n  if (!tenant) {\n    notFound()\n  }\n\n  return (\n    <ClientLayout tenant={tenant}>\n      <CarrinhoContent tenant={tenant} />\n    </ClientLayout>\n  )\n}\n","size_bytes":907},"pedai-nextjs/app/api/pedidos/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { createClient } from '@/lib/supabase/server'\nimport { getTenantBySlug } from '@/lib/tenantConfig'\n\nexport async function POST(request: NextRequest) {\n  try {\n    // Check for Authorization header (localStorage-based sessions in iframe)\n    const authHeader = request.headers.get('authorization')\n    const token = authHeader?.replace('Bearer ', '')\n    \n    // Create Supabase client with token if available\n    const supabase = token \n      ? await createClient(token)\n      : await createClient()\n    \n    const body = await request.json()\n    const { \n      items, \n      endereco, \n      referencia,\n      observacoes, \n      forma_pagamento,\n      troco_para\n    } = body\n    \n    if (!items || items.length === 0) {\n      return NextResponse.json(\n        { error: 'Carrinho vazio' },\n        { status: 400 }\n      )\n    }\n    \n    if (!endereco) {\n      return NextResponse.json(\n        { error: 'Endereço de entrega é obrigatório' },\n        { status: 400 }\n      )\n    }\n    \n    // AUTHENTICATION REQUIRED: User must be logged in to create orders\n    const { data: { user }, error: authError } = await supabase.auth.getUser()\n    \n    if (authError || !user) {\n      return NextResponse.json(\n        { error: 'Autenticação necessária. Faça login para fazer pedidos.' },\n        { status: 401 }\n      )\n    }\n    \n    // Get user profile - only clientes can create orders\n    const { data: perfil } = await supabase\n      .from('perfis')\n      .select('id, tipo')\n      .eq('user_id', user.id)\n      .single()\n    \n    if (!perfil) {\n      return NextResponse.json(\n        { error: 'Perfil não encontrado' },\n        { status: 404 }\n      )\n    }\n    \n    if (perfil.tipo !== 'cliente') {\n      return NextResponse.json(\n        { error: 'Apenas clientes podem criar pedidos' },\n        { status: 403 }\n      )\n    }\n    \n    const perfil_id = perfil.id\n    \n    // Get loja_id from first item (assuming single-store cart)\n    const loja_id = items[0].loja_id\n    \n    // Verify all items are from the same loja\n    const allSameLoja = items.every((item: any) => item.loja_id === loja_id)\n    if (!allSameLoja) {\n      return NextResponse.json(\n        { error: 'Todos os itens devem ser da mesma loja' },\n        { status: 400 }\n      )\n    }\n    \n    // Verify the loja exists - município is derived FROM the loja (trusted source)\n    // This prevents tenant isolation bypass by trusting database state, not client input\n    const { data: loja, error: lojaError } = await supabase\n      .from('lojas')\n      .select('id, nome_loja, municipio')\n      .eq('id', loja_id)\n      .single()\n    \n    if (lojaError || !loja) {\n      return NextResponse.json(\n        { error: 'Loja não encontrada' },\n        { status: 404 }\n      )\n    }\n    \n    // CRITICAL SECURITY: Validate quantities before any calculations\n    for (const item of items) {\n      if (!item.quantidade || item.quantidade <= 0 || item.quantidade > 100) {\n        return NextResponse.json(\n          { error: 'Quantidade inválida. Deve ser entre 1 e 100.' },\n          { status: 400 }\n        )\n      }\n      // Ensure quantidade is an integer to prevent decimal exploits\n      if (!Number.isInteger(item.quantidade)) {\n        return NextResponse.json(\n          { error: 'Quantidade deve ser um número inteiro' },\n          { status: 400 }\n        )\n      }\n    }\n    \n    // CRITICAL SECURITY: Fetch actual prices from database to prevent price tampering\n    const productIds = items.map((item: any) => item.produto_id)\n    const { data: produtos, error: produtosError } = await supabase\n      .from('produtos')\n      .select('id, nome, preco, loja_id')\n      .in('id', productIds)\n    \n    if (produtosError || !produtos) {\n      return NextResponse.json(\n        { error: 'Erro ao validar produtos' },\n        { status: 500 }\n      )\n    }\n    \n    // Validate all products exist and belong to the correct loja\n    const invalidProducts = produtos.filter((p: any) => p.loja_id !== loja_id)\n    if (invalidProducts.length > 0) {\n      return NextResponse.json(\n        { error: 'Alguns produtos não pertencem a esta loja' },\n        { status: 400 }\n      )\n    }\n    \n    // Create a map of product prices from database (trusted source)\n    const produtoMap = new Map(produtos.map((p: any) => [p.id, p]))\n    \n    // Calculate server-side pricing (prevent price tampering)\n    let subtotal = 0\n    const validatedItems = items.map((item: any) => {\n      const produto = produtoMap.get(item.produto_id)\n      if (!produto) {\n        throw new Error(`Produto ${item.produto_id} não encontrado`)\n      }\n      const itemTotal = produto.preco * item.quantidade\n      subtotal += itemTotal\n      return {\n        produto_id: item.produto_id,\n        quantidade: item.quantidade,\n        preco_unitario: produto.preco, // Use DB price, not client price\n        observacao: item.observacao,\n      }\n    })\n    \n    // Get tenant config from loja's município for delivery fee calculation\n    // Normalize município name to match tenant slug format\n    const municipioSlug = loja.municipio\n      .toLowerCase()\n      .normalize('NFD') // Decompose accented characters\n      .replace(/[\\u0300-\\u036f]/g, '') // Remove diacritics\n      .replace(/\\s+/g, '-') // Replace spaces with hyphens\n      .trim()\n    \n    const tenant = getTenantBySlug(municipioSlug)\n    if (!tenant) {\n      console.error(`Tenant not found for município: ${loja.municipio}, normalized to: ${municipioSlug}`)\n      return NextResponse.json(\n        { error: 'Configuração de município não encontrada' },\n        { status: 500 }\n      )\n    }\n    \n    // Recalculate total with correct delivery fee from loja's tenant\n    const taxa_entrega = tenant.delivery.baseFee\n    const total = subtotal + taxa_entrega\n    \n    // Create order\n    const { data: pedido, error: pedidoError } = await supabase\n      .from('pedidos')\n      .insert({\n        perfil_id,\n        loja_id,\n        endereco_entrega: `${endereco}${referencia ? ` | Ref: ${referencia}` : ''}`,\n        observacoes,\n        forma_pagamento: forma_pagamento || 'dinheiro',\n        troco_para: troco_para || null,\n        subtotal,\n        taxa_entrega,\n        total,\n        status: 'pendente',\n      })\n      .select()\n      .single()\n    \n    if (pedidoError) {\n      console.error('Erro ao criar pedido:', pedidoError)\n      return NextResponse.json(\n        { error: 'Erro ao criar pedido' },\n        { status: 500 }\n      )\n    }\n    \n    // Create order items with server-validated prices\n    const itemsToInsert = validatedItems.map((item: any) => ({\n      pedido_id: pedido.id,\n      ...item,\n    }))\n    \n    const { error: itemsError } = await supabase\n      .from('pedido_itens')\n      .insert(itemsToInsert)\n    \n    if (itemsError) {\n      console.error('Erro ao criar itens do pedido:', itemsError)\n      // Rollback: delete the order\n      await supabase.from('pedidos').delete().eq('id', pedido.id)\n      return NextResponse.json(\n        { error: 'Erro ao criar itens do pedido' },\n        { status: 500 }\n      )\n    }\n    \n    return NextResponse.json(\n      {\n        message: 'Pedido criado com sucesso!',\n        id: pedido.id,\n        pedido,\n      },\n      { status: 201 }\n    )\n  } catch (error: any) {\n    console.error('Erro ao processar pedido:', error)\n    return NextResponse.json(\n      { error: 'Erro interno do servidor' },\n      { status: 500 }\n    )\n  }\n}\n\nexport async function GET(request: NextRequest) {\n  try {\n    const supabase = await createClient()\n    \n    // Check authentication\n    const { data: { user }, error: authError } = await supabase.auth.getUser()\n    \n    if (authError || !user) {\n      return NextResponse.json(\n        { error: 'Não autenticado' },\n        { status: 401 }\n      )\n    }\n    \n    // Get user profile\n    const { data: perfil } = await supabase\n      .from('perfis')\n      .select('id, tipo')\n      .eq('user_id', user.id)\n      .single()\n    \n    if (!perfil) {\n      return NextResponse.json(\n        { error: 'Perfil não encontrado' },\n        { status: 404 }\n      )\n    }\n    \n    // Get municipio from query param for tenant validation\n    const searchParams = request.nextUrl.searchParams\n    const municipio = searchParams.get('municipio')\n    \n    // Build base query with JOIN to lojas for municipio filtering\n    let query = supabase\n      .from('pedidos')\n      .select(`\n        *,\n        loja:lojas!inner(id, nome_loja, municipio),\n        perfil:perfis(nome_completo)\n      `)\n    \n    // Filter based on user type AND enforce tenant isolation\n    if (perfil.tipo === 'cliente') {\n      // Clientes only see their own orders\n      query = query.eq('perfil_id', perfil.id)\n      \n      // If municipio is provided, enforce server-side filter (tenant isolation)\n      if (municipio) {\n        query = query.eq('loja.municipio', municipio)\n      }\n    } else if (perfil.tipo === 'loja') {\n      // Get loja data\n      const { data: loja } = await supabase\n        .from('lojas')\n        .select('id, municipio')\n        .eq('user_id', user.id)\n        .single()\n      \n      if (!loja) {\n        return NextResponse.json(\n          { error: 'Loja não encontrada' },\n          { status: 404 }\n        )\n      }\n      \n      // Lojas only see orders for their own store (automatic tenant isolation)\n      query = query.eq('loja_id', loja.id)\n      \n      // Double-check municipio matches if provided\n      if (municipio && loja.municipio !== municipio) {\n        return NextResponse.json(\n          { error: 'Município não corresponde à loja' },\n          { status: 403 }\n        )\n      }\n    }\n    \n    query = query.order('created_at', { ascending: false })\n    \n    const { data, error } = await query\n    \n    if (error) {\n      console.error('Erro ao buscar pedidos:', error)\n      return NextResponse.json(\n        { error: 'Erro ao buscar pedidos' },\n        { status: 500 }\n      )\n    }\n    \n    return NextResponse.json(data)\n  } catch (error: any) {\n    console.error('Erro ao buscar pedidos:', error)\n    return NextResponse.json(\n      { error: 'Erro interno do servidor' },\n      { status: 500 }\n    )\n  }\n}\n","size_bytes":10206},"pedai-nextjs/components/clientes/LojasContent.tsx":{"content":"'use client'\n\nimport { useState } from 'react'\nimport Link from 'next/link'\nimport type { TenantConfig } from '@/lib/types/tenant'\n\ninterface Loja {\n  id: string\n  nome_loja: string\n  descricao?: string\n  logo_url?: string\n  categoria?: string\n  avaliacao_media?: number\n  tempo_entrega_medio?: number\n  taxa_entrega?: number\n  municipio?: string\n  aberta?: boolean\n}\n\ninterface LojasContentProps {\n  tenant: TenantConfig\n  initialLojas: Loja[]\n  categoriaInicial?: string\n}\n\nconst CATEGORIAS = [\n  { id: 'todas', nome: 'Todas', icone: '🏪' },\n  { id: 'restaurante', nome: 'Restaurantes', icone: '🍔' },\n  { id: 'mercado', nome: 'Mercados', icone: '🛒' },\n  { id: 'farmacia', nome: 'Farmácias', icone: '💊' },\n  { id: 'padaria', nome: 'Padarias', icone: '🥖' },\n  { id: 'bebidas', nome: 'Bebidas', icone: '🍺' },\n  { id: 'lanchonete', nome: 'Lanchonetes', icone: '🌭' },\n  { id: 'pizzaria', nome: 'Pizzarias', icone: '🍕' },\n  { id: 'outros', nome: 'Outros', icone: '📦' },\n]\n\nexport default function LojasContent({ tenant, initialLojas, categoriaInicial = 'todas' }: LojasContentProps) {\n  const [lojas] = useState<Loja[]>(initialLojas)\n  const [categoriaAtiva, setCategoriaAtiva] = useState(categoriaInicial)\n  const [busca, setBusca] = useState('')\n\n  const lojasFiltradas = lojas.filter(loja => {\n    const matchCategoria = categoriaAtiva === 'todas' || \n      (loja.categoria || '').trim().toLowerCase() === categoriaAtiva.toLowerCase()\n    const matchBusca = !busca || \n      loja.nome_loja.toLowerCase().includes(busca.toLowerCase()) ||\n      loja.descricao?.toLowerCase().includes(busca.toLowerCase())\n    \n    return matchCategoria && matchBusca\n  })\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900\">\n      {/* Header Section */}\n      <div className=\"bg-gray-900 border-b border-gray-800\">\n        <div className=\"container mx-auto px-4 py-8\">\n          <h1 className=\"text-4xl font-bold text-white mb-2\">\n            Lojas em <span className=\"text-tenant-primary\">{tenant.name}</span>\n          </h1>\n          <p className=\"text-gray-400\">\n            Descubra as melhores lojas da sua cidade\n          </p>\n        </div>\n      </div>\n\n      {/* Search Bar */}\n      <div className=\"bg-gray-900 border-b border-gray-800\">\n        <div className=\"container mx-auto px-4 py-6\">\n          <div className=\"max-w-2xl\">\n            <input\n              type=\"text\"\n              placeholder=\"Buscar lojas...\"\n              value={busca}\n              onChange={(e) => setBusca(e.target.value)}\n              className=\"w-full px-6 py-4 bg-gray-800 border border-gray-700 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-tenant-primary focus:border-transparent\"\n            />\n          </div>\n        </div>\n      </div>\n\n      {/* Categories */}\n      <div className=\"bg-gray-900 border-b border-gray-800\">\n        <div className=\"container mx-auto px-4 py-4\">\n          <div className=\"flex gap-3 overflow-x-auto pb-2 scrollbar-hide\">\n            {CATEGORIAS.map((categoria) => (\n              <button\n                key={categoria.id}\n                onClick={() => setCategoriaAtiva(categoria.id)}\n                className={`flex items-center gap-2 px-6 py-3 rounded-full font-medium transition-all whitespace-nowrap ${\n                  categoriaAtiva === categoria.id\n                    ? 'bg-tenant-primary text-tenant-secondary'\n                    : 'bg-gray-800 text-gray-300 hover:bg-gray-700'\n                }`}\n              >\n                <span>{categoria.icone}</span>\n                <span>{categoria.nome}</span>\n              </button>\n            ))}\n          </div>\n        </div>\n      </div>\n\n      {/* Lojas Grid */}\n      <div className=\"container mx-auto px-4 py-8\">\n        {lojasFiltradas.length === 0 ? (\n          <div className=\"text-center py-12\">\n            <div className=\"text-6xl mb-4\">🏪</div>\n            <h3 className=\"text-2xl font-bold text-white mb-2\">Nenhuma loja encontrada</h3>\n            <p className=\"text-gray-400\">\n              {busca \n                ? 'Tente buscar por outro termo'\n                : 'Ainda não temos lojas nesta categoria'}\n            </p>\n          </div>\n        ) : (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n            {lojasFiltradas.map((loja) => (\n              <Link\n                key={loja.id}\n                href={`/${tenant.slug}/loja/${loja.id}`}\n                className=\"group bg-gray-800 rounded-xl overflow-hidden hover:ring-2 hover:ring-tenant-primary transition-all\"\n              >\n                <div className=\"aspect-video bg-gray-900 flex items-center justify-center text-6xl\">\n                  {loja.logo_url ? (\n                    <img src={loja.logo_url} alt={loja.nome_loja} className=\"w-full h-full object-cover\" />\n                  ) : (\n                    '🏪'\n                  )}\n                </div>\n                \n                <div className=\"p-5\">\n                  <div className=\"flex items-start justify-between mb-2\">\n                    <h3 className=\"text-xl font-bold text-white group-hover:text-tenant-primary transition-colors\">\n                      {loja.nome_loja}\n                    </h3>\n                    {loja.aberta && (\n                      <span className=\"px-3 py-1 bg-green-500/10 text-green-500 text-xs font-medium rounded-full\">\n                        Aberta\n                      </span>\n                    )}\n                  </div>\n\n                  {loja.descricao && (\n                    <p className=\"text-gray-400 text-sm mb-4 line-clamp-2\">\n                      {loja.descricao}\n                    </p>\n                  )}\n\n                  <div className=\"flex items-center gap-4 text-sm text-gray-500\">\n                    {loja.avaliacao_media && (\n                      <span className=\"flex items-center gap-1\">\n                        ⭐ {loja.avaliacao_media.toFixed(1)}\n                      </span>\n                    )}\n                    {loja.tempo_entrega_medio && (\n                      <span className=\"flex items-center gap-1\">\n                        ⏱️ {loja.tempo_entrega_medio} min\n                      </span>\n                    )}\n                    {loja.taxa_entrega !== undefined && (\n                      <span className=\"flex items-center gap-1\">\n                        🚚 R$ {loja.taxa_entrega.toFixed(2)}\n                      </span>\n                    )}\n                  </div>\n                </div>\n              </Link>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\n","size_bytes":6684},"pedai-nextjs/lib/auth/types.ts":{"content":"export type UserType = 'cliente' | 'loja' | 'entregador'\n\nexport interface UserProfile {\n  id: string\n  user_id: string\n  email: string\n  nome_completo: string\n  tipo: UserType\n  created_at?: string\n  updated_at?: string\n}\n\nexport interface RegisterData {\n  email: string\n  password: string\n  nome: string\n  tipo: UserType\n  nome_loja?: string\n}\n\nexport interface LoginData {\n  email: string\n  password: string\n}\n","size_bytes":413},"pedai-nextjs/populate-data.js":{"content":"const { createClient } = require('@supabase/supabase-js');\n\nconst supabase = createClient(\n  'https://jrskruadcwuytvjeqybh.supabase.co',\n  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Impyc2tydWFkY3d1eXR2amVxeWJoIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc0OTIyNzg5MywiZXhwIjoyMDY0ODAzODkzfQ.SQqgGs7mEPPZ7dmS7NjPXUvsDPRHa-UZSY09SZntrAc'\n);\n\nasync function populate() {\n  console.log('🔄 Populando categorias...\\n');\n  \n  const categorias = [\n    { nome_categoria: 'Restaurantes', icone: '🍽️' },\n    { nome_categoria: 'Mercados', icone: '🛒' },\n    { nome_categoria: 'Farmácias', icone: '💊' },\n    { nome_categoria: 'Padarias', icone: '🥖' },\n    { nome_categoria: 'Bebidas', icone: '🥤' },\n    { nome_categoria: 'Outros', icone: '📦' }\n  ];\n  \n  const { data, error } = await supabase\n    .from('categorias')\n    .insert(categorias)\n    .select();\n  \n  if (error) {\n    console.log('❌ Erro ao inserir categorias:', error.message);\n    console.log('Detalhes:', error);\n  } else {\n    console.log(`✅ ${data.length} categorias inseridas!`);\n    console.log('Categorias:', data.map(c => c.nome_categoria).join(', '));\n  }\n}\n\npopulate();\n","size_bytes":1180},"pedai-nextjs/components/clientes/HeroSection.tsx":{"content":"'use client'\n\nimport { useState } from 'react'\nimport { useRouter } from 'next/navigation'\nimport type { TenantConfig } from '@/lib/types/tenant'\n\ninterface HeroSectionProps {\n  tenant: TenantConfig\n}\n\nexport default function HeroSection({ tenant }: HeroSectionProps) {\n  const router = useRouter()\n  const [endereco, setEndereco] = useState('')\n\n  const handleBuscarLojas = (e: React.FormEvent) => {\n    e.preventDefault()\n    \n    if (endereco.trim()) {\n      // Store address in localStorage\n      localStorage.setItem('endereco_entrega', endereco)\n      \n      // Navigate to stores page\n      router.push(`/${tenant.slug}/lojas`)\n    }\n  }\n\n  return (\n    <section className=\"relative min-h-[600px] flex items-center justify-center bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 overflow-hidden\">\n      {/* Animated Background */}\n      <div className=\"absolute inset-0 opacity-20\">\n        <div className=\"absolute top-20 left-10 w-72 h-72 rounded-full blur-3xl animate-pulse\"\n          style={{ backgroundColor: tenant.theme.primary }}\n        ></div>\n        <div className=\"absolute bottom-20 right-10 w-96 h-96 rounded-full blur-3xl animate-pulse delay-1000\"\n          style={{ backgroundColor: tenant.theme.primary }}\n        ></div>\n      </div>\n\n      <div className=\"container mx-auto px-4 py-20 relative z-10\">\n        <div className=\"max-w-4xl mx-auto text-center\">\n          {/* Main Heading */}\n          <h1 className=\"text-5xl md:text-6xl lg:text-7xl font-bold text-white mb-6 leading-tight\">\n            Peça e receba em\n            <br />\n            <span className=\"text-tenant-primary\">{tenant.name}</span>\n          </h1>\n          \n          <p className=\"text-xl md:text-2xl text-gray-300 mb-8 max-w-2xl mx-auto\">\n            Delivery local para sua cidade. Comida, remédios, compras e muito mais, \n            entregue rápido na sua porta.\n          </p>\n\n          {/* Address Search Form */}\n          <form onSubmit={handleBuscarLojas} className=\"max-w-2xl mx-auto mb-12\">\n            <div className=\"flex flex-col sm:flex-row gap-3 bg-white/10 backdrop-blur-md p-3 rounded-2xl shadow-2xl\">\n              <div className=\"flex-1\">\n                <input\n                  type=\"text\"\n                  placeholder=\"Digite seu endereço...\"\n                  value={endereco}\n                  onChange={(e) => setEndereco(e.target.value)}\n                  className=\"w-full px-6 py-4 bg-transparent text-white placeholder-gray-400 focus:outline-none text-lg\"\n                />\n              </div>\n              <button\n                type=\"submit\"\n                className=\"px-8 py-4 font-semibold rounded-xl transition-all hover:opacity-90 whitespace-nowrap\"\n                style={{\n                  backgroundColor: tenant.theme.primary,\n                  color: tenant.theme.secondary,\n                }}\n              >\n                Buscar Lojas\n              </button>\n            </div>\n          </form>\n\n          {/* Stats */}\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-6 max-w-3xl mx-auto\">\n            <div className=\"bg-white/5 backdrop-blur-sm rounded-xl p-6 border border-white/10\">\n              <div className=\"text-3xl font-bold text-tenant-primary mb-2\">50+</div>\n              <div className=\"text-gray-400 text-sm\">Lojas Parceiras</div>\n            </div>\n            <div className=\"bg-white/5 backdrop-blur-sm rounded-xl p-6 border border-white/10\">\n              <div className=\"text-3xl font-bold text-tenant-primary mb-2\">{tenant.delivery.maxDistance}km</div>\n              <div className=\"text-gray-400 text-sm\">Raio de Entrega</div>\n            </div>\n            <div className=\"bg-white/5 backdrop-blur-sm rounded-xl p-6 border border-white/10\">\n              <div className=\"text-3xl font-bold text-tenant-primary mb-2\">30min</div>\n              <div className=\"text-gray-400 text-sm\">Tempo Médio</div>\n            </div>\n            <div className=\"bg-white/5 backdrop-blur-sm rounded-xl p-6 border border-white/10\">\n              <div className=\"text-3xl font-bold text-tenant-primary mb-2\">R$ {tenant.delivery.baseFee.toFixed(2)}</div>\n              <div className=\"text-gray-400 text-sm\">Taxa Mínima</div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </section>\n  )\n}\n","size_bytes":4300},"pedai-nextjs/lib/contexts/CartContext.tsx":{"content":"'use client'\n\nimport { createContext, useContext, useState, useEffect, ReactNode } from 'react'\n\nexport interface CartItem {\n  id: string\n  produto_id: string\n  nome: string\n  preco: number\n  quantidade: number\n  observacao?: string\n  loja_id: string\n  loja_nome: string\n  imagem_url?: string\n}\n\ninterface CartContextType {\n  items: CartItem[]\n  addItem: (item: Omit<CartItem, 'id'>) => void\n  removeItem: (id: string) => void\n  updateQuantity: (id: string, quantidade: number) => void\n  clearCart: () => void\n  total: number\n  itemCount: number\n}\n\nconst CartContext = createContext<CartContextType | undefined>(undefined)\n\nexport function CartProvider({ children }: { children: ReactNode }) {\n  const [items, setItems] = useState<CartItem[]>([])\n\n  // Load cart from localStorage on mount\n  useEffect(() => {\n    const savedCart = localStorage.getItem('cart')\n    if (savedCart) {\n      try {\n        setItems(JSON.parse(savedCart))\n      } catch (error) {\n        console.error('Erro ao carregar carrinho:', error)\n      }\n    }\n  }, [])\n\n  // Save cart to localStorage whenever it changes\n  useEffect(() => {\n    localStorage.setItem('cart', JSON.stringify(items))\n  }, [items])\n\n  const addItem = (newItem: Omit<CartItem, 'id'>) => {\n    setItems(currentItems => {\n      // Check if item from same store exists\n      const existingItem = currentItems.find(\n        item => item.produto_id === newItem.produto_id && item.loja_id === newItem.loja_id\n      )\n\n      if (existingItem) {\n        // Update quantity if item exists\n        return currentItems.map(item =>\n          item.id === existingItem.id\n            ? { ...item, quantidade: item.quantidade + newItem.quantidade }\n            : item\n        )\n      }\n\n      // Add new item\n      return [\n        ...currentItems,\n        {\n          ...newItem,\n          id: `${newItem.produto_id}-${Date.now()}`,\n        },\n      ]\n    })\n  }\n\n  const removeItem = (id: string) => {\n    setItems(currentItems => currentItems.filter(item => item.id !== id))\n  }\n\n  const updateQuantity = (id: string, quantidade: number) => {\n    if (quantidade <= 0) {\n      removeItem(id)\n      return\n    }\n\n    setItems(currentItems =>\n      currentItems.map(item =>\n        item.id === id ? { ...item, quantidade } : item\n      )\n    )\n  }\n\n  const clearCart = () => {\n    setItems([])\n  }\n\n  const total = items.reduce((sum, item) => sum + item.preco * item.quantidade, 0)\n  const itemCount = items.reduce((sum, item) => sum + item.quantidade, 0)\n\n  return (\n    <CartContext.Provider\n      value={{\n        items,\n        addItem,\n        removeItem,\n        updateQuantity,\n        clearCart,\n        total,\n        itemCount,\n      }}\n    >\n      {children}\n    </CartContext.Provider>\n  )\n}\n\nexport function useCart() {\n  const context = useContext(CartContext)\n  if (context === undefined) {\n    throw new Error('useCart must be used within a CartProvider')\n  }\n  return context\n}\n","size_bytes":2929},"pedai-nextjs/components/clientes/LojaDetalhesContent.tsx":{"content":"'use client'\n\nimport Link from 'next/link'\nimport type { TenantConfig } from '@/lib/types/tenant'\nimport { useCart } from '@/lib/contexts/CartContext'\n\ninterface Loja {\n  id: number\n  nome_loja: string\n  categoria?: string\n  url_imagem?: string\n  nota_avaliacao?: number\n  municipio: string\n  created_at: string\n}\n\ninterface Produto {\n  id: number\n  nome: string\n  descricao?: string\n  preco: number\n  imagem_url?: string\n  disponivel: boolean\n  loja_id: number\n  created_at: string\n}\n\ninterface LojaDetalhesContentProps {\n  tenant: TenantConfig\n  loja: Loja\n  produtos: Produto[]\n}\n\nexport default function LojaDetalhesContent({ tenant, loja, produtos }: LojaDetalhesContentProps) {\n  const { addItem } = useCart()\n\n  const handleAddToCart = (produto: Produto) => {\n    addItem({\n      produto_id: produto.id.toString(),\n      nome: produto.nome,\n      preco: produto.preco,\n      quantidade: 1,\n      loja_id: loja.id.toString(),\n      loja_nome: loja.nome_loja,\n      imagem_url: produto.imagem_url\n    })\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900\">\n      {/* Breadcrumb */}\n      <div className=\"bg-gray-900 border-b border-gray-800\">\n        <div className=\"container mx-auto px-4 py-3\">\n          <div className=\"flex items-center gap-2 text-sm text-gray-400\">\n            <Link href={`/${tenant.slug}`} className=\"hover:text-tenant-primary transition-colors\">\n              Início\n            </Link>\n            <span>›</span>\n            <Link href={`/${tenant.slug}/lojas`} className=\"hover:text-tenant-primary transition-colors\">\n              Lojas\n            </Link>\n            <span>›</span>\n            <span className=\"text-white\">{loja.nome_loja}</span>\n          </div>\n        </div>\n      </div>\n\n      {/* Cabeçalho da Loja */}\n      <div className=\"bg-gray-900 border-b border-gray-800\">\n        <div className=\"container mx-auto px-4 py-8\">\n          <div className=\"flex flex-col md:flex-row gap-6 items-start\">\n            {/* Logo da Loja */}\n            <div className=\"w-32 h-32 bg-gray-800 rounded-xl flex items-center justify-center text-6xl flex-shrink-0\">\n              {loja.url_imagem ? (\n                <img\n                  src={loja.url_imagem}\n                  alt={loja.nome_loja}\n                  className=\"w-full h-full object-cover rounded-xl\"\n                />\n              ) : (\n                '🏪'\n              )}\n            </div>\n\n            {/* Informações da Loja */}\n            <div className=\"flex-1\">\n              <h1 className=\"text-3xl md:text-4xl font-bold text-white mb-2\">\n                {loja.nome_loja}\n              </h1>\n              \n              <div className=\"flex flex-wrap items-center gap-4 text-gray-400 mb-4\">\n                {loja.categoria && (\n                  <span className=\"px-3 py-1 bg-gray-800 rounded-full text-sm\">\n                    {loja.categoria}\n                  </span>\n                )}\n                {loja.nota_avaliacao && (\n                  <span className=\"flex items-center gap-1\">\n                    ⭐ <span className=\"font-semibold text-white\">{loja.nota_avaliacao.toFixed(1)}</span>\n                  </span>\n                )}\n              </div>\n\n              <p className=\"text-gray-400\">\n                📍 {tenant.name}\n              </p>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Produtos */}\n      <div className=\"container mx-auto px-4 py-8\">\n        <h2 className=\"text-2xl font-bold text-white mb-6\">\n          Cardápio\n        </h2>\n\n        {produtos.length === 0 ? (\n          <div className=\"text-center py-12\">\n            <div className=\"text-6xl mb-4\">📦</div>\n            <h3 className=\"text-xl font-bold text-white mb-2\">Nenhum produto disponível</h3>\n            <p className=\"text-gray-400\">\n              Esta loja ainda não cadastrou produtos\n            </p>\n          </div>\n        ) : (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n            {produtos.map((produto) => (\n              <div\n                key={produto.id}\n                className=\"bg-gray-800 rounded-xl overflow-hidden hover:ring-2 hover:ring-tenant-primary transition-all\"\n              >\n                {/* Imagem do Produto */}\n                <div className=\"aspect-video bg-gray-900 flex items-center justify-center text-4xl\">\n                  {produto.imagem_url ? (\n                    <img\n                      src={produto.imagem_url}\n                      alt={produto.nome}\n                      className=\"w-full h-full object-cover\"\n                    />\n                  ) : (\n                    '🍽️'\n                  )}\n                </div>\n\n                <div className=\"p-5\">\n                  <h3 className=\"text-lg font-bold text-white mb-2\">\n                    {produto.nome}\n                  </h3>\n\n                  {produto.descricao && (\n                    <p className=\"text-gray-400 text-sm mb-4 line-clamp-2\">\n                      {produto.descricao}\n                    </p>\n                  )}\n\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-2xl font-bold text-tenant-primary\">\n                      R$ {produto.preco.toFixed(2)}\n                    </span>\n\n                    <button\n                      onClick={() => handleAddToCart(produto)}\n                      className=\"px-6 py-2 bg-tenant-primary text-tenant-secondary rounded-lg font-semibold hover:opacity-90 transition-opacity\"\n                    >\n                      Adicionar\n                    </button>\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\n","size_bytes":5812},"pedai-nextjs/app/api/lojas/[id]/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { createClient } from '@/lib/supabase/server'\n\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: { id: string } }\n) {\n  try {\n    const supabase = await createClient()\n    const lojaId = params.id\n\n    const { data: loja, error: lojaError } = await supabase\n      .from('lojas')\n      .select('*')\n      .eq('id', lojaId)\n      .single()\n\n    if (lojaError) {\n      console.error('Erro ao buscar loja:', lojaError)\n      return NextResponse.json({ error: 'Loja não encontrada' }, { status: 404 })\n    }\n\n    const { data: produtos, error: produtosError } = await supabase\n      .from('produtos')\n      .select('*')\n      .eq('loja_id', lojaId)\n      .eq('disponivel', true)\n      .order('created_at', { ascending: false })\n\n    if (produtosError) {\n      console.error('Erro ao buscar produtos:', produtosError)\n    }\n\n    return NextResponse.json({\n      loja,\n      produtos: produtos || []\n    })\n  } catch (error) {\n    console.error('Erro na API:', error)\n    return NextResponse.json({ error: 'Erro interno do servidor' }, { status: 500 })\n  }\n}\n","size_bytes":1141},"pedai-nextjs/setup-database.js":{"content":"const { createClient } = require('@supabase/supabase-js');\n\nconst supabase = createClient(\n  'https://jrskruadcwuytvjeqybh.supabase.co',\n  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Impyc2tydWFkY3d1eXR2amVxeWJoIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc0OTIyNzg5MywiZXhwIjoyMDY0ODAzODkzfQ.SQqgGs7mEPPZ7dmS7NjPXUvsDPRHa-UZSY09SZntrAc'\n);\n\nasync function setup() {\n  console.log('🚀 Configurando banco de dados...\\n');\n  \n  // Etapa 1: Criar lojas de exemplo (populando direto)\n  console.log('📋 Criando lojas...');\n  \n  const lojas = [\n    {\n      nome_loja: 'Pizzaria Sabor da Hora',\n      municipio: 'Alagoa Nova',\n      categoria: 'Restaurantes',\n      endereco: 'Rua Principal, 123',\n      telefone: '(83) 98888-1111'\n    },\n    {\n      nome_loja: 'Supermercado Central',\n      municipio: 'Alagoa Nova',\n      categoria: 'Mercados',\n      endereco: 'Av. Central, 456',\n      telefone: '(83) 98888-2222'\n    },\n    {\n      nome_loja: 'Farmácia Saúde',\n      municipio: 'Esperança',\n      categoria: 'Farmácias',\n      endereco: 'Rua da Saúde, 789',\n      telefone: '(83) 98888-3333'\n    },\n    {\n      nome_loja: 'Padaria Pão Quente',\n      municipio: 'Lagoa Seca',\n      categoria: 'Padarias',\n      endereco: 'Praça Central, 321',\n      telefone: '(83) 98888-4444'\n    }\n  ];\n  \n  const { data, error } = await supabase\n    .from('lojas')\n    .insert(lojas)\n    .select();\n  \n  if (error) {\n    console.log('❌ Erro ao criar lojas:',error.message);\n    console.log('Detalhes:', JSON.stringify(error, null, 2));\n  } else {\n    console.log(`✅ ${data.length} lojas criadas!`);\n    data.forEach(l => console.log(`  - ${l.nome_loja} (${l.municipio})`));\n  }\n}\n\nsetup();\n","size_bytes":1710},"pedai-nextjs/components/clientes/CheckoutContent.tsx":{"content":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useRouter } from 'next/navigation'\nimport { useCart } from '@/lib/contexts/CartContext'\nimport type { TenantConfig } from '@/lib/types/tenant'\nimport { createClient } from '@/lib/supabase/client'\n\ninterface CheckoutContentProps {\n  tenant: TenantConfig\n}\n\nexport default function CheckoutContent({ tenant }: CheckoutContentProps) {\n  const router = useRouter()\n  const { items, total, clearCart } = useCart()\n  const [loading, setLoading] = useState(false)\n  const [checkingAuth, setCheckingAuth] = useState(true)\n  const [pedidoCriado, setPedidoCriado] = useState(false)\n\n  // Check authentication on mount\n  useEffect(() => {\n    const checkAuth = async () => {\n      const supabase = createClient()\n      const { data: { user } } = await supabase.auth.getUser()\n      \n      if (!user) {\n        // Save current path to redirect back after login\n        sessionStorage.setItem('redirectAfterLogin', `/${tenant.slug}/checkout`)\n        router.push(`/${tenant.slug}/auth/login`)\n        return\n      }\n      \n      setCheckingAuth(false)\n    }\n    \n    checkAuth()\n  }, [router, tenant])\n\n  // Redirect if cart is empty (but not if order was just created)\n  useEffect(() => {\n    if (items.length === 0 && !checkingAuth && !pedidoCriado) {\n      router.push(`/${tenant.slug}/carrinho`)\n    }\n  }, [items, router, tenant, checkingAuth, pedidoCriado])\n\n  // Form state\n  const [formData, setFormData] = useState({\n    rua: '',\n    numero: '',\n    bairro: '',\n    complemento: '',\n    referencia: '',\n    formaPagamento: 'dinheiro',\n    trocoPara: '',\n    observacoes: ''\n  })\n\n  const [errors, setErrors] = useState<Record<string, string>>({})\n\n  const taxaEntrega = tenant.delivery.baseFee\n  const totalComEntrega = total + taxaEntrega\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>) => {\n    const { name, value } = e.target\n    setFormData(prev => ({ ...prev, [name]: value }))\n    // Clear error when user starts typing\n    if (errors[name]) {\n      setErrors(prev => ({ ...prev, [name]: '' }))\n    }\n  }\n\n  const validateForm = () => {\n    const newErrors: Record<string, string> = {}\n\n    if (!formData.rua.trim()) newErrors.rua = 'Rua é obrigatória'\n    if (!formData.numero.trim()) newErrors.numero = 'Número é obrigatório'\n    if (!formData.bairro.trim()) newErrors.bairro = 'Bairro é obrigatório'\n    \n    if (formData.formaPagamento === 'dinheiro' && formData.trocoPara) {\n      const trocoPara = parseFloat(formData.trocoPara)\n      if (isNaN(trocoPara) || trocoPara < totalComEntrega) {\n        newErrors.trocoPara = 'Valor deve ser maior que o total do pedido'\n      }\n    }\n\n    setErrors(newErrors)\n    return Object.keys(newErrors).length === 0\n  }\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n\n    if (!validateForm()) {\n      return\n    }\n\n    setLoading(true)\n\n    try {\n      const endereco = `${formData.rua}, ${formData.numero} - ${formData.bairro}${formData.complemento ? ` (${formData.complemento})` : ''}`\n      \n      // Get access token for authentication (localStorage-based session)\n      const supabase = createClient()\n      const { data: { session } } = await supabase.auth.getSession()\n      \n      const response = await fetch('/api/pedidos', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          ...(session?.access_token && { 'Authorization': `Bearer ${session.access_token}` }),\n        },\n        body: JSON.stringify({\n          items: items.map(item => ({\n            produto_id: parseInt(item.produto_id),\n            loja_id: parseInt(item.loja_id),\n            quantidade: item.quantidade,\n            preco: item.preco,\n          })),\n          endereco,\n          referencia: formData.referencia || null,\n          forma_pagamento: formData.formaPagamento,\n          troco_para: formData.formaPagamento === 'dinheiro' && formData.trocoPara ? parseFloat(formData.trocoPara) : null,\n          observacoes: formData.observacoes || null,\n          taxa_entrega: taxaEntrega,\n          total: totalComEntrega,\n        }),\n      })\n\n      const data = await response.json()\n\n      if (!response.ok) {\n        // If 401 Unauthorized, redirect to login\n        if (response.status === 401) {\n          sessionStorage.setItem('redirectAfterLogin', `/${tenant.slug}/checkout`)\n          router.push(`/${tenant.slug}/auth/login`)\n          return\n        }\n        throw new Error(data.error || 'Erro ao criar pedido')\n      }\n\n      // Mark order as created to prevent cart empty redirect\n      setPedidoCriado(true)\n      \n      // Clear cart and redirect to success page\n      clearCart()\n      router.push(`/${tenant.slug}/pedido/${data.id}`)\n    } catch (error: any) {\n      alert('Erro ao finalizar pedido: ' + error.message)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  if (checkingAuth) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-16 w-16 border-b-2 border-tenant-primary mx-auto mb-4\"></div>\n          <p className=\"text-gray-400\">Verificando autenticação...</p>\n        </div>\n      </div>\n    )\n  }\n\n  if (items.length === 0) {\n    return null // Will redirect via useEffect\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 py-8\">\n      <div className=\"container mx-auto px-4\">\n        <h1 className=\"text-4xl font-bold text-white mb-8\">Finalizar Pedido</h1>\n\n        <div className=\"grid lg:grid-cols-3 gap-8\">\n          {/* Checkout Form */}\n          <div className=\"lg:col-span-2\">\n            <form onSubmit={handleSubmit} className=\"space-y-6\">\n              {/* Endereço */}\n              <div className=\"bg-gray-800 rounded-xl p-6\">\n                <h2 className=\"text-2xl font-bold text-white mb-4\">📍 Endereço de Entrega</h2>\n                \n                <div className=\"grid md:grid-cols-4 gap-4\">\n                  <div className=\"md:col-span-3\">\n                    <label htmlFor=\"rua\" className=\"block text-sm font-medium text-gray-300 mb-2\">\n                      Rua/Avenida *\n                    </label>\n                    <input\n                      id=\"rua\"\n                      name=\"rua\"\n                      type=\"text\"\n                      value={formData.rua}\n                      onChange={handleChange}\n                      placeholder=\"Ex: Rua das Flores\"\n                      className={`w-full px-4 py-3 bg-gray-900 border ${errors.rua ? 'border-red-500' : 'border-gray-700'} rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-tenant-primary`}\n                    />\n                    {errors.rua && <p className=\"text-red-500 text-sm mt-1\">{errors.rua}</p>}\n                  </div>\n\n                  <div>\n                    <label htmlFor=\"numero\" className=\"block text-sm font-medium text-gray-300 mb-2\">\n                      Número *\n                    </label>\n                    <input\n                      id=\"numero\"\n                      name=\"numero\"\n                      type=\"text\"\n                      value={formData.numero}\n                      onChange={handleChange}\n                      placeholder=\"123\"\n                      className={`w-full px-4 py-3 bg-gray-900 border ${errors.numero ? 'border-red-500' : 'border-gray-700'} rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-tenant-primary`}\n                    />\n                    {errors.numero && <p className=\"text-red-500 text-sm mt-1\">{errors.numero}</p>}\n                  </div>\n\n                  <div className=\"md:col-span-2\">\n                    <label htmlFor=\"bairro\" className=\"block text-sm font-medium text-gray-300 mb-2\">\n                      Bairro *\n                    </label>\n                    <input\n                      id=\"bairro\"\n                      name=\"bairro\"\n                      type=\"text\"\n                      value={formData.bairro}\n                      onChange={handleChange}\n                      placeholder=\"Ex: Centro\"\n                      className={`w-full px-4 py-3 bg-gray-900 border ${errors.bairro ? 'border-red-500' : 'border-gray-700'} rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-tenant-primary`}\n                    />\n                    {errors.bairro && <p className=\"text-red-500 text-sm mt-1\">{errors.bairro}</p>}\n                  </div>\n\n                  <div className=\"md:col-span-2\">\n                    <label htmlFor=\"complemento\" className=\"block text-sm font-medium text-gray-300 mb-2\">\n                      Complemento\n                    </label>\n                    <input\n                      id=\"complemento\"\n                      name=\"complemento\"\n                      type=\"text\"\n                      value={formData.complemento}\n                      onChange={handleChange}\n                      placeholder=\"Ex: Apto 201, Bloco B\"\n                      className=\"w-full px-4 py-3 bg-gray-900 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-tenant-primary\"\n                    />\n                  </div>\n\n                  <div className=\"md:col-span-4\">\n                    <label htmlFor=\"referencia\" className=\"block text-sm font-medium text-gray-300 mb-2\">\n                      Ponto de Referência\n                    </label>\n                    <input\n                      id=\"referencia\"\n                      name=\"referencia\"\n                      type=\"text\"\n                      value={formData.referencia}\n                      onChange={handleChange}\n                      placeholder=\"Ex: Próximo à Padaria Central\"\n                      className=\"w-full px-4 py-3 bg-gray-900 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-tenant-primary\"\n                    />\n                  </div>\n                </div>\n              </div>\n\n              {/* Forma de Pagamento */}\n              <div className=\"bg-gray-800 rounded-xl p-6\">\n                <h2 className=\"text-2xl font-bold text-white mb-4\">💳 Forma de Pagamento</h2>\n                \n                <div className=\"space-y-4\">\n                  <div>\n                    <label htmlFor=\"formaPagamento\" className=\"block text-sm font-medium text-gray-300 mb-2\">\n                      Pagar com *\n                    </label>\n                    <select\n                      id=\"formaPagamento\"\n                      name=\"formaPagamento\"\n                      value={formData.formaPagamento}\n                      onChange={handleChange}\n                      className=\"w-full px-4 py-3 bg-gray-900 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-tenant-primary\"\n                    >\n                      <option value=\"dinheiro\">💵 Dinheiro</option>\n                      <option value=\"pix\">📱 PIX</option>\n                      <option value=\"cartao\">💳 Cartão (na entrega)</option>\n                    </select>\n                  </div>\n\n                  {formData.formaPagamento === 'dinheiro' && (\n                    <div>\n                      <label htmlFor=\"trocoPara\" className=\"block text-sm font-medium text-gray-300 mb-2\">\n                        Troco para (opcional)\n                      </label>\n                      <input\n                        id=\"trocoPara\"\n                        name=\"trocoPara\"\n                        type=\"number\"\n                        step=\"0.01\"\n                        value={formData.trocoPara}\n                        onChange={handleChange}\n                        placeholder={`Mínimo: R$ ${totalComEntrega.toFixed(2)}`}\n                        className={`w-full px-4 py-3 bg-gray-900 border ${errors.trocoPara ? 'border-red-500' : 'border-gray-700'} rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-tenant-primary`}\n                      />\n                      {errors.trocoPara && <p className=\"text-red-500 text-sm mt-1\">{errors.trocoPara}</p>}\n                      {formData.trocoPara && !errors.trocoPara && parseFloat(formData.trocoPara) > totalComEntrega && (\n                        <p className=\"text-green-500 text-sm mt-1\">\n                          Troco: R$ {(parseFloat(formData.trocoPara) - totalComEntrega).toFixed(2)}\n                        </p>\n                      )}\n                    </div>\n                  )}\n                </div>\n              </div>\n\n              {/* Observações */}\n              <div className=\"bg-gray-800 rounded-xl p-6\">\n                <h2 className=\"text-2xl font-bold text-white mb-4\">📝 Observações</h2>\n                \n                <textarea\n                  id=\"observacoes\"\n                  name=\"observacoes\"\n                  value={formData.observacoes}\n                  onChange={handleChange}\n                  placeholder=\"Ex: sem cebola, bem passado, cuidado com o portão...\"\n                  rows={4}\n                  className=\"w-full px-4 py-3 bg-gray-900 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-tenant-primary resize-none\"\n                />\n              </div>\n            </form>\n          </div>\n\n          {/* Order Summary */}\n          <div className=\"lg:col-span-1\">\n            <div className=\"bg-gray-800 rounded-xl p-6 sticky top-24\">\n              <h2 className=\"text-2xl font-bold text-white mb-4\">Resumo do Pedido</h2>\n\n              {/* Items */}\n              <div className=\"space-y-3 mb-4 max-h-60 overflow-y-auto\">\n                {items.map((item) => (\n                  <div key={item.id} className=\"flex justify-between text-sm\">\n                    <span className=\"text-gray-400\">\n                      {item.quantidade}x {item.nome}\n                    </span>\n                    <span className=\"text-white\">\n                      R$ {(item.preco * item.quantidade).toFixed(2)}\n                    </span>\n                  </div>\n                ))}\n              </div>\n\n              {/* Totals */}\n              <div className=\"space-y-2 border-t border-gray-700 pt-4\">\n                <div className=\"flex justify-between text-gray-400\">\n                  <span>Subtotal</span>\n                  <span>R$ {total.toFixed(2)}</span>\n                </div>\n                <div className=\"flex justify-between text-gray-400\">\n                  <span>Taxa de Entrega</span>\n                  <span>R$ {taxaEntrega.toFixed(2)}</span>\n                </div>\n                <div className=\"flex justify-between text-white text-xl font-bold border-t border-gray-700 pt-2\">\n                  <span>Total</span>\n                  <span className=\"text-tenant-primary\">R$ {totalComEntrega.toFixed(2)}</span>\n                </div>\n              </div>\n\n              <button\n                onClick={handleSubmit}\n                disabled={loading}\n                className=\"w-full mt-6 py-4 bg-tenant-primary text-tenant-secondary font-bold text-lg rounded-lg hover:opacity-90 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                {loading ? 'Processando...' : 'Confirmar Pedido'}\n              </button>\n\n              <button\n                onClick={() => router.push(`/${tenant.slug}/carrinho`)}\n                className=\"w-full mt-3 py-3 bg-gray-700 text-white font-semibold rounded-lg hover:bg-gray-600 transition-colors\"\n              >\n                Voltar ao Carrinho\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n","size_bytes":15927},"pedai-nextjs/components/TenantTheme.tsx":{"content":"'use client'\n\nimport { useEffect } from 'react'\nimport type { TenantConfig } from '@/lib/types/tenant'\n\ninterface TenantThemeProps {\n  tenant?: TenantConfig\n}\n\nexport default function TenantTheme({ tenant }: TenantThemeProps) {\n  useEffect(() => {\n    if (tenant) {\n      document.documentElement.style.setProperty('--color-primary', tenant.theme.primary)\n      document.documentElement.style.setProperty('--color-secondary', tenant.theme.secondary)\n      document.documentElement.style.setProperty('--color-accent', tenant.theme.accent)\n    } else {\n      document.documentElement.style.setProperty('--color-primary', '#FFD100')\n      document.documentElement.style.setProperty('--color-secondary', '#1A1A1A')\n      document.documentElement.style.setProperty('--color-accent', '#FFFFFF')\n    }\n  }, [tenant])\n\n  return null\n}\n","size_bytes":827},"pedai-nextjs/components/Providers.tsx":{"content":"'use client'\n\nimport { ReactNode } from 'react'\nimport { CartProvider } from '@/lib/contexts/CartContext'\n\ninterface ProvidersProps {\n  children: ReactNode\n}\n\nexport default function Providers({ children }: ProvidersProps) {\n  return (\n    <CartProvider>\n      {children}\n    </CartProvider>\n  )\n}\n","size_bytes":298},"pedai-nextjs/app/[municipio]/loja/[id]/page.tsx":{"content":"import { Metadata } from 'next'\nimport { notFound } from 'next/navigation'\nimport Footer from '@/components/Footer'\nimport ClientLayout from '@/components/ClientLayout'\nimport LojaDetalhesContent from '@/components/clientes/LojaDetalhesContent'\nimport { getTenantBySlug, isTenantValid } from '@/lib/tenantConfig'\nimport { createClient } from '@/lib/supabase/server'\n\ninterface PageProps {\n  params: {\n    municipio: string\n    id: string\n  }\n}\n\nexport async function generateMetadata({ params }: PageProps): Promise<Metadata> {\n  const tenant = getTenantBySlug(params.municipio)\n  \n  if (!tenant) {\n    return {\n      title: 'Município não encontrado'\n    }\n  }\n\n  return {\n    title: `Loja - ${tenant.name} | PedeAí`,\n    description: `Detalhes da loja em ${tenant.name}`\n  }\n}\n\nasync function getLojaDetalhes(lojaId: string, municipio: string) {\n  const supabase = await createClient()\n  \n  // Buscar loja (apenas aprovadas)\n  const { data: loja, error: lojaError } = await supabase\n    .from('lojas')\n    .select('*')\n    .eq('id', lojaId)\n    .eq('municipio', municipio)\n    .eq('aprovada', true)\n    .single()\n  \n  if (lojaError || !loja) {\n    return null\n  }\n  \n  // Buscar produtos da loja\n  const { data: produtos, error: produtosError } = await supabase\n    .from('produtos')\n    .select('*')\n    .eq('loja_id', lojaId)\n    .eq('disponivel', true)\n    .order('nome')\n  \n  return {\n    loja,\n    produtos: produtos || []\n  }\n}\n\nexport default async function LojaPage({ params }: PageProps) {\n  if (!isTenantValid(params.municipio)) {\n    notFound()\n  }\n\n  const tenant = getTenantBySlug(params.municipio)!\n  const data = await getLojaDetalhes(params.id, tenant.slug)\n\n  if (!data) {\n    notFound()\n  }\n\n  return (\n    <ClientLayout tenant={tenant}>\n      <div className=\"min-h-screen flex flex-col bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900\">\n        <main className=\"flex-1\">\n          <LojaDetalhesContent \n            tenant={tenant} \n            loja={data.loja}\n            produtos={data.produtos}\n          />\n        </main>\n        <Footer tenant={tenant} />\n      </div>\n    </ClientLayout>\n  )\n}\n","size_bytes":2133},"pedai-nextjs/app/[municipio]/checkout/page.tsx":{"content":"import { Metadata } from 'next'\nimport { getTenantBySlug } from '@/lib/tenantConfig'\nimport { notFound } from 'next/navigation'\nimport ClientLayout from '@/components/ClientLayout'\nimport CheckoutContent from '@/components/clientes/CheckoutContent'\n\ninterface PageProps {\n  params: {\n    municipio: string\n  }\n}\n\nexport async function generateMetadata({ params }: PageProps): Promise<Metadata> {\n  const tenant = getTenantBySlug(params.municipio)\n  \n  if (!tenant) {\n    return {\n      title: 'Município não encontrado',\n    }\n  }\n\n  return {\n    title: `Checkout - ${tenant.name} - PedeAí`,\n    description: 'Finalize seu pedido',\n  }\n}\n\nexport default function CheckoutPage({ params }: PageProps) {\n  const tenant = getTenantBySlug(params.municipio)\n\n  if (!tenant) {\n    notFound()\n  }\n\n  return (\n    <ClientLayout tenant={tenant}>\n      <CheckoutContent tenant={tenant} />\n    </ClientLayout>\n  )\n}\n","size_bytes":907},"pedai-nextjs/app/[municipio]/pedido/[id]/page.tsx":{"content":"'use client'\n\nimport { useEffect, useState } from 'react'\nimport { useParams, useRouter } from 'next/navigation'\nimport { getTenantBySlug } from '@/lib/tenantConfig'\nimport ClientLayout from '@/components/ClientLayout'\nimport PedidoConfirmacaoContent from '@/components/clientes/PedidoConfirmacaoContent'\nimport { createClient } from '@/lib/supabase/client'\n\nexport default function PedidoPage() {\n  const params = useParams()\n  const router = useRouter()\n  const municipio = params.municipio as string\n  const id = params.id as string\n  \n  const [pedido, setPedido] = useState<any>(null)\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState(false)\n  \n  const tenant = getTenantBySlug(municipio)\n\n  useEffect(() => {\n    // Redirect if tenant not found\n    if (!tenant) {\n      router.replace('/')\n      return\n    }\n\n    async function fetchPedido() {\n      try {\n        const supabase = createClient()\n        \n        const { data, error: fetchError } = await supabase\n          .from('pedidos')\n          .select(`\n            *,\n            loja:lojas!inner(id, nome_loja, municipio, url_imagem),\n            itens:pedido_itens(\n              id,\n              quantidade,\n              preco_unitario,\n              observacao,\n              produto:produtos(id, nome, imagem_url)\n            )\n          `)\n          .eq('id', id)\n          .single()\n        \n        if (fetchError || !data || !data.loja) {\n          console.error('Erro ao buscar pedido:', fetchError)\n          setError(true)\n          setLoading(false)\n          return\n        }\n        \n        // Normalize município from database to slug format for comparison\n        const municipioSlug = data.loja.municipio\n          .toLowerCase()\n          .normalize('NFD')\n          .replace(/[\\u0300-\\u036f]/g, '')\n          .replace(/\\s+/g, '-')\n          .trim()\n        \n        // Verify pedido is from correct municipality\n        if (municipioSlug !== tenant.slug) {\n          console.error('Municipality mismatch:', { municipioSlug, tenantSlug: tenant.slug })\n          setError(true)\n          setLoading(false)\n          return\n        }\n        \n        setPedido(data)\n        setLoading(false)\n      } catch (err) {\n        console.error('Erro ao carregar pedido:', err)\n        setError(true)\n        setLoading(false)\n      }\n    }\n    \n    if (tenant) {\n      fetchPedido()\n    }\n  }, [id, tenant, router])\n\n  if (!tenant) {\n    return null // Will redirect via useEffect\n  }\n\n  if (loading) {\n    return (\n      <ClientLayout tenant={tenant}>\n        <div className=\"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 flex items-center justify-center\">\n          <div className=\"text-center\">\n            <div className=\"animate-spin rounded-full h-16 w-16 border-b-2 border-tenant-primary mx-auto mb-4\"></div>\n            <p className=\"text-gray-400\">Carregando pedido...</p>\n          </div>\n        </div>\n      </ClientLayout>\n    )\n  }\n\n  if (error || !pedido) {\n    return (\n      <ClientLayout tenant={tenant}>\n        <div className=\"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 flex items-center justify-center\">\n          <div className=\"max-w-md w-full mx-auto px-4 text-center\">\n            <div className=\"text-6xl mb-6\">😔</div>\n            <h1 className=\"text-3xl font-bold text-white mb-4\">Pedido não encontrado</h1>\n            <p className=\"text-gray-400 mb-8\">\n              Não conseguimos encontrar este pedido. Ele pode ter sido cancelado ou você não tem permissão para visualizá-lo.\n            </p>\n            <button\n              onClick={() => router.push(`/${municipio}/meus-pedidos`)}\n              className=\"w-full py-3 px-6 bg-tenant-primary text-white font-semibold rounded-lg hover:opacity-90 transition-opacity mb-3\"\n            >\n              Ver meus pedidos\n            </button>\n            <button\n              onClick={() => router.push(`/${municipio}`)}\n              className=\"w-full py-3 px-6 bg-gray-700 text-white font-semibold rounded-lg hover:bg-gray-600 transition-colors\"\n            >\n              Voltar ao início\n            </button>\n          </div>\n        </div>\n      </ClientLayout>\n    )\n  }\n\n  return (\n    <ClientLayout tenant={tenant}>\n      <PedidoConfirmacaoContent tenant={tenant} pedido={pedido} />\n    </ClientLayout>\n  )\n}\n","size_bytes":4372},"pedai-nextjs/components/clientes/PedidoConfirmacaoContent.tsx":{"content":"'use client'\n\nimport { useRouter } from 'next/navigation'\nimport type { TenantConfig } from '@/lib/types/tenant'\nimport { useEffect } from 'react'\n\ninterface PedidoConfirmacaoContentProps {\n  tenant: TenantConfig\n  pedido: any\n}\n\nexport default function PedidoConfirmacaoContent({ tenant, pedido }: PedidoConfirmacaoContentProps) {\n  const router = useRouter()\n\n  // Celebração visual ao carregar\n  useEffect(() => {\n    // Opcional: Adicionar confetti ou animação de sucesso\n  }, [])\n\n  const statusColors: Record<string, string> = {\n    'pendente': 'bg-yellow-500/20 text-yellow-500 border-yellow-500',\n    'confirmado': 'bg-blue-500/20 text-blue-500 border-blue-500',\n    'preparando': 'bg-orange-500/20 text-orange-500 border-orange-500',\n    'saiu_entrega': 'bg-purple-500/20 text-purple-500 border-purple-500',\n    'entregue': 'bg-green-500/20 text-green-500 border-green-500',\n    'cancelado': 'bg-red-500/20 text-red-500 border-red-500',\n  }\n\n  const statusLabels: Record<string, string> = {\n    'pendente': 'Aguardando Confirmação',\n    'confirmado': 'Confirmado',\n    'preparando': 'Em Preparação',\n    'saiu_entrega': 'Saiu para Entrega',\n    'entregue': 'Entregue',\n    'cancelado': 'Cancelado',\n  }\n\n  const statusIcon: Record<string, string> = {\n    'pendente': '⏳',\n    'confirmado': '✅',\n    'preparando': '👨‍🍳',\n    'saiu_entrega': '🚚',\n    'entregue': '🎉',\n    'cancelado': '❌',\n  }\n\n  const formatDate = (dateString: string) => {\n    const date = new Date(dateString)\n    return date.toLocaleString('pt-BR', {\n      day: '2-digit',\n      month: '2-digit',\n      year: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit',\n    })\n  }\n\n  const formatPayment = (formaPagamento: string) => {\n    const payments: Record<string, string> = {\n      'dinheiro': '💵 Dinheiro',\n      'pix': '📱 PIX',\n      'cartao': '💳 Cartão',\n    }\n    return payments[formaPagamento] || formaPagamento\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 py-8\">\n      <div className=\"container mx-auto px-4 max-w-4xl\">\n        {/* Success Message */}\n        <div className=\"bg-gradient-to-r from-green-500/20 to-tenant-primary/20 border border-green-500 rounded-xl p-8 mb-8 text-center\">\n          <div className=\"text-6xl mb-4\">🎉</div>\n          <h1 className=\"text-3xl font-bold text-white mb-2\">Pedido Realizado com Sucesso!</h1>\n          <p className=\"text-gray-300 text-lg\">\n            Seu pedido foi recebido e será processado em breve\n          </p>\n        </div>\n\n        {/* Pedido Info */}\n        <div className=\"bg-gray-800 rounded-xl p-6 mb-6\">\n          <div className=\"flex items-center justify-between mb-6\">\n            <div>\n              <h2 className=\"text-2xl font-bold text-white\">Pedido #{pedido.id}</h2>\n              <p className=\"text-gray-400 text-sm mt-1\">{formatDate(pedido.created_at)}</p>\n            </div>\n            <div className={`px-4 py-2 rounded-full border text-sm font-semibold ${statusColors[pedido.status] || statusColors['pendente']}`}>\n              {statusIcon[pedido.status]} {statusLabels[pedido.status] || pedido.status}\n            </div>\n          </div>\n\n          {/* Loja Info */}\n          <div className=\"border-t border-gray-700 pt-6\">\n            <h3 className=\"text-lg font-semibold text-white mb-4\">🏪 Informações da Loja</h3>\n            <div className=\"flex items-center gap-4\">\n              <div className=\"w-16 h-16 bg-gray-700 rounded-lg flex items-center justify-center text-3xl\">\n                {pedido.loja.url_imagem ? (\n                  <img src={pedido.loja.url_imagem} alt={pedido.loja.nome_loja} className=\"w-full h-full object-cover rounded-lg\" />\n                ) : (\n                  '🏪'\n                )}\n              </div>\n              <div>\n                <p className=\"text-white font-semibold\">{pedido.loja.nome_loja}</p>\n                <p className=\"text-gray-400 text-sm\">{pedido.loja.municipio}</p>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Itens do Pedido */}\n        <div className=\"bg-gray-800 rounded-xl p-6 mb-6\">\n          <h3 className=\"text-lg font-semibold text-white mb-4\">🛍️ Itens do Pedido</h3>\n          <div className=\"space-y-3\">\n            {pedido.itens?.map((item: any) => (\n              <div key={item.id} className=\"flex items-center gap-4 p-3 bg-gray-900 rounded-lg\">\n                <div className=\"w-12 h-12 bg-gray-700 rounded flex items-center justify-center text-2xl\">\n                  {item.produto?.imagem_url ? (\n                    <img src={item.produto.imagem_url} alt={item.produto.nome} className=\"w-full h-full object-cover rounded\" />\n                  ) : (\n                    '🍔'\n                  )}\n                </div>\n                <div className=\"flex-1\">\n                  <p className=\"text-white font-medium\">{item.produto?.nome || 'Produto'}</p>\n                  {item.observacao && (\n                    <p className=\"text-gray-400 text-sm\">Obs: {item.observacao}</p>\n                  )}\n                </div>\n                <div className=\"text-right\">\n                  <p className=\"text-gray-400 text-sm\">{item.quantidade}x</p>\n                  <p className=\"text-white font-semibold\">R$ {(item.preco_unitario * item.quantidade).toFixed(2)}</p>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n\n        {/* Detalhes do Pedido */}\n        <div className=\"bg-gray-800 rounded-xl p-6 mb-6\">\n          <h3 className=\"text-lg font-semibold text-white mb-4\">📋 Detalhes</h3>\n          \n          <div className=\"space-y-3\">\n            <div>\n              <p className=\"text-gray-400 text-sm\">Endereço de Entrega</p>\n              <p className=\"text-white\">{pedido.endereco_entrega}</p>\n            </div>\n\n            <div>\n              <p className=\"text-gray-400 text-sm\">Forma de Pagamento</p>\n              <p className=\"text-white\">{formatPayment(pedido.forma_pagamento || 'dinheiro')}</p>\n              {pedido.troco_para && (\n                <p className=\"text-gray-400 text-sm\">Troco para: R$ {parseFloat(pedido.troco_para).toFixed(2)}</p>\n              )}\n            </div>\n\n            {pedido.observacoes && (\n              <div>\n                <p className=\"text-gray-400 text-sm\">Observações</p>\n                <p className=\"text-white\">{pedido.observacoes}</p>\n              </div>\n            )}\n          </div>\n        </div>\n\n        {/* Resumo Financeiro */}\n        <div className=\"bg-gray-800 rounded-xl p-6 mb-6\">\n          <h3 className=\"text-lg font-semibold text-white mb-4\">💰 Resumo do Pagamento</h3>\n          \n          <div className=\"space-y-2\">\n            <div className=\"flex justify-between text-gray-400\">\n              <span>Subtotal</span>\n              <span>R$ {(pedido.total - pedido.taxa_entrega).toFixed(2)}</span>\n            </div>\n            <div className=\"flex justify-between text-gray-400\">\n              <span>Taxa de Entrega</span>\n              <span>R$ {pedido.taxa_entrega.toFixed(2)}</span>\n            </div>\n            <div className=\"flex justify-between text-white text-xl font-bold border-t border-gray-700 pt-3\">\n              <span>Total</span>\n              <span className=\"text-tenant-primary\">R$ {pedido.total.toFixed(2)}</span>\n            </div>\n          </div>\n        </div>\n\n        {/* Tempo Estimado */}\n        <div className=\"bg-gradient-to-r from-tenant-primary/10 to-transparent border border-tenant-primary/30 rounded-xl p-6 mb-6\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"text-4xl\">⏰</div>\n            <div>\n              <p className=\"text-white font-semibold\">Tempo Estimado de Entrega</p>\n              <p className=\"text-tenant-primary text-2xl font-bold\">30-45 minutos</p>\n            </div>\n          </div>\n        </div>\n\n        {/* Ações */}\n        <div className=\"flex flex-col sm:flex-row gap-4\">\n          <button\n            onClick={() => router.push(`/${tenant.slug}/lojas`)}\n            className=\"flex-1 py-4 bg-tenant-primary text-tenant-secondary font-bold text-lg rounded-lg hover:opacity-90 transition-opacity\"\n          >\n            Fazer Novo Pedido\n          </button>\n          <button\n            onClick={() => router.push(`/${tenant.slug}`)}\n            className=\"flex-1 py-4 bg-gray-700 text-white font-semibold rounded-lg hover:bg-gray-600 transition-colors\"\n          >\n            Voltar ao Início\n          </button>\n        </div>\n      </div>\n    </div>\n  )\n}\n","size_bytes":8591},"pedai-nextjs/create-loja-user.js":{"content":"const { createClient } = require('@supabase/supabase-js')\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL\nconst supabaseKey = process.env.SUPABASE_SERVICE_ROLE_KEY\n\nconst supabase = createClient(supabaseUrl, supabaseKey, {\n  auth: {\n    autoRefreshToken: false,\n    persistSession: false\n  }\n})\n\nasync function createLojaUser() {\n  console.log('🔧 Criando usuário lojista de teste...\\n')\n  \n  // Create auth user\n  const { data: authData, error: authError } = await supabase.auth.admin.createUser({\n    email: 'loja@pizzaria.com',\n    password: 'senha123',\n    email_confirm: true\n  })\n  \n  if (authError) {\n    console.error('❌ Erro ao criar usuário:', authError.message)\n    return\n  }\n  \n  console.log('✅ Usuário criado:', authData.user.id)\n  \n  // Create perfil\n  const { data: perfil, error: perfilError } = await supabase\n    .from('perfis')\n    .insert({\n      user_id: authData.user.id,\n      tipo: 'loja',\n      nome_completo: 'Pizzaria Sabor da Hora',\n      telefone: '(83) 98888-1111'\n    })\n    .select()\n    .single()\n  \n  if (perfilError) {\n    console.error('❌ Erro ao criar perfil:', perfilError)\n    return\n  }\n  \n  console.log('✅ Perfil criado:', perfil.id)\n  \n  // Update loja with perfil_id\n  const { error: updateError } = await supabase\n    .from('lojas')\n    .update({ perfil_id: perfil.id, user_id: authData.user.id })\n    .eq('id', 1)\n  \n  if (updateError) {\n    console.error('❌ Erro ao vincular loja:', updateError)\n    return\n  }\n  \n  console.log('✅ Loja vinculada ao perfil!\\n')\n  console.log('📧 Email: loja@pizzaria.com')\n  console.log('🔑 Senha: senha123')\n}\n\ncreateLojaUser().catch(console.error)\n","size_bytes":1661},"pedai-nextjs/app/api/loja/pedidos/[id]/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { createClient } from '@/lib/supabase/server'\n\nexport async function PATCH(\n  request: NextRequest,\n  { params }: { params: { id: string } }\n) {\n  try {\n    const supabase = await createClient()\n    const pedidoId = params.id\n    \n    const { data: { user }, error: authError } = await supabase.auth.getUser()\n    \n    if (authError || !user) {\n      return NextResponse.json(\n        { error: 'Autenticação necessária' },\n        { status: 401 }\n      )\n    }\n    \n    const { data: perfil } = await supabase\n      .from('perfis')\n      .select('id, tipo')\n      .eq('user_id', user.id)\n      .single()\n    \n    if (!perfil || (perfil.tipo !== 'loja' && perfil.tipo !== 'admin')) {\n      return NextResponse.json(\n        { error: 'Acesso negado. Apenas lojistas e administradores podem atualizar pedidos.' },\n        { status: 403 }\n      )\n    }\n    \n    // Admin pode atualizar qualquer pedido, lojista só da própria loja\n    let loja = null\n    if (perfil.tipo === 'loja') {\n      const { data: lojaData } = await supabase\n        .from('lojas')\n        .select('id')\n        .eq('perfil_id', perfil.id)\n        .single()\n      \n      if (!lojaData) {\n        return NextResponse.json(\n          { error: 'Loja não encontrada' },\n          { status: 404 }\n        )\n      }\n      loja = lojaData\n    }\n    \n    const body = await request.json()\n    const { status } = body\n    \n    if (!status) {\n      return NextResponse.json(\n        { error: 'Status é obrigatório' },\n        { status: 400 }\n      )\n    }\n    \n    const validStatuses = ['pendente', 'aceito', 'preparando', 'pronto', 'em_entrega', 'entregue', 'cancelado']\n    if (!validStatuses.includes(status)) {\n      return NextResponse.json(\n        { error: 'Status inválido' },\n        { status: 400 }\n      )\n    }\n    \n    const { data: pedido, error: pedidoError } = await supabase\n      .from('pedidos')\n      .select('id, loja_id, status')\n      .eq('id', pedidoId)\n      .single()\n    \n    if (pedidoError || !pedido) {\n      return NextResponse.json(\n        { error: 'Pedido não encontrado' },\n        { status: 404 }\n      )\n    }\n    \n    // Apenas lojistas precisam verificar ownership, admin pode tudo\n    if (perfil.tipo === 'loja' && pedido.loja_id !== loja.id) {\n      return NextResponse.json(\n        { error: 'Você não tem permissão para atualizar este pedido' },\n        { status: 403 }\n      )\n    }\n    \n    const { data: updatedPedido, error: updateError } = await supabase\n      .from('pedidos')\n      .update({ status })\n      .eq('id', pedidoId)\n      .select()\n      .single()\n    \n    if (updateError) {\n      console.error('Erro ao atualizar pedido:', updateError)\n      return NextResponse.json(\n        { error: 'Erro ao atualizar pedido' },\n        { status: 500 }\n      )\n    }\n    \n    return NextResponse.json({\n      message: 'Status atualizado com sucesso',\n      pedido: updatedPedido\n    })\n  } catch (error: any) {\n    console.error('Erro inesperado:', error)\n    return NextResponse.json(\n      { error: 'Erro interno do servidor' },\n      { status: 500 }\n    )\n  }\n}\n","size_bytes":3151},"pedai-nextjs/app/loja/pedidos/page.tsx":{"content":"import { Metadata } from 'next'\nimport LojaPedidosContent from '@/components/loja/LojaPedidosContent'\n\nexport const metadata: Metadata = {\n  title: 'Pedidos - Dashboard Loja - PedeAí',\n  description: 'Gerencie os pedidos da sua loja',\n}\n\nexport default function PedidosPage() {\n  return <LojaPedidosContent />\n}\n","size_bytes":313},"pedai-nextjs/components/loja/LojaPedidosContent.tsx":{"content":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useRouter } from 'next/navigation'\nimport { createClient } from '@/lib/supabase/client'\n\ninterface Pedido {\n  id: number\n  status: string\n  total: number\n  subtotal: number\n  taxa_entrega: number\n  endereco_entrega: string\n  forma_pagamento: string\n  observacoes: string | null\n  created_at: string\n  perfil: {\n    nome_completo: string\n    telefone: string\n  }\n  items: Array<{\n    quantidade: number\n    preco_unitario: number\n    observacao: string | null\n    produto: {\n      id: number\n      nome: string\n    }\n  }>\n}\n\nconst statusLabels: Record<string, string> = {\n  todos: 'Todos',\n  pendente: 'Pendente',\n  aceito: 'Aceito',\n  preparando: 'Preparando',\n  pronto: 'Pronto',\n  em_entrega: 'Em Entrega',\n  entregue: 'Entregue',\n  cancelado: 'Cancelado',\n}\n\nconst statusColors: Record<string, string> = {\n  pendente: 'bg-yellow-500',\n  aceito: 'bg-blue-500',\n  preparando: 'bg-purple-500',\n  pronto: 'bg-green-500',\n  em_entrega: 'bg-cyan-500',\n  entregue: 'bg-gray-500',\n  cancelado: 'bg-red-500',\n}\n\nexport default function LojaPedidosContent() {\n  const router = useRouter()\n  const [loading, setLoading] = useState(true)\n  const [pedidos, setPedidos] = useState<Pedido[]>([])\n  const [filtroStatus, setFiltroStatus] = useState('todos')\n  const [loja, setLoja] = useState<any>(null)\n  const [expandedPedido, setExpandedPedido] = useState<number | null>(null)\n  const [updating, setUpdating] = useState<number | null>(null)\n\n  useEffect(() => {\n    checkAuthAndLoadPedidos()\n  }, [filtroStatus])\n\n  const checkAuthAndLoadPedidos = async () => {\n    const supabase = createClient()\n    \n    const { data: { user } } = await supabase.auth.getUser()\n    \n    if (!user) {\n      router.push('/auth/login')\n      return\n    }\n\n    // Get user profile via API (bypasses RLS)\n    // Send cookies for server-side session validation\n    const profileResponse = await fetch('/api/auth/get-profile', {\n      credentials: 'include'\n    })\n    const profileData = await profileResponse.json()\n\n    if (!profileResponse.ok || !profileData.perfil) {\n      router.push('/')\n      return\n    }\n\n    const perfil = profileData.perfil\n\n    if (perfil.tipo !== 'loja' && perfil.tipo !== 'admin') {\n      router.push('/')\n      return\n    }\n\n    await loadPedidos()\n  }\n\n  const loadPedidos = async () => {\n    setLoading(true)\n    try {\n      const url = filtroStatus === 'todos' \n        ? '/api/loja/pedidos'\n        : `/api/loja/pedidos?status=${filtroStatus}`\n      \n      const response = await fetch(url, {\n        credentials: 'include'\n      })\n      const data = await response.json()\n\n      if (response.ok) {\n        setPedidos(data.pedidos || [])\n        setLoja(data.loja)\n      } else {\n        console.error('Erro ao carregar pedidos:', data.error)\n      }\n    } catch (error) {\n      console.error('Erro ao carregar pedidos:', error)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleUpdateStatus = async (pedidoId: number, newStatus: string) => {\n    setUpdating(pedidoId)\n    try {\n      const response = await fetch(`/api/loja/pedidos/${pedidoId}`, {\n        method: 'PATCH',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        credentials: 'include',\n        body: JSON.stringify({ status: newStatus }),\n      })\n\n      if (response.ok) {\n        await loadPedidos()\n      } else {\n        const data = await response.json()\n        alert('Erro ao atualizar status: ' + data.error)\n      }\n    } catch (error) {\n      console.error('Erro ao atualizar status:', error)\n      alert('Erro ao atualizar status do pedido')\n    } finally {\n      setUpdating(null)\n    }\n  }\n\n  const formatCurrency = (value: number) => {\n    return new Intl.NumberFormat('pt-BR', {\n      style: 'currency',\n      currency: 'BRL',\n    }).format(value)\n  }\n\n  const formatDate = (dateString: string) => {\n    const date = new Date(dateString)\n    return new Intl.DateTimeFormat('pt-BR', {\n      day: '2-digit',\n      month: '2-digit',\n      year: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit',\n    }).format(date)\n  }\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-500 mx-auto mb-4\"></div>\n          <p className=\"text-gray-400\">Carregando pedidos...</p>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 py-8\">\n      <div className=\"container mx-auto px-4\">\n        <div className=\"mb-8\">\n          <h1 className=\"text-4xl font-bold text-white mb-2\">Pedidos</h1>\n          <p className=\"text-gray-400\">{loja?.nome_loja}</p>\n        </div>\n\n        <div className=\"flex flex-wrap gap-2 mb-6\">\n          {Object.entries(statusLabels).map(([value, label]) => (\n            <button\n              key={value}\n              onClick={() => setFiltroStatus(value)}\n              className={`px-4 py-2 rounded-lg font-medium transition-colors ${\n                filtroStatus === value\n                  ? 'bg-blue-600 text-white'\n                  : 'bg-gray-800 text-gray-300 hover:bg-gray-700'\n              }`}\n            >\n              {label}\n            </button>\n          ))}\n        </div>\n\n        {pedidos.length === 0 ? (\n          <div className=\"bg-gray-800 rounded-xl p-12 text-center\">\n            <p className=\"text-gray-400 text-lg\">Nenhum pedido encontrado</p>\n          </div>\n        ) : (\n          <div className=\"space-y-4\">\n            {pedidos.map((pedido) => (\n              <div key={pedido.id} className=\"bg-gray-800 rounded-xl overflow-hidden\">\n                <div\n                  className=\"p-6 cursor-pointer hover:bg-gray-750 transition-colors\"\n                  onClick={() => setExpandedPedido(expandedPedido === pedido.id ? null : pedido.id)}\n                >\n                  <div className=\"flex flex-wrap items-center justify-between gap-4\">\n                    <div className=\"flex-1 min-w-[200px]\">\n                      <div className=\"flex items-center gap-3 mb-2\">\n                        <h3 className=\"text-xl font-bold text-white\">Pedido #{pedido.id}</h3>\n                        <span className={`px-3 py-1 rounded-full text-xs font-bold text-white ${statusColors[pedido.status]}`}>\n                          {statusLabels[pedido.status]}\n                        </span>\n                      </div>\n                      <p className=\"text-gray-400 text-sm\">{formatDate(pedido.created_at)}</p>\n                      <p className=\"text-gray-300 font-medium mt-1\">{pedido.perfil.nome_completo}</p>\n                    </div>\n                    \n                    <div className=\"text-right\">\n                      <p className=\"text-2xl font-bold text-white\">{formatCurrency(pedido.total)}</p>\n                      <p className=\"text-gray-400 text-sm\">{pedido.items.length} {pedido.items.length === 1 ? 'item' : 'itens'}</p>\n                    </div>\n                  </div>\n                </div>\n\n                {expandedPedido === pedido.id && (\n                  <div className=\"border-t border-gray-700 p-6 bg-gray-850\">\n                    <div className=\"grid md:grid-cols-2 gap-6 mb-6\">\n                      <div>\n                        <h4 className=\"text-white font-bold mb-3\">📦 Itens do Pedido</h4>\n                        <div className=\"space-y-2\">\n                          {pedido.items.map((item, index) => (\n                            <div key={index} className=\"bg-gray-800 rounded-lg p-3\">\n                              <div className=\"flex justify-between items-start\">\n                                <div className=\"flex-1\">\n                                  <p className=\"text-white font-medium\">{item.quantidade}x {item.produto.nome}</p>\n                                  {item.observacao && (\n                                    <p className=\"text-gray-400 text-sm mt-1\">Obs: {item.observacao}</p>\n                                  )}\n                                </div>\n                                <p className=\"text-white font-bold ml-4\">{formatCurrency(item.preco_unitario * item.quantidade)}</p>\n                              </div>\n                            </div>\n                          ))}\n                        </div>\n                        \n                        <div className=\"mt-4 space-y-1 text-sm\">\n                          <div className=\"flex justify-between text-gray-400\">\n                            <span>Subtotal:</span>\n                            <span>{formatCurrency(pedido.subtotal)}</span>\n                          </div>\n                          <div className=\"flex justify-between text-gray-400\">\n                            <span>Taxa de entrega:</span>\n                            <span>{formatCurrency(pedido.taxa_entrega)}</span>\n                          </div>\n                          <div className=\"flex justify-between text-white font-bold text-base pt-2 border-t border-gray-700\">\n                            <span>Total:</span>\n                            <span>{formatCurrency(pedido.total)}</span>\n                          </div>\n                        </div>\n                      </div>\n\n                      <div>\n                        <h4 className=\"text-white font-bold mb-3\">📍 Informações de Entrega</h4>\n                        <div className=\"space-y-3 text-sm\">\n                          <div>\n                            <p className=\"text-gray-400\">Cliente:</p>\n                            <p className=\"text-white\">{pedido.perfil.nome_completo}</p>\n                          </div>\n                          <div>\n                            <p className=\"text-gray-400\">Telefone:</p>\n                            <p className=\"text-white\">{pedido.perfil.telefone || 'Não informado'}</p>\n                          </div>\n                          <div>\n                            <p className=\"text-gray-400\">Endereço:</p>\n                            <p className=\"text-white\">{pedido.endereco_entrega}</p>\n                          </div>\n                          <div>\n                            <p className=\"text-gray-400\">Forma de pagamento:</p>\n                            <p className=\"text-white capitalize\">{pedido.forma_pagamento}</p>\n                          </div>\n                          {pedido.observacoes && (\n                            <div>\n                              <p className=\"text-gray-400\">Observações:</p>\n                              <p className=\"text-white\">{pedido.observacoes}</p>\n                            </div>\n                          )}\n                        </div>\n\n                        <div className=\"mt-6\">\n                          <h4 className=\"text-white font-bold mb-3\">🔄 Atualizar Status</h4>\n                          <div className=\"grid grid-cols-2 gap-2\">\n                            {pedido.status === 'pendente' && (\n                              <>\n                                <button\n                                  onClick={() => handleUpdateStatus(pedido.id, 'aceito')}\n                                  disabled={updating === pedido.id}\n                                  className=\"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium disabled:opacity-50\"\n                                >\n                                  ✅ Aceitar\n                                </button>\n                                <button\n                                  onClick={() => handleUpdateStatus(pedido.id, 'cancelado')}\n                                  disabled={updating === pedido.id}\n                                  className=\"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium disabled:opacity-50\"\n                                >\n                                  ❌ Cancelar\n                                </button>\n                              </>\n                            )}\n                            {pedido.status === 'aceito' && (\n                              <button\n                                onClick={() => handleUpdateStatus(pedido.id, 'preparando')}\n                                disabled={updating === pedido.id}\n                                className=\"col-span-2 bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-medium disabled:opacity-50\"\n                              >\n                                👨‍🍳 Iniciar Preparo\n                              </button>\n                            )}\n                            {pedido.status === 'preparando' && (\n                              <button\n                                onClick={() => handleUpdateStatus(pedido.id, 'pronto')}\n                                disabled={updating === pedido.id}\n                                className=\"col-span-2 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium disabled:opacity-50\"\n                              >\n                                ✨ Marcar como Pronto\n                              </button>\n                            )}\n                            {pedido.status === 'pronto' && (\n                              <button\n                                onClick={() => handleUpdateStatus(pedido.id, 'em_entrega')}\n                                disabled={updating === pedido.id}\n                                className=\"col-span-2 bg-cyan-600 hover:bg-cyan-700 text-white px-4 py-2 rounded-lg font-medium disabled:opacity-50\"\n                              >\n                                🚚 Saiu para Entrega\n                              </button>\n                            )}\n                            {pedido.status === 'em_entrega' && (\n                              <button\n                                onClick={() => handleUpdateStatus(pedido.id, 'entregue')}\n                                disabled={updating === pedido.id}\n                                className=\"col-span-2 bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium disabled:opacity-50\"\n                              >\n                                🎉 Marcar como Entregue\n                              </button>\n                            )}\n                            {(pedido.status === 'entregue' || pedido.status === 'cancelado') && (\n                              <p className=\"col-span-2 text-center text-gray-400 py-2\">\n                                Pedido finalizado\n                              </p>\n                            )}\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                )}\n              </div>\n            ))}\n          </div>\n        )}\n\n        <div className=\"mt-8\">\n          <button\n            onClick={() => router.push('/loja/dashboard')}\n            className=\"text-gray-400 hover:text-white transition-colors\"\n          >\n            ← Voltar ao Dashboard\n          </button>\n        </div>\n      </div>\n    </div>\n  )\n}\n","size_bytes":15214},"pedai-nextjs/app/api/loja/pedidos/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { createClient } from '@/lib/supabase/server'\nimport { createClient as createServiceClient } from '@supabase/supabase-js'\n\nexport async function GET(request: NextRequest) {\n  try {\n    // Try to get token from Authorization header (for localStorage-based auth)\n    const authHeader = request.headers.get('Authorization')\n    let user = null\n\n    if (authHeader?.startsWith('Bearer ')) {\n      const token = authHeader.substring(7)\n      \n      // Verify token with Supabase\n      const supabaseAdmin = createServiceClient(\n        process.env.NEXT_PUBLIC_SUPABASE_URL!,\n        process.env.SUPABASE_SERVICE_ROLE_KEY!,\n        {\n          auth: {\n            autoRefreshToken: false,\n            persistSession: false,\n          },\n        }\n      )\n\n      const { data: { user: tokenUser }, error: tokenError } = await supabaseAdmin.auth.getUser(token)\n      \n      if (!tokenError && tokenUser) {\n        user = tokenUser\n      }\n    }\n\n    // Fallback to cookie-based auth\n    if (!user) {\n      const supabase = await createClient()\n      const { data: { user: cookieUser }, error: userError } = await supabase.auth.getUser()\n      \n      if (!userError && cookieUser) {\n        user = cookieUser\n      }\n    }\n\n    if (!user) {\n      return NextResponse.json(\n        { error: 'Autenticação necessária' },\n        { status: 401 }\n      )\n    }\n\n    // Create service role client to bypass RLS\n    const supabaseAdmin = createServiceClient(\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\n      process.env.SUPABASE_SERVICE_ROLE_KEY!,\n      {\n        auth: {\n          autoRefreshToken: false,\n          persistSession: false,\n        },\n      }\n    )\n    \n    const { data: perfil } = await supabaseAdmin\n      .from('perfis')\n      .select('id, tipo')\n      .eq('user_id', user.id)\n      .single()\n    \n    if (!perfil || (perfil.tipo !== 'loja' && perfil.tipo !== 'admin')) {\n      return NextResponse.json(\n        { error: 'Acesso negado. Apenas lojistas e administradores podem acessar esta funcionalidade.' },\n        { status: 403 }\n      )\n    }\n    \n    const { searchParams } = new URL(request.url)\n    const status = searchParams.get('status')\n    const lojaIdParam = searchParams.get('loja_id')\n    \n    // Determinar loja_id baseado no tipo de usuário\n    let lojaId: number\n    let loja: any\n    \n    if (perfil.tipo === 'loja') {\n      // Lojista só pode ver sua própria loja\n      const { data: lojaData } = await supabaseAdmin\n        .from('lojas')\n        .select('id, nome_loja')\n        .eq('perfil_id', perfil.id)\n        .single()\n      \n      if (!lojaData) {\n        return NextResponse.json(\n          { error: 'Loja não encontrada' },\n          { status: 404 }\n        )\n      }\n      \n      lojaId = lojaData.id\n      loja = lojaData\n    } else {\n      // Admin pode especificar loja via query param\n      if (!lojaIdParam) {\n        return NextResponse.json(\n          { error: 'loja_id é obrigatório para admin' },\n          { status: 400 }\n        )\n      }\n      \n      const { data: lojaData } = await supabaseAdmin\n        .from('lojas')\n        .select('id, nome_loja')\n        .eq('id', parseInt(lojaIdParam))\n        .single()\n      \n      if (!lojaData) {\n        return NextResponse.json(\n          { error: 'Loja não encontrada' },\n          { status: 404 }\n        )\n      }\n      \n      lojaId = lojaData.id\n      loja = lojaData\n    }\n    \n    let query = supabaseAdmin\n      .from('pedidos')\n      .select(`\n        id,\n        status,\n        total,\n        subtotal,\n        taxa_entrega,\n        endereco_entrega,\n        forma_pagamento,\n        observacoes,\n        created_at,\n        perfil:perfis!pedidos_perfil_id_fkey (\n          nome_completo,\n          telefone\n        )\n      `)\n      .eq('loja_id', lojaId)\n      .order('created_at', { ascending: false })\n    \n    if (status && status !== 'todos') {\n      query = query.eq('status', status)\n    }\n    \n    const { data: pedidos, error: pedidosError } = await query\n    \n    if (pedidosError) {\n      console.error('Erro ao buscar pedidos:', pedidosError)\n      return NextResponse.json(\n        { error: 'Erro ao buscar pedidos' },\n        { status: 500 }\n      )\n    }\n    \n    const pedidosWithItems = await Promise.all(\n      pedidos.map(async (pedido) => {\n        const { data: items } = await supabaseAdmin\n          .from('pedido_itens')\n          .select(`\n            quantidade,\n            preco_unitario,\n            observacao,\n            produto:produtos!pedido_itens_produto_id_fkey (\n              id,\n              nome\n            )\n          `)\n          .eq('pedido_id', pedido.id)\n        \n        return {\n          ...pedido,\n          items: items || []\n        }\n      })\n    )\n    \n    return NextResponse.json({\n      pedidos: pedidosWithItems,\n      loja\n    })\n  } catch (error: any) {\n    console.error('Erro inesperado:', error)\n    return NextResponse.json(\n      { error: 'Erro interno do servidor' },\n      { status: 500 }\n    )\n  }\n}\n","size_bytes":5054},"pedai-nextjs/app/api/admin/configuracoes/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { createClient } from '@/lib/supabase/server'\n\nexport async function GET(request: NextRequest) {\n  try {\n    const supabase = await createClient()\n    \n    const { data: { user } } = await supabase.auth.getUser()\n    \n    if (!user) {\n      return NextResponse.json({ error: 'Não autenticado' }, { status: 401 })\n    }\n\n    const { data: perfil } = await supabase\n      .from('perfis')\n      .select('tipo')\n      .eq('user_id', user.id)\n      .single()\n\n    if (!perfil || perfil.tipo !== 'admin') {\n      return NextResponse.json({ error: 'Acesso negado' }, { status: 403 })\n    }\n\n    const { data: configuracoes, error } = await supabase\n      .from('configuracoes_plataforma')\n      .select('*')\n      .order('chave')\n\n    if (error) {\n      return NextResponse.json({ error: error.message }, { status: 500 })\n    }\n\n    return NextResponse.json({ configuracoes })\n  } catch (error: any) {\n    return NextResponse.json({ error: error.message }, { status: 500 })\n  }\n}\n\nexport async function PATCH(request: NextRequest) {\n  try {\n    const supabase = await createClient()\n    \n    const { data: { user } } = await supabase.auth.getUser()\n    \n    if (!user) {\n      return NextResponse.json({ error: 'Não autenticado' }, { status: 401 })\n    }\n\n    const { data: perfil } = await supabase\n      .from('perfis')\n      .select('*')\n      .eq('user_id', user.id)\n      .single()\n\n    if (!perfil || perfil.tipo !== 'admin') {\n      return NextResponse.json({ error: 'Acesso negado' }, { status: 403 })\n    }\n\n    const body = await request.json()\n    const { chave, valor, municipio } = body\n\n    if (!chave || !valor) {\n      return NextResponse.json({ \n        error: 'chave e valor são obrigatórios' \n      }, { status: 400 })\n    }\n\n    let query = supabase\n      .from('configuracoes_plataforma')\n      .update({ valor })\n      .eq('chave', chave)\n\n    if (municipio) {\n      query = query.eq('municipio', municipio)\n    } else {\n      query = query.is('municipio', null)\n    }\n\n    const { data: config, error } = await query.select().single()\n\n    if (error) {\n      return NextResponse.json({ error: error.message }, { status: 500 })\n    }\n\n    await supabase\n      .from('auditoria')\n      .insert({\n        usuario_id: perfil.id,\n        usuario_email: perfil.email,\n        usuario_nome: perfil.nome_completo,\n        acao: 'ATUALIZAR_CONFIGURACAO',\n        entidade: 'configuracoes_plataforma',\n        entidade_id: config.id,\n        dados_novos: { chave, valor, municipio },\n      })\n\n    return NextResponse.json({ configuracao: config })\n  } catch (error: any) {\n    return NextResponse.json({ error: error.message }, { status: 500 })\n  }\n}\n","size_bytes":2725},"pedai-nextjs/components/admin/usuarios/AdminUsuarios.tsx":{"content":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { createClient } from '@/lib/supabase/client'\n\ninterface Usuario {\n  id: string\n  nome: string\n  email: string\n  tipo: string\n  telefone: string | null\n  bloqueado: boolean\n  motivo_bloqueio: string | null\n}\n\nexport default function AdminUsuarios() {\n  const [usuarios, setUsuarios] = useState<Usuario[]>([])\n  const [filteredUsuarios, setFilteredUsuarios] = useState<Usuario[]>([])\n  const [loading, setLoading] = useState(true)\n  \n  const [filterTipo, setFilterTipo] = useState('todos')\n  const [filterStatus, setFilterStatus] = useState('todos')\n  const [searchTerm, setSearchTerm] = useState('')\n  \n  const [showBlockModal, setShowBlockModal] = useState(false)\n  const [selectedUser, setSelectedUser] = useState<Usuario | null>(null)\n  const [motivoBloqueio, setMotivoBloqueio] = useState('')\n  const [showDetailsModal, setShowDetailsModal] = useState(false)\n\n  useEffect(() => {\n    loadUsuarios()\n  }, [])\n\n  useEffect(() => {\n    applyFilters()\n  }, [usuarios, filterTipo, filterStatus, searchTerm])\n\n  const loadUsuarios = async () => {\n    const supabase = createClient()\n    \n    const { data: perfis } = await supabase\n      .from('perfis')\n      .select('user_id, nome, tipo, telefone, bloqueado, motivo_bloqueio')\n      .order('nome')\n\n    if (perfis) {\n      const usuariosData: Usuario[] = []\n      \n      for (const perfil of perfis) {\n        const { data: { user } } = await supabase.auth.admin.getUserById(perfil.user_id)\n        \n        if (user) {\n          usuariosData.push({\n            id: perfil.user_id,\n            nome: perfil.nome || 'Sem nome',\n            email: user.email || 'Sem email',\n            tipo: perfil.tipo,\n            telefone: perfil.telefone,\n            bloqueado: perfil.bloqueado || false,\n            motivo_bloqueio: perfil.motivo_bloqueio\n          })\n        }\n      }\n      \n      setUsuarios(usuariosData)\n    }\n    \n    setLoading(false)\n  }\n\n  const applyFilters = () => {\n    let filtered = [...usuarios]\n    \n    if (filterTipo !== 'todos') {\n      filtered = filtered.filter(u => u.tipo === filterTipo)\n    }\n    \n    if (filterStatus === 'ativos') {\n      filtered = filtered.filter(u => !u.bloqueado)\n    } else if (filterStatus === 'bloqueados') {\n      filtered = filtered.filter(u => u.bloqueado)\n    }\n    \n    if (searchTerm) {\n      filtered = filtered.filter(u => \n        u.nome.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        u.email.toLowerCase().includes(searchTerm.toLowerCase())\n      )\n    }\n    \n    setFilteredUsuarios(filtered)\n  }\n\n  const handleBlock = (user: Usuario) => {\n    setSelectedUser(user)\n    setMotivoBloqueio('')\n    setShowBlockModal(true)\n  }\n\n  const handleUnblock = async (user: Usuario) => {\n    const supabase = createClient()\n    \n    await supabase\n      .from('perfis')\n      .update({ bloqueado: false, motivo_bloqueio: null })\n      .eq('user_id', user.id)\n    \n    loadUsuarios()\n  }\n\n  const confirmBlock = async () => {\n    if (!selectedUser || !motivoBloqueio.trim()) return\n    \n    const supabase = createClient()\n    \n    await supabase\n      .from('perfis')\n      .update({ bloqueado: true, motivo_bloqueio: motivoBloqueio })\n      .eq('user_id', selectedUser.id)\n    \n    setShowBlockModal(false)\n    setSelectedUser(null)\n    setMotivoBloqueio('')\n    loadUsuarios()\n  }\n\n  const handleResetPassword = async (user: Usuario) => {\n    if (confirm(`Enviar email de recuperação de senha para ${user.email}?`)) {\n      const supabase = createClient()\n      await supabase.auth.resetPasswordForEmail(user.email)\n      alert('Email de recuperação enviado!')\n    }\n  }\n\n  const handleViewDetails = (user: Usuario) => {\n    setSelectedUser(user)\n    setShowDetailsModal(true)\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500\"></div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Filters */}\n      <div className=\"bg-gray-800 rounded-lg shadow-lg p-6\">\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n          <div>\n            <label className=\"block text-sm font-medium text-gray-300 mb-2\">Tipo de Usuário</label>\n            <select\n              value={filterTipo}\n              onChange={(e) => setFilterTipo(e.target.value)}\n              className=\"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            >\n              <option value=\"todos\">Todos</option>\n              <option value=\"cliente\">Clientes</option>\n              <option value=\"loja\">Lojas</option>\n              <option value=\"entregador\">Entregadores</option>\n              <option value=\"admin\">Administradores</option>\n            </select>\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-300 mb-2\">Status</label>\n            <select\n              value={filterStatus}\n              onChange={(e) => setFilterStatus(e.target.value)}\n              className=\"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            >\n              <option value=\"todos\">Todos</option>\n              <option value=\"ativos\">Ativos</option>\n              <option value=\"bloqueados\">Bloqueados</option>\n            </select>\n          </div>\n\n          <div className=\"md:col-span-2\">\n            <label className=\"block text-sm font-medium text-gray-300 mb-2\">Buscar por Nome/Email</label>\n            <input\n              type=\"text\"\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n              placeholder=\"Digite para buscar...\"\n              className=\"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            />\n          </div>\n        </div>\n      </div>\n\n      {/* Stats */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <div className=\"bg-gray-800 rounded-lg shadow-lg p-4\">\n          <p className=\"text-sm text-gray-400\">Total de Usuários</p>\n          <p className=\"text-2xl font-bold text-white\">{usuarios.length}</p>\n        </div>\n        <div className=\"bg-gray-800 rounded-lg shadow-lg p-4\">\n          <p className=\"text-sm text-gray-400\">Ativos</p>\n          <p className=\"text-2xl font-bold text-green-500\">{usuarios.filter(u => !u.bloqueado).length}</p>\n        </div>\n        <div className=\"bg-gray-800 rounded-lg shadow-lg p-4\">\n          <p className=\"text-sm text-gray-400\">Bloqueados</p>\n          <p className=\"text-2xl font-bold text-red-500\">{usuarios.filter(u => u.bloqueado).length}</p>\n        </div>\n        <div className=\"bg-gray-800 rounded-lg shadow-lg p-4\">\n          <p className=\"text-sm text-gray-400\">Resultados Filtrados</p>\n          <p className=\"text-2xl font-bold text-blue-500\">{filteredUsuarios.length}</p>\n        </div>\n      </div>\n\n      {/* Table */}\n      <div className=\"bg-gray-800 rounded-lg shadow-lg overflow-hidden\">\n        <div className=\"overflow-x-auto\">\n          <table className=\"w-full\">\n            <thead className=\"bg-gray-700\">\n              <tr>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider\">Nome</th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider\">Email</th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider\">Tipo</th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider\">Telefone</th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider\">Status</th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider\">Ações</th>\n              </tr>\n            </thead>\n            <tbody className=\"divide-y divide-gray-700\">\n              {filteredUsuarios.map((usuario) => (\n                <tr key={usuario.id} className=\"hover:bg-gray-700 transition\">\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <div className=\"text-sm font-medium text-white\">{usuario.nome}</div>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <div className=\"text-sm text-gray-300\">{usuario.email}</div>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <span className={`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${\n                      usuario.tipo === 'admin' ? 'bg-purple-600 text-white' :\n                      usuario.tipo === 'loja' ? 'bg-blue-600 text-white' :\n                      usuario.tipo === 'entregador' ? 'bg-green-600 text-white' :\n                      'bg-gray-600 text-white'\n                    }`}>\n                      {usuario.tipo}\n                    </span>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <div className=\"text-sm text-gray-300\">{usuario.telefone || 'N/A'}</div>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    {usuario.bloqueado ? (\n                      <span className=\"px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-600 text-white\">\n                        Bloqueado\n                      </span>\n                    ) : (\n                      <span className=\"px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-600 text-white\">\n                        Ativo\n                      </span>\n                    )}\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm\">\n                    <div className=\"flex space-x-2\">\n                      <button\n                        onClick={() => handleViewDetails(usuario)}\n                        className=\"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded transition\"\n                        title=\"Ver detalhes\"\n                      >\n                        Ver\n                      </button>\n                      \n                      {usuario.bloqueado ? (\n                        <button\n                          onClick={() => handleUnblock(usuario)}\n                          className=\"bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded transition\"\n                          title=\"Desbloquear\"\n                        >\n                          Desbloquear\n                        </button>\n                      ) : (\n                        <button\n                          onClick={() => handleBlock(usuario)}\n                          className=\"bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded transition\"\n                          title=\"Bloquear\"\n                        >\n                          Bloquear\n                        </button>\n                      )}\n                      \n                      <button\n                        onClick={() => handleResetPassword(usuario)}\n                        className=\"bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-1 rounded transition\"\n                        title=\"Resetar senha\"\n                      >\n                        Reset\n                      </button>\n                    </div>\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n      </div>\n\n      {/* Block Modal */}\n      {showBlockModal && selectedUser && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n          <div className=\"bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4\">\n            <h3 className=\"text-xl font-bold text-white mb-4\">Bloquear Usuário</h3>\n            \n            <p className=\"text-gray-300 mb-4\">\n              Você está prestes a bloquear <strong>{selectedUser.nome}</strong>.\n            </p>\n            \n            <div className=\"mb-4\">\n              <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                Motivo do Bloqueio *\n              </label>\n              <textarea\n                value={motivoBloqueio}\n                onChange={(e) => setMotivoBloqueio(e.target.value)}\n                className=\"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-red-500\"\n                rows={4}\n                placeholder=\"Descreva o motivo do bloqueio...\"\n              />\n            </div>\n            \n            <div className=\"flex space-x-3\">\n              <button\n                onClick={confirmBlock}\n                disabled={!motivoBloqueio.trim()}\n                className=\"flex-1 bg-red-600 hover:bg-red-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white px-4 py-2 rounded-lg transition\"\n              >\n                Confirmar Bloqueio\n              </button>\n              <button\n                onClick={() => setShowBlockModal(false)}\n                className=\"flex-1 bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition\"\n              >\n                Cancelar\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Details Modal */}\n      {showDetailsModal && selectedUser && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n          <div className=\"bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4\">\n            <h3 className=\"text-xl font-bold text-white mb-4\">Detalhes do Usuário</h3>\n            \n            <div className=\"space-y-3\">\n              <div>\n                <p className=\"text-sm text-gray-400\">Nome</p>\n                <p className=\"text-white font-medium\">{selectedUser.nome}</p>\n              </div>\n              \n              <div>\n                <p className=\"text-sm text-gray-400\">Email</p>\n                <p className=\"text-white font-medium\">{selectedUser.email}</p>\n              </div>\n              \n              <div>\n                <p className=\"text-sm text-gray-400\">Tipo</p>\n                <p className=\"text-white font-medium capitalize\">{selectedUser.tipo}</p>\n              </div>\n              \n              <div>\n                <p className=\"text-sm text-gray-400\">Telefone</p>\n                <p className=\"text-white font-medium\">{selectedUser.telefone || 'Não informado'}</p>\n              </div>\n              \n              <div>\n                <p className=\"text-sm text-gray-400\">Status</p>\n                <p className=\"text-white font-medium\">\n                  {selectedUser.bloqueado ? 'Bloqueado' : 'Ativo'}\n                </p>\n              </div>\n              \n              {selectedUser.bloqueado && selectedUser.motivo_bloqueio && (\n                <div>\n                  <p className=\"text-sm text-gray-400\">Motivo do Bloqueio</p>\n                  <p className=\"text-white font-medium\">{selectedUser.motivo_bloqueio}</p>\n                </div>\n              )}\n            </div>\n            \n            <button\n              onClick={() => setShowDetailsModal(false)}\n              className=\"w-full mt-6 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition\"\n            >\n              Fechar\n            </button>\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n","size_bytes":15672},"pedai-nextjs/components/admin/lojas/AdminLojas.tsx":{"content":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { createClient } from '@/lib/supabase/client'\n\ninterface Loja {\n  id: number\n  nome_loja: string\n  municipio: string\n  categoria: string\n  aprovada: boolean\n  aberta: boolean\n  taxa_entrega: number | null\n  comissao_plataforma: number | null\n  horario_abertura: string | null\n  horario_fechamento: string | null\n  raio_entrega_km: number | null\n}\n\nexport default function AdminLojas() {\n  const [lojas, setLojas] = useState<Loja[]>([])\n  const [filteredLojas, setFilteredLojas] = useState<Loja[]>([])\n  const [loading, setLoading] = useState(true)\n  \n  const [filterMunicipio, setFilterMunicipio] = useState('todos')\n  const [filterCategoria, setFilterCategoria] = useState('todos')\n  const [filterAprovacao, setFilterAprovacao] = useState('todos')\n  \n  const [showEditModal, setShowEditModal] = useState(false)\n  const [selectedLoja, setSelectedLoja] = useState<Loja | null>(null)\n  const [editForm, setEditForm] = useState({\n    taxa_entrega: '',\n    comissao_plataforma: '',\n    horario_abertura: '',\n    horario_fechamento: '',\n    raio_entrega_km: ''\n  })\n\n  const categorias = ['Restaurante', 'Lanchonete', 'Pizzaria', 'Padaria', 'Açaí', 'Mercado', 'Farmácia', 'Outros']\n  const municipios = ['Alagoa Nova', 'Esperança', 'Lagoa Seca']\n\n  useEffect(() => {\n    loadLojas()\n  }, [])\n\n  useEffect(() => {\n    applyFilters()\n  }, [lojas, filterMunicipio, filterCategoria, filterAprovacao])\n\n  const loadLojas = async () => {\n    const supabase = createClient()\n    \n    const { data } = await supabase\n      .from('lojas')\n      .select('*')\n      .order('municipio')\n      .order('nome_loja')\n\n    if (data) {\n      setLojas(data)\n    }\n    \n    setLoading(false)\n  }\n\n  const applyFilters = () => {\n    let filtered = [...lojas]\n    \n    if (filterMunicipio !== 'todos') {\n      filtered = filtered.filter(l => l.municipio === filterMunicipio)\n    }\n    \n    if (filterCategoria !== 'todos') {\n      filtered = filtered.filter(l => l.categoria === filterCategoria)\n    }\n    \n    if (filterAprovacao === 'pendentes') {\n      filtered = filtered.filter(l => !l.aprovada)\n    } else if (filterAprovacao === 'aprovadas') {\n      filtered = filtered.filter(l => l.aprovada)\n    }\n    \n    setFilteredLojas(filtered)\n  }\n\n  const handleAprovar = async (loja: Loja) => {\n    if (confirm(`Aprovar a loja ${loja.nome_loja}?`)) {\n      const supabase = createClient()\n      \n      await supabase\n        .from('lojas')\n        .update({ aprovada: true })\n        .eq('id', loja.id)\n      \n      loadLojas()\n    }\n  }\n\n  const handleReprovar = async (loja: Loja) => {\n    if (confirm(`Reprovar a loja ${loja.nome_loja}? Isso pode desativá-la.`)) {\n      const supabase = createClient()\n      \n      await supabase\n        .from('lojas')\n        .update({ aprovada: false })\n        .eq('id', loja.id)\n      \n      loadLojas()\n    }\n  }\n\n  const handleEdit = (loja: Loja) => {\n    setSelectedLoja(loja)\n    setEditForm({\n      taxa_entrega: loja.taxa_entrega?.toString() || '',\n      comissao_plataforma: loja.comissao_plataforma?.toString() || '',\n      horario_abertura: loja.horario_abertura || '',\n      horario_fechamento: loja.horario_fechamento || '',\n      raio_entrega_km: loja.raio_entrega_km?.toString() || ''\n    })\n    setShowEditModal(true)\n  }\n\n  const confirmEdit = async () => {\n    if (!selectedLoja) return\n    \n    const supabase = createClient()\n    \n    await supabase\n      .from('lojas')\n      .update({\n        taxa_entrega: editForm.taxa_entrega ? parseFloat(editForm.taxa_entrega) : null,\n        comissao_plataforma: editForm.comissao_plataforma ? parseFloat(editForm.comissao_plataforma) : null,\n        horario_abertura: editForm.horario_abertura || null,\n        horario_fechamento: editForm.horario_fechamento || null,\n        raio_entrega_km: editForm.raio_entrega_km ? parseFloat(editForm.raio_entrega_km) : null\n      })\n      .eq('id', selectedLoja.id)\n    \n    setShowEditModal(false)\n    setSelectedLoja(null)\n    loadLojas()\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500\"></div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Filters */}\n      <div className=\"bg-gray-800 rounded-lg shadow-lg p-6\">\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n          <div>\n            <label className=\"block text-sm font-medium text-gray-300 mb-2\">Município</label>\n            <select\n              value={filterMunicipio}\n              onChange={(e) => setFilterMunicipio(e.target.value)}\n              className=\"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            >\n              <option value=\"todos\">Todos</option>\n              {municipios.map(m => (\n                <option key={m} value={m}>{m}</option>\n              ))}\n            </select>\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-300 mb-2\">Categoria</label>\n            <select\n              value={filterCategoria}\n              onChange={(e) => setFilterCategoria(e.target.value)}\n              className=\"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            >\n              <option value=\"todos\">Todas</option>\n              {categorias.map(c => (\n                <option key={c} value={c}>{c}</option>\n              ))}\n            </select>\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-300 mb-2\">Status de Aprovação</label>\n            <select\n              value={filterAprovacao}\n              onChange={(e) => setFilterAprovacao(e.target.value)}\n              className=\"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            >\n              <option value=\"todos\">Todas</option>\n              <option value=\"pendentes\">Pendentes</option>\n              <option value=\"aprovadas\">Aprovadas</option>\n            </select>\n          </div>\n        </div>\n      </div>\n\n      {/* Stats */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <div className=\"bg-gray-800 rounded-lg shadow-lg p-4\">\n          <p className=\"text-sm text-gray-400\">Total de Lojas</p>\n          <p className=\"text-2xl font-bold text-white\">{lojas.length}</p>\n        </div>\n        <div className=\"bg-gray-800 rounded-lg shadow-lg p-4\">\n          <p className=\"text-sm text-gray-400\">Aprovadas</p>\n          <p className=\"text-2xl font-bold text-green-500\">{lojas.filter(l => l.aprovada).length}</p>\n        </div>\n        <div className=\"bg-gray-800 rounded-lg shadow-lg p-4\">\n          <p className=\"text-sm text-gray-400\">Pendentes</p>\n          <p className=\"text-2xl font-bold text-yellow-500\">{lojas.filter(l => !l.aprovada).length}</p>\n        </div>\n        <div className=\"bg-gray-800 rounded-lg shadow-lg p-4\">\n          <p className=\"text-sm text-gray-400\">Abertas Agora</p>\n          <p className=\"text-2xl font-bold text-blue-500\">{lojas.filter(l => l.aberta).length}</p>\n        </div>\n      </div>\n\n      {/* Lojas Grid */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n        {filteredLojas.map((loja) => (\n          <div\n            key={loja.id}\n            className={`bg-gray-800 rounded-lg shadow-lg p-6 hover:shadow-xl transition ${\n              !loja.aprovada ? 'border-2 border-yellow-500' : ''\n            }`}\n          >\n            <div className=\"flex items-start justify-between mb-4\">\n              <div>\n                <h3 className=\"text-lg font-bold text-white\">{loja.nome_loja}</h3>\n                <p className=\"text-sm text-gray-400\">{loja.municipio}</p>\n              </div>\n              \n              {!loja.aprovada && (\n                <span className=\"px-2 py-1 text-xs font-semibold bg-yellow-500 text-gray-900 rounded-full\">\n                  Pendente\n                </span>\n              )}\n            </div>\n\n            <div className=\"space-y-2 mb-4\">\n              <div className=\"flex items-center justify-between text-sm\">\n                <span className=\"text-gray-400\">Categoria:</span>\n                <span className=\"text-white font-medium\">{loja.categoria}</span>\n              </div>\n              \n              <div className=\"flex items-center justify-between text-sm\">\n                <span className=\"text-gray-400\">Status:</span>\n                {loja.aberta ? (\n                  <span className=\"text-green-500 font-medium\">Aberta</span>\n                ) : (\n                  <span className=\"text-red-500 font-medium\">Fechada</span>\n                )}\n              </div>\n              \n              <div className=\"flex items-center justify-between text-sm\">\n                <span className=\"text-gray-400\">Taxa Entrega:</span>\n                <span className=\"text-white font-medium\">\n                  {loja.taxa_entrega ? `R$ ${loja.taxa_entrega.toFixed(2)}` : 'Padrão'}\n                </span>\n              </div>\n              \n              <div className=\"flex items-center justify-between text-sm\">\n                <span className=\"text-gray-400\">Comissão:</span>\n                <span className=\"text-white font-medium\">\n                  {loja.comissao_plataforma ? `${loja.comissao_plataforma}%` : 'Padrão'}\n                </span>\n              </div>\n              \n              {loja.horario_abertura && loja.horario_fechamento && (\n                <div className=\"flex items-center justify-between text-sm\">\n                  <span className=\"text-gray-400\">Horário:</span>\n                  <span className=\"text-white font-medium\">\n                    {loja.horario_abertura} - {loja.horario_fechamento}\n                  </span>\n                </div>\n              )}\n            </div>\n\n            <div className=\"flex flex-wrap gap-2\">\n              {!loja.aprovada && (\n                <>\n                  <button\n                    onClick={() => handleAprovar(loja)}\n                    className=\"flex-1 bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-lg transition text-sm font-medium\"\n                  >\n                    Aprovar\n                  </button>\n                  <button\n                    onClick={() => handleReprovar(loja)}\n                    className=\"flex-1 bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded-lg transition text-sm font-medium\"\n                  >\n                    Reprovar\n                  </button>\n                </>\n              )}\n              \n              <button\n                onClick={() => handleEdit(loja)}\n                className=\"flex-1 bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-2 rounded-lg transition text-sm font-medium\"\n              >\n                Configurar\n              </button>\n            </div>\n          </div>\n        ))}\n      </div>\n\n      {filteredLojas.length === 0 && (\n        <div className=\"bg-gray-800 rounded-lg shadow-lg p-12 text-center\">\n          <p className=\"text-gray-400 text-lg\">Nenhuma loja encontrada com os filtros selecionados.</p>\n        </div>\n      )}\n\n      {/* Edit Modal */}\n      {showEditModal && selectedLoja && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n          <div className=\"bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto\">\n            <h3 className=\"text-xl font-bold text-white mb-4\">\n              Configurar Loja: {selectedLoja.nome_loja}\n            </h3>\n            \n            <div className=\"space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                  Taxa de Entrega (R$)\n                </label>\n                <input\n                  type=\"number\"\n                  step=\"0.01\"\n                  value={editForm.taxa_entrega}\n                  onChange={(e) => setEditForm({ ...editForm, taxa_entrega: e.target.value })}\n                  className=\"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-yellow-500\"\n                  placeholder=\"Ex: 5.00\"\n                />\n                <p className=\"text-xs text-gray-400 mt-1\">Deixe vazio para usar valor padrão</p>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                  Comissão da Plataforma (%)\n                </label>\n                <input\n                  type=\"number\"\n                  step=\"0.1\"\n                  value={editForm.comissao_plataforma}\n                  onChange={(e) => setEditForm({ ...editForm, comissao_plataforma: e.target.value })}\n                  className=\"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-yellow-500\"\n                  placeholder=\"Ex: 10\"\n                />\n                <p className=\"text-xs text-gray-400 mt-1\">Deixe vazio para usar valor padrão</p>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                  Horário de Abertura\n                </label>\n                <input\n                  type=\"time\"\n                  value={editForm.horario_abertura}\n                  onChange={(e) => setEditForm({ ...editForm, horario_abertura: e.target.value })}\n                  className=\"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-yellow-500\"\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                  Horário de Fechamento\n                </label>\n                <input\n                  type=\"time\"\n                  value={editForm.horario_fechamento}\n                  onChange={(e) => setEditForm({ ...editForm, horario_fechamento: e.target.value })}\n                  className=\"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-yellow-500\"\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                  Raio de Entrega (km)\n                </label>\n                <input\n                  type=\"number\"\n                  step=\"0.1\"\n                  value={editForm.raio_entrega_km}\n                  onChange={(e) => setEditForm({ ...editForm, raio_entrega_km: e.target.value })}\n                  className=\"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-yellow-500\"\n                  placeholder=\"Ex: 5.0\"\n                />\n              </div>\n            </div>\n            \n            <div className=\"flex space-x-3 mt-6\">\n              <button\n                onClick={confirmEdit}\n                className=\"flex-1 bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg transition font-medium\"\n              >\n                Salvar Alterações\n              </button>\n              <button\n                onClick={() => setShowEditModal(false)}\n                className=\"flex-1 bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition font-medium\"\n              >\n                Cancelar\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n","size_bytes":15755},"pedai-nextjs/app/admin/dashboard/page.tsx":{"content":"import AdminLayout from '@/components/admin/AdminLayout'\nimport AdminDashboard from '@/components/admin/AdminDashboard'\n\nexport default function AdminDashboardPage() {\n  return (\n    <AdminLayout>\n      <AdminDashboard />\n    </AdminLayout>\n  )\n}\n","size_bytes":247},"pedai-nextjs/components/admin/AdminLayout.tsx":{"content":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useRouter } from 'next/navigation'\nimport { createClient } from '@/lib/supabase/client'\nimport Link from 'next/link'\n\ninterface AdminLayoutProps {\n  children: React.ReactNode\n  currentPage?: 'dashboard' | 'usuarios' | 'lojas' | 'financeiro' | 'configuracoes'\n}\n\nexport default function AdminLayout({ children, currentPage = 'dashboard' }: AdminLayoutProps) {\n  const router = useRouter()\n  const [adminName, setAdminName] = useState('')\n  const [loading, setLoading] = useState(true)\n  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false)\n\n  useEffect(() => {\n    checkAuth()\n  }, [])\n\n  const checkAuth = async () => {\n    const supabase = createClient()\n    \n    const { data: { session } } = await supabase.auth.getSession()\n    \n    if (!session) {\n      router.push('/auth/login')\n      return\n    }\n\n    // Get profile via API (bypasses RLS) - Send cookies for server-side session validation\n    const response = await fetch('/api/auth/get-profile', {\n      credentials: 'include'\n    })\n    const data = await response.json()\n\n    if (!response.ok || !data.perfil || data.perfil.tipo !== 'admin') {\n      router.push('/')\n      return\n    }\n\n    setAdminName(data.perfil.nome_completo || session.user.email || 'Admin')\n    setLoading(false)\n  }\n\n  const handleLogout = async () => {\n    const supabase = createClient()\n    await supabase.auth.signOut()\n    router.push('/auth/login')\n  }\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gray-900 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto\"></div>\n          <p className=\"mt-4 text-gray-300\">Carregando...</p>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-900 flex\">\n      {/* Mobile Menu Overlay */}\n      {isMobileMenuOpen && (\n        <div \n          className=\"fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden\"\n          onClick={() => setIsMobileMenuOpen(false)}\n        />\n      )}\n\n      {/* Fixed Sidebar */}\n      <aside className={`fixed left-0 top-0 h-screen w-64 bg-gray-800 border-r border-gray-700 flex flex-col z-50 transform transition-transform duration-300 ease-in-out ${\n        isMobileMenuOpen ? 'translate-x-0' : '-translate-x-full lg:translate-x-0'\n      }`}>\n        {/* Logo */}\n        <div className=\"p-6 border-b border-gray-700\">\n          <h1 className=\"text-2xl font-bold text-white\">PedeAí</h1>\n          <p className=\"text-sm text-gray-400 mt-1\">Painel Admin</p>\n        </div>\n\n        {/* Navigation Menu */}\n        <nav className=\"flex-1 p-4 space-y-2\">\n          <Link href=\"/admin/dashboard\">\n            <div className={`flex items-center space-x-3 px-4 py-3 rounded-lg transition cursor-pointer ${\n              currentPage === 'dashboard' \n                ? 'bg-blue-600 text-white' \n                : 'text-gray-300 hover:bg-gray-700 hover:text-white'\n            }`}>\n              <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6\" />\n              </svg>\n              <span className=\"font-medium\">Dashboard</span>\n            </div>\n          </Link>\n\n          <Link href=\"/admin/usuarios\">\n            <div className={`flex items-center space-x-3 px-4 py-3 rounded-lg transition cursor-pointer ${\n              currentPage === 'usuarios' \n                ? 'bg-blue-600 text-white' \n                : 'text-gray-300 hover:bg-gray-700 hover:text-white'\n            }`}>\n              <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z\" />\n              </svg>\n              <span className=\"font-medium\">Usuários</span>\n            </div>\n          </Link>\n\n          <Link href=\"/admin/lojas\">\n            <div className={`flex items-center space-x-3 px-4 py-3 rounded-lg transition cursor-pointer ${\n              currentPage === 'lojas' \n                ? 'bg-blue-600 text-white' \n                : 'text-gray-300 hover:bg-gray-700 hover:text-white'\n            }`}>\n              <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4\" />\n              </svg>\n              <span className=\"font-medium\">Lojas</span>\n            </div>\n          </Link>\n\n          <Link href=\"/admin/financeiro\">\n            <div className={`flex items-center space-x-3 px-4 py-3 rounded-lg transition cursor-pointer ${\n              currentPage === 'financeiro' \n                ? 'bg-blue-600 text-white' \n                : 'text-gray-300 hover:bg-gray-700 hover:text-white'\n            }`}>\n              <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n              </svg>\n              <span className=\"font-medium\">Financeiro</span>\n            </div>\n          </Link>\n\n          <Link href=\"/admin/configuracoes\">\n            <div className={`flex items-center space-x-3 px-4 py-3 rounded-lg transition cursor-pointer ${\n              currentPage === 'configuracoes' \n                ? 'bg-blue-600 text-white' \n                : 'text-gray-300 hover:bg-gray-700 hover:text-white'\n            }`}>\n              <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z\" />\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" />\n              </svg>\n              <span className=\"font-medium\">Configurações</span>\n            </div>\n          </Link>\n        </nav>\n      </aside>\n\n      {/* Main Content Area */}\n      <div className=\"lg:ml-64 flex-1 flex flex-col\">\n        {/* Top Header */}\n        <header className=\"bg-gray-800 border-b border-gray-700 px-4 lg:px-8 py-4\">\n          <div className=\"flex items-center justify-between\">\n            {/* Mobile Menu Button */}\n            <button\n              onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}\n              className=\"lg:hidden text-white p-2 rounded-lg hover:bg-gray-700\"\n            >\n              <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 6h16M4 12h16M4 18h16\" />\n              </svg>\n            </button>\n            <div className=\"flex-1 lg:flex-none\">\n              <h2 className=\"text-lg lg:text-xl font-semibold text-white\">\n                {currentPage === 'dashboard' && 'Dashboard'}\n                {currentPage === 'usuarios' && 'Gestão de Usuários'}\n                {currentPage === 'lojas' && 'Gestão de Lojas'}\n                {currentPage === 'financeiro' && 'Painel Financeiro'}\n                {currentPage === 'configuracoes' && 'Configurações da Plataforma'}\n              </h2>\n            </div>\n            \n            <div className=\"flex items-center space-x-2 lg:space-x-4\">\n              <div className=\"hidden sm:block text-right\">\n                <p className=\"text-sm text-gray-400\">Bem-vindo,</p>\n                <p className=\"font-medium text-white\">{adminName}</p>\n              </div>\n              \n              <button\n                onClick={handleLogout}\n                className=\"bg-red-600 hover:bg-red-700 text-white px-3 lg:px-4 py-2 rounded-lg transition flex items-center space-x-2\"\n              >\n                <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1\" />\n                </svg>\n                <span className=\"hidden sm:inline\">Sair</span>\n              </button>\n            </div>\n          </div>\n        </header>\n\n        {/* Page Content */}\n        <main className=\"flex-1 p-8 overflow-auto\">\n          {children}\n        </main>\n      </div>\n    </div>\n  )\n}\n","size_bytes":9418},"pedai-nextjs/app/admin/configuracoes/page.tsx":{"content":"import AdminLayout from '@/components/admin/AdminLayout'\nimport AdminConfiguracoes from '@/components/admin/configuracoes/AdminConfiguracoes'\n\nexport default function ConfiguracoesPage() {\n  return (\n    <AdminLayout currentPage=\"configuracoes\">\n      <AdminConfiguracoes />\n    </AdminLayout>\n  )\n}\n","size_bytes":300},"pedai-nextjs/components/admin/loja/AdminLojaPedidos.tsx":{"content":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useRouter } from 'next/navigation'\nimport { createClient } from '@/lib/supabase/client'\nimport Link from 'next/link'\n\ninterface Pedido {\n  id: number\n  status: string\n  total: number\n  subtotal: number\n  taxa_entrega: number\n  endereco_entrega: string\n  forma_pagamento: string\n  observacoes: string | null\n  created_at: string\n  perfil: {\n    nome_completo: string\n    telefone: string\n  }\n  items: Array<{\n    quantidade: number\n    preco_unitario: number\n    observacao: string | null\n    produto: {\n      id: number\n      nome: string\n    }\n  }>\n}\n\nconst statusLabels: Record<string, string> = {\n  todos: 'Todos',\n  pendente: 'Pendente',\n  aceito: 'Aceito',\n  preparando: 'Preparando',\n  pronto: 'Pronto',\n  em_entrega: 'Em Entrega',\n  entregue: 'Entregue',\n  cancelado: 'Cancelado',\n}\n\nconst statusColors: Record<string, string> = {\n  pendente: 'bg-yellow-500',\n  aceito: 'bg-blue-500',\n  preparando: 'bg-purple-500',\n  pronto: 'bg-green-500',\n  em_entrega: 'bg-cyan-500',\n  entregue: 'bg-gray-500',\n  cancelado: 'bg-red-500',\n}\n\ninterface AdminLojaPedidosProps {\n  lojaId: string\n}\n\nexport default function AdminLojaPedidos({ lojaId }: AdminLojaPedidosProps) {\n  const router = useRouter()\n  const [loading, setLoading] = useState(true)\n  const [pedidos, setPedidos] = useState<Pedido[]>([])\n  const [filtroStatus, setFiltroStatus] = useState('todos')\n  const [loja, setLoja] = useState<any>(null)\n  const [expandedPedido, setExpandedPedido] = useState<number | null>(null)\n  const [updating, setUpdating] = useState<number | null>(null)\n\n  useEffect(() => {\n    checkAuthAndLoadPedidos()\n  }, [filtroStatus, lojaId])\n\n  const checkAuthAndLoadPedidos = async () => {\n    const supabase = createClient()\n    \n    const { data: { user } } = await supabase.auth.getUser()\n    \n    if (!user) {\n      router.push('/auth/login')\n      return\n    }\n\n    const { data: perfil } = await supabase\n      .from('perfis')\n      .select('tipo')\n      .eq('user_id', user.id)\n      .single()\n\n    if (!perfil || perfil.tipo !== 'admin') {\n      router.push('/')\n      return\n    }\n\n    await loadPedidos()\n  }\n\n  const loadPedidos = async () => {\n    setLoading(true)\n    try {\n      const url = filtroStatus === 'todos' \n        ? `/api/loja/pedidos?loja_id=${lojaId}`\n        : `/api/loja/pedidos?status=${filtroStatus}&loja_id=${lojaId}`\n      \n      const response = await fetch(url)\n      const data = await response.json()\n\n      if (response.ok) {\n        setPedidos(data.pedidos || [])\n        setLoja(data.loja)\n      } else {\n        console.error('Erro ao carregar pedidos:', data.error)\n      }\n    } catch (error) {\n      console.error('Erro ao carregar pedidos:', error)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const updateStatus = async (pedidoId: number, newStatus: string) => {\n    setUpdating(pedidoId)\n    try {\n      const response = await fetch(`/api/loja/pedidos/${pedidoId}`, {\n        method: 'PATCH',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ status: newStatus }),\n      })\n\n      if (response.ok) {\n        await loadPedidos()\n      } else {\n        const data = await response.json()\n        console.error('Erro ao atualizar status:', data.error)\n        alert('Erro ao atualizar status do pedido')\n      }\n    } catch (error) {\n      console.error('Erro ao atualizar status:', error)\n      alert('Erro ao atualizar status do pedido')\n    } finally {\n      setUpdating(null)\n    }\n  }\n\n  const getStatusActions = (pedido: Pedido) => {\n    const actions = []\n    \n    if (pedido.status === 'pendente') {\n      actions.push(\n        <button\n          key=\"aceitar\"\n          onClick={() => updateStatus(pedido.id, 'aceito')}\n          className=\"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700\"\n          disabled={updating === pedido.id}\n        >\n          Aceitar Pedido\n        </button>,\n        <button\n          key=\"cancelar\"\n          onClick={() => updateStatus(pedido.id, 'cancelado')}\n          className=\"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700\"\n          disabled={updating === pedido.id}\n        >\n          Cancelar\n        </button>\n      )\n    } else if (pedido.status === 'aceito') {\n      actions.push(\n        <button\n          key=\"preparando\"\n          onClick={() => updateStatus(pedido.id, 'preparando')}\n          className=\"px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700\"\n          disabled={updating === pedido.id}\n        >\n          Iniciar Preparo\n        </button>\n      )\n    } else if (pedido.status === 'preparando') {\n      actions.push(\n        <button\n          key=\"pronto\"\n          onClick={() => updateStatus(pedido.id, 'pronto')}\n          className=\"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700\"\n          disabled={updating === pedido.id}\n        >\n          Marcar como Pronto\n        </button>\n      )\n    } else if (pedido.status === 'pronto') {\n      actions.push(\n        <button\n          key=\"em_entrega\"\n          onClick={() => updateStatus(pedido.id, 'em_entrega')}\n          className=\"px-4 py-2 bg-cyan-600 text-white rounded-md hover:bg-cyan-700\"\n          disabled={updating === pedido.id}\n        >\n          Saiu para Entrega\n        </button>\n      )\n    } else if (pedido.status === 'em_entrega') {\n      actions.push(\n        <button\n          key=\"entregue\"\n          onClick={() => updateStatus(pedido.id, 'entregue')}\n          className=\"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700\"\n          disabled={updating === pedido.id}\n        >\n          Marcar como Entregue\n        </button>\n      )\n    }\n    \n    return actions\n  }\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900 mx-auto\"></div>\n          <p className=\"mt-4 text-gray-600\">Carregando pedidos...</p>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <div className=\"max-w-7xl mx-auto px-4 py-8\">\n        {/* Header */}\n        <div className=\"mb-8\">\n          <div className=\"flex items-center gap-2 mb-2\">\n            <Link href={`/admin/loja/${lojaId}/dashboard`} className=\"text-blue-600 hover:text-blue-800\">\n              ← Voltar ao Dashboard\n            </Link>\n          </div>\n          <h1 className=\"text-3xl font-bold text-gray-900\">Gerenciar Pedidos</h1>\n          <p className=\"text-gray-600\">{loja?.nome_loja} (Admin)</p>\n        </div>\n\n        {/* Filtros */}\n        <div className=\"mb-6 flex flex-wrap gap-2\">\n          {Object.entries(statusLabels).map(([value, label]) => (\n            <button\n              key={value}\n              onClick={() => setFiltroStatus(value)}\n              className={`px-4 py-2 rounded-md font-medium transition ${\n                filtroStatus === value\n                  ? 'bg-blue-600 text-white'\n                  : 'bg-white text-gray-700 hover:bg-gray-100'\n              }`}\n            >\n              {label}\n            </button>\n          ))}\n        </div>\n\n        {/* Lista de Pedidos */}\n        {pedidos.length === 0 ? (\n          <div className=\"bg-white rounded-lg shadow p-8 text-center\">\n            <p className=\"text-gray-500\">Nenhum pedido encontrado.</p>\n          </div>\n        ) : (\n          <div className=\"space-y-4\">\n            {pedidos.map((pedido) => (\n              <div key={pedido.id} className=\"bg-white rounded-lg shadow overflow-hidden\">\n                <div\n                  className=\"p-6 cursor-pointer hover:bg-gray-50\"\n                  onClick={() => setExpandedPedido(expandedPedido === pedido.id ? null : pedido.id)}\n                >\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-4\">\n                      <div>\n                        <h3 className=\"text-lg font-bold text-gray-900\">Pedido #{pedido.id}</h3>\n                        <p className=\"text-sm text-gray-600\">\n                          {new Date(pedido.created_at).toLocaleString('pt-BR')}\n                        </p>\n                      </div>\n                    </div>\n                    <div className=\"flex items-center gap-4\">\n                      <span className={`px-3 py-1 rounded-full text-white text-sm font-medium ${statusColors[pedido.status]}`}>\n                        {statusLabels[pedido.status]}\n                      </span>\n                      <span className=\"text-lg font-bold text-gray-900\">\n                        R$ {pedido.total.toFixed(2)}\n                      </span>\n                      <svg\n                        className={`w-5 h-5 text-gray-400 transition-transform ${expandedPedido === pedido.id ? 'rotate-180' : ''}`}\n                        fill=\"none\"\n                        stroke=\"currentColor\"\n                        viewBox=\"0 0 24 24\"\n                      >\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n                      </svg>\n                    </div>\n                  </div>\n                </div>\n\n                {expandedPedido === pedido.id && (\n                  <div className=\"border-t border-gray-200 p-6 bg-gray-50\">\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6\">\n                      <div>\n                        <h4 className=\"font-semibold text-gray-900 mb-2\">Cliente</h4>\n                        <p className=\"text-gray-700\">{pedido.perfil?.nome_completo || 'Cliente Guest'}</p>\n                        <p className=\"text-gray-600\">{pedido.perfil?.telefone || 'Sem telefone'}</p>\n                      </div>\n                      <div>\n                        <h4 className=\"font-semibold text-gray-900 mb-2\">Endereço de Entrega</h4>\n                        <p className=\"text-gray-700\">{pedido.endereco_entrega}</p>\n                      </div>\n                    </div>\n\n                    <div className=\"mb-6\">\n                      <h4 className=\"font-semibold text-gray-900 mb-2\">Itens do Pedido</h4>\n                      <div className=\"space-y-2\">\n                        {pedido.items.map((item, index) => (\n                          <div key={index} className=\"flex justify-between items-center bg-white p-3 rounded\">\n                            <div>\n                              <p className=\"font-medium text-gray-900\">{item.produto.nome}</p>\n                              <p className=\"text-sm text-gray-600\">Quantidade: {item.quantidade}</p>\n                              {item.observacao && (\n                                <p className=\"text-sm text-gray-500 italic\">Obs: {item.observacao}</p>\n                              )}\n                            </div>\n                            <p className=\"font-semibold text-gray-900\">\n                              R$ {(item.quantidade * item.preco_unitario).toFixed(2)}\n                            </p>\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n\n                    <div className=\"mb-6\">\n                      <div className=\"flex justify-between text-sm mb-1\">\n                        <span className=\"text-gray-600\">Subtotal:</span>\n                        <span className=\"text-gray-900\">R$ {pedido.subtotal.toFixed(2)}</span>\n                      </div>\n                      <div className=\"flex justify-between text-sm mb-1\">\n                        <span className=\"text-gray-600\">Taxa de Entrega:</span>\n                        <span className=\"text-gray-900\">R$ {pedido.taxa_entrega.toFixed(2)}</span>\n                      </div>\n                      <div className=\"flex justify-between font-bold text-lg\">\n                        <span>Total:</span>\n                        <span>R$ {pedido.total.toFixed(2)}</span>\n                      </div>\n                      <div className=\"flex justify-between text-sm mt-2\">\n                        <span className=\"text-gray-600\">Forma de Pagamento:</span>\n                        <span className=\"text-gray-900 capitalize\">{pedido.forma_pagamento}</span>\n                      </div>\n                    </div>\n\n                    {pedido.observacoes && (\n                      <div className=\"mb-6\">\n                        <h4 className=\"font-semibold text-gray-900 mb-2\">Observações</h4>\n                        <p className=\"text-gray-700 bg-white p-3 rounded\">{pedido.observacoes}</p>\n                      </div>\n                    )}\n\n                    {/* Actions */}\n                    <div className=\"flex gap-2 flex-wrap\">\n                      {getStatusActions(pedido)}\n                    </div>\n                  </div>\n                )}\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\n","size_bytes":13019},"pedai-nextjs/components/admin/loja/AdminLojaDashboard.tsx":{"content":"'use client'\n\nimport { useEffect, useState } from 'react'\nimport { createClient } from '@/lib/supabase/client'\nimport { useRouter } from 'next/navigation'\nimport Link from 'next/link'\n\ninterface DashboardStats {\n  pedidosHoje: number\n  receitaHoje: number\n  pedidosPendentes: number\n  produtosAtivos: number\n}\n\ninterface AdminLojaDashboardProps {\n  lojaId: string\n}\n\nexport default function AdminLojaDashboard({ lojaId }: AdminLojaDashboardProps) {\n  const router = useRouter()\n  const [loading, setLoading] = useState(true)\n  const [stats, setStats] = useState<DashboardStats>({\n    pedidosHoje: 0,\n    receitaHoje: 0,\n    pedidosPendentes: 0,\n    produtosAtivos: 0,\n  })\n  const [loja, setLoja] = useState<any>(null)\n\n  useEffect(() => {\n    checkAuthAndLoadStats()\n  }, [lojaId])\n\n  const checkAuthAndLoadStats = async () => {\n    const supabase = createClient()\n    \n    const { data: { user } } = await supabase.auth.getUser()\n    \n    if (!user) {\n      router.push('/auth/login')\n      return\n    }\n\n    const { data: perfil } = await supabase\n      .from('perfis')\n      .select('tipo')\n      .eq('user_id', user.id)\n      .single()\n\n    if (!perfil || perfil.tipo !== 'admin') {\n      router.push('/')\n      return\n    }\n\n    // Get loja data by ID\n    const { data: lojaData } = await supabase\n      .from('lojas')\n      .select('*')\n      .eq('id', lojaId)\n      .single()\n\n    if (!lojaData) {\n      console.error('Loja não encontrada')\n      router.push('/admin/dashboard')\n      return\n    }\n\n    setLoja(lojaData)\n    \n    // Load real stats from database\n    const today = new Date()\n    today.setHours(0, 0, 0, 0)\n    const todayISO = today.toISOString()\n\n    // Count pedidos hoje\n    const { count: pedidosHojeCount } = await supabase\n      .from('pedidos')\n      .select('*', { count: 'exact', head: true })\n      .eq('loja_id', lojaData.id)\n      .gte('created_at', todayISO)\n\n    // Sum receita hoje\n    const { data: pedidosHoje } = await supabase\n      .from('pedidos')\n      .select('total')\n      .eq('loja_id', lojaData.id)\n      .gte('created_at', todayISO)\n      .not('status', 'eq', 'cancelado')\n\n    const receitaHoje = pedidosHoje?.reduce((sum, p) => sum + (p.total || 0), 0) || 0\n\n    // Count pendentes\n    const { count: pendentesCount } = await supabase\n      .from('pedidos')\n      .select('*', { count: 'exact', head: true })\n      .eq('loja_id', lojaData.id)\n      .in('status', ['pendente', 'aceito', 'preparando', 'pronto'])\n\n    // Count produtos ativos\n    const { count: produtosCount } = await supabase\n      .from('produtos')\n      .select('*', { count: 'exact', head: true })\n      .eq('loja_id', lojaData.id)\n      .eq('disponivel', true)\n\n    setStats({\n      pedidosHoje: pedidosHojeCount || 0,\n      receitaHoje: receitaHoje,\n      pedidosPendentes: pendentesCount || 0,\n      produtosAtivos: produtosCount || 0,\n    })\n\n    setLoading(false)\n  }\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900 mx-auto\"></div>\n          <p className=\"mt-4 text-gray-600\">Carregando...</p>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <div className=\"max-w-7xl mx-auto px-4 py-8\">\n        {/* Header */}\n        <div className=\"mb-8 flex items-center justify-between\">\n          <div>\n            <div className=\"flex items-center gap-2 mb-2\">\n              <Link href=\"/admin/dashboard\" className=\"text-blue-600 hover:text-blue-800\">\n                ← Voltar ao Painel Admin\n              </Link>\n            </div>\n            <h1 className=\"text-3xl font-bold text-gray-900\">{loja.nome_loja}</h1>\n            <p className=\"text-gray-600\">{loja.municipio} - Dashboard de Gerenciamento (Admin)</p>\n          </div>\n        </div>\n\n        {/* Stats Grid */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8\">\n          <div className=\"bg-white rounded-lg shadow p-6\">\n            <p className=\"text-sm text-gray-600\">Pedidos Hoje</p>\n            <p className=\"text-3xl font-bold text-gray-900\">{stats.pedidosHoje}</p>\n          </div>\n          <div className=\"bg-white rounded-lg shadow p-6\">\n            <p className=\"text-sm text-gray-600\">Receita Hoje</p>\n            <p className=\"text-3xl font-bold text-green-600\">R$ {stats.receitaHoje.toFixed(2)}</p>\n          </div>\n          <div className=\"bg-white rounded-lg shadow p-6\">\n            <p className=\"text-sm text-gray-600\">Pedidos Pendentes</p>\n            <p className=\"text-3xl font-bold text-orange-600\">{stats.pedidosPendentes}</p>\n          </div>\n          <div className=\"bg-white rounded-lg shadow p-6\">\n            <p className=\"text-sm text-gray-600\">Produtos Ativos</p>\n            <p className=\"text-3xl font-bold text-blue-600\">{stats.produtosAtivos}</p>\n          </div>\n        </div>\n\n        {/* Quick Actions */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n          <Link \n            href={`/admin/loja/${lojaId}/pedidos`}\n            className=\"bg-white rounded-lg shadow hover:shadow-lg transition p-6 border-2 border-transparent hover:border-blue-500\"\n          >\n            <h3 className=\"text-xl font-bold text-gray-900 mb-2\">Gerenciar Pedidos</h3>\n            <p className=\"text-gray-600\">Visualize e atualize os pedidos desta loja</p>\n          </Link>\n\n          <div className=\"bg-white rounded-lg shadow p-6 border-2 border-gray-300 opacity-50\">\n            <h3 className=\"text-xl font-bold text-gray-900 mb-2\">Gerenciar Produtos</h3>\n            <p className=\"text-gray-600\">Em desenvolvimento</p>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n","size_bytes":5792},"pedai-nextjs/app/api/auth/get-profile/route.ts":{"content":"import { createClient } from '@/lib/supabase/server'\nimport { createClient as createServiceClient } from '@supabase/supabase-js'\nimport { NextRequest, NextResponse } from 'next/server'\n\nexport async function GET(request: NextRequest) {\n  try {\n    // Try to get token from Authorization header (for localStorage-based auth)\n    const authHeader = request.headers.get('Authorization')\n    let user = null\n\n    if (authHeader?.startsWith('Bearer ')) {\n      const token = authHeader.substring(7)\n      \n      // Verify token with Supabase\n      const supabaseAdmin = createServiceClient(\n        process.env.NEXT_PUBLIC_SUPABASE_URL!,\n        process.env.SUPABASE_SERVICE_ROLE_KEY!,\n        {\n          auth: {\n            autoRefreshToken: false,\n            persistSession: false,\n          },\n        }\n      )\n\n      const { data: { user: tokenUser }, error: tokenError } = await supabaseAdmin.auth.getUser(token)\n      \n      if (!tokenError && tokenUser) {\n        user = tokenUser\n      }\n    }\n\n    // Fallback to cookie-based auth\n    if (!user) {\n      const supabase = await createClient()\n      const { data: { user: cookieUser }, error: userError } = await supabase.auth.getUser()\n      \n      if (!userError && cookieUser) {\n        user = cookieUser\n      }\n    }\n\n    if (!user) {\n      return NextResponse.json(\n        { error: 'Não autenticado' },\n        { status: 401 }\n      )\n    }\n\n    // Create service role client to bypass RLS\n    const supabaseAdmin = createServiceClient(\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\n      process.env.SUPABASE_SERVICE_ROLE_KEY!,\n      {\n        auth: {\n          autoRefreshToken: false,\n          persistSession: false,\n        },\n      }\n    )\n\n    // Get user profile using service role (bypasses RLS)\n    const { data: perfil, error: perfilError } = await supabaseAdmin\n      .from('perfis')\n      .select('*')\n      .eq('user_id', user.id)\n      .maybeSingle()\n\n    if (perfilError) {\n      console.error('Error fetching profile:', perfilError)\n      return NextResponse.json(\n        { error: 'Erro ao buscar perfil do usuário' },\n        { status: 500 }\n      )\n    }\n\n    if (!perfil) {\n      return NextResponse.json(\n        { error: 'Perfil de usuário não encontrado. Entre em contato com o suporte.' },\n        { status: 404 }\n      )\n    }\n\n    // Check if user is blocked\n    if (perfil.bloqueado) {\n      return NextResponse.json(\n        { \n          error: `Usuário bloqueado: ${perfil.bloqueado_motivo || 'Entre em contato com o suporte'}` \n        },\n        { status: 403 }\n      )\n    }\n\n    // Return profile\n    return NextResponse.json({\n      success: true,\n      perfil,\n    })\n\n  } catch (error: any) {\n    console.error('Get profile error:', error)\n    return NextResponse.json(\n      { error: error.message || 'Erro ao buscar perfil' },\n      { status: 500 }\n    )\n  }\n}\n","size_bytes":2866},"pedai-nextjs/app/admin/loja/[lojaId]/pedidos/page.tsx":{"content":"import AdminLojaPedidos from '@/components/admin/loja/AdminLojaPedidos'\n\nexport default function AdminLojaPedidosPage({ params }: { params: { lojaId: string } }) {\n  return <AdminLojaPedidos lojaId={params.lojaId} />\n}\n","size_bytes":219},"pedai-nextjs/app/admin/financeiro/page.tsx":{"content":"import AdminLayout from '@/components/admin/AdminLayout'\nimport AdminFinanceiro from '@/components/admin/financeiro/AdminFinanceiro'\n\nexport default function FinanceiroPage() {\n  return (\n    <AdminLayout currentPage=\"financeiro\">\n      <AdminFinanceiro />\n    </AdminLayout>\n  )\n}\n","size_bytes":282},"pedai-nextjs/app/api/admin/lojas/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { createClient } from '@/lib/supabase/server'\n\nexport async function GET(request: NextRequest) {\n  try {\n    const supabase = await createClient()\n    \n    const { data: { user } } = await supabase.auth.getUser()\n    \n    if (!user) {\n      return NextResponse.json({ error: 'Não autenticado' }, { status: 401 })\n    }\n\n    const { data: perfil } = await supabase\n      .from('perfis')\n      .select('tipo')\n      .eq('user_id', user.id)\n      .single()\n\n    if (!perfil || perfil.tipo !== 'admin') {\n      return NextResponse.json({ error: 'Acesso negado' }, { status: 403 })\n    }\n\n    const { searchParams } = new URL(request.url)\n    const municipio = searchParams.get('municipio')\n    const categoria = searchParams.get('categoria')\n    const aprovacao = searchParams.get('aprovacao')\n\n    let query = supabase\n      .from('lojas')\n      .select(`\n        *,\n        perfil:perfis!lojas_perfil_id_fkey(nome_completo, email, telefone)\n      `)\n      .order('created_at', { ascending: false })\n\n    if (municipio && municipio !== 'todos') {\n      query = query.eq('municipio', municipio)\n    }\n\n    if (categoria && categoria !== 'todas') {\n      query = query.eq('categoria', categoria)\n    }\n\n    if (aprovacao === 'pendentes') {\n      query = query.eq('aprovada', false)\n    } else if (aprovacao === 'aprovadas') {\n      query = query.eq('aprovada', true)\n    }\n\n    const { data: lojas, error } = await query\n\n    if (error) {\n      return NextResponse.json({ error: error.message }, { status: 500 })\n    }\n\n    const stats = {\n      total: lojas?.length || 0,\n      aprovadas: lojas?.filter(l => l.aprovada).length || 0,\n      pendentes: lojas?.filter(l => !l.aprovada).length || 0,\n      abertas: lojas?.filter(l => l.aberta).length || 0,\n    }\n\n    return NextResponse.json({ lojas, stats })\n  } catch (error: any) {\n    return NextResponse.json({ error: error.message }, { status: 500 })\n  }\n}\n\nexport async function PATCH(request: NextRequest) {\n  try {\n    const supabase = await createClient()\n    \n    const { data: { user } } = await supabase.auth.getUser()\n    \n    if (!user) {\n      return NextResponse.json({ error: 'Não autenticado' }, { status: 401 })\n    }\n\n    const { data: perfil } = await supabase\n      .from('perfis')\n      .select('*')\n      .eq('user_id', user.id)\n      .single()\n\n    if (!perfil || perfil.tipo !== 'admin') {\n      return NextResponse.json({ error: 'Acesso negado' }, { status: 403 })\n    }\n\n    const body = await request.json()\n    const { loja_id, ...updates } = body\n\n    if (!loja_id) {\n      return NextResponse.json({ error: 'loja_id é obrigatório' }, { status: 400 })\n    }\n\n    const { data: lojaAntes } = await supabase\n      .from('lojas')\n      .select('*')\n      .eq('id', loja_id)\n      .single()\n\n    const { data: lojaAtualizada, error } = await supabase\n      .from('lojas')\n      .update(updates)\n      .eq('id', loja_id)\n      .select()\n      .single()\n\n    if (error) {\n      return NextResponse.json({ error: error.message }, { status: 500 })\n    }\n\n    await supabase\n      .from('auditoria')\n      .insert({\n        usuario_id: perfil.id,\n        usuario_email: perfil.email,\n        usuario_nome: perfil.nome_completo,\n        acao: 'ATUALIZAR_LOJA',\n        entidade: 'lojas',\n        entidade_id: loja_id,\n        dados_anteriores: lojaAntes,\n        dados_novos: updates,\n      })\n\n    return NextResponse.json({ loja: lojaAtualizada })\n  } catch (error: any) {\n    return NextResponse.json({ error: error.message }, { status: 500 })\n  }\n}\n","size_bytes":3584},"pedai-nextjs/app/api/admin/lojas/aprovar/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { createClient } from '@/lib/supabase/server'\n\nexport async function POST(request: NextRequest) {\n  try {\n    const supabase = await createClient()\n    \n    const { data: { user } } = await supabase.auth.getUser()\n    \n    if (!user) {\n      return NextResponse.json({ error: 'Não autenticado' }, { status: 401 })\n    }\n\n    const { data: perfil } = await supabase\n      .from('perfis')\n      .select('*')\n      .eq('user_id', user.id)\n      .single()\n\n    if (!perfil || perfil.tipo !== 'admin') {\n      return NextResponse.json({ error: 'Acesso negado' }, { status: 403 })\n    }\n\n    const body = await request.json()\n    const { loja_id, aprovada } = body\n\n    if (!loja_id || aprovada === undefined) {\n      return NextResponse.json({ \n        error: 'loja_id e aprovada são obrigatórios' \n      }, { status: 400 })\n    }\n\n    const updates: any = {\n      aprovada,\n      aprovada_em: new Date().toISOString(),\n      aprovada_por: perfil.id,\n    }\n\n    const { data: loja, error } = await supabase\n      .from('lojas')\n      .update(updates)\n      .eq('id', loja_id)\n      .select()\n      .single()\n\n    if (error) {\n      return NextResponse.json({ error: error.message }, { status: 500 })\n    }\n\n    await supabase\n      .from('auditoria')\n      .insert({\n        usuario_id: perfil.id,\n        usuario_email: perfil.email,\n        usuario_nome: perfil.nome_completo,\n        acao: aprovada ? 'APROVAR_LOJA' : 'REPROVAR_LOJA',\n        entidade: 'lojas',\n        entidade_id: loja_id,\n        dados_novos: updates,\n      })\n\n    return NextResponse.json({ \n      loja,\n      message: aprovada ? 'Loja aprovada com sucesso' : 'Loja reprovada' \n    })\n  } catch (error: any) {\n    return NextResponse.json({ error: error.message }, { status: 500 })\n  }\n}\n","size_bytes":1824},"pedai-nextjs/app/api/admin/financeiro/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { createClient } from '@/lib/supabase/server'\n\nexport async function GET(request: NextRequest) {\n  try {\n    const supabase = await createClient()\n    \n    const { data: { user } } = await supabase.auth.getUser()\n    \n    if (!user) {\n      return NextResponse.json({ error: 'Não autenticado' }, { status: 401 })\n    }\n\n    const { data: perfil } = await supabase\n      .from('perfis')\n      .select('tipo')\n      .eq('user_id', user.id)\n      .single()\n\n    if (!perfil || perfil.tipo !== 'admin') {\n      return NextResponse.json({ error: 'Acesso negado' }, { status: 403 })\n    }\n\n    const { searchParams } = new URL(request.url)\n    const loja_id = searchParams.get('loja_id')\n    const status = searchParams.get('status')\n\n    let query = supabase\n      .from('repasses_financeiros')\n      .select(`\n        *,\n        loja:lojas!repasses_financeiros_loja_id_fkey(id, nome_loja, municipio)\n      `)\n      .order('created_at', { ascending: false })\n\n    if (loja_id) {\n      query = query.eq('loja_id', parseInt(loja_id))\n    }\n\n    if (status && status !== 'todos') {\n      query = query.eq('status', status)\n    }\n\n    const { data: repasses, error } = await query\n\n    if (error) {\n      return NextResponse.json({ error: error.message }, { status: 500 })\n    }\n\n    const stats = {\n      receita_total: repasses?.reduce((sum, r) => sum + parseFloat(r.valor_bruto || '0'), 0) || 0,\n      comissoes_total: repasses?.reduce((sum, r) => sum + parseFloat(r.comissao_plataforma || '0'), 0) || 0,\n      repasses_pendentes: repasses?.filter(r => r.status === 'pendente').length || 0,\n      repasses_pagos: repasses?.filter(r => r.status === 'pago').length || 0,\n    }\n\n    const { data: lojas } = await supabase\n      .from('lojas')\n      .select('id, nome_loja')\n      .eq('aprovada', true)\n      .order('nome_loja')\n\n    return NextResponse.json({ repasses, stats, lojas })\n  } catch (error: any) {\n    return NextResponse.json({ error: error.message }, { status: 500 })\n  }\n}\n","size_bytes":2044},"pedai-nextjs/app/admin/usuarios/page.tsx":{"content":"import AdminLayout from '@/components/admin/AdminLayout'\nimport AdminUsuarios from '@/components/admin/usuarios/AdminUsuarios'\n\nexport default function UsuariosPage() {\n  return (\n    <AdminLayout currentPage=\"usuarios\">\n      <AdminUsuarios />\n    </AdminLayout>\n  )\n}\n","size_bytes":270},"pedai-nextjs/app/api/admin/usuarios/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { createClient } from '@/lib/supabase/server'\n\nexport async function GET(request: NextRequest) {\n  try {\n    const supabase = await createClient()\n    \n    const { data: { user } } = await supabase.auth.getUser()\n    \n    if (!user) {\n      return NextResponse.json({ error: 'Não autenticado' }, { status: 401 })\n    }\n\n    const { data: perfil } = await supabase\n      .from('perfis')\n      .select('tipo')\n      .eq('user_id', user.id)\n      .single()\n\n    if (!perfil || perfil.tipo !== 'admin') {\n      return NextResponse.json({ error: 'Acesso negado' }, { status: 403 })\n    }\n\n    const { searchParams } = new URL(request.url)\n    const tipo = searchParams.get('tipo')\n    const status = searchParams.get('status')\n    const busca = searchParams.get('busca')\n\n    let query = supabase\n      .from('perfis')\n      .select('*')\n      .order('created_at', { ascending: false })\n\n    if (tipo && tipo !== 'todos') {\n      query = query.eq('tipo', tipo)\n    }\n\n    if (status === 'bloqueados') {\n      query = query.eq('bloqueado', true)\n    } else if (status === 'ativos') {\n      query = query.eq('bloqueado', false)\n    }\n\n    if (busca) {\n      query = query.or(`nome_completo.ilike.%${busca}%,email.ilike.%${busca}%`)\n    }\n\n    const { data: usuarios, error } = await query\n\n    if (error) {\n      return NextResponse.json({ error: error.message }, { status: 500 })\n    }\n\n    const stats = {\n      total: usuarios?.length || 0,\n      ativos: usuarios?.filter(u => !u.bloqueado).length || 0,\n      bloqueados: usuarios?.filter(u => u.bloqueado).length || 0,\n      clientes: usuarios?.filter(u => u.tipo === 'cliente').length || 0,\n      lojas: usuarios?.filter(u => u.tipo === 'loja').length || 0,\n      entregadores: usuarios?.filter(u => u.tipo === 'entregador').length || 0,\n    }\n\n    return NextResponse.json({ usuarios, stats })\n  } catch (error: any) {\n    return NextResponse.json({ error: error.message }, { status: 500 })\n  }\n}\n\nexport async function PATCH(request: NextRequest) {\n  try {\n    const supabase = await createClient()\n    \n    const { data: { user } } = await supabase.auth.getUser()\n    \n    if (!user) {\n      return NextResponse.json({ error: 'Não autenticado' }, { status: 401 })\n    }\n\n    const { data: perfil } = await supabase\n      .from('perfis')\n      .select('*')\n      .eq('user_id', user.id)\n      .single()\n\n    if (!perfil || perfil.tipo !== 'admin') {\n      return NextResponse.json({ error: 'Acesso negado' }, { status: 403 })\n    }\n\n    const body = await request.json()\n    const { usuario_id, bloqueado, bloqueado_motivo } = body\n\n    if (!usuario_id) {\n      return NextResponse.json({ error: 'usuario_id é obrigatório' }, { status: 400 })\n    }\n\n    const updates: any = { bloqueado }\n    \n    if (bloqueado) {\n      updates.bloqueado_motivo = bloqueado_motivo || 'Sem motivo informado'\n      updates.bloqueado_em = new Date().toISOString()\n    } else {\n      updates.bloqueado_motivo = null\n      updates.bloqueado_em = null\n    }\n\n    const { data: updated, error } = await supabase\n      .from('perfis')\n      .update(updates)\n      .eq('id', usuario_id)\n      .select()\n      .single()\n\n    if (error) {\n      return NextResponse.json({ error: error.message }, { status: 500 })\n    }\n\n    const { error: auditError } = await supabase\n      .from('auditoria')\n      .insert({\n        usuario_id: perfil.id,\n        usuario_email: perfil.email,\n        usuario_nome: perfil.nome_completo,\n        acao: bloqueado ? 'BLOQUEAR_USUARIO' : 'DESBLOQUEAR_USUARIO',\n        entidade: 'perfis',\n        entidade_id: usuario_id,\n        dados_novos: updates,\n      })\n\n    return NextResponse.json({ usuario: updated })\n  } catch (error: any) {\n    return NextResponse.json({ error: error.message }, { status: 500 })\n  }\n}\n","size_bytes":3837},"pedai-nextjs/components/admin/configuracoes/AdminConfiguracoes.tsx":{"content":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { createClient } from '@/lib/supabase/client'\n\ninterface ConfigGeral {\n  taxa_entrega_padrao: number\n  comissao_plataforma_padrao: number\n  pedido_minimo_padrao: number\n}\n\ninterface ConfigMunicipio {\n  municipio: string\n  taxa_entrega: number | null\n  comissao_plataforma: number | null\n  pedido_minimo: number | null\n  raio_entrega_km: number | null\n}\n\ninterface Cupom {\n  id: number\n  codigo: string\n  tipo: 'percentual' | 'valor_fixo'\n  valor: number\n  minimo_pedido: number | null\n  validade: string | null\n  ativo: boolean\n  municipio: string | null\n}\n\nexport default function AdminConfiguracoes() {\n  const [activeTab, setActiveTab] = useState<'geral' | 'municipios' | 'cupons'>('geral')\n  const [loading, setLoading] = useState(true)\n  \n  const [configGeral, setConfigGeral] = useState<ConfigGeral>({\n    taxa_entrega_padrao: 5.00,\n    comissao_plataforma_padrao: 10,\n    pedido_minimo_padrao: 15.00\n  })\n\n  const [configsMunicipio, setConfigsMunicipio] = useState<ConfigMunicipio[]>([\n    { municipio: 'Alagoa Nova', taxa_entrega: null, comissao_plataforma: null, pedido_minimo: null, raio_entrega_km: null },\n    { municipio: 'Esperança', taxa_entrega: null, comissao_plataforma: null, pedido_minimo: null, raio_entrega_km: null },\n    { municipio: 'Lagoa Seca', taxa_entrega: null, comissao_plataforma: null, pedido_minimo: null, raio_entrega_km: null }\n  ])\n\n  const [cupons, setCupons] = useState<Cupom[]>([])\n  const [showCupomModal, setShowCupomModal] = useState(false)\n  const [editingCupom, setEditingCupom] = useState<Cupom | null>(null)\n  const [cupomForm, setCupomForm] = useState({\n    codigo: '',\n    tipo: 'percentual' as 'percentual' | 'valor_fixo',\n    valor: '',\n    minimo_pedido: '',\n    validade: '',\n    municipio: ''\n  })\n\n  useEffect(() => {\n    loadConfiguracoes()\n  }, [])\n\n  const loadConfiguracoes = async () => {\n    setCupons([\n      {\n        id: 1,\n        codigo: 'BEMVINDO10',\n        tipo: 'percentual',\n        valor: 10,\n        minimo_pedido: 20,\n        validade: '2025-12-31',\n        ativo: true,\n        municipio: null\n      },\n      {\n        id: 2,\n        codigo: 'FRETE5',\n        tipo: 'valor_fixo',\n        valor: 5,\n        minimo_pedido: null,\n        validade: null,\n        ativo: true,\n        municipio: 'Alagoa Nova'\n      }\n    ])\n    \n    setLoading(false)\n  }\n\n  const handleSaveGeral = () => {\n    alert('Configurações gerais salvas com sucesso!')\n  }\n\n  const handleSaveMunicipio = (municipio: string) => {\n    alert(`Configurações de ${municipio} salvas com sucesso!`)\n  }\n\n  const handleCreateCupom = () => {\n    setEditingCupom(null)\n    setCupomForm({\n      codigo: '',\n      tipo: 'percentual',\n      valor: '',\n      minimo_pedido: '',\n      validade: '',\n      municipio: ''\n    })\n    setShowCupomModal(true)\n  }\n\n  const handleEditCupom = (cupom: Cupom) => {\n    setEditingCupom(cupom)\n    setCupomForm({\n      codigo: cupom.codigo,\n      tipo: cupom.tipo,\n      valor: cupom.valor.toString(),\n      minimo_pedido: cupom.minimo_pedido?.toString() || '',\n      validade: cupom.validade || '',\n      municipio: cupom.municipio || ''\n    })\n    setShowCupomModal(true)\n  }\n\n  const handleSaveCupom = () => {\n    if (!cupomForm.codigo || !cupomForm.valor) {\n      alert('Preencha todos os campos obrigatórios!')\n      return\n    }\n\n    if (editingCupom) {\n      alert(`Cupom ${cupomForm.codigo} atualizado com sucesso!`)\n    } else {\n      alert(`Cupom ${cupomForm.codigo} criado com sucesso!`)\n    }\n    \n    setShowCupomModal(false)\n    loadConfiguracoes()\n  }\n\n  const handleToggleCupom = (cupom: Cupom) => {\n    alert(`Cupom ${cupom.codigo} ${cupom.ativo ? 'desativado' : 'ativado'} com sucesso!`)\n    loadConfiguracoes()\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500\"></div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Tabs */}\n      <div className=\"bg-gray-800 rounded-lg shadow-lg p-2\">\n        <div className=\"flex space-x-2\">\n          <button\n            onClick={() => setActiveTab('geral')}\n            className={`flex-1 px-4 py-3 rounded-lg font-medium transition ${\n              activeTab === 'geral'\n                ? 'bg-blue-600 text-white'\n                : 'text-gray-400 hover:text-white hover:bg-gray-700'\n            }`}\n          >\n            Configurações Gerais\n          </button>\n          <button\n            onClick={() => setActiveTab('municipios')}\n            className={`flex-1 px-4 py-3 rounded-lg font-medium transition ${\n              activeTab === 'municipios'\n                ? 'bg-blue-600 text-white'\n                : 'text-gray-400 hover:text-white hover:bg-gray-700'\n            }`}\n          >\n            Por Município\n          </button>\n          <button\n            onClick={() => setActiveTab('cupons')}\n            className={`flex-1 px-4 py-3 rounded-lg font-medium transition ${\n              activeTab === 'cupons'\n                ? 'bg-blue-600 text-white'\n                : 'text-gray-400 hover:text-white hover:bg-gray-700'\n            }`}\n          >\n            Cupons de Desconto\n          </button>\n        </div>\n      </div>\n\n      {/* Tab: Geral */}\n      {activeTab === 'geral' && (\n        <div className=\"bg-gray-800 rounded-lg shadow-lg p-6\">\n          <h3 className=\"text-xl font-bold text-white mb-6\">Configurações Padrão da Plataforma</h3>\n          \n          <div className=\"space-y-6 max-w-2xl\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                Taxa de Entrega Padrão (R$)\n              </label>\n              <input\n                type=\"number\"\n                step=\"0.01\"\n                value={configGeral.taxa_entrega_padrao}\n                onChange={(e) => setConfigGeral({ ...configGeral, taxa_entrega_padrao: parseFloat(e.target.value) })}\n                className=\"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              />\n              <p className=\"text-xs text-gray-400 mt-1\">\n                Valor padrão cobrado para entregas quando não especificado pela loja\n              </p>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                Comissão da Plataforma Padrão (%)\n              </label>\n              <input\n                type=\"number\"\n                step=\"0.1\"\n                value={configGeral.comissao_plataforma_padrao}\n                onChange={(e) => setConfigGeral({ ...configGeral, comissao_plataforma_padrao: parseFloat(e.target.value) })}\n                className=\"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              />\n              <p className=\"text-xs text-gray-400 mt-1\">\n                Percentual cobrado sobre cada pedido quando não especificado pela loja\n              </p>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                Pedido Mínimo Padrão (R$)\n              </label>\n              <input\n                type=\"number\"\n                step=\"0.01\"\n                value={configGeral.pedido_minimo_padrao}\n                onChange={(e) => setConfigGeral({ ...configGeral, pedido_minimo_padrao: parseFloat(e.target.value) })}\n                className=\"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              />\n              <p className=\"text-xs text-gray-400 mt-1\">\n                Valor mínimo para realizar pedidos quando não especificado pela loja\n              </p>\n            </div>\n\n            <button\n              onClick={handleSaveGeral}\n              className=\"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition font-medium\"\n            >\n              Salvar Configurações Gerais\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* Tab: Municípios */}\n      {activeTab === 'municipios' && (\n        <div className=\"space-y-6\">\n          <div className=\"bg-gray-800 rounded-lg shadow-lg p-6\">\n            <h3 className=\"text-xl font-bold text-white mb-2\">Configurações Por Município</h3>\n            <p className=\"text-sm text-gray-400 mb-6\">\n              Configure valores específicos para cada município. Deixe vazio para usar os valores padrão.\n            </p>\n          </div>\n\n          {configsMunicipio.map((config, index) => (\n            <div key={config.municipio} className=\"bg-gray-800 rounded-lg shadow-lg p-6\">\n              <h4 className=\"text-lg font-bold text-white mb-4\">{config.municipio}</h4>\n              \n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                    Taxa de Entrega (R$)\n                  </label>\n                  <input\n                    type=\"number\"\n                    step=\"0.01\"\n                    value={config.taxa_entrega || ''}\n                    onChange={(e) => {\n                      const newConfigs = [...configsMunicipio]\n                      newConfigs[index].taxa_entrega = e.target.value ? parseFloat(e.target.value) : null\n                      setConfigsMunicipio(newConfigs)\n                    }}\n                    placeholder=\"Usar padrão\"\n                    className=\"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                    Comissão (%)\n                  </label>\n                  <input\n                    type=\"number\"\n                    step=\"0.1\"\n                    value={config.comissao_plataforma || ''}\n                    onChange={(e) => {\n                      const newConfigs = [...configsMunicipio]\n                      newConfigs[index].comissao_plataforma = e.target.value ? parseFloat(e.target.value) : null\n                      setConfigsMunicipio(newConfigs)\n                    }}\n                    placeholder=\"Usar padrão\"\n                    className=\"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                    Pedido Mínimo (R$)\n                  </label>\n                  <input\n                    type=\"number\"\n                    step=\"0.01\"\n                    value={config.pedido_minimo || ''}\n                    onChange={(e) => {\n                      const newConfigs = [...configsMunicipio]\n                      newConfigs[index].pedido_minimo = e.target.value ? parseFloat(e.target.value) : null\n                      setConfigsMunicipio(newConfigs)\n                    }}\n                    placeholder=\"Usar padrão\"\n                    className=\"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                    Raio de Entrega (km)\n                  </label>\n                  <input\n                    type=\"number\"\n                    step=\"0.1\"\n                    value={config.raio_entrega_km || ''}\n                    onChange={(e) => {\n                      const newConfigs = [...configsMunicipio]\n                      newConfigs[index].raio_entrega_km = e.target.value ? parseFloat(e.target.value) : null\n                      setConfigsMunicipio(newConfigs)\n                    }}\n                    placeholder=\"Sem limite\"\n                    className=\"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  />\n                </div>\n              </div>\n\n              <button\n                onClick={() => handleSaveMunicipio(config.municipio)}\n                className=\"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition font-medium\"\n              >\n                Salvar {config.municipio}\n              </button>\n            </div>\n          ))}\n        </div>\n      )}\n\n      {/* Tab: Cupons */}\n      {activeTab === 'cupons' && (\n        <div className=\"space-y-6\">\n          <div className=\"bg-gray-800 rounded-lg shadow-lg p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <h3 className=\"text-xl font-bold text-white mb-2\">Cupons de Desconto</h3>\n                <p className=\"text-sm text-gray-400\">\n                  Gerencie os cupons promocionais da plataforma\n                </p>\n              </div>\n              <button\n                onClick={handleCreateCupom}\n                className=\"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition font-medium flex items-center space-x-2\"\n              >\n                <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\n                </svg>\n                <span>Criar Cupom</span>\n              </button>\n            </div>\n          </div>\n\n          <div className=\"bg-gray-800 rounded-lg shadow-lg overflow-hidden\">\n            <table className=\"w-full\">\n              <thead className=\"bg-gray-700\">\n                <tr>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider\">Código</th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider\">Tipo</th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider\">Desconto</th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider\">Mínimo</th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider\">Validade</th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider\">Município</th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider\">Status</th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider\">Ações</th>\n                </tr>\n              </thead>\n              <tbody className=\"divide-y divide-gray-700\">\n                {cupons.map((cupom) => (\n                  <tr key={cupom.id} className=\"hover:bg-gray-700 transition\">\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\n                      <div className=\"text-sm font-bold text-white\">{cupom.codigo}</div>\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\n                      <div className=\"text-sm text-gray-300\">\n                        {cupom.tipo === 'percentual' ? 'Percentual' : 'Valor Fixo'}\n                      </div>\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\n                      <div className=\"text-sm font-semibold text-green-400\">\n                        {cupom.tipo === 'percentual' ? `${cupom.valor}%` : `R$ ${cupom.valor.toFixed(2)}`}\n                      </div>\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\n                      <div className=\"text-sm text-gray-300\">\n                        {cupom.minimo_pedido ? `R$ ${cupom.minimo_pedido.toFixed(2)}` : 'Sem mínimo'}\n                      </div>\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\n                      <div className=\"text-sm text-gray-300\">\n                        {cupom.validade ? new Date(cupom.validade).toLocaleDateString('pt-BR') : 'Sem validade'}\n                      </div>\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\n                      <div className=\"text-sm text-gray-300\">\n                        {cupom.municipio || 'Todos'}\n                      </div>\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\n                      <span className={`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${\n                        cupom.ativo ? 'bg-green-600 text-white' : 'bg-red-600 text-white'\n                      }`}>\n                        {cupom.ativo ? 'Ativo' : 'Inativo'}\n                      </span>\n                    </td>\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm\">\n                      <div className=\"flex space-x-2\">\n                        <button\n                          onClick={() => handleEditCupom(cupom)}\n                          className=\"bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-1 rounded transition\"\n                        >\n                          Editar\n                        </button>\n                        <button\n                          onClick={() => handleToggleCupom(cupom)}\n                          className={`${\n                            cupom.ativo \n                              ? 'bg-red-600 hover:bg-red-700' \n                              : 'bg-green-600 hover:bg-green-700'\n                          } text-white px-3 py-1 rounded transition`}\n                        >\n                          {cupom.ativo ? 'Desativar' : 'Ativar'}\n                        </button>\n                      </div>\n                    </td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          </div>\n\n          {cupons.length === 0 && (\n            <div className=\"bg-gray-800 rounded-lg shadow-lg p-12 text-center\">\n              <p className=\"text-gray-400 text-lg\">Nenhum cupom cadastrado ainda.</p>\n            </div>\n          )}\n        </div>\n      )}\n\n      {/* Cupom Modal */}\n      {showCupomModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n          <div className=\"bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto\">\n            <h3 className=\"text-xl font-bold text-white mb-4\">\n              {editingCupom ? 'Editar Cupom' : 'Criar Novo Cupom'}\n            </h3>\n            \n            <div className=\"space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                  Código do Cupom *\n                </label>\n                <input\n                  type=\"text\"\n                  value={cupomForm.codigo}\n                  onChange={(e) => setCupomForm({ ...cupomForm, codigo: e.target.value.toUpperCase() })}\n                  className=\"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  placeholder=\"Ex: BEMVINDO10\"\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                  Tipo de Desconto *\n                </label>\n                <select\n                  value={cupomForm.tipo}\n                  onChange={(e) => setCupomForm({ ...cupomForm, tipo: e.target.value as 'percentual' | 'valor_fixo' })}\n                  className=\"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                >\n                  <option value=\"percentual\">Percentual (%)</option>\n                  <option value=\"valor_fixo\">Valor Fixo (R$)</option>\n                </select>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                  Valor do Desconto *\n                </label>\n                <input\n                  type=\"number\"\n                  step=\"0.01\"\n                  value={cupomForm.valor}\n                  onChange={(e) => setCupomForm({ ...cupomForm, valor: e.target.value })}\n                  className=\"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  placeholder={cupomForm.tipo === 'percentual' ? 'Ex: 10' : 'Ex: 5.00'}\n                />\n                <p className=\"text-xs text-gray-400 mt-1\">\n                  {cupomForm.tipo === 'percentual' ? 'Percentual de desconto' : 'Valor em reais'}\n                </p>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                  Valor Mínimo do Pedido (R$)\n                </label>\n                <input\n                  type=\"number\"\n                  step=\"0.01\"\n                  value={cupomForm.minimo_pedido}\n                  onChange={(e) => setCupomForm({ ...cupomForm, minimo_pedido: e.target.value })}\n                  className=\"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  placeholder=\"Opcional\"\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                  Data de Validade\n                </label>\n                <input\n                  type=\"date\"\n                  value={cupomForm.validade}\n                  onChange={(e) => setCupomForm({ ...cupomForm, validade: e.target.value })}\n                  className=\"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-300 mb-2\">\n                  Município Específico\n                </label>\n                <select\n                  value={cupomForm.municipio}\n                  onChange={(e) => setCupomForm({ ...cupomForm, municipio: e.target.value })}\n                  className=\"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                >\n                  <option value=\"\">Todos os municípios</option>\n                  <option value=\"Alagoa Nova\">Alagoa Nova</option>\n                  <option value=\"Esperança\">Esperança</option>\n                  <option value=\"Lagoa Seca\">Lagoa Seca</option>\n                </select>\n              </div>\n            </div>\n            \n            <div className=\"flex space-x-3 mt-6\">\n              <button\n                onClick={handleSaveCupom}\n                className=\"flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition font-medium\"\n              >\n                {editingCupom ? 'Salvar Alterações' : 'Criar Cupom'}\n              </button>\n              <button\n                onClick={() => setShowCupomModal(false)}\n                className=\"flex-1 bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition font-medium\"\n              >\n                Cancelar\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n","size_bytes":24024},"pedai-nextjs/app/api/admin/cupons/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { createClient } from '@/lib/supabase/server'\n\nexport async function GET(request: NextRequest) {\n  try {\n    const supabase = await createClient()\n    \n    const { data: { user } } = await supabase.auth.getUser()\n    \n    if (!user) {\n      return NextResponse.json({ error: 'Não autenticado' }, { status: 401 })\n    }\n\n    const { data: perfil } = await supabase\n      .from('perfis')\n      .select('tipo')\n      .eq('user_id', user.id)\n      .single()\n\n    if (!perfil || perfil.tipo !== 'admin') {\n      return NextResponse.json({ error: 'Acesso negado' }, { status: 403 })\n    }\n\n    const { data: cupons, error } = await supabase\n      .from('cupons')\n      .select('*')\n      .order('created_at', { ascending: false })\n\n    if (error) {\n      return NextResponse.json({ error: error.message }, { status: 500 })\n    }\n\n    return NextResponse.json({ cupons })\n  } catch (error: any) {\n    return NextResponse.json({ error: error.message }, { status: 500 })\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const supabase = await createClient()\n    \n    const { data: { user } } = await supabase.auth.getUser()\n    \n    if (!user) {\n      return NextResponse.json({ error: 'Não autenticado' }, { status: 401 })\n    }\n\n    const { data: perfil } = await supabase\n      .from('perfis')\n      .select('*')\n      .eq('user_id', user.id)\n      .single()\n\n    if (!perfil || perfil.tipo !== 'admin') {\n      return NextResponse.json({ error: 'Acesso negado' }, { status: 403 })\n    }\n\n    const body = await request.json()\n    const cupomData = {\n      ...body,\n      criado_por: perfil.id,\n    }\n\n    const { data: cupom, error } = await supabase\n      .from('cupons')\n      .insert(cupomData)\n      .select()\n      .single()\n\n    if (error) {\n      return NextResponse.json({ error: error.message }, { status: 500 })\n    }\n\n    await supabase\n      .from('auditoria')\n      .insert({\n        usuario_id: perfil.id,\n        usuario_email: perfil.email,\n        usuario_nome: perfil.nome_completo,\n        acao: 'CRIAR_CUPOM',\n        entidade: 'cupons',\n        entidade_id: cupom.id,\n        dados_novos: cupom,\n      })\n\n    return NextResponse.json({ cupom, message: 'Cupom criado com sucesso' })\n  } catch (error: any) {\n    return NextResponse.json({ error: error.message }, { status: 500 })\n  }\n}\n\nexport async function PATCH(request: NextRequest) {\n  try {\n    const supabase = await createClient()\n    \n    const { data: { user } } = await supabase.auth.getUser()\n    \n    if (!user) {\n      return NextResponse.json({ error: 'Não autenticado' }, { status: 401 })\n    }\n\n    const { data: perfil } = await supabase\n      .from('perfis')\n      .select('*')\n      .eq('user_id', user.id)\n      .single()\n\n    if (!perfil || perfil.tipo !== 'admin') {\n      return NextResponse.json({ error: 'Acesso negado' }, { status: 403 })\n    }\n\n    const body = await request.json()\n    const { cupom_id, ...updates } = body\n\n    if (!cupom_id) {\n      return NextResponse.json({ error: 'cupom_id é obrigatório' }, { status: 400 })\n    }\n\n    const { data: cupom, error } = await supabase\n      .from('cupons')\n      .update(updates)\n      .eq('id', cupom_id)\n      .select()\n      .single()\n\n    if (error) {\n      return NextResponse.json({ error: error.message }, { status: 500 })\n    }\n\n    await supabase\n      .from('auditoria')\n      .insert({\n        usuario_id: perfil.id,\n        usuario_email: perfil.email,\n        usuario_nome: perfil.nome_completo,\n        acao: 'ATUALIZAR_CUPOM',\n        entidade: 'cupons',\n        entidade_id: cupom_id,\n        dados_novos: updates,\n      })\n\n    return NextResponse.json({ cupom, message: 'Cupom atualizado com sucesso' })\n  } catch (error: any) {\n    return NextResponse.json({ error: error.message }, { status: 500 })\n  }\n}\n","size_bytes":3862},"pedai-nextjs/app/admin/lojas/page.tsx":{"content":"import AdminLayout from '@/components/admin/AdminLayout'\nimport AdminLojas from '@/components/admin/lojas/AdminLojas'\n\nexport default function LojasPage() {\n  return (\n    <AdminLayout currentPage=\"lojas\">\n      <AdminLojas />\n    </AdminLayout>\n  )\n}\n","size_bytes":252},"pedai-nextjs/components/admin/financeiro/AdminFinanceiro.tsx":{"content":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { createClient } from '@/lib/supabase/client'\n\ninterface Repasse {\n  id: number\n  loja_id: number\n  loja_nome: string\n  periodo_inicio: string\n  periodo_fim: string\n  valor_bruto: number\n  comissao: number\n  valor_liquido: number\n  status: 'pendente' | 'processando' | 'pago'\n}\n\ninterface FinancialStats {\n  receitaTotal: number\n  comissoesTotais: number\n  repassesPendentes: number\n  pedidosTotal: number\n}\n\nexport default function AdminFinanceiro() {\n  const [stats, setStats] = useState<FinancialStats>({\n    receitaTotal: 0,\n    comissoesTotais: 0,\n    repassesPendentes: 0,\n    pedidosTotal: 0\n  })\n  const [repasses, setRepasses] = useState<Repasse[]>([])\n  const [filteredRepasses, setFilteredRepasses] = useState<Repasse[]>([])\n  const [loading, setLoading] = useState(true)\n  \n  const [filterLoja, setFilterLoja] = useState('todos')\n  const [filterStatus, setFilterStatus] = useState('todos')\n  const [filterPeriodo, setFilterPeriodo] = useState('todos')\n  \n  const [lojas, setLojas] = useState<Array<{ id: number; nome_loja: string }>>([])\n  const [showProcessModal, setShowProcessModal] = useState(false)\n  const [selectedRepasse, setSelectedRepasse] = useState<Repasse | null>(null)\n\n  useEffect(() => {\n    loadData()\n  }, [])\n\n  useEffect(() => {\n    applyFilters()\n  }, [repasses, filterLoja, filterStatus, filterPeriodo])\n\n  const loadData = async () => {\n    const supabase = createClient()\n    \n    const { data: lojasData } = await supabase\n      .from('lojas')\n      .select('id, nome_loja')\n      .order('nome_loja')\n    \n    if (lojasData) {\n      setLojas(lojasData)\n    }\n\n    const { data: pedidos } = await supabase\n      .from('pedidos')\n      .select('total, loja_id, status, created_at')\n      .not('status', 'eq', 'cancelado')\n\n    let receitaTotal = 0\n    let comissoesTotais = 0\n    const repassesMap = new Map<number, { valor_bruto: number; pedidos: number }>()\n\n    if (pedidos) {\n      pedidos.forEach(pedido => {\n        receitaTotal += pedido.total || 0\n        const comissao = (pedido.total || 0) * 0.10\n        comissoesTotais += comissao\n\n        if (!repassesMap.has(pedido.loja_id)) {\n          repassesMap.set(pedido.loja_id, { valor_bruto: 0, pedidos: 0 })\n        }\n        const current = repassesMap.get(pedido.loja_id)!\n        current.valor_bruto += pedido.total || 0\n        current.pedidos += 1\n      })\n    }\n\n    const repassesData: Repasse[] = []\n    let repassesPendentesTotal = 0\n\n    repassesMap.forEach((data, lojaId) => {\n      const loja = lojasData?.find(l => l.id === lojaId)\n      if (loja) {\n        const comissao = data.valor_bruto * 0.10\n        const valor_liquido = data.valor_bruto - comissao\n        \n        repassesData.push({\n          id: lojaId,\n          loja_id: lojaId,\n          loja_nome: loja.nome_loja,\n          periodo_inicio: '2025-01-01',\n          periodo_fim: '2025-01-31',\n          valor_bruto: data.valor_bruto,\n          comissao: comissao,\n          valor_liquido: valor_liquido,\n          status: 'pendente'\n        })\n        \n        repassesPendentesTotal += valor_liquido\n      }\n    })\n\n    setStats({\n      receitaTotal,\n      comissoesTotais,\n      repassesPendentes: repassesPendentesTotal,\n      pedidosTotal: pedidos?.length || 0\n    })\n\n    setRepasses(repassesData)\n    setLoading(false)\n  }\n\n  const applyFilters = () => {\n    let filtered = [...repasses]\n    \n    if (filterLoja !== 'todos') {\n      filtered = filtered.filter(r => r.loja_id.toString() === filterLoja)\n    }\n    \n    if (filterStatus !== 'todos') {\n      filtered = filtered.filter(r => r.status === filterStatus)\n    }\n    \n    setFilteredRepasses(filtered)\n  }\n\n  const handleProcessar = (repasse: Repasse) => {\n    setSelectedRepasse(repasse)\n    setShowProcessModal(true)\n  }\n\n  const confirmProcessar = async () => {\n    if (!selectedRepasse) return\n    \n    alert(`Pagamento processado para ${selectedRepasse.loja_nome}: R$ ${selectedRepasse.valor_liquido.toFixed(2)}`)\n    \n    setShowProcessModal(false)\n    setSelectedRepasse(null)\n  }\n\n  const handleGerarNovoPeriodo = () => {\n    alert('Função de gerar novo período de repasse será implementada.')\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500\"></div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* KPI Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n        <div className=\"bg-gradient-to-br from-blue-600 to-blue-700 rounded-lg shadow-lg p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm text-blue-100\">Receita Total</p>\n              <p className=\"text-3xl font-bold text-white mt-2\">\n                R$ {stats.receitaTotal.toFixed(2)}\n              </p>\n            </div>\n            <div className=\"bg-blue-500 bg-opacity-50 p-3 rounded-full\">\n              <svg className=\"w-8 h-8 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n              </svg>\n            </div>\n          </div>\n          <p className=\"text-xs text-blue-100 mt-3\">{stats.pedidosTotal} pedidos totais</p>\n        </div>\n\n        <div className=\"bg-gradient-to-br from-green-600 to-green-700 rounded-lg shadow-lg p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm text-green-100\">Comissões Totais</p>\n              <p className=\"text-3xl font-bold text-white mt-2\">\n                R$ {stats.comissoesTotais.toFixed(2)}\n              </p>\n            </div>\n            <div className=\"bg-green-500 bg-opacity-50 p-3 rounded-full\">\n              <svg className=\"w-8 h-8 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z\" />\n              </svg>\n            </div>\n          </div>\n          <p className=\"text-xs text-green-100 mt-3\">Média de 10% por pedido</p>\n        </div>\n\n        <div className=\"bg-gradient-to-br from-yellow-600 to-yellow-700 rounded-lg shadow-lg p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm text-yellow-100\">Repasses Pendentes</p>\n              <p className=\"text-3xl font-bold text-white mt-2\">\n                R$ {stats.repassesPendentes.toFixed(2)}\n              </p>\n            </div>\n            <div className=\"bg-yellow-500 bg-opacity-50 p-3 rounded-full\">\n              <svg className=\"w-8 h-8 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\" />\n              </svg>\n            </div>\n          </div>\n          <p className=\"text-xs text-yellow-100 mt-3\">{repasses.filter(r => r.status === 'pendente').length} lojas aguardando</p>\n        </div>\n\n        <div className=\"bg-gradient-to-br from-purple-600 to-purple-700 rounded-lg shadow-lg p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm text-purple-100\">Lojas Ativas</p>\n              <p className=\"text-3xl font-bold text-white mt-2\">\n                {lojas.length}\n              </p>\n            </div>\n            <div className=\"bg-purple-500 bg-opacity-50 p-3 rounded-full\">\n              <svg className=\"w-8 h-8 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4\" />\n              </svg>\n            </div>\n          </div>\n          <p className=\"text-xs text-purple-100 mt-3\">Lojas cadastradas</p>\n        </div>\n      </div>\n\n      {/* Filters and Actions */}\n      <div className=\"bg-gray-800 rounded-lg shadow-lg p-6\">\n        <div className=\"flex flex-col md:flex-row md:items-end gap-4\">\n          <div className=\"flex-1 grid grid-cols-1 md:grid-cols-3 gap-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-300 mb-2\">Filtrar por Loja</label>\n              <select\n                value={filterLoja}\n                onChange={(e) => setFilterLoja(e.target.value)}\n                className=\"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              >\n                <option value=\"todos\">Todas as Lojas</option>\n                {lojas.map(loja => (\n                  <option key={loja.id} value={loja.id.toString()}>{loja.nome_loja}</option>\n                ))}\n              </select>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-300 mb-2\">Status</label>\n              <select\n                value={filterStatus}\n                onChange={(e) => setFilterStatus(e.target.value)}\n                className=\"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              >\n                <option value=\"todos\">Todos</option>\n                <option value=\"pendente\">Pendentes</option>\n                <option value=\"processando\">Processando</option>\n                <option value=\"pago\">Pagos</option>\n              </select>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-300 mb-2\">Período</label>\n              <select\n                value={filterPeriodo}\n                onChange={(e) => setFilterPeriodo(e.target.value)}\n                className=\"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              >\n                <option value=\"todos\">Todos os Períodos</option>\n                <option value=\"2025-01\">Janeiro 2025</option>\n                <option value=\"2024-12\">Dezembro 2024</option>\n              </select>\n            </div>\n          </div>\n\n          <button\n            onClick={handleGerarNovoPeriodo}\n            className=\"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition font-medium flex items-center space-x-2\"\n          >\n            <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\n            </svg>\n            <span>Gerar Período</span>\n          </button>\n        </div>\n      </div>\n\n      {/* Repasses Table */}\n      <div className=\"bg-gray-800 rounded-lg shadow-lg overflow-hidden\">\n        <div className=\"overflow-x-auto\">\n          <table className=\"w-full\">\n            <thead className=\"bg-gray-700\">\n              <tr>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider\">Loja</th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider\">Período</th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider\">Valor Bruto</th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider\">Comissão (10%)</th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider\">Valor Líquido</th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider\">Status</th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider\">Ações</th>\n              </tr>\n            </thead>\n            <tbody className=\"divide-y divide-gray-700\">\n              {filteredRepasses.map((repasse) => (\n                <tr key={repasse.id} className=\"hover:bg-gray-700 transition\">\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <div className=\"text-sm font-medium text-white\">{repasse.loja_nome}</div>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <div className=\"text-sm text-gray-300\">\n                      {new Date(repasse.periodo_inicio).toLocaleDateString('pt-BR')} - {new Date(repasse.periodo_fim).toLocaleDateString('pt-BR')}\n                    </div>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <div className=\"text-sm font-semibold text-white\">R$ {repasse.valor_bruto.toFixed(2)}</div>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <div className=\"text-sm text-red-400\">- R$ {repasse.comissao.toFixed(2)}</div>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <div className=\"text-sm font-bold text-green-400\">R$ {repasse.valor_liquido.toFixed(2)}</div>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <span className={`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${\n                      repasse.status === 'pago' ? 'bg-green-600 text-white' :\n                      repasse.status === 'processando' ? 'bg-blue-600 text-white' :\n                      'bg-yellow-600 text-white'\n                    }`}>\n                      {repasse.status === 'pago' ? 'Pago' :\n                       repasse.status === 'processando' ? 'Processando' :\n                       'Pendente'}\n                    </span>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm\">\n                    {repasse.status === 'pendente' && (\n                      <button\n                        onClick={() => handleProcessar(repasse)}\n                        className=\"bg-green-600 hover:bg-green-700 text-white px-4 py-1 rounded transition\"\n                      >\n                        Processar\n                      </button>\n                    )}\n                    {repasse.status === 'processando' && (\n                      <span className=\"text-gray-400\">Em processamento...</span>\n                    )}\n                    {repasse.status === 'pago' && (\n                      <span className=\"text-green-400\">✓ Concluído</span>\n                    )}\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n      </div>\n\n      {filteredRepasses.length === 0 && (\n        <div className=\"bg-gray-800 rounded-lg shadow-lg p-12 text-center\">\n          <p className=\"text-gray-400 text-lg\">Nenhum repasse encontrado com os filtros selecionados.</p>\n        </div>\n      )}\n\n      {/* Process Modal */}\n      {showProcessModal && selectedRepasse && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n          <div className=\"bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4\">\n            <h3 className=\"text-xl font-bold text-white mb-4\">Processar Pagamento</h3>\n            \n            <div className=\"bg-gray-700 rounded-lg p-4 mb-4 space-y-2\">\n              <div className=\"flex justify-between\">\n                <span className=\"text-gray-400\">Loja:</span>\n                <span className=\"text-white font-medium\">{selectedRepasse.loja_nome}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-gray-400\">Período:</span>\n                <span className=\"text-white font-medium\">\n                  {new Date(selectedRepasse.periodo_inicio).toLocaleDateString('pt-BR')} - {new Date(selectedRepasse.periodo_fim).toLocaleDateString('pt-BR')}\n                </span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-gray-400\">Valor Bruto:</span>\n                <span className=\"text-white font-medium\">R$ {selectedRepasse.valor_bruto.toFixed(2)}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-gray-400\">Comissão:</span>\n                <span className=\"text-red-400 font-medium\">- R$ {selectedRepasse.comissao.toFixed(2)}</span>\n              </div>\n              <div className=\"border-t border-gray-600 pt-2 mt-2 flex justify-between\">\n                <span className=\"text-gray-300 font-semibold\">Valor a Pagar:</span>\n                <span className=\"text-green-400 font-bold text-lg\">R$ {selectedRepasse.valor_liquido.toFixed(2)}</span>\n              </div>\n            </div>\n\n            <p className=\"text-yellow-400 text-sm mb-4\">\n              ⚠️ Esta ação marcará o repasse como processado. Confirme que o pagamento foi realizado.\n            </p>\n            \n            <div className=\"flex space-x-3\">\n              <button\n                onClick={confirmProcessar}\n                className=\"flex-1 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition font-medium\"\n              >\n                Confirmar Pagamento\n              </button>\n              <button\n                onClick={() => setShowProcessModal(false)}\n                className=\"flex-1 bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition font-medium\"\n              >\n                Cancelar\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n","size_bytes":18119},"pedai-nextjs/app/api/admin/financeiro/gerar-repasse/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { createClient } from '@/lib/supabase/server'\n\nexport async function POST(request: NextRequest) {\n  try {\n    const supabase = await createClient()\n    \n    const { data: { user } } = await supabase.auth.getUser()\n    \n    if (!user) {\n      return NextResponse.json({ error: 'Não autenticado' }, { status: 401 })\n    }\n\n    const { data: perfil } = await supabase\n      .from('perfis')\n      .select('*')\n      .eq('user_id', user.id)\n      .single()\n\n    if (!perfil || perfil.tipo !== 'admin') {\n      return NextResponse.json({ error: 'Acesso negado' }, { status: 403 })\n    }\n\n    const body = await request.json()\n    const { loja_id, periodo_inicio, periodo_fim } = body\n\n    if (!loja_id || !periodo_inicio || !periodo_fim) {\n      return NextResponse.json({ \n        error: 'loja_id, periodo_inicio e periodo_fim são obrigatórios' \n      }, { status: 400 })\n    }\n\n    const { data: pedidos } = await supabase\n      .from('pedidos')\n      .select('total, taxa_entrega')\n      .eq('loja_id', loja_id)\n      .gte('created_at', periodo_inicio)\n      .lte('created_at', periodo_fim)\n      .in('status', ['entregue', 'pronto', 'em_entrega'])\n\n    const { data: loja } = await supabase\n      .from('lojas')\n      .select('comissao_plataforma')\n      .eq('id', loja_id)\n      .single()\n\n    const valor_bruto = pedidos?.reduce((sum, p) => sum + parseFloat(p.total || '0'), 0) || 0\n    const taxas_entrega = pedidos?.reduce((sum, p) => sum + parseFloat(p.taxa_entrega || '0'), 0) || 0\n    const comissao_percentual = loja?.comissao_plataforma || 10\n    const comissao_plataforma = (valor_bruto * comissao_percentual) / 100\n    const valor_liquido = valor_bruto - comissao_plataforma\n\n    const { data: repasse, error } = await supabase\n      .from('repasses_financeiros')\n      .insert({\n        loja_id,\n        periodo_inicio,\n        periodo_fim,\n        total_pedidos: pedidos?.length || 0,\n        valor_bruto,\n        comissao_plataforma,\n        taxas_entrega,\n        valor_liquido,\n        status: 'pendente',\n        criado_por: perfil.id,\n      })\n      .select()\n      .single()\n\n    if (error) {\n      return NextResponse.json({ error: error.message }, { status: 500 })\n    }\n\n    await supabase\n      .from('auditoria')\n      .insert({\n        usuario_id: perfil.id,\n        usuario_email: perfil.email,\n        usuario_nome: perfil.nome_completo,\n        acao: 'GERAR_REPASSE',\n        entidade: 'repasses_financeiros',\n        entidade_id: repasse.id,\n        dados_novos: repasse,\n      })\n\n    return NextResponse.json({ repasse, message: 'Repasse gerado com sucesso' })\n  } catch (error: any) {\n    return NextResponse.json({ error: error.message }, { status: 500 })\n  }\n}\n","size_bytes":2759},"pedai-nextjs/app/api/admin/usuarios/resetar-senha/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { createClient } from '@/lib/supabase/server'\nimport { createClient as createServiceClient } from '@supabase/supabase-js'\n\nexport async function POST(request: NextRequest) {\n  try {\n    const supabase = await createClient()\n    \n    const { data: { user } } = await supabase.auth.getUser()\n    \n    if (!user) {\n      return NextResponse.json({ error: 'Não autenticado' }, { status: 401 })\n    }\n\n    const { data: perfil } = await supabase\n      .from('perfis')\n      .select('*')\n      .eq('user_id', user.id)\n      .single()\n\n    if (!perfil || perfil.tipo !== 'admin') {\n      return NextResponse.json({ error: 'Acesso negado' }, { status: 403 })\n    }\n\n    const body = await request.json()\n    const { email } = body\n\n    if (!email) {\n      return NextResponse.json({ error: 'Email é obrigatório' }, { status: 400 })\n    }\n\n    const serviceSupabase = createServiceClient(\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\n      process.env.SUPABASE_SERVICE_ROLE_KEY!\n    )\n\n    const { error: resetError } = await serviceSupabase.auth.admin.generateLink({\n      type: 'recovery',\n      email: email,\n    })\n\n    if (resetError) {\n      return NextResponse.json({ error: resetError.message }, { status: 500 })\n    }\n\n    const { error: auditError } = await supabase\n      .from('auditoria')\n      .insert({\n        usuario_id: perfil.id,\n        usuario_email: perfil.email,\n        usuario_nome: perfil.nome_completo,\n        acao: 'RESETAR_SENHA_USUARIO',\n        entidade: 'perfis',\n        dados_novos: { email },\n      })\n\n    return NextResponse.json({ \n      message: 'Link de recuperação enviado para o email do usuário' \n    })\n  } catch (error: any) {\n    return NextResponse.json({ error: error.message }, { status: 500 })\n  }\n}\n","size_bytes":1811},"pedai-nextjs/app/api/admin/financeiro/processar/route.ts":{"content":"import { NextRequest, NextResponse } from 'next/server'\nimport { createClient } from '@/lib/supabase/server'\n\nexport async function POST(request: NextRequest) {\n  try {\n    const supabase = await createClient()\n    \n    const { data: { user } } = await supabase.auth.getUser()\n    \n    if (!user) {\n      return NextResponse.json({ error: 'Não autenticado' }, { status: 401 })\n    }\n\n    const { data: perfil } = await supabase\n      .from('perfis')\n      .select('*')\n      .eq('user_id', user.id)\n      .single()\n\n    if (!perfil || perfil.tipo !== 'admin') {\n      return NextResponse.json({ error: 'Acesso negado' }, { status: 403 })\n    }\n\n    const body = await request.json()\n    const { repasse_id, status, observacoes } = body\n\n    if (!repasse_id || !status) {\n      return NextResponse.json({ \n        error: 'repasse_id e status são obrigatórios' \n      }, { status: 400 })\n    }\n\n    const updates: any = {\n      status,\n      processado_por: perfil.id,\n      observacoes,\n    }\n\n    if (status === 'pago') {\n      updates.data_pagamento = new Date().toISOString()\n    }\n\n    const { data: repasse, error } = await supabase\n      .from('repasses_financeiros')\n      .update(updates)\n      .eq('id', repasse_id)\n      .select()\n      .single()\n\n    if (error) {\n      return NextResponse.json({ error: error.message }, { status: 500 })\n    }\n\n    await supabase\n      .from('auditoria')\n      .insert({\n        usuario_id: perfil.id,\n        usuario_email: perfil.email,\n        usuario_nome: perfil.nome_completo,\n        acao: 'PROCESSAR_REPASSE',\n        entidade: 'repasses_financeiros',\n        entidade_id: repasse_id,\n        dados_novos: updates,\n      })\n\n    return NextResponse.json({ repasse, message: 'Repasse processado com sucesso' })\n  } catch (error: any) {\n    return NextResponse.json({ error: error.message }, { status: 500 })\n  }\n}\n","size_bytes":1868},"pedai-nextjs/app/admin/loja/[lojaId]/dashboard/page.tsx":{"content":"import AdminLojaDashboard from '@/components/admin/loja/AdminLojaDashboard'\n\nexport default function AdminLojaDashboardPage({ params }: { params: { lojaId: string } }) {\n  return <AdminLojaDashboard lojaId={params.lojaId} />\n}\n","size_bytes":227},"pedai-nextjs/app/api/auth/login/route.ts":{"content":"import { createClient } from '@/lib/supabase/server'\nimport { createClient as createServiceClient } from '@supabase/supabase-js'\nimport { NextResponse } from 'next/server'\n\nexport async function POST(request: Request) {\n  try {\n    const { email, password } = await request.json()\n\n    if (!email || !password) {\n      return NextResponse.json(\n        { error: 'Email e senha são obrigatórios' },\n        { status: 400 }\n      )\n    }\n\n    const supabase = await createClient()\n\n    // Authenticate user\n    const { data: authData, error: authError } = await supabase.auth.signInWithPassword({\n      email,\n      password,\n    })\n\n    if (authError) {\n      return NextResponse.json(\n        { error: authError.message },\n        { status: 401 }\n      )\n    }\n\n    if (!authData.user) {\n      return NextResponse.json(\n        { error: 'Erro ao fazer login' },\n        { status: 401 }\n      )\n    }\n\n    // Create service role client to bypass RLS\n    const supabaseAdmin = createServiceClient(\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\n      process.env.SUPABASE_SERVICE_ROLE_KEY!,\n      {\n        auth: {\n          autoRefreshToken: false,\n          persistSession: false,\n        },\n      }\n    )\n\n    // Get user profile using service role (bypasses RLS)\n    const { data: perfil, error: perfilError } = await supabaseAdmin\n      .from('perfis')\n      .select('*')\n      .eq('user_id', authData.user.id)\n      .maybeSingle()\n\n    if (perfilError) {\n      console.error('Error fetching profile:', perfilError)\n      return NextResponse.json(\n        { error: 'Erro ao buscar perfil do usuário' },\n        { status: 500 }\n      )\n    }\n\n    if (!perfil) {\n      return NextResponse.json(\n        { error: 'Perfil de usuário não encontrado. Entre em contato com o suporte.' },\n        { status: 404 }\n      )\n    }\n\n    // Check if user is blocked\n    if (perfil.bloqueado) {\n      return NextResponse.json(\n        { \n          error: `Usuário bloqueado: ${perfil.bloqueado_motivo || 'Entre em contato com o suporte'}` \n        },\n        { status: 403 }\n      )\n    }\n\n    // Return success with profile\n    return NextResponse.json({\n      success: true,\n      user: authData.user,\n      perfil,\n    })\n\n  } catch (error: any) {\n    console.error('Login error:', error)\n    return NextResponse.json(\n      { error: error.message || 'Erro ao fazer login' },\n      { status: 500 }\n    )\n  }\n}\n","size_bytes":2405},"pedai-nextjs/components/admin/AdminDashboard.tsx":{"content":"'use client'\n\nimport { useEffect, useState } from 'react'\nimport { createClient } from '@/lib/supabase/client'\nimport { useRouter } from 'next/navigation'\nimport Link from 'next/link'\n\ninterface Stats {\n  totalLojas: number\n  totalPedidos: number\n  totalClientes: number\n  receitaTotal: number\n}\n\ninterface Loja {\n  id: number\n  nome_loja: string\n  municipio: string\n}\n\nexport default function AdminDashboard() {\n  const router = useRouter()\n  const [loading, setLoading] = useState(true)\n  const [stats, setStats] = useState<Stats>({\n    totalLojas: 0,\n    totalPedidos: 0,\n    totalClientes: 0,\n    receitaTotal: 0,\n  })\n  const [lojas, setLojas] = useState<Loja[]>([])\n\n  useEffect(() => {\n    checkAuthAndLoadStats()\n  }, [])\n\n  const checkAuthAndLoadStats = async () => {\n    const supabase = createClient()\n    \n    const { data: { user } } = await supabase.auth.getUser()\n    \n    if (!user) {\n      router.push('/auth/login')\n      return\n    }\n\n    // Get profile via API (bypasses RLS)\n    // Send cookies for server-side session validation\n    const profileResponse = await fetch('/api/auth/get-profile', {\n      credentials: 'include'\n    })\n    const profileData = await profileResponse.json()\n\n    if (!profileResponse.ok || !profileData.perfil || profileData.perfil.tipo !== 'admin') {\n      router.push('/')\n      return\n    }\n\n    // Load platform stats\n    const { count: lojasCount } = await supabase\n      .from('lojas')\n      .select('*', { count: 'exact', head: true })\n\n    const { count: pedidosCount } = await supabase\n      .from('pedidos')\n      .select('*', { count: 'exact', head: true })\n\n    const { count: clientesCount } = await supabase\n      .from('perfis')\n      .select('*', { count: 'exact', head: true })\n      .eq('tipo', 'cliente')\n\n    const { data: pedidos } = await supabase\n      .from('pedidos')\n      .select('total')\n      .not('status', 'eq', 'cancelado')\n\n    const receitaTotal = pedidos?.reduce((sum, p) => sum + (p.total || 0), 0) || 0\n\n    // Load all lojas\n    const { data: lojasData } = await supabase\n      .from('lojas')\n      .select('id, nome_loja, municipio')\n      .order('municipio')\n\n    setStats({\n      totalLojas: lojasCount || 0,\n      totalPedidos: pedidosCount || 0,\n      totalClientes: clientesCount || 0,\n      receitaTotal: receitaTotal,\n    })\n\n    setLojas(lojasData || [])\n    setLoading(false)\n  }\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900 mx-auto\"></div>\n          <p className=\"mt-4 text-gray-600\">Carregando...</p>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <div className=\"max-w-7xl mx-auto px-4 py-8\">\n        {/* Header */}\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-bold text-gray-900\">Painel Administrativo</h1>\n          <p className=\"text-gray-600 mt-2\">Visão geral da plataforma PedeAí</p>\n        </div>\n\n        {/* Stats Grid */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8\">\n          <div className=\"bg-white rounded-lg shadow p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm text-gray-600\">Total de Lojas</p>\n                <p className=\"text-3xl font-bold text-gray-900\">{stats.totalLojas}</p>\n              </div>\n              <div className=\"bg-blue-100 p-3 rounded-full\">\n                <svg className=\"w-6 h-6 text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4\" />\n                </svg>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"bg-white rounded-lg shadow p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm text-gray-600\">Total de Pedidos</p>\n                <p className=\"text-3xl font-bold text-gray-900\">{stats.totalPedidos}</p>\n              </div>\n              <div className=\"bg-green-100 p-3 rounded-full\">\n                <svg className=\"w-6 h-6 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z\" />\n                </svg>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"bg-white rounded-lg shadow p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm text-gray-600\">Total de Clientes</p>\n                <p className=\"text-3xl font-bold text-gray-900\">{stats.totalClientes}</p>\n              </div>\n              <div className=\"bg-purple-100 p-3 rounded-full\">\n                <svg className=\"w-6 h-6 text-purple-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z\" />\n                </svg>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"bg-white rounded-lg shadow p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm text-gray-600\">Receita Total</p>\n                <p className=\"text-3xl font-bold text-gray-900\">\n                  R$ {stats.receitaTotal.toFixed(2)}\n                </p>\n              </div>\n              <div className=\"bg-yellow-100 p-3 rounded-full\">\n                <svg className=\"w-6 h-6 text-yellow-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                </svg>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Navigation Cards */}\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8\">\n          <div className=\"bg-white rounded-lg shadow p-6 border-2 border-blue-500\">\n            <div className=\"flex items-center mb-4\">\n              <div className=\"bg-blue-100 p-3 rounded-full mr-4\">\n                <svg className=\"w-8 h-8 text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4\" />\n                </svg>\n              </div>\n              <div>\n                <h3 className=\"text-xl font-bold text-gray-900\">Área de Lojistas</h3>\n                <p className=\"text-sm text-gray-600\">Gerenciar pedidos e produtos</p>\n              </div>\n            </div>\n            <p className=\"text-gray-500 text-sm mb-4\">Selecione uma loja para gerenciar:</p>\n            <select\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              onChange={(e) => {\n                if (e.target.value) {\n                  window.location.href = `/admin/loja/${e.target.value}/dashboard`\n                }\n              }}\n            >\n              <option value=\"\">Escolher loja...</option>\n              {lojas.map((loja) => (\n                <option key={loja.id} value={loja.id}>\n                  {loja.nome_loja} - {loja.municipio}\n                </option>\n              ))}\n            </select>\n          </div>\n\n          <Link href=\"/alagoa-nova\" className=\"bg-white rounded-lg shadow hover:shadow-lg transition p-6 border-2 border-transparent hover:border-yellow-500\">\n            <div className=\"flex items-center mb-4\">\n              <div className=\"bg-yellow-100 p-3 rounded-full mr-4\">\n                <svg className=\"w-8 h-8 text-yellow-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z\" />\n                </svg>\n              </div>\n              <div>\n                <h3 className=\"text-xl font-bold text-gray-900\">Área de Clientes</h3>\n                <p className=\"text-sm text-gray-600\">Navegar como cliente</p>\n              </div>\n            </div>\n            <p className=\"text-gray-500 text-sm\">Visualize a plataforma como um cliente nos municípios</p>\n          </Link>\n\n          <div className=\"bg-white rounded-lg shadow p-6 border-2 border-gray-300 opacity-50\">\n            <div className=\"flex items-center mb-4\">\n              <div className=\"bg-gray-100 p-3 rounded-full mr-4\">\n                <svg className=\"w-8 h-8 text-gray-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 10V3L4 14h7v7l9-11h-7z\" />\n                </svg>\n              </div>\n              <div>\n                <h3 className=\"text-xl font-bold text-gray-900\">Área de Entregadores</h3>\n                <p className=\"text-sm text-gray-600\">Em breve</p>\n              </div>\n            </div>\n            <p className=\"text-gray-500 text-sm\">Funcionalidade em desenvolvimento</p>\n          </div>\n        </div>\n\n        {/* Lojas por Município */}\n        <div className=\"bg-white rounded-lg shadow p-6\">\n          <h2 className=\"text-xl font-bold text-gray-900 mb-4\">Lojas Cadastradas</h2>\n          <div className=\"space-y-4\">\n            {['Alagoa Nova', 'Esperança', 'Lagoa Seca'].map((municipio) => {\n              const lojasDoMunicipio = lojas.filter(l => l.municipio === municipio)\n              return (\n                <div key={municipio} className=\"border-b pb-4 last:border-b-0\">\n                  <h3 className=\"font-semibold text-gray-900 mb-2\">{municipio}</h3>\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2\">\n                    {lojasDoMunicipio.length > 0 ? (\n                      lojasDoMunicipio.map((loja) => (\n                        <div key={loja.id} className=\"text-sm text-gray-600 bg-gray-50 p-2 rounded\">\n                          {loja.nome_loja}\n                        </div>\n                      ))\n                    ) : (\n                      <p className=\"text-sm text-gray-400\">Nenhuma loja cadastrada</p>\n                    )}\n                  </div>\n                </div>\n              )\n            })}\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n","size_bytes":11052},"pedai-nextjs/app/test-login/page.tsx":{"content":"'use client'\n\nimport { useState } from 'react'\nimport { createClient } from '@/lib/supabase/client'\n\nexport default function TestLogin() {\n  const [status, setStatus] = useState('')\n  const [logs, setLogs] = useState<string[]>([])\n\n  const addLog = (msg: string) => {\n    console.log(msg)\n    setLogs(prev => [...prev, `[${new Date().toLocaleTimeString()}] ${msg}`])\n  }\n\n  const testLogin = async () => {\n    setStatus('Testando...')\n    setLogs([])\n\n    try {\n      addLog('1. Criando cliente Supabase...')\n      const supabase = createClient()\n\n      addLog('2. Tentando fazer login com admin@pedai.com...')\n      const { data: authData, error: authError } = await supabase.auth.signInWithPassword({\n        email: 'admin@pedai.com',\n        password: 'admin123',\n      })\n\n      if (authError) {\n        addLog(`❌ ERRO DE AUTENTICAÇÃO: ${authError.message}`)\n        setStatus('Erro no login')\n        return\n      }\n\n      addLog(`✅ Login bem-sucedido! User ID: ${authData.user?.id}`)\n\n      addLog('3. Verificando sessão via getSession()...')\n      const { data: { session: currentSession } } = await supabase.auth.getSession()\n      if (currentSession) {\n        addLog(`✅ Sessão encontrada! Expires: ${new Date(currentSession.expires_at! * 1000).toLocaleString()}`)\n      } else {\n        addLog('❌ Sessão não encontrada via getSession()!')\n      }\n\n      addLog('3b. Verificando cookies no navegador...')\n      const cookies = document.cookie\n      if (cookies.includes('sb-')) {\n        addLog(`✅ Cookies Supabase encontrados: ${cookies.substring(0, 100)}...`)\n      } else {\n        addLog(`❌ Nenhum cookie Supabase encontrado! Cookies: ${cookies || '(vazio)'}`)\n      }\n\n      addLog('3c. Verificando usuário via getUser()...')\n      const { data: { user: currentUser } } = await supabase.auth.getUser()\n      if (currentUser) {\n        addLog(`✅ getUser() retornou: ${currentUser.id}`)\n      } else {\n        addLog('❌ getUser() não retornou usuário!')\n      }\n\n      addLog('4. Chamando API /api/auth/get-profile...')\n      const { data: { session: apiSession } } = await supabase.auth.getSession()\n      const response = await fetch('/api/auth/get-profile', {\n        headers: apiSession ? {\n          'Authorization': `Bearer ${apiSession.access_token}`\n        } : {}\n      })\n      const data = await response.json()\n\n      if (response.ok) {\n        addLog(`✅ Perfil recebido: ${JSON.stringify(data.perfil)}`)\n        setStatus('Sucesso total!')\n      } else {\n        addLog(`❌ Erro ao buscar perfil: ${data.error}`)\n        setStatus('Login OK, mas perfil falhou')\n      }\n\n    } catch (error: any) {\n      addLog(`❌ ERRO FATAL: ${error.message}`)\n      setStatus('Erro fatal')\n    }\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-900 text-white p-8\">\n      <div className=\"max-w-4xl mx-auto\">\n        <h1 className=\"text-3xl font-bold mb-6\">🔧 Teste de Login</h1>\n        \n        <button\n          onClick={testLogin}\n          className=\"px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-bold mb-6\"\n        >\n          Testar Login Admin\n        </button>\n\n        {status && (\n          <div className=\"mb-4 p-4 bg-gray-800 rounded-lg\">\n            <strong>Status:</strong> {status}\n          </div>\n        )}\n\n        <div className=\"bg-gray-800 rounded-lg p-4\">\n          <h2 className=\"font-bold mb-2\">Logs:</h2>\n          <div className=\"space-y-1 font-mono text-sm\">\n            {logs.length === 0 ? (\n              <p className=\"text-gray-500\">Clique no botão para iniciar o teste</p>\n            ) : (\n              logs.map((log, i) => (\n                <div key={i} className=\"text-green-400\">{log}</div>\n              ))\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n","size_bytes":3784},"pedai-nextjs/components/clientes/MeusPedidosContent.tsx":{"content":"'use client'\n\nimport Link from 'next/link'\nimport type { TenantConfig } from '@/lib/types/tenant'\n\ninterface Perfil {\n  id: number\n  nome_completo: string\n  email: string\n}\n\ninterface Loja {\n  id: number\n  nome_loja: string\n}\n\ninterface PedidoItem {\n  id: number\n  produto_id: number\n  nome_produto: string\n  quantidade: number\n  preco_unitario: number\n  subtotal: number\n}\n\ninterface Pedido {\n  id: number\n  numero_pedido: string\n  status: string\n  valor_total: number\n  taxa_entrega: number\n  endereco_entrega: string\n  forma_pagamento: string\n  created_at: string\n  lojas: Loja\n  pedido_itens: PedidoItem[]\n}\n\ninterface MeusPedidosContentProps {\n  pedidos: Pedido[]\n  tenant: TenantConfig\n  perfil: Perfil\n}\n\nconst STATUS_CONFIG: Record<string, { label: string; color: string; bgColor: string }> = {\n  pendente: { label: 'Pendente', color: 'text-yellow-500', bgColor: 'bg-yellow-500/10' },\n  confirmado: { label: 'Confirmado', color: 'text-blue-500', bgColor: 'bg-blue-500/10' },\n  preparando: { label: 'Preparando', color: 'text-purple-500', bgColor: 'bg-purple-500/10' },\n  em_entrega: { label: 'Em Entrega', color: 'text-cyan-500', bgColor: 'bg-cyan-500/10' },\n  entregue: { label: 'Entregue', color: 'text-green-500', bgColor: 'bg-green-500/10' },\n  cancelado: { label: 'Cancelado', color: 'text-red-500', bgColor: 'bg-red-500/10' },\n}\n\nexport default function MeusPedidosContent({ pedidos, tenant, perfil }: MeusPedidosContentProps) {\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900\">\n      {/* Header */}\n      <div className=\"bg-gray-900 border-b border-gray-800\">\n        <div className=\"container mx-auto px-4 py-8\">\n          <div className=\"flex items-center gap-2 text-sm text-gray-400 mb-4\">\n            <Link href={`/${tenant.slug}`} className=\"hover:text-tenant-primary transition-colors\">\n              Início\n            </Link>\n            <span>›</span>\n            <span className=\"text-white\">Meus Pedidos</span>\n          </div>\n\n          <h1 className=\"text-4xl font-bold text-white mb-2\">\n            Meus Pedidos\n          </h1>\n          <p className=\"text-gray-400\">\n            Olá, {perfil.nome_completo.split(' ')[0]}! Acompanhe seus pedidos aqui\n          </p>\n        </div>\n      </div>\n\n      {/* Lista de Pedidos */}\n      <div className=\"container mx-auto px-4 py-8\">\n        {pedidos.length === 0 ? (\n          <div className=\"text-center py-16\">\n            <div className=\"text-6xl mb-4\">📦</div>\n            <h3 className=\"text-2xl font-bold text-white mb-2\">\n              Você ainda não fez nenhum pedido\n            </h3>\n            <p className=\"text-gray-400 mb-6\">\n              Explore as lojas e faça seu primeiro pedido!\n            </p>\n            <Link\n              href={`/${tenant.slug}/lojas`}\n              className=\"inline-block px-8 py-3 bg-tenant-primary text-tenant-secondary rounded-lg font-semibold hover:opacity-90 transition-opacity\"\n            >\n              Ver Lojas\n            </Link>\n          </div>\n        ) : (\n          <div className=\"space-y-6 max-w-4xl mx-auto\">\n            {pedidos.map((pedido) => {\n              const statusInfo = STATUS_CONFIG[pedido.status] || STATUS_CONFIG.pendente\n              const dataFormatada = new Date(pedido.created_at).toLocaleString('pt-BR', {\n                day: '2-digit',\n                month: '2-digit',\n                year: 'numeric',\n                hour: '2-digit',\n                minute: '2-digit',\n              })\n\n              return (\n                <div\n                  key={pedido.id}\n                  className=\"bg-gray-800 rounded-xl overflow-hidden border border-gray-700 hover:border-tenant-primary transition-colors\"\n                >\n                  {/* Cabeçalho do Pedido */}\n                  <div className=\"p-6 border-b border-gray-700\">\n                    <div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-4\">\n                      <div>\n                        <div className=\"flex items-center gap-3 mb-2\">\n                          <h3 className=\"text-xl font-bold text-white\">\n                            Pedido #{pedido.numero_pedido}\n                          </h3>\n                          <span className={`px-3 py-1 rounded-full text-sm font-medium ${statusInfo.color} ${statusInfo.bgColor}`}>\n                            {statusInfo.label}\n                          </span>\n                        </div>\n                        <p className=\"text-gray-400 text-sm\">\n                          📅 {dataFormatada}\n                        </p>\n                      </div>\n\n                      <div className=\"text-right\">\n                        <div className=\"text-sm text-gray-400 mb-1\">Loja</div>\n                        <div className=\"font-semibold text-white\">\n                          {pedido.lojas.nome_loja}\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Itens do Pedido */}\n                  <div className=\"p-6 bg-gray-900/50\">\n                    <h4 className=\"text-sm font-semibold text-gray-400 mb-3\">\n                      Itens do Pedido\n                    </h4>\n                    <div className=\"space-y-2\">\n                      {pedido.pedido_itens.map((item) => (\n                        <div\n                          key={item.id}\n                          className=\"flex items-center justify-between text-sm\"\n                        >\n                          <div className=\"flex items-center gap-2\">\n                            <span className=\"text-tenant-primary font-medium\">\n                              {item.quantidade}x\n                            </span>\n                            <span className=\"text-white\">{item.nome_produto}</span>\n                          </div>\n                          <span className=\"text-gray-400\">\n                            R$ {item.subtotal.toFixed(2)}\n                          </span>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n\n                  {/* Rodapé do Pedido */}\n                  <div className=\"p-6 border-t border-gray-700\">\n                    <div className=\"space-y-2\">\n                      <div className=\"flex items-center justify-between text-sm\">\n                        <span className=\"text-gray-400\">Subtotal</span>\n                        <span className=\"text-white\">\n                          R$ {(pedido.valor_total - pedido.taxa_entrega).toFixed(2)}\n                        </span>\n                      </div>\n                      <div className=\"flex items-center justify-between text-sm\">\n                        <span className=\"text-gray-400\">Taxa de Entrega</span>\n                        <span className=\"text-white\">\n                          R$ {pedido.taxa_entrega.toFixed(2)}\n                        </span>\n                      </div>\n                      <div className=\"flex items-center justify-between pt-2 border-t border-gray-700\">\n                        <span className=\"text-lg font-bold text-white\">Total</span>\n                        <span className=\"text-2xl font-bold text-tenant-primary\">\n                          R$ {pedido.valor_total.toFixed(2)}\n                        </span>\n                      </div>\n                    </div>\n\n                    <div className=\"mt-4 pt-4 border-t border-gray-700 space-y-2 text-sm text-gray-400\">\n                      <div>\n                        <span className=\"font-medium\">Endereço:</span> {pedido.endereco_entrega}\n                      </div>\n                      <div>\n                        <span className=\"font-medium\">Pagamento:</span>{' '}\n                        {pedido.forma_pagamento === 'dinheiro' && 'Dinheiro'}\n                        {pedido.forma_pagamento === 'pix' && 'PIX'}\n                        {pedido.forma_pagamento === 'cartao' && 'Cartão'}\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              )\n            })}\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\n","size_bytes":8180},"pedai-nextjs/app/[municipio]/meus-pedidos/page.tsx":{"content":"import { getTenantBySlug } from '@/lib/tenantConfig'\nimport { notFound, redirect } from 'next/navigation'\nimport { createClient } from '@/lib/supabase/server'\nimport ClientLayout from '@/components/ClientLayout'\nimport MeusPedidosContent from '@/components/clientes/MeusPedidosContent'\n\ninterface Props {\n  params: Promise<{ municipio: string }>\n}\n\nexport default async function MeusPedidosPage({ params }: Props) {\n  const { municipio } = await params\n  \n  const tenant = getTenantBySlug(municipio)\n  \n  if (!tenant) {\n    notFound()\n  }\n\n  const supabase = await createClient()\n  \n  const { data: { session } } = await supabase.auth.getSession()\n  \n  if (!session) {\n    redirect(`/${municipio}/auth/login?redirect=/${municipio}/meus-pedidos`)\n  }\n\n  const { data: perfil } = await supabase\n    .from('perfis')\n    .select('*')\n    .eq('user_id', session.user.id)\n    .single()\n\n  if (!perfil || perfil.tipo !== 'cliente') {\n    redirect(`/${municipio}`)\n  }\n\n  const { data: pedidos, error } = await supabase\n    .from('pedidos')\n    .select(`\n      *,\n      lojas:loja_id (\n        id,\n        nome_loja\n      ),\n      pedido_itens (\n        id,\n        produto_id,\n        nome_produto,\n        quantidade,\n        preco_unitario,\n        subtotal\n      )\n    `)\n    .eq('perfil_id', perfil.id)\n    .order('created_at', { ascending: false })\n\n  if (error) {\n    console.error('Erro ao carregar pedidos:', error)\n  }\n\n  return (\n    <ClientLayout tenant={tenant}>\n      <MeusPedidosContent \n        pedidos={pedidos || []} \n        tenant={tenant}\n        perfil={perfil}\n      />\n    </ClientLayout>\n  )\n}\n","size_bytes":1611}},"version":2}